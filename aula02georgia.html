<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>Simulado Aula 02 Geórgia</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      background-color: #f4f4f4;
    }

    .quiz-container {
      max-width: 800px;
      width: 100%;
    }

    h1 {
      color: #333;
      text-align: center;
      margin-bottom: 30px;
    }

    .card {
      background-color: white;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .question {
      font-weight: bold;
      margin-bottom: 10px;
      color: #333;
    }

    .options {
      margin-top: 15px;
    }

    /* Estilos unificados para todas as opções (estáticas e dinâmicas) */
    .option, label.option, label, #newQuestionsContent label {
      display: flex; /* Para alinhar imagem e texto */
      align-items: center;
      margin-bottom: 10px;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.2s ease;
      position: relative; /* Para posicionar a tesoura */
    }

    /* FORÇA a remoção de inputs de radio em QUALQUER lugar */
    .option input[type="radio"], 
    label input[type="radio"],
    #newQuestionsContent input[type="radio"],
    #newQuestionsContent label input[type="radio"] {
        display: none !important;
        visibility: hidden !important;
        opacity: 0 !important;
        position: absolute !important;
        left: -9999px !important;
    }

    .option:hover, 
    label.option:hover, 
    label:hover,
    #newQuestionsContent label:hover {
      background-color: #e9e9e9;
    }

    .option.selected, 
    label.option.selected, 
    label.selected,
    #newQuestionsContent label.selected {
      background-color: #d1e7dd;
      border-color: #28a745;
    }

    .option.correct, 
    label.option.correct, 
    label.correct,
    #newQuestionsContent label.correct {
      background-color: #d4edda;
      border-color: #28a745;
    }

    .option.incorrect, 
    label.option.incorrect, 
    label.incorrect,
    #newQuestionsContent label.incorrect {
      background-color: #f8d7da;
      border-color: #dc3545;
    }

    .submit-btn {
      display: block;
      width: 100%;
      padding: 15px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 18px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      margin-top: 30px;
    }

    .submit-btn:hover {
      background-color: #0056b3;
    }

    .results {
      text-align: center;
      margin-top: 30px;
      font-size: 20px;
      font-weight: bold;
      color: #333;
    }

    .scissor-icon {
      margin-right: 10px; /* Espaço entre a tesoura e o texto da opção */
      width: 20px; /* Ajuste conforme o tamanho da sua imagem */
      height: 20px; /* Ajuste conforme o tamanho da sua imagem */
      opacity: 0.5; /* Transparência como no original */
      cursor: pointer;
    }

    .scissor-icon.hidden {
      display: none;
    }

    .struck-through {
      text-decoration: line-through;
      color: #888;
    }

    .comment {
      margin-top: 10px;
      padding: 10px;
      background-color: #f0f0f0;
      border-left: 4px solid #007bff;
      font-style: italic;
      color: #555;
      display: none; /* Escondido por padrão */
    }
    .comment.show {
      display: block; /* Mostrado quando ativado */
    }

    /* Estilos para o botão de navegação de erro / diagnóstico */
    .error-nav-btn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: #dc3545; /* Vermelho para erro */
      color: white;
      border: none;
      border-radius: 50%; /* Torna o botão redondo */
      width: 60px;
      height: 60px;
      font-size: 24px;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      z-index: 1000;
      display: none; /* Escondido por padrão */
      flex-direction: column; /* Para empilhar o ícone e o contador */
      padding: 5px; /* Ajuste o padding para acomodar texto maior */
      box-sizing: border-box; /* Garante que padding não aumente o tamanho total */
      text-align: center;
    }

    .error-nav-btn:hover {
      background-color: #c82333;
    }

    .error-nav-btn .arrow-icon {
      font-size: 30px; /* Tamanho da seta */
      line-height: 1; /* Ajuste para centralizar */
    }

    .error-nav-btn .button-text {
      font-size: 12px; /* Tamanho do texto abaixo da seta */
      line-height: 1;
      margin-top: 2px; /* Espaço entre a seta e o texto */
    }

    /* Estilos para a seção de diagnóstico de erros */
    .error-diagnosis-section {
        margin-top: 50px;
        padding: 30px;
        background-color: #ffe0b2; /* Um laranja claro ou similar */
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.15);
        display: none; /* Escondido por padrão */
        text-align: center;
        font-size: 1.1em;
        color: #333;
    }

    .error-diagnosis-section h2 {
        color: #e65100; /* Laranja mais escuro */
        margin-bottom: 20px;
        font-size: 1.8em;
    }

    .error-diagnosis-section ul {
        list-style: none; /* Remove marcadores de lista */
        padding: 0;
        margin: 0;
    }

    .error-diagnosis-section li {
        background-color: #ff9800; /* Laranja */
        color: white;
        padding: 8px 15px;
        margin: 8px 0;
        border-radius: 5px;
        display: inline-block; /* Para que os itens fiquem lado a lado */
        margin-right: 10px;
        font-weight: bold;
    }
    .error-diagnosis-section li:last-child {
        margin-right: 0;
    }
 .card-bloco {
      border: 1px solid #ddd;
      border-radius: 6px;
      padding: 10px;
      background: #fff;
      margin-bottom: 20px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    }
  </style>
</head>
<body>
  <div class="quiz-container">
    <h1 style="text-align:center; margin-bottom: 30px;">Simulado Aula 02 Geórgia</h1>
    <div class="card-bloco" id="quiz"></div>
    <button class="submit-btn" id="verifyAnswersBtn">Verificar Respostas</button>

    <button class="generate-questions-btn submit-btn" id="generateNewQuestionsBtn" style="display:none;">
      Gerar Novas Perguntas
    </button>

    <div class="results card-bloco" id="results"></div>
    <div id="statusMessage" style="text-align: center; margin-top: 10px; font-weight: bold; color: #007bff;"></div>

    <div class="error-diagnosis-section card-bloco" id="errorDiagnosis">
      <h2>Diagnóstico de Erros</h2>
      <p>Parece que você precisa revisar os seguintes assuntos:</p>
      <ul id="topicsToReview"></ul>
    </div>

    <div class="generated-questions-section card-bloco" id="generatedQuestionsSection" style="display:none;">
      <h2>Novas Perguntas Geradas</h2>
      <div id="newQuestionsContent"></div>
    </div>
  </div>
  
  <button class="error-nav-btn" id="errorNavBtn" style="display:none;">
    <span class="arrow-icon"></span>
    <span class="button-text"></span>
  </button>

  <script>
    const quizContainer = document.getElementById("quiz");
    const resultsContainer = document.getElementById("results");
    const errorNavBtn = document.getElementById("errorNavBtn");
    const arrowIcon = errorNavBtn.querySelector(".arrow-icon");
    const buttonText = errorNavBtn.querySelector(".button-text");
    const errorDiagnosisSection = document.getElementById("errorDiagnosis");
    const topicsToReviewList = document.getElementById("topicsToReview");
    const generateNewQuestionsBtn = document.getElementById("generateNewQuestionsBtn");
    const generatedQuestionsSection = document.getElementById("generatedQuestionsSection");
    const newQuestionsContent = document.getElementById("newQuestionsContent");
    const statusMessage = document.getElementById("statusMessage");

    let wrongQuestionIndices = [];
    let errorCountByTopic = {};
    let totalAnsweredQuestionsByTopic = {};
    let currentWrongQuestionIndex = -1;
    let hasErrors = false;
    let isShowingErrors = false;
    let isShowingDiagnosis = false;

    // Inicializa a visibilidade das seções no carregamento
    errorDiagnosisSection.style.display = 'none';
    topicsToReviewList.innerHTML = '';
    statusMessage.textContent = '';

    const questions = [       {         question: "1. Qual das seguintes opções descreve corretamente a função do checkpoint G1?",         options: [           "a) Verificar se o DNA foi totalmente duplicado.",           "b) Separar as cromátides irmãs.",           "c) Analisar as condições externas e internas da célula, como a presença de nutrientes e fatores de crescimento, e verificar a integridade do DNA.",           "d) Sintetizar o RNA mensageiro.",         ],         correctAnswer: "c) Analisar as condições externas e internas da célula, como a presença de nutrientes e fatores de crescimento, e verificar a integridade do DNA.",         comment: "O checkpoint G1 é o primeiro ponto de controle do ciclo celular, onde a célula avalia se as condições ambientais (nutrientes e fatores de crescimento) são favoráveis e se o material genético está intacto antes de prosseguir com a duplicação do DNA.",         topic: "Checkpoints do Ciclo Celular",       },       {         question: "2. O que acontece se o DNA de uma célula for considerado danificado no checkpoint G1?",         options: [           "a) A célula avança para a fase S.",           "b) A proteína p53 é ativada para iniciar o processo de reparo ou apoptose.",           "c) A célula se divide imediatamente.",           "d) A transcrição gênica é acelerada.",         ],         correctAnswer: "b) A proteína p53 é ativada para iniciar o processo de reparo ou apoptose.",         comment: "A proteína p53, conhecida como 'guardiã do genoma', é ativada em resposta a danos no DNA. Ela pode tanto pausar o ciclo celular para permitir o reparo do DNA quanto induzir a apoptose (morte celular programada) se o dano for irreparável.",         topic: "Apoptose",       },       {         question: "3. Qual é a relação entre a proteína p53 e a p21?",         options: [           "a) A p53 inativa a p21 para permitir a proliferação celular.",           "b) A p21 ativa a p53 para iniciar a apoptose.",           "c) A p53 ativa a p21 para bloquear a CDK2 e pausar o ciclo celular.",           "d) A p21 ativa a CDK2 para promover a duplicação do DNA.",         ],         correctAnswer: "c) A p53 ativa a p21 para bloquear a CDK2 e pausar o ciclo celular.",         comment: "Quando o DNA está danificado, a p53 ativa a p21. A p21, por sua vez, age inibindo a CDK2, que é uma enzima crucial para a transição da fase G1 para a fase S. Esse bloqueio impede que a célula com DNA danificado se duplique.",         topic: "Ciclo Celular: Proteínas de Controle",       },       {         question: "4. A fase S do ciclo celular é caracterizada por qual evento principal?",         options: [           "a) Crescimento e expansão das organelas.",           "b) Duplicação do DNA.",           "c) Divisão celular (mitose).",           "d) Checagem final dos cromossomos.",         ],         correctAnswer: "b) Duplicação do DNA.",         comment: "A fase S, que significa 'síntese', é a etapa do ciclo celular dedicada exclusivamente à duplicação do material genético da célula, ou seja, do DNA.",         topic: "Fases do Ciclo Celular",       },       {         question: "5. Qual é o papel da ubiquitina no controle pós-traducional de proteínas?",         options: [           "a) Ativar a proteína para que ela comece a atuar.",           "b) Aumentar a estabilidade da proteína no citoplasma.",           "c) Marcar a proteína para ser degradada, ou seja, eliminada.",           "d) Ajudar a proteína a se ligar corretamente ao ribossomo.",         ],         correctAnswer: "c) Marcar a proteína para ser degradada, ou seja, eliminada.",         comment: "A ubiquitina é uma proteína que atua como um marcador. Ao se ligar a outra proteína, ela sinaliza para a maquinaria celular que essa proteína deve ser degradada, geralmente porque não é mais necessária ou está danificada.",         topic: "Controle Pós-traducional",       },       {         question: "6. A duplicação do DNA é descrita como um processo semiconservativo. O que isso significa?",         options: [           "a) O DNA se duplica em apenas uma direção.",           "b) Metade da fita original é conservada como molde, e a outra metade é recém-sintetizada.",           "c) Todo o DNA é copiado integralmente em uma nova fita.",           "d) Apenas uma das fitas do DNA é copiada.",         ],         correctAnswer: "b) Metade da fita original é conservada como molde, e a outra metade é recém-sintetizada.",         comment: "O modelo semiconservativo da duplicação do DNA indica que cada nova molécula de DNA é composta por uma fita original (molde) e uma fita recém-sintetizada, garantindo a conservação de metade do material genético original.",         topic: "Duplicação do DNA",       },       {         question: "7. Quais são as três fases que compõem a interfase?",         options: [           "a) G1, S e M.",           "b) S, G2 e M.",           "c) G1, S e G2.",           "d) G0, G1 e S.",         ],         correctAnswer: "c) G1, S e G2.",         comment: "A interfase é o período de preparação da célula para a divisão. Ela é composta por três subfases: G1 (crescimento), S (síntese de DNA) e G2 (crescimento final e verificação).",         topic: "Interfase",       },       {         question: "8. Por que a interfase é considerada a fase em que a célula mais trabalha?",         options: [           "a) Porque é o momento em que a mitose ocorre.",           "b) Porque a célula está em repouso e consumindo pouca energia.",           "c) Porque nela ocorrem a expansão de organelas, a duplicação do DNA e a preparação para a mitose.",           "d) Porque a p53 está constantemente ativada.",         ],         correctAnswer: "c) Porque nela ocorrem a expansão de organelas, a duplicação do DNA e a preparação para a mitose.",         comment: "Contrariando a ideia antiga de que a interfase era um período de inatividade, hoje se sabe que é a fase mais ativa da célula, onde ela cresce, duplica seu DNA e prepara todas as suas estruturas para a divisão celular subsequente.",         topic: "Metabolismo Celular",       },       {         question: "9. Qual é o principal objetivo do checkpoint G2?",         options: [           "a) Verificar a quantidade de nutrientes disponíveis.",           "b) Checar se a duplicação do DNA foi concluída corretamente.",           "c) Iniciar a condensação dos cromossomos.",           "d) Promover a tradução de proteínas.",         ],         correctAnswer: "b) Checar se a duplicação do DNA foi concluída corretamente.",         comment: "O checkpoint G2 garante que a célula só avance para a mitose se tiver concluído com sucesso a duplicação do DNA, evitando a divisão de células com material genético incompleto ou danificado.",         topic: "Checkpoints do Ciclo Celular",       },       {         question: "10. A proteína p53 é ativada em quais checkpoints do ciclo celular?",         options: [           "a) Apenas no checkpoint G1.",           "b) Apenas no checkpoint G2.",           "c) Apenas no checkpoint M.",           "d) Nos checkpoints G1 e G2.",         ],         correctAnswer: "d) Nos checkpoints G1 e G2.",         comment: "A p53 é ativada em ambos os checkpoints do núcleo interfásico (G1 e G2) para verificar a integridade do material genético e garantir que a célula não se divida com DNA danificado.",         topic: "Proteína p53",       },       {         question: "11. Qual é a função da CDK2 no ciclo celular?",         options: [           "a) Iniciar a degradação de proteínas.",           "b) Promover a transição da fase G1 para a fase S.",           "c) Replicar o DNA na fase S.",           "d) Descondensar a cromatina para a transcrição.",         ],         correctAnswer: "b) Promover a transição da fase G1 para a fase S.",         comment: "A CDK2, quando ativada, é responsável por impulsionar a célula da fase de crescimento (G1) para a fase de síntese (S), onde a duplicação do DNA ocorre. O bloqueio da CDK2 pela p21 impede essa transição.",         topic: "Ciclo Celular: Proteínas de Controle",       },       {         question: "12. O que acontece se o dano no DNA não puder ser reparado durante o checkpoint G1?",         options: [           "a) A célula se divide e forma células-filhas danificadas.",           "b) A célula entra em apoptose, um processo de morte celular programada.",           "c) O ciclo celular é reiniciado.",           "d) A transcrição de genes é acionada.",         ],         correctAnswer: "b) A célula entra em apoptose, um processo de morte celular programada.",         comment: "A p53 é um fator central na decisão de vida ou morte da célula. Se o dano no DNA é irreparável, a p53 induz a apoptose para eliminar a célula e evitar a propagação de mutações genéticas que podem levar ao câncer.",         topic: "Morte Celular",       },       {         question: "13. Qual é a diferença fundamental entre heterocromatina e eucromatina?",         options: [           "a) Heterocromatina é o DNA ativado, e eucromatina é o DNA inativo.",           "b) Heterocromatina é o DNA compactado e inacessível, enquanto eucromatina é o DNA afrouxado e acessível para transcrição.",           "c) Heterocromatina é o RNA mensageiro, e eucromatina é o DNA.",           "d) Heterocromatina contém éxons, e eucromatina contém íntrons.",         ],         correctAnswer: "b) Heterocromatina é o DNA compactado e inacessível, enquanto eucromatina é o DNA afrouxado e acessível para transcrição.",         comment: "A heterocromatina é a forma mais condensada e inacessível do DNA, que impede a transcrição. Já a eucromatina é a forma mais dispersa e acessível, que permite que a maquinaria celular leia os genes e os transcreva.",         topic: "Cromatina",       },       {         question: "14. A modificação da cromatina de heterocromatina para eucromatina ocorre através de qual processo?",         options: [           "a) Ubiquitinação.",           "b) Glicosilação.",           "c) Acetilação.",           "d) Fosforilação.",         ],         correctAnswer: "c) Acetilação.",         comment: "A acetilação das histonas é um processo epigenético que neutraliza suas cargas, enfraquecendo a ligação com o DNA e fazendo com que a cromatina se torne mais afrouxada e acessível, ou seja, eucromatina.",         topic: "Epigenética",       },       {         question: "15. Qual a função da RNA polimerase na expressão gênica?",         options: [           "a) Duplicar o DNA.",           "b) Ler a fita de DNA e sintetizar uma fita de RNA mensageiro.",           "c) Traduzir o RNA mensageiro em proteína.",           "d) Reparar danos no DNA.",         ],         correctAnswer: "b) Ler a fita de DNA e sintetizar uma fita de RNA mensageiro.",         comment: "A RNA polimerase é a enzima principal responsável pela transcrição. Ela se liga ao DNA e sintetiza uma cópia complementar de RNA a partir de um gene específico.",         topic: "Transcrição",       },       {         question: "16. Qual das seguintes características é exclusiva do RNA, não sendo encontrada no DNA?",         options: [           "a) Ser uma fita dupla.",           "b) Possuir a base nitrogenada timina.",           "c) Ser uma fita única.",           "d) Possuir a base nitrogenada adenina.",         ],         correctAnswer: "c) Ser uma fita única.",         comment: "O RNA é uma molécula de fita única, enquanto o DNA é uma fita dupla. Outra diferença fundamental é que no RNA a timina é substituída pela uracila.",         topic: "Estrutura do RNA",       },       {         question: "17. O que são os íntrons?",         options: [           "a) Partes do RNA mensageiro que codificam para proteínas.",           "b) Partes do DNA que são retiradas durante o processo de maturação do RNA.",           "c) Proteínas que se ligam ao DNA para formar a heterocromatina.",           "d) Complexos proteicos que realizam a tradução.",         ],         correctAnswer: "b) Partes do DNA que são retiradas durante o processo de maturação do RNA.",         comment: "Íntrons são sequências de DNA que são transcritas em RNA mensageiro, mas que não codificam proteínas. Eles são removidos durante o processo de splicing, para que o RNA mensageiro se torne maduro e funcional.",         topic: "Maturação do RNA",       },       {         question: "18. Qual é a função do \"cap\" 5' e da cauda poli-A no RNA mensageiro?",         options: [           "a) Direcionar o RNA mensageiro para o núcleo.",           "b) Protegê-lo da degradação e direcioná-lo para o ribossomo.",           "c) Remover os íntrons do RNA.",           "d) Ativar a tradução no ribossomo.",         ],         correctAnswer: "b) Protegê-lo da degradação e direcioná-lo para o ribossomo.",         comment: "O \"cap\" 5' e a cauda poli-A são modificações adicionadas ao pré-RNA mensageiro para protegê-lo de enzimas que poderiam degradá-lo. Eles também auxiliam no transporte do RNA para fora do núcleo e na sua ligação correta ao ribossomo.",         topic: "Modificações do RNA",       },       {         question: "19. O que é um códon?",         options: [           "a) Um aminoácido que compõe uma proteína.",           "b) Um fragmento de DNA que codifica para um gene.",           "c) Uma sequência de três bases nitrogenadas na fita de RNA mensageiro que codifica para um aminoácido.",           "d) Uma proteína que traduz o RNA mensageiro.",         ],         correctAnswer: "c) Uma sequência de três bases nitrogenadas na fita de RNA mensageiro que codifica para um aminoácido.",         comment: "O códon é a unidade de leitura do código genético. Cada sequência de três bases no RNA mensageiro corresponde a um aminoácido específico que será adicionado à proteína em formação.",         topic: "Código Genético",       },       {         question: "20. A tradução do RNA mensageiro para proteína ocorre em qual organela?",         options: [           "a) Mitocôndria.",           "b) Núcleo.",           "c) Retículo endoplasmático liso.",           "d) Ribossomo.",         ],         correctAnswer: "d) Ribossomo.",         comment: "Os ribossomos são as fábricas de proteínas da célula. Eles leem a informação do RNA mensageiro e, com o auxílio dos RNAs transportadores, sintetizam a cadeia de aminoácidos que formará a proteína.",         topic: "Tradução",       },       {         question: "21. Qual é a principal função do retículo endoplasmático rugoso na síntese de proteínas?",         options: [           "a) A produção de lipídios e esteroides.",           "b) A síntese de ATP para a célula.",           "c) Abrigar os ribossomos que traduzem o RNA mensageiro em proteínas.",           "d) A degradação de proteínas danificadas.",         ],         correctAnswer: "c) Abrigar os ribossomos que traduzem o RNA mensageiro em proteínas.",         comment: "O retículo endoplasmático rugoso é chamado assim por ter \"rugas\", que são os ribossomos aderidos à sua superfície. Ele é o local principal onde a tradução do RNA mensageiro em proteínas ocorre na célula.",         topic: "Ribossomos",       },       {         question: "22. O que é o controle pós-traducional?",         options: [           "a) O processo de duplicação do DNA.",           "b) A regulação da expressão gênica no nível da transcrição.",           "c) A maturação do RNA mensageiro após a transcrição.",           "d) A modificação e ativação da proteína após a sua tradução.",         ],         correctAnswer: "d) A modificação e ativação da proteína após a sua tradução.",         comment: "O controle pós-traducional se refere às modificações que ocorrem em uma proteína depois que ela já foi traduzida pelo ribossomo. Essas modificações são essenciais para que a proteína se torne funcional e possa desempenhar sua função na célula.",         topic: "Controle Pós-Traducional",       },       {         question: "23. A glicosilação é um exemplo de qual tipo de controle na biologia celular?",         options: [           "a) Controle transcricional.",           "b) Controle pós-traducional.",           "c) Controle do ciclo celular.",           "d) Controle de reparo do DNA.",         ],         correctAnswer: "b) Controle pós-traducional.",         comment: "A glicosilação é a adição de carboidratos a uma proteína, o que pode alterar sua estrutura e função. É um dos mecanismos de controle pós-traducional, que ativam ou desativam a proteína para seu papel específico.",         topic: "Modificações de Proteínas",       },       {         question: "24. Qual é a função da ubiquitina?",         options: [           "a) Ativar a proteína para que ela se torne funcional.",           "b) Levar a proteína para ser degradada.",           "c) Proteger a proteína de degradação.",           "d) Sintetizar novos aminoácidos.",         ],         correctAnswer: "b) Levar a proteína para ser degradada.",         comment: "A ubiquitina serve como um marcador molecular. Ao se ligar a uma proteína, ela sinaliza para a maquinaria celular que essa proteína deve ser levada ao proteassomo para degradação, eliminando-a da célula.",         topic: "Ubiquitina",       },       {         question: "25. O que são exportinas?",         options: [           "a) Proteínas que transportam o RNA mensageiro do núcleo para o citoplasma.",           "b) Proteínas que ligam o DNA às histonas.",           "c) Enzimas que ativam proteínas no citoplasma.",           "d) Moléculas que retiram os íntrons do RNA.",         ],         correctAnswer: "a) Proteínas que transportam o RNA mensageiro do núcleo para o citoplasma.",         comment: "As exportinas são proteínas localizadas na membrana nuclear. Elas reconhecem o RNA mensageiro maduro e facilitam sua saída do núcleo para o citoplasma, onde a tradução ocorrerá.",         topic: "Transporte Nuclear",       },       {         question: "26. A fase G0 do ciclo celular pode ser caracterizada por qual evento?",         options: [           "a) A célula está se dividindo ativamente.",           "b) O DNA está sendo duplicado.",           "c) A célula está em um estado de repouso metabólico, aguardando um sinal para voltar ao ciclo.",           "d) A célula está sofrendo apoptose.",         ],         correctAnswer: "c) A célula está em um estado de repouso metabólico, aguardando um sinal para voltar ao ciclo.",         comment: "A fase G0 é uma etapa de quiescência, na qual a célula deixa temporariamente o ciclo celular. Ela não está se dividindo nem se preparando para se dividir, mas mantém seu metabolismo em um estado de baixa atividade.",         topic: "Fases do Ciclo Celular",       },       {         question: "27. O que é o splicing?",         options: [           "a) Um processo de maturação do RNA mensageiro onde os íntrons são removidos e os éxons são unidos.",           "b) A duplicação da molécula de DNA.",           "c) A tradução do RNA em proteína.",           "d) A ativação de uma proteína por fosforilação.",         ],         correctAnswer: "a) Um processo de maturação do RNA mensageiro onde os íntrons são removidos e os éxons são unidos.",         comment: "O splicing é um processo essencial de maturação do pré-RNA mensageiro. Os íntrons, que são sequências não codificantes, são cortados, e os éxons, que são as sequências codificantes, são ligados uns aos outros para formar o RNA mensageiro maduro.",         topic: "Splicing",       },       {         question: "28. A acoplação de aminoácidos para formar uma proteína é realizada por qual estrutura?",         options: [           "a) DNA polimerase.",           "b) RNA transportador.",           "c) Ribossomo.",           "d) Splicossomo.",         ],         correctAnswer: "c) Ribossomo.",         comment: "O ribossomo é a organela onde ocorre a tradução. Ele tem a capacidade de ler o códon do RNA mensageiro e acoplar o aminoácido correto, que é transportado pelo RNA transportador, formando a cadeia polipeptídica que dará origem à proteína.",         topic: "Tradução",       },       {         question: "29. O que o termo \"genótipo\" se refere, segundo a explicação da aula?",         options: [           "a) As características físicas observáveis em um organismo.",           "b) A expressão de um gene em uma proteína.",           "c) A informação genética contida no DNA (o gene).",           "d) As modificações epigenéticas do DNA.",         ],         correctAnswer: "c) A informação genética contida no DNA (o gene).",         comment: "O genótipo se refere à constituição genética de um indivíduo, ou seja, o conjunto de genes que ele possui, contido em seu DNA.",         topic: "Genótipo e Fenótipo",       },       {         question: "30. Como a glicosilação contribui para a função de uma proteína?",         options: [           "a) Ativando a proteína para sua atividade funcional.",           "b) Degradando a proteína indesejada.",           "c) Enrolando a proteína para economizar espaço.",           "d) Desativando a proteína para economizar energia.",         ],         correctAnswer: "a) Ativando a proteína para sua atividade funcional.",         comment: "A glicosilação é um dos tipos de controle pós-traducional que pode ativar uma proteína. A adição de grupos glicosídicos pode alterar a conformação da proteína, permitindo que ela exerça sua função biológica específica.",         topic: "Controle Pós-Traducional",       },       {         question: "31. Qual a função da porção menor do ribossomo?",         options: [           "a) Sintetizar o RNA mensageiro.",           "b) Aumentar o tamanho da subunidade maior.",           "c) Manter o RNA mensageiro em uma posição adequada para a tradução.",           "d) Realizar a acetilação das histonas.",         ],         correctAnswer: "c) Manter o RNA mensageiro em uma posição adequada para a tradução.",         comment: "A subunidade menor do ribossomo tem a função de se ligar ao RNA mensageiro e mantê-lo no lugar para que a subunidade maior possa se ligar e começar a tradução.",         topic: "Estrutura e Função do Ribossomo",       },       {         question: "32. Quais proteínas são responsáveis por abrir a fita de DNA durante o processo de transcrição?",         options: [           "a) RNA polimerase.",           "b) Histonas.",           "c) Exportinas.",           "d) As enzimas não foram especificadas, mas a heterocromatina precisa se tornar eucromatina.",         ],         correctAnswer: "d) As enzimas não foram especificadas, mas a heterocromatina precisa se tornar eucromatina.",         comment: "A aula não nomeia a enzima específica que abre a fita para a transcrição, mas explica que o DNA precisa ser desenrolado de sua forma compactada (heterocromatina) para a forma afrouxada (eucromatina) por meio de modificações epigenéticas, como a acetilação.",         topic: "Transcrição",       },       {         question: "33. O que o termo \"fenótipo\" representa?",         options: [           "a) O conjunto de genes de um organismo.",           "b) As características visíveis de um organismo, resultantes da interação entre o genótipo e o ambiente.",           "c) O processo de duplicação do DNA.",           "d) As modificações do DNA que não alteram a sequência de bases.",         ],         correctAnswer: "b) As características visíveis de um organismo, resultantes da interação entre o genótipo e o ambiente.",         comment: "Fenótipo é a manifestação física das características de um indivíduo. Ele é resultado da interação do genótipo com o ambiente, incluindo fatores como nutrição, exposição ao sol, etc.",         topic: "Genótipo e Fenótipo",       },       {         question: "34. A formação do RNA mensageiro maduro envolve quais processos, segundo a aula?",         options: [           "a) Apenas a duplicação.",           "b) Apenas a tradução.",           "c) Adição de um \"cap\" 5', cauda poli-A e remoção de íntrons.",           "d) Apenas a degradação de proteínas.",         ],         correctAnswer: "c) Adição de um \"cap\" 5', cauda poli-A e remoção de íntrons.",         comment: "Para que o pré-RNA mensageiro se torne maduro, ele precisa passar por um processo de maturação que inclui a adição de um \"cap\" na extremidade 5', uma cauda de adeninas (poli-A) na extremidade 3', e a remoção dos íntrons por splicing.",         topic: "Maturação do RNA",       },       {         question: "35. A proteína p21, ativada pela p53, tem a função de:",         options: [           "a) Acelerar a duplicação do DNA.",           "b) Bloquear a ação da CDK2.",           "c) Iniciar a apoptose.",           "d) Direcionar o RNA para fora do núcleo.",         ],         correctAnswer: "b) Bloquear a ação da CDK2.",         comment: "A p21 é uma proteína que age como um inibidor da quinase. Ela se liga à CDK2, impedindo que essa enzima ative outras proteínas e continue o ciclo celular. Isso força a célula a pausar o ciclo para reparar o DNA danificado.",         topic: "Ciclo Celular: Proteínas de Controle",       },       {         question: "36. A diferenciação entre heterocromatina e eucromatina é crucial para qual processo celular?",         options: [           "a) Apoptose.",           "b) Mitose.",           "c) Tradução.",           "d) Transcrição.",         ],         correctAnswer: "d) Transcrição.",         comment: "A transcrição, que é a síntese do RNA a partir do DNA, só pode ocorrer quando o DNA está acessível. A heterocromatina é compactada e inativa, enquanto a eucromatina está afrouxada e ativa, sendo a forma ideal para a transcrição.",         topic: "Cromatina e Expressão Gênica",       },       {         question: "37. Qual é a principal característica que diferencia o RNA do DNA?",         options: [           "a) A presença de ribose.",           "b) A presença de timina.",           "c) O formato de dupla-hélice.",           "d) A presença de histonas.",         ],         correctAnswer: "a) A presença de ribose.",         comment: "O RNA contém o açúcar ribose em sua estrutura, enquanto o DNA possui desoxirribose. As outras opções são características do DNA, não do RNA.",         topic: "Diferenças entre DNA e RNA",       },       {         question: "38. Qual a importância da maturação do pré-RNA mensageiro, segundo a aula?",         options: [           "a) Para que o DNA possa ser duplicado corretamente.",           "b) Para que ele possa se ligar ao ribossomo e ser traduzido em proteína.",           "c) Para que a célula possa entrar em apoptose.",           "d) Para que a p53 possa verificar se há danos no DNA.",         ],         correctAnswer: "b) Para que ele possa se ligar ao ribossomo e ser traduzido em proteína.",         comment: "O pré-RNA mensageiro só pode ser traduzido em proteína depois de passar por um processo de maturação que o torna uma molécula funcional e estável. Apenas na sua forma madura ele pode sair do núcleo e se ligar ao ribossomo para a tradução.",         topic: "Maturação do RNA",       },       {         question: "39. O que é o spliciossomo?",         options: [           "a) A enzima responsável pela duplicação do DNA.",           "b) Um complexo proteico que realiza a retirada dos íntrons do pré-RNA mensageiro.",           "c) A proteína que ativa a apoptose.",           "d) O local do ribossomo onde a tradução ocorre.",         ],         correctAnswer: "b) Um complexo proteico que realiza a retirada dos íntrons do pré-RNA mensageiro.",         comment: "O spliciossomo é um complexo molecular que atua no processo de splicing, removendo os íntrons (partes não codificantes) do pré-RNA mensageiro e unindo os éxons (partes codificantes) para formar o RNA mensageiro maduro.",         topic: "Splicing",       },       {         question: "40. Qual a função do RNA transportador (tRNA) na tradução?",         options: [           "a) Sintetizar a fita de RNA mensageiro.",           "b) Levar o aminoácido correto para o ribossomo.",           "c) Ativar o ribossomo para a tradução.",           "d) Marcar a proteína para degradação.",         ],         correctAnswer: "b) Levar o aminoácido correto para o ribossomo.",         comment: "O RNA transportador é uma molécula adaptadora que se liga a um aminoácido em uma extremidade e a um anticódon na outra. No ribossomo, ele reconhece o códon do RNA mensageiro e entrega o aminoácido correspondente para ser adicionado à cadeia polipeptídica em crescimento.",         topic: "Tradução",       },     ];

    function buildQuiz() {
      const output = [];

      questions.forEach((currentQuestion, questionNumber) => {
        const options = [];
        for (let i = 0; i < currentQuestion.options.length; i++) {
          options.push(
            `<label class="option" data-question="${questionNumber}" data-value="${currentQuestion.options[i]}">
              <img src="tesouras.png" class="scissor-icon" onclick="event.stopPropagation(); this.parentNode.classList.toggle('struck-through');">
              ${currentQuestion.options[i]}
            </label>`
          );
        }

        output.push(
          `<div class="card" id="question-${questionNumber}" data-topic="${currentQuestion.topic}">
            <div class="question">${currentQuestion.question}</div>
            <div class="options">${options.join("")}</div>
            <div class="comment" id="comment-${questionNumber}"></div>
          </div>`
        );
      });

      quizContainer.innerHTML = output.join("");
    }

    function showResults() {
      wrongQuestionIndices = [];
      errorCountByTopic = {};
      totalAnsweredQuestionsByTopic = {};
      currentWrongQuestionIndex = -1;
      hasErrors = false;
      isShowingErrors = false;
      isShowingDiagnosis = false;

      errorDiagnosisSection.style.display = 'none';
      topicsToReviewList.innerHTML = '';
      statusMessage.textContent = '';

      // Busca por todas as perguntas: estáticas e dinâmicas
      const allQuestionCards = document.querySelectorAll('.quiz-container .card, #newQuestionsContent .card');
      let correctAnswersCount = 0;
      let totalQuestionsAnswered = 0;

      console.log('🔍 Verificando', allQuestionCards.length, 'perguntas...');

      allQuestionCards.forEach((card, index) => {
        const questionEl = card.querySelector('.question') || card.querySelector('p');
        if (!questionEl) return;

        const questionText = questionEl.textContent.trim();
        const optionsContainer = card.querySelector('.options') || card;
        const allOptions = optionsContainer.querySelectorAll('.option, label.option, label');
        const userAnswerElement = optionsContainer.querySelector('.option.selected, label.selected');
        const commentDiv = card.querySelector('.comment');

        const questionTopic = card.dataset.topic || "Tópico não informado";
        
        console.log(`📝 Pergunta ${index + 1}: Tópico = "${questionTopic}"`);
        console.log(`🔍 Encontradas ${allOptions.length} alternativas`);
        
        // Remove classes anteriores
        allOptions.forEach(option => {
          option.classList.remove('correct', 'incorrect', 'selected');
        });
        if (commentDiv) commentDiv.classList.remove('show');

        let correctAnswerValue = null;
        let questionComment = null;

        // Verifica se é pergunta estática ou dinâmica
        const isStatic = card.id && card.id.startsWith('question-');
        if (isStatic) {
          // Pergunta estática - busca nos dados originais
          const questionData = questions.find(q => q.question.trim() === questionText);
          if (questionData) {
            correctAnswerValue = questionData.correctAnswer.trim();
            questionComment = questionData.comment;
          }
        } else {
          // Pergunta dinâmica - busca pela opção marcada como correta
          const correctOpt = optionsContainer.querySelector('.option[data-answer="true"], label[data-answer="true"]');
          if (correctOpt) {
            correctAnswerValue = correctOpt.dataset.value?.trim() || correctOpt.textContent.trim();
            console.log(`✅ Resposta correta encontrada: "${correctAnswerValue}"`);
          } else {
            console.log('❌ Nenhuma resposta correta encontrada para pergunta dinâmica');
          }
          
          // Busca comentário no próprio card ou no div comment
          const commentElement = card.querySelector('.comment');
          if (commentElement && commentElement.textContent.trim()) {
            questionComment = commentElement.textContent.trim();
          }
        }

        // Processa resposta do usuário e aplica coloração
        let userAnswer = null;
        if (userAnswerElement) {
          userAnswerElement.classList.add('selected');
          userAnswer = userAnswerElement.dataset.value?.trim() || userAnswerElement.textContent.trim();
          totalQuestionsAnswered++;
          totalAnsweredQuestionsByTopic[questionTopic] = (totalAnsweredQuestionsByTopic[questionTopic] || 0) + 1;

          console.log(`👤 Resposta do usuário: "${userAnswer}"`);
          console.log(`🎯 Resposta correta: "${correctAnswerValue}"`);

          // Verifica se a resposta está correta
          if (userAnswer === correctAnswerValue) {
            correctAnswersCount++;
            console.log(`✅ Resposta correta!`);
          } else {
            hasErrors = true;
            errorCountByTopic[questionTopic] = (errorCountByTopic[questionTopic] || 0) + 1;
            console.log(`❌ Resposta incorreta para tópico: ${questionTopic}`);
          }
        }

        // Aplica coloração: SEMPRE marca a correta de verde, e a errada de vermelho se foi marcada
        allOptions.forEach(option => {
          const optionValue = option.dataset.value?.trim() || option.textContent.trim();
          
          // Marca a resposta correta de verde SEMPRE
          if (optionValue === correctAnswerValue) {
            option.classList.add('correct');
            console.log(`🟢 Marcando como correta: "${optionValue}"`);
          }
          
          // Se o usuário marcou uma resposta E ela está errada, marca de vermelho
          if (userAnswer && optionValue === userAnswer && userAnswer !== correctAnswerValue) {
            option.classList.add('incorrect');
            console.log(`🔴 Marcando como incorreta: "${optionValue}"`);
          }
        });

        // Mostra comentário se disponível
        if (commentDiv && questionComment) {
          commentDiv.textContent = questionComment;
          commentDiv.classList.add('show');
        }
      });

      // Exibe resultados
      resultsContainer.textContent = `Você acertou ${correctAnswersCount} de ${totalQuestionsAnswered} questões respondidas.`;

      console.log('📊 Erros por tópico:', errorCountByTopic);
      console.log('📊 Total por tópico:', totalAnsweredQuestionsByTopic);

      // Gera diagnóstico de erros
      if (hasErrors) {
        for (const topic in errorCountByTopic) {
          const errors = errorCountByTopic[topic];
          const total = totalAnsweredQuestionsByTopic[topic] || 0;
          if (total > 0) {
            const percent = ((errors / total) * 100).toFixed(1);
            const li = document.createElement('li');
            li.textContent = `${topic}: ${percent}% de erros (${errors} de ${total} questões respondidas)`;
            topicsToReviewList.appendChild(li);
          }
        }
      } else {
        const li = document.createElement('li');
        li.textContent = "🥳 Parabéns! Você não teve erros nas questões respondidas.";
        topicsToReviewList.appendChild(li);
      }

      errorDiagnosisSection.style.display = 'block';
      generatedQuestionsSection.style.display = 'block';
      generateNewQuestionsBtn.style.display = 'block';
      scrollToDiagnosis();
    }

    function scrollToQuestion(index) {
      const questionCard = document.getElementById(`question-${index}`);
      if (questionCard) {
        questionCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }
    }

    function scrollToDiagnosis() {
        errorDiagnosisSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    function scrollToGeneratedQuestions() {
        generatedQuestionsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    // Event listener para seleção de opções (funciona para estáticas e dinâmicas)
    document.addEventListener("click", function (event) {
      const clickedElement = event.target;
      const optionElement = clickedElement.closest('.option');

      if (optionElement) {
          if (clickedElement.classList.contains("scissor-icon")) {
              event.stopPropagation();
              optionElement.classList.toggle("struck-through");
          }
          else {
              const parentCard = optionElement.closest('.card');
              const currentQuestionOptions = parentCard.querySelectorAll('.option');

              currentQuestionOptions.forEach(opt => opt.classList.remove("selected"));
              optionElement.classList.add("selected");
          }
      }
    });

    generateNewQuestionsBtn.addEventListener("click", async function() {
        statusMessage.textContent = '⏳ Gerando novas perguntas...';
        generateNewQuestionsBtn.disabled = true;

        const topics = Object.keys(errorCountByTopic).filter(topic => {
            const errorsInTopic = errorCountByTopic[topic] || 0;
            const totalAnsweredInTopic = totalAnsweredQuestionsByTopic[topic] || 0;
            return errorsInTopic > 0 && totalAnsweredInTopic > 0;
        });

        const topicsToSend = topics.length > 0 ? topics : ["fisiologia celular", "biologia"];

        try {
            const response = await fetch('https://www.quizia.xyz/quiz', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ topicos: topicsToSend }),
            });

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const data = await response.json();

            newQuestionsContent.innerHTML = '';
            if (data && data.html) {
                console.log('📥 HTML recebido do Flask:', data.html);
                
                // Insere o HTML diretamente sem reconstrução complexa
                newQuestionsContent.innerHTML = data.html.replace(/```html|```/g, '');
                
                // Adiciona tesouras e ajusta formatação apenas se necessário
                newQuestionsContent.querySelectorAll('.card').forEach((card, cardIndex) => {
                    // Garante que o elemento de pergunta tenha a classe correta
                    const questionElement = card.querySelector('p');
                    if (questionElement && !questionElement.classList.contains('question')) {
                       questionElement.classList.add('question');
                    }

                    // Remove qualquer input de radio que possa existir e adiciona tesouras
                    card.querySelectorAll('label').forEach((label) => {
                        // Remove inputs de radio MAS preserva o atributo data-answer
                        const radioInput = label.querySelector('input[type="radio"]');
                        if (radioInput) {
                            // PRESERVA o atributo data-answer do input no label
                            if (radioInput.hasAttribute('data-answer')) {
                                label.setAttribute('data-answer', radioInput.getAttribute('data-answer'));
                            }
                            radioInput.remove();
                        }
                        
                        // Garante que tenha a classe option
                        if (!label.classList.contains('option')) {
                            label.classList.add('option');
                        }

                        // Garante que tenha data-value
                        if (!label.dataset.value) {
                            label.dataset.value = label.textContent.trim();
                        }

                        // Adiciona tesoura se não existir
                        if (!label.querySelector('.scissor-icon')) {
                            const scissorIcon = document.createElement('img');
                            scissorIcon.src = 'tesouras.png';
                            scissorIcon.className = 'scissor-icon';
                            scissorIcon.onclick = function(e) {
                                e.stopPropagation();
                                label.classList.toggle('struck-through');
                            };
                            label.insertBefore(scissorIcon, label.firstChild);
                        }
                    });

                    console.log(`🏷️ Card ${cardIndex}: data-topic = "${card.dataset.topic}"`);
                    
                    // Verifica se há opção correta marcada
                    const correctOption = card.querySelector('label[data-answer="true"]');
                    if (correctOption) {
                        console.log(`✅ Opção correta encontrada: "${correctOption.dataset.value}"`);
                    } else {
                        console.log('❌ Nenhuma opção correta encontrada');
                    }
                });
            } else {
                newQuestionsContent.innerHTML = "<p>Não foi possível gerar novas perguntas para os tópicos selecionados.</p>";
            }
            
            generatedQuestionsSection.style.display = 'block';
            scrollToGeneratedQuestions();
            statusMessage.textContent = '✅ Perguntas geradas com sucesso!';
            setTimeout(() => { statusMessage.textContent = '' }, 3000);

        } catch (error) {
            console.error('Erro ao gerar novas perguntas:', error);
            newQuestionsContent.innerHTML = `<p>Erro ao carregar novas perguntas: ${error.message}. Por favor, tente novamente.</p>`;
            generatedQuestionsSection.style.display = 'block';
            scrollToGeneratedQuestions();
            statusMessage.textContent = '❌ Erro na requisição: ' + error.message;
            setTimeout(() => { statusMessage.textContent = '' }, 5000);
        } finally {
            generateNewQuestionsBtn.disabled = false;
        }
    });

    // Inicialização
    buildQuiz();
    errorDiagnosisSection.style.display = 'none';
    generatedQuestionsSection.style.display = 'none';
    generateNewQuestionsBtn.style.display = 'none';

    // Event listener para o botão de verificar respostas
    document.getElementById("verifyAnswersBtn").addEventListener("click", showResults);
  </script>
</body>
</html>
