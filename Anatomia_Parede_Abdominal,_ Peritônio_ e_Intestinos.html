<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>Simulado de Anatomia: Parede Abdominal, Peritônio e Intestinos</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      background-color: #f4f4f4;
    }

    .quiz-container {
      max-width: 800px;
      width: 100%;
    }

    h1 {
      color: #333;
      text-align: center;
      margin-bottom: 30px;
    }

    .card {
      background-color: white;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .question {
      font-weight: bold;
      margin-bottom: 10px;
      color: #333;
    }

    .options {
      margin-top: 15px;
    }

    /* Estilos unificados para todas as opções (estáticas e dinâmicas) */
    .option, label.option, label, #newQuestionsContent label {
      display: flex; /* Para alinhar imagem e texto */
      align-items: center;
      margin-bottom: 10px;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.2s ease;
      position: relative; /* Para posicionar a tesoura */
    }

    /* FORÇA a remoção de inputs de radio em QUALQUER lugar */
    .option input[type="radio"], 
    label input[type="radio"],
    #newQuestionsContent input[type="radio"],
    #newQuestionsContent label input[type="radio"] {
        display: none !important;
        visibility: hidden !important;
        opacity: 0 !important;
        position: absolute !important;
        left: -9999px !important;
    }

    .option:hover, 
    label.option:hover, 
    label:hover,
    #newQuestionsContent label:hover {
      background-color: #e9e9e9;
    }

    .option.selected, 
    label.option.selected, 
    label.selected,
    #newQuestionsContent label.selected {
      background-color: #d1e7dd;
      border-color: #28a745;
    }

    .option.correct, 
    label.option.correct, 
    label.correct,
    #newQuestionsContent label.correct {
      background-color: #d4edda;
      border-color: #28a745;
    }

    .option.incorrect, 
    label.option.incorrect, 
    label.incorrect,
    #newQuestionsContent label.incorrect {
      background-color: #f8d7da;
      border-color: #dc3545;
    }

    .submit-btn {
      display: block;
      width: 100%;
      padding: 15px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 18px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      margin-top: 30px;
    }

    .submit-btn:hover {
      background-color: #0056b3;
    }

    .results {
      text-align: center;
      margin-top: 30px;
      font-size: 20px;
      font-weight: bold;
      color: #333;
    }

    .scissor-icon {
      margin-right: 10px; /* Espaço entre a tesoura e o texto da opção */
      width: 20px; /* Ajuste conforme o tamanho da sua imagem */
      height: 20px; /* Ajuste conforme o tamanho da sua imagem */
      opacity: 0.5; /* Transparência como no original */
      cursor: pointer;
    }

    .scissor-icon.hidden {
      display: none;
    }

    .struck-through {
      text-decoration: line-through;
      color: #888;
    }

    .comment {
      margin-top: 10px;
      padding: 10px;
      background-color: #f0f0f0;
      border-left: 4px solid #007bff;
      font-style: italic;
      color: #555;
      display: none; /* Escondido por padrão */
    }
    .comment.show {
      display: block; /* Mostrado quando ativado */
    }

    /* Estilos para o botão de navegação de erro / diagnóstico */
    .error-nav-btn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: #dc3545; /* Vermelho para erro */
      color: white;
      border: none;
      border-radius: 50%; /* Torna o botão redondo */
      width: 60px;
      height: 60px;
      font-size: 24px;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      z-index: 1000;
      display: none; /* Escondido por padrão */
      flex-direction: column; /* Para empilhar o ícone e o contador */
      padding: 5px; /* Ajuste o padding para acomodar texto maior */
      box-sizing: border-box; /* Garante que padding não aumente o tamanho total */
      text-align: center;
    }

    .error-nav-btn:hover {
      background-color: #c82333;
    }

    .error-nav-btn .arrow-icon {
      font-size: 30px; /* Tamanho da seta */
      line-height: 1; /* Ajuste para centralizar */
    }

    .error-nav-btn .button-text {
      font-size: 12px; /* Tamanho do texto abaixo da seta */
      line-height: 1;
      margin-top: 2px; /* Espaço entre a seta e o texto */
    }

    /* Estilos para a seção de diagnóstico de erros */
    .error-diagnosis-section {
        margin-top: 50px;
        padding: 30px;
        background-color: #ffe0b2; /* Um laranja claro ou similar */
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.15);
        display: none; /* Escondido por padrão */
        text-align: center;
        font-size: 1.1em;
        color: #333;
    }

    .error-diagnosis-section h2 {
        color: #e65100; /* Laranja mais escuro */
        margin-bottom: 20px;
        font-size: 1.8em;
    }

    .error-diagnosis-section ul {
        list-style: none; /* Remove marcadores de lista */
        padding: 0;
        margin: 0;
    }

    .error-diagnosis-section li {
        background-color: #ff9800; /* Laranja */
        color: white;
        padding: 8px 15px;
        margin: 8px 0;
        border-radius: 5px;
        display: inline-block; /* Para que os itens fiquem lado a lado */
        margin-right: 10px;
        font-weight: bold;
    }
    .error-diagnosis-section li:last-child {
        margin-right: 0;
    }
 .card-bloco {
      border: 1px solid #ddd;
      border-radius: 6px;
      padding: 10px;
      background: #fff;
      margin-bottom: 20px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    }

    .question img {
        max-width: 100%;
        height: auto;
        display: block;
        margin: 15px auto;
        border: 1px solid #ccc;
        border-radius: 5px;
    }
  </style>
</head>
<body>
  <div class="quiz-container">
    <h1 style="text-align:center; margin-bottom: 30px;">Simulado de Anatomia: Parede Abdominal, Peritônio e Intestinos</h1>
    <div class="card-bloco" id="quiz"></div>
    <button class="submit-btn" id="verifyAnswersBtn">Verificar Respostas</button>

    <button class="generate-questions-btn submit-btn" id="generateNewQuestionsBtn" style="display:none;">
      Gerar Novas Perguntas
    </button>

    <div class="results card-bloco" id="results"></div>
    <div id="statusMessage" style="text-align: center; margin-top: 10px; font-weight: bold; color: #007bff;"></div>

    <div class="error-diagnosis-section card-bloco" id="errorDiagnosis">
      <h2>Diagnóstico de Erros</h2>
      <p>Parece que você precisa revisar os seguintes assuntos:</p>
      <ul id="topicsToReview"></ul>
    </div>

    <div class="generated-questions-section card-bloco" id="generatedQuestionsSection" style="display:none;">
      <h2>Novas Perguntas Geradas</h2>
      <div id="newQuestionsContent"></div>
    </div>
  </div>
  
  <button class="error-nav-btn" id="errorNavBtn" style="display:none;">
    <span class="arrow-icon"></span>
    <span class="button-text"></span>
  </button>

  <script>
    const quizContainer = document.getElementById("quiz");
    const resultsContainer = document.getElementById("results");
    const errorNavBtn = document.getElementById("errorNavBtn");
    const arrowIcon = errorNavBtn.querySelector(".arrow-icon");
    const buttonText = errorNavBtn.querySelector(".button-text");
    const errorDiagnosisSection = document.getElementById("errorDiagnosis");
    const topicsToReviewList = document.getElementById("topicsToReview");
    const generateNewQuestionsBtn = document.getElementById("generateNewQuestionsBtn");
    const generatedQuestionsSection = document.getElementById("generatedQuestionsSection");
    const newQuestionsContent = document.getElementById("newQuestionsContent");
    const statusMessage = document.getElementById("statusMessage");

    let wrongQuestionIndices = [];
    let errorCountByTopic = {};
    let totalAnsweredQuestionsByTopic = {};
    let currentWrongQuestionIndex = -1;
    let hasErrors = false;
    let isShowingErrors = false;
    let isShowingDiagnosis = false;

    // Inicializa a visibilidade das seções no carregamento
    errorDiagnosisSection.style.display = 'none';
    topicsToReviewList.innerHTML = '';
    statusMessage.textContent = '';

    const questions = [
      {
        question: `1. Observando a vista superior da vértebra lombar na imagem, qual estrutura é crucial para a articulação com a costela correspondente e como sua orientação pode variar em diferentes regiões da coluna vertebral?
        <img src="https://brunooofernandesss.github.io/index.html/Anatomia/Michigan/Abdominal_Wall_Peritoneum_and_Intestines/EmbeddedImage.jpg" alt="Vista superior de uma vértebra lombar.">`,
        options: [
          "1. O processo espinhoso, que se projeta lateralmente para a articulação com as costelas.",
          "2. O corpo vertebral, que se articula com a cabeça da costela na região torácica.",
          "3. O processo transverso, que na região lombar é mais fino e se projeta lateralmente, enquanto na região torácica apresenta uma faceta articular para o tubérculo da costela.",
          "4. O processo articular, que forma articulações sinoviais com processos adjacentes.",
        ],
        correctAnswer: "3. O processo transverso, que na região lombar é mais fino e se projeta lateralmente, enquanto na região torácica apresenta uma faceta articular para o tubérculo da costela.",
        comment: "O processo transverso das vértebras torácicas possui facetas para articulação com o tubérculo das costelas, uma característica ausente nas vértebras lombares, onde os processos transversos são mais desenvolvidos e se projetam lateralmente. O processo espinhoso não se articula com a costela, e o corpo vertebral articula-se com a cabeça da costela, mas a pergunta se refere à estrutura que se articula com a costela correspondente (tubérculo da costela).",
        topic: "Anatomia da Coluna Vertebral: Vértebras Lombares e Torácicas",
      },
      {
        question: `2. A imagem mostra uma vista anterior da cintura pélvica. Qual é a principal função combinada do ísquio e do púbis na formação do assoalho pélvico e na sustentação do peso corporal na posição sentada?
        <img src="https://brunooofernandesss.github.io/index.html/Anatomia/Michigan/Abdominal_Wall_Peritoneum_and_Intestines/EmbeddedImage-1.jpg" alt="Vista anterior da cintura pélvica.">`,
        options: [
          "1. O ísquio e o púbis formam a parte superior do anel pélvico, fornecendo inserção para os músculos abdominais.",
          "2. Juntos, o ísquio e o púbis delimitam o forame obturado e fornecem inserção para os músculos da coxa e do assoalho pélvico, sendo os tubérculos isquiáticos essenciais para a sustentação do peso ao sentar.",
          "3. O ísquio e o púbis são as principais estruturas de suporte para a coluna vertebral.",
          "4. O púbis atua principalmente na articulação com o sacro, enquanto o ísquio sustenta o peso corporal.",
        ],
        correctAnswer: "2. Juntos, o ísquio e o púbis delimitam o forame obturado e fornecem inserção para os músculos da coxa e do assoalho pélvico, sendo os tubérculos isquiáticos essenciais para a sustentação do peso ao sentar.",
        comment: "O ísquio e o púbis, juntamente com o ílio, formam o osso do quadril. Eles delimitam o forame obturado e servem como importantes pontos de inserção para diversos músculos da coxa e do assoalho pélvico. Os tubérculos isquiáticos, especificamente, são as estruturas ósseas proeminentes do ísquio que sustentam o peso do corpo na posição sentada.",
        topic: "Cintura Pélvica: Ísquio e Púbis, Assoalho Pélvico",
      },
      {
        question: `3. Na vista lateral do osso coxal esquerdo, observe a área colorida em azul. Qual é a importância clínica da crista ilíaca, uma estrutura pertencente a essa parte do osso, para procedimentos médicos e qual sua relação com a parede abdominal?
        <img src="https://brunooofernandesss.github.io/index.html/Anatomia/Michigan/Abdominal_Wall_Peritoneum_and_Intestines/EmbeddedImage-2.jpg" alt="Vista lateral de um osso coxal esquerdo, com partes coloridas.">`,
        options: [
          "1. A crista ilíaca é um marco importante para punções lombares, sendo o principal ponto de inserção para o ligamento inguinal.",
          "2. A crista ilíaca serve como um local comum para a coleta de medula óssea e como um ponto de inserção para os músculos da parede abdominal lateral e dorsal, como os oblíquos e o transverso do abdome.",
          "3. A crista ilíaca delimita o forame obturado, sendo importante na sustentação do peso corporal.",
          "4. A crista ilíaca é a área de articulação com o sacro e forma a parte posterior da cintura pélvica.",
        ],
        correctAnswer: "2. A crista ilíaca serve como um local comum para a coleta de medula óssea e como um ponto de inserção para os músculos da parede abdominal lateral e dorsal, como os oblíquos e o transverso do abdome.",
        comment: "A crista ilíaca, parte do ílio (azul na imagem), é um marco anatômico proeminente e facilmente palpável. Sua importância clínica reside no fato de ser um local comum para a biópsia de medula óssea devido à sua acessibilidade e quantidade de tecido hematopoiético. Além disso, serve como uma vasta área de origem e inserção para músculos importantes da parede abdominal, como os oblíquos externos e internos, e o transverso do abdome, bem como músculos das costas e da coxa.",
        topic: "Cintura Pélvica: Ílio e Crista Ilíaca, Músculos da Parede Abdominal",
      },
      {
        question: `4. A imagem destaca a crista púbica e o tubérculo púbico em uma vista anterior da cintura pélvica. Qual é a principal função do tubérculo púbico em relação ao ligamento inguinal e suas implicações na formação da parede abdominal inferior?
        <img src="https://brunooofernandesss.github.io/index.html/Anatomia/Michigan/Abdominal_Wall_Peritoneum_and_Intestines/EmbeddedImage-4.jpg" alt="Vista anterior da cintura pélvica, com ênfase nas características do púbis.">`,
        options: [
          "1. O tubérculo púbico serve como ponto de origem para o músculo reto do abdome.",
          "2. O tubérculo púbico é o ponto de inserção lateral do ligamento inguinal, delimitando o canal inguinal.",
          "3. O tubérculo púbico é o principal ponto de inserção medial do ligamento inguinal, uma estrutura crucial na delimitação do canal inguinal e na prevenção de hérnias inguinais.",
          "4. A crista púbica é o principal local de inserção para o músculo iliopsoas.",
        ],
        correctAnswer: "3. O tubérculo púbico é o principal ponto de inserção medial do ligamento inguinal, uma estrutura crucial na delimitação do canal inguinal e na prevenção de hérnias inguinais.",
        comment: "O tubérculo púbico é um marco ósseo chave na região do púbis e serve como o ponto de inserção medial do ligamento inguinal. O ligamento inguinal é uma borda inferior engrossada da aponeurose do músculo oblíquo externo do abdome, que se estende da espinha ilíaca ântero-superior até o tubérculo púbico. Essa estrutura é fundamental na formação do assoalho do canal inguinal e tem relevância clínica na compreensão das hérnias inguinais.",
        topic: "Parede Abdominal Inferior: Púbis, Tubérculo Púbico, Ligamento Inguinal, Canal Inguinal",
      },
      {
        question: `5. Analise a vista anterior do abdômen, que revela a fáscia muscular do oblíquo externo e a bainha do reto. Qual é a importância funcional dessas estruturas para a integridade da parede abdominal e para o movimento do tronco?
        <img src="https://brunooofernandesss.github.io/index.html/Anatomia/Michigan/Abdominal_Wall_Peritoneum_and_Intestines/EmbeddedImage-7.jpg" alt="Vista anterior do abdômen, mostrando a musculatura superficial.">`,
        options: [
          "1. A fáscia muscular do oblíquo externo e a bainha do reto atuam exclusivamente na proteção dos órgãos internos, sem papel significativo na movimentação.",
          "2. A fáscia muscular do oblíquo externo e a bainha do reto contribuem para a estabilidade do tronco e a movimentação abdominal, sendo a bainha do reto uma aponeurose que envolve os músculos retos do abdome e a fáscia muscular do oblíquo externo uma camada fibrosa que cobre esse músculo, ambas essenciais para a contração e suporte da parede abdominal.",
          "3. A bainha do reto é composta principalmente por tecido adiposo, com função de isolamento térmico.",
          "4. Ambas as estruturas são compostas de cartilagem, permitindo flexibilidade extrema ao tronco.",
        ],
        correctAnswer: "2. A fáscia muscular do oblíquo externo e a bainha do reto contribuem para a estabilidade do tronco e a movimentação abdominal, sendo a bainha do reto uma aponeurose que envolve os músculos retos do abdome e a fáscia muscular do oblíquo externo uma camada fibrosa que cobre esse músculo, ambas essenciais para a contração e suporte da parede abdominal.",
        comment: "A fáscia muscular do músculo oblíquo externo e a bainha do reto são componentes cruciais da parede abdominal. A bainha do reto é uma forte aponeurose formada pelas aponeuroses dos três músculos planos do abdome (oblíquo externo, oblíquo interno e transverso do abdome), que envolve os músculos retos do abdome. Essas estruturas fornecem suporte robusto para a cavidade abdominal, protegem as vísceras e são essenciais para a flexão e rotação do tronco, além de auxiliar na respiração forçada e na defecação.",
        topic: "Parede Abdominal: Músculos, Fáscias e Bainha do Reto, Biomecânica do Tronco",
      },
      {
        question: `6. A imagem é uma vista anterior da região inguinal, mostrando os pilares medial e lateral do anel inguinal superficial. Qual é a importância clínica desse anel para a formação de hérnias, especialmente em homens?
        <img src="https://brunooofernandesss.github.io/index.html/Anatomia/Michigan/Abdominal_Wall_Peritoneum_and_Intestines/EmbeddedImage-10.jpg" alt="Vista anterior da região inguinal, mostrando os componentes do anel inguinal superficial.">`,
        options: [
          "1. O anel inguinal superficial é uma abertura no músculo transverso do abdome, por onde vasos sanguíneos importantes passam.",
          "2. O anel inguinal superficial é a saída do canal inguinal, sendo um ponto de fraqueza potencial na parede abdominal por onde podem protrusões de vísceras (hérnias inguinais diretas e indiretas), especialmente em homens devido à passagem do funículo espermático.",
          "3. O anel inguinal superficial é uma estrutura fibrosa que fortalece a parede abdominal, impedindo a formação de hérnias.",
          "4. O anel inguinal superficial é exclusivamente uma estrutura feminina, permitindo a passagem do ligamento redondo do útero.",
        ],
        correctAnswer: "2. O anel inguinal superficial é a saída do canal inguinal, sendo um ponto de fraqueza potencial na parede abdominal por onde podem protrusões de vísceras (hérnias inguinais diretas e indiretas), especialmente em homens devido à passagem do funículo espermático.",
        comment: "O anel inguinal superficial é uma abertura triangular na aponeurose do músculo oblíquo externo. Ele representa a saída do canal inguinal. Em homens, o funículo espermático passa por este anel; em mulheres, é o ligamento redondo do útero. Clinicamente, o anel inguinal superficial é um local de fraqueza na parede abdominal, tornando-o suscetível ao desenvolvimento de hérnias inguinais, tanto diretas quanto indiretas, que são protrusões de conteúdo abdominal para fora da cavidade.",
        topic: "Parede Abdominal: Região Inguinal, Anel Inguinal Superficial, Hérnias Inguinais",
      },
      {
        question: `7. A imagem é uma vista posterior da parede abdominal anterior rebatida, destacando as pregas umbilicais. Qual é a principal estrutura que a prega umbilical medial envolve e qual a sua função no desenvolvimento fetal, em contraste com sua função residual no adulto?
        <img src="https://brunooofernandesss.github.io/index.html/Anatomia/Michigan/Abdominal_Wall_Peritoneum_and_Intestines/EmbeddedImage-18.jpg" alt="Parede abdominal anterior rebatida posteriormente, exibindo as pregas umbilicais.">`,
        options: [
          "1. A prega umbilical medial envolve a artéria umbilical obliteração, que era funcional na circulação fetal, mas se torna um ligamento fibroso no adulto.",
          "2. A prega umbilical medial envolve a veia umbilical, que permanece permeável no adulto como parte do sistema porta.",
          "3. A prega umbilical lateral envolve a artéria epigástrica inferior, que é a principal suprimento sanguíneo do reto do abdome.",
          "4. A prega umbilical mediana contém o úraco, um remanescente do alantoide fetal, que no adulto é uma estrutura completamente vestigial.",
        ],
        correctAnswer: "1. A prega umbilical medial envolve a artéria umbilical obliteração, que era funcional na circulação fetal, mas se torna um ligamento fibroso no adulto.",
        comment: "A prega umbilical medial (ou ligamento umbilical medial) é uma elevação do peritônio parietal que cobre a artéria umbilical obliterada. Durante a vida fetal, as artérias umbilicais transportam sangue desoxigenado do feto para a placenta. Após o nascimento, elas se ocluem e se tornam ligamentos fibrosos, atuando como marcos anatômicos na parede abdominal posterior, sem função ativa no adulto.",
        topic: "Parede Abdominal: Pregas Umbilicais, Desenvolvimento Fetal, Anatomia Pós-Natal",
      },
      {
        question: `8. A imagem mostra uma vista anterossuperior do diafragma, com destaque para a abertura da veia cava. Qual é a característica única dessa abertura em comparação com as outras aberturas diafragmáticas (esofágica e aórtica) e por que isso é funcionalmente importante para o fluxo sanguíneo?
        <img src="https://brunooofernandesss.github.io/index.html/Anatomia/Michigan/Abdominal_Wall_Peritoneum_and_Intestines/EmbeddedImage-21.jpg" alt="Vista anterossuperior do diafragma, com destaque para aberturas e estruturas centrais.">`,
        options: [
          "1. A abertura da veia cava está localizada no hiato esofágico, garantindo o fluxo sanguíneo para o esôfago.",
          "2. A abertura da veia cava é a única abertura que atravessa a porção muscular do diafragma, contraindo-se durante a inspiração para auxiliar o retorno venoso.",
          "3. A abertura da veia cava é a mais superior e está localizada no tendão central do diafragma, o que permite que a veia cava inferior permaneça aberta e não seja comprimida durante a contração diafragmática (inspiração), facilitando o retorno venoso ao coração.",
          "4. A abertura da veia cava é a mais inferior e atravessa a parte muscular do diafragma, sendo comprimida durante a expiração.",
        ],
        correctAnswer: "3. A abertura da veia cava é a mais superior e está localizada no tendão central do diafragma, o que permite que a veia cava inferior permaneça aberta e não seja comprimida durante a contração diafragmática (inspiração), facilitando o retorno venoso ao coração.",
        comment: "A abertura da veia cava inferior é única porque está localizada no tendão central do diafragma, uma estrutura fibrosa. Isso é crucial funcionalmente, pois ao contrário das aberturas esofágica e aórtica (que atravessam a porção muscular), a abertura da veia cava não é comprimida durante a contração do diafragma na inspiração. Essa característica garante que o fluxo sanguíneo da veia cava inferior para o coração não seja impedido, auxiliando no retorno venoso.",
        topic: "Anatomia do Diafragma: Aberturas Diafragmáticas, Retorno Venoso",
      },
      {
        question: `9. Na vista anterior da cavidade abdominal, com o cólon transverso rebatido, observa-se o intestino delgado (jejuno e íleo) e o mesentério. Qual é a principal função do mesentério em relação ao intestino delgado e qual sua importância para a absorção de nutrientes?
        <img src="https://brunooofernandesss.github.io/index.html/Anatomia/Michigan/Abdominal_Wall_Peritoneum_and_Intestines/EmbeddedImage-25.jpg" alt="Vista anterior da cavidade abdominal, com foco no jejuno e íleo do intestino delgado, bem como o mesentério.">`,
        options: [
          "1. O mesentério é um órgão digestivo primário responsável pela produção de enzimas.",
          "2. O mesentério é uma dobra do peritônio que fixa o intestino delgado à parede abdominal posterior, contendo vasos sanguíneos, linfáticos e nervos essenciais para a nutrição e função do intestino, e permitindo sua mobilidade controlada para a digestão e absorção de nutrientes.",
          "3. O mesentério é uma estrutura muscular que impulsiona o alimento através do intestino delgado.",
          "4. O mesentério é uma camada de gordura que isola o intestino delgado do restante do corpo.",
        ],
        correctAnswer: "2. O mesentério é uma dobra do peritônio que fixa o intestino delgado à parede abdominal posterior, contendo vasos sanguíneos, linfáticos e nervos essenciais para a nutrição e função do intestino, e permitindo sua mobilidade controlada para a digestão e absorção de nutrientes.",
        comment: "O mesentério é uma grande dobra de peritônio que conecta o jejuno e o íleo à parede abdominal posterior. Ele é vital porque serve como uma rota para os vasos sanguíneos (artérias jejunais e ileais da artéria mesentérica superior), vasos linfáticos e nervos que suprem o intestino delgado. Além de nutrir o intestino, o mesentério permite que o intestino delgado tenha mobilidade suficiente para o peristaltismo, ao mesmo tempo em que o mantém fixo em sua posição anatômica, facilitando os processos de digestão e absorção.",
        topic: "Peritônio: Mesentério, Intestino Delgado, Vascularização e Funções",
      },
      {
        question: `10. A imagem mostra a vascularização arterial do cólon, destacando a artéria mesentérica superior e seus ramos (artérias jejunais e ileais). Qual é a principal diferença na função das artérias jejunais e ileais em relação ao suprimento sanguíneo e suas implicações para a absorção de nutrientes em cada segmento?
        <img src="https://brunooofernandesss.github.io/index.html/Anatomia/Michigan/Abdominal_Wall_Peritoneum_and_Intestines/EmbeddedImage-36.jpg" alt="Vista anterior da cavidade abdominal, focando na artéria mesentérica superior e seus ramos.">`,
        options: [
          "1. As artérias jejunais e ileais são idênticas em sua distribuição e função, sem diferenças significativas.",
          "2. As artérias jejunais formam arcadas mais simples e longas com menos ramos retos, refletindo a maior vascularização e área de absorção do jejuno, enquanto as ileais formam arcadas mais complexas e curtas com mais ramos retos, indicando menor absorção.",
          "3. As artérias jejunais formam arcadas mais complexas e curtas, com mais vasos retos e menor suprimento sanguíneo, enquanto as ileais formam arcadas mais simples e longas, com menos vasos retos, refletindo a maior atividade absortiva do íleo.",
          "4. As artérias jejunais tendem a formar menos arcadas e mais ramos retos, enquanto as artérias ileais formam arcadas mais numerosas e complexas, com menos ramos retos, características que refletem as diferenças histológicas e funcionais entre o jejuno (maior absorção) e o íleo (principalmente absorção de vitamina B12 e sais biliares).",
        ],
        correctAnswer: "4. As artérias jejunais tendem a formar menos arcadas e mais ramos retos, enquanto as artérias ileais formam arcadas mais numerosas e complexas, com menos ramos retos, características que refletem as diferenças histológicas e funcionais entre o jejuno (maior absorção) e o íleo (principalmente absorção de vitamina B12 e sais biliares).",
        comment: "As artérias jejunais e ileais, ramos da artéria mesentérica superior, apresentam padrões de vascularização distintos que se correlacionam com as funções de cada segmento do intestino delgado. As artérias jejunais geralmente formam menos arcadas (alças vasculares) e dão origem a vasos retos mais longos e menos numerosos, o que é consistente com o jejuno sendo o principal local de absorção de nutrientes. Por outro lado, as artérias ileais formam arcadas mais numerosas e complexas, com vasos retos mais curtos e mais abundantes, refletindo a função do íleo na absorção específica de vitamina B12 e sais biliares, e um papel menor na absorção geral de nutrientes em comparação com o jejuno.",
        topic: "Anatomia do Intestino Delgado: Vascularização do Jejuno e Íleo, Artéria Mesentérica Superior, Função e Absorção",
      },
    ];

    function buildQuiz() {
      const output = [];

      questions.forEach((currentQuestion, questionNumber) => {
        const options = [];
        for (let i = 0; i < currentQuestion.options.length; i++) {
          options.push(
            `<label class="option" data-question="${questionNumber}" data-value="${currentQuestion.options[i]}">
              <img src="tesouras.png" class="scissor-icon" onclick="event.stopPropagation(); this.parentNode.classList.toggle('struck-through');">
              ${currentQuestion.options[i]}
            </label>`
          );
        }

        output.push(
          `<div class="card" id="question-${questionNumber}" data-topic="${currentQuestion.topic}">
            <div class="question">${currentQuestion.question}</div>
            <div class="options">${options.join("")}</div>
            <div class="comment" id="comment-${questionNumber}"></div>
          </div>`
        );
      });

      quizContainer.innerHTML = output.join("");
    }

    function showResults() {
      wrongQuestionIndices = [];
      errorCountByTopic = {};
      totalAnsweredQuestionsByTopic = {};
      currentWrongQuestionIndex = -1;
      hasErrors = false;
      isShowingErrors = false;
      isShowingDiagnosis = false;

      errorDiagnosisSection.style.display = 'none';
      topicsToReviewList.innerHTML = '';
      statusMessage.textContent = '';

      // Busca por todas as perguntas: estáticas e dinâmicas
      const allQuestionCards = document.querySelectorAll('.quiz-container .card, #newQuestionsContent .card');
      let correctAnswersCount = 0;
      let totalQuestionsAnswered = 0;

      console.log('🔍 Verificando', allQuestionCards.length, 'perguntas...');

      allQuestionCards.forEach((card, index) => {
        const questionEl = card.querySelector('.question') || card.querySelector('p');
        if (!questionEl) return;

        const questionText = questionEl.textContent.trim();
        const optionsContainer = card.querySelector('.options') || card;
        const allOptions = optionsContainer.querySelectorAll('.option, label.option, label');
        const userAnswerElement = optionsContainer.querySelector('.option.selected, label.selected');
        const commentDiv = card.querySelector('.comment');

        const questionTopic = card.dataset.topic || "Tópico não informado";
        
        console.log(`📝 Pergunta ${index + 1}: Tópico = "${questionTopic}"`);
        console.log(`🔍 Encontradas ${allOptions.length} alternativas`);
        
        // Remove classes anteriores
        allOptions.forEach(option => {
          option.classList.remove('correct', 'incorrect', 'selected');
        });
        if (commentDiv) commentDiv.classList.remove('show');

        let correctAnswerValue = null;
        let questionComment = null;

        // Verifica se é pergunta estática ou dinâmica
        const isStatic = card.id && card.id.startsWith('question-');
        if (isStatic) {
          // Pergunta estática - busca nos dados originais
          const questionData = questions.find(q => q.question.includes(questionText.substring(0, 50))); // substring para evitar problemas com imagens no texto
          if (questionData) {
            correctAnswerValue = questionData.correctAnswer.trim();
            questionComment = questionData.comment;
          }
        } else {
          // Pergunta dinâmica - busca pela opção marcada como correta
          const correctOpt = optionsContainer.querySelector('.option[data-answer="true"], label[data-answer="true"]');
          if (correctOpt) {
            correctAnswerValue = correctOpt.dataset.value?.trim() || correctOpt.textContent.trim();
            console.log(`✅ Resposta correta encontrada: "${correctAnswerValue}"`);
          } else {
            console.log('❌ Nenhuma resposta correta encontrada para pergunta dinâmica');
          }
          
          // Busca comentário no próprio card ou no div comment
          const commentElement = card.querySelector('.comment');
          if (commentElement && commentElement.textContent.trim()) {
            questionComment = commentElement.textContent.trim();
          }
        }

        // Processa resposta do usuário e aplica coloração
        let userAnswer = null;
        if (userAnswerElement) {
          userAnswerElement.classList.add('selected');
          userAnswer = userAnswerElement.dataset.value?.trim() || userAnswerElement.textContent.trim();
          totalQuestionsAnswered++;
          totalAnsweredQuestionsByTopic[questionTopic] = (totalAnsweredQuestionsByTopic[questionTopic] || 0) + 1;

          console.log(`👤 Resposta do usuário: "${userAnswer}"`);
          console.log(`🎯 Resposta correta: "${correctAnswerValue}"`);

          // Verifica se a resposta está correta
          if (userAnswer === correctAnswerValue) {
            correctAnswersCount++;
            console.log(`✅ Resposta correta!`);
          } else {
            hasErrors = true;
            errorCountByTopic[questionTopic] = (errorCountByTopic[questionTopic] || 0) + 1;
            console.log(`❌ Resposta incorreta para tópico: ${questionTopic}`);
          }
        }

        // Aplica coloração: SEMPRE marca a correta de verde, e a errada de vermelho se foi marcada
        allOptions.forEach(option => {
          const optionValue = option.dataset.value?.trim() || option.textContent.trim();
          
          // Marca a resposta correta de verde SEMPRE
          if (optionValue === correctAnswerValue) {
            option.classList.add('correct');
            console.log(`🟢 Marcando como correta: "${optionValue}"`);
          }
          
          // Se o usuário marcou uma resposta E ela está errada, marca de vermelho
          if (userAnswer && optionValue === userAnswer && userAnswer !== correctAnswerValue) {
            option.classList.add('incorrect');
            console.log(`🔴 Marcando como incorreta: "${optionValue}"`);
          }
        });

        // Mostra comentário se disponível
        if (commentDiv && questionComment) {
          commentDiv.textContent = questionComment;
          commentDiv.classList.add('show');
        }
      });

      // Exibe resultados
      resultsContainer.textContent = `Você acertou ${correctAnswersCount} de ${totalQuestionsAnswered} questões respondidas.`;

      console.log('📊 Erros por tópico:', errorCountByTopic);
      console.log('📊 Total por tópico:', totalAnsweredQuestionsByTopic);

      // Gera diagnóstico de erros
      if (hasErrors) {
        for (const topic in errorCountByTopic) {
          const errors = errorCountByTopic[topic];
          const total = totalAnsweredQuestionsByTopic[topic] || 0;
          if (total > 0) {
            const percent = ((errors / total) * 100).toFixed(1);
            const li = document.createElement('li');
            li.textContent = `${topic}: ${percent}% de erros (${errors} de ${total} questões respondidas)`;
            topicsToReviewList.appendChild(li);
          }
        }
      } else {
        const li = document.createElement('li');
        li.textContent = "🥳 Parabéns! Você não teve erros nas questões respondidas.";
        topicsToReviewList.appendChild(li);
      }

      errorDiagnosisSection.style.display = 'block';
      generatedQuestionsSection.style.display = 'block';
      generateNewQuestionsBtn.style.display = 'block';
      scrollToDiagnosis();
    }

    function scrollToQuestion(index) {
      const questionCard = document.getElementById(`question-${index}`);
      if (questionCard) {
        questionCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }
    }

    function scrollToDiagnosis() {
        errorDiagnosisSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    function scrollToGeneratedQuestions() {
        generatedQuestionsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    // Event listener para seleção de opções (funciona para estáticas e dinâmicas)
    document.addEventListener("click", function (event) {
      const clickedElement = event.target;
      const optionElement = clickedElement.closest('.option');

      if (optionElement) {
          if (clickedElement.classList.contains("scissor-icon")) {
              event.stopPropagation();
              optionElement.classList.toggle("struck-through");
          }
          else {
              const parentCard = optionElement.closest('.card');
              const currentQuestionOptions = parentCard.querySelectorAll('.option');

              currentQuestionOptions.forEach(opt => opt.classList.remove("selected"));
              optionElement.classList.add("selected");
          }
      }
    });

    generateNewQuestionsBtn.addEventListener("click", async function() {
        statusMessage.textContent = '⏳ Gerando novas perguntas...';
        generateNewQuestionsBtn.disabled = true;

        const topics = Object.keys(errorCountByTopic).filter(topic => {
            const errorsInTopic = errorCountByTopic[topic] || 0;
            const totalAnsweredInTopic = totalAnsweredQuestionsByTopic[topic] || 0;
            return errorsInTopic > 0 && totalAnsweredInTopic > 0;
        });

        const topicsToSend = topics.length > 0 ? topics : ["anatomia da parede abdominal", "anatomia do peritônio", "anatomia dos intestinos", "anatomia da cintura pélvica", "hérnias inguinais"];

        try {
            const response = await fetch('https://www.quizia.xyz/quiz', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ topicos: topicsToSend }),
            });

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const data = await response.json();

            newQuestionsContent.innerHTML = '';
            if (data && data.html) {
                console.log('📥 HTML recebido do Flask:', data.html);
                
                // Insere o HTML diretamente sem reconstrução complexa
                newQuestionsContent.innerHTML = data.html.replace(/```html|```/g, '');
                
                // Adiciona tesouras e ajusta formatação apenas se necessário
                newQuestionsContent.querySelectorAll('.card').forEach((card, cardIndex) => {
                    // Garante que o elemento de pergunta tenha a classe correta
                    const questionElement = card.querySelector('p');
                    if (questionElement && !questionElement.classList.contains('question')) {
                       questionElement.classList.add('question');
                    }

                    // Remove qualquer input de radio que possa existir e adiciona tesouras
                    card.querySelectorAll('label').forEach((label) => {
                        // Remove inputs de radio MAS preserva o atributo data-answer
                        const radioInput = label.querySelector('input[type="radio"]');
                        if (radioInput) {
                            // PRESERVA o atributo data-answer do input no label
                            if (radioInput.hasAttribute('data-answer')) {
                                label.setAttribute('data-answer', radioInput.getAttribute('data-answer'));
                            }
                            radioInput.remove();
                        }
                        
                        // Garante que tenha a classe option
                        if (!label.classList.contains('option')) {
                            label.classList.add('option');
                        }

                        // Garante que tenha data-value
                        if (!label.dataset.value) {
                            label.dataset.value = label.textContent.trim();
                        }

                        // Adiciona tesoura se não existir
                        if (!label.querySelector('.scissor-icon')) {
                            const scissorIcon = document.createElement('img');
                            scissorIcon.src = 'tesouras.png';
                            scissorIcon.className = 'scissor-icon';
                            scissorIcon.onclick = function(e) {
                                e.stopPropagation();
                                label.classList.toggle('struck-through');
                            };
                            label.insertBefore(scissorIcon, label.firstChild);
                        }
                    });

                    console.log(`🏷️ Card ${cardIndex}: data-topic = "${card.dataset.topic}"`);
                    
                    // Verifica se há opção correta marcada
                    const correctOption = card.querySelector('label[data-answer="true"]');
                    if (correctOption) {
                        console.log(`✅ Opção correta encontrada: "${correctOption.dataset.value}"`);
                    } else {
                        console.log('❌ Nenhuma opção correta encontrada');
                    }
                });
            } else {
                newQuestionsContent.innerHTML = "<p>Não foi possível gerar novas perguntas para os tópicos selecionados.</p>";
            }
            
            generatedQuestionsSection.style.display = 'block';
            scrollToGeneratedQuestions();
            statusMessage.textContent = '✅ Perguntas geradas com sucesso!';
            setTimeout(() => { statusMessage.textContent = '' }, 3000);

        } catch (error) {
            console.error('Erro ao gerar novas perguntas:', error);
            newQuestionsContent.innerHTML = `<p>Erro ao carregar novas perguntas: ${error.message}. Por favor, tente novamente.</p>`;
            generatedQuestionsSection.style.display = 'block';
            scrollToGeneratedQuestions();
            statusMessage.textContent = '❌ Erro na requisição: ' + error.message;
            setTimeout(() => { statusMessage.textContent = '' }, 5000);
        } finally {
            generateNewQuestionsBtn.disabled = false;
        }
    });

    // Inicialização
    buildQuiz();
    errorDiagnosisSection.style.display = 'none';
    generatedQuestionsSection.style.display = 'none';
    generateNewQuestionsBtn.style.display = 'none';

    // Event listener para o botão de verificar respostas
    document.getElementById("verifyAnswersBtn").addEventListener("click", showResults);
  </script>
</body>
</html>