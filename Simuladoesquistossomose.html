
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>Simulado Esquistossomose</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      background-color: #f4f4f4;
    }

    .quiz-container {
      max-width: 800px;
      width: 100%;
    }

    h1 {
      color: #333;
      text-align: center;
      margin-bottom: 30px;
    }

    .card {
      background-color: white;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .question {
      font-weight: bold;
      margin-bottom: 10px;
      color: #333;
    }

    .options {
      margin-top: 15px;
    }

    /* Estilos unificados para todas as op√ß√µes (est√°ticas e din√¢micas) */
    .option, label.option, label, #newQuestionsContent label {
      display: flex; /* Para alinhar imagem e texto */
      align-items: center;
      margin-bottom: 10px;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.2s ease;
      position: relative; /* Para posicionar a tesoura */
    }

    /* FOR√áA a remo√ß√£o de inputs de radio em QUALQUER lugar */
    .option input[type="radio"], 
    label input[type="radio"],
    #newQuestionsContent input[type="radio"],
    #newQuestionsContent label input[type="radio"] {
        display: none !important;
        visibility: hidden !important;
        opacity: 0 !important;
        position: absolute !important;
        left: -9999px !important;
    }

    .option:hover, 
    label.option:hover, 
    label:hover,
    #newQuestionsContent label:hover {
      background-color: #e9e9e9;
    }

    .option.selected, 
    label.option.selected, 
    label.selected,
    #newQuestionsContent label.selected {
      background-color: #d1e7dd;
      border-color: #28a745;
    }

    .option.correct, 
    label.option.correct, 
    label.correct,
    #newQuestionsContent label.correct {
      background-color: #d4edda;
      border-color: #28a745;
    }

    .option.incorrect, 
    label.option.incorrect, 
    label.incorrect,
    #newQuestionsContent label.incorrect {
      background-color: #f8d7da;
      border-color: #dc3545;
    }

    .submit-btn {
      display: block;
      width: 100%;
      padding: 15px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 18px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      margin-top: 30px;
    }

    .submit-btn:hover {
      background-color: #0056b3;
    }

    .results {
      text-align: center;
      margin-top: 30px;
      font-size: 20px;
      font-weight: bold;
      color: #333;
    }

    .scissor-icon {
      margin-right: 10px; /* Espa√ßo entre a tesoura e o texto da op√ß√£o */
      width: 20px; /* Ajuste conforme o tamanho da sua imagem */
      height: 20px; /* Ajuste conforme o tamanho da sua imagem */
      opacity: 0.5; /* Transpar√™ncia como no original */
      cursor: pointer;
    }

    .scissor-icon.hidden {
      display: none;
    }

    .struck-through {
      text-decoration: line-through;
      color: #888;
    }

    .comment {
      margin-top: 10px;
      padding: 10px;
      background-color: #f0f0f0;
      border-left: 4px solid #007bff;
      font-style: italic;
      color: #555;
      display: none; /* Escondido por padr√£o */
    }
    .comment.show {
      display: block; /* Mostrado quando ativado */
    }

    /* Estilos para o bot√£o de navega√ß√£o de erro / diagn√≥stico */
    .error-nav-btn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: #dc3545; /* Vermelho para erro */
      color: white;
      border: none;
      border-radius: 50%; /* Torna o bot√£o redondo */
      width: 60px;
      height: 60px;
      font-size: 24px;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      z-index: 1000;
      display: none; /* Escondido por padr√£o */
      flex-direction: column; /* Para empilhar o √≠cone e o contador */
      padding: 5px; /* Ajuste o padding para acomodar texto maior */
      box-sizing: border-box; /* Garante que padding n√£o aumente o tamanho total */
      text-align: center;
    }

    .error-nav-btn:hover {
      background-color: #c82333;
    }

    .error-nav-btn .arrow-icon {
      font-size: 30px; /* Tamanho da seta */
      line-height: 1; /* Ajuste para centralizar */
    }

    .error-nav-btn .button-text {
      font-size: 12px; /* Tamanho do texto abaixo da seta */
      line-height: 1;
      margin-top: 2px; /* Espa√ßo entre a seta e o texto */
    }

    /* Estilos para a se√ß√£o de diagn√≥stico de erros */
    .error-diagnosis-section {
        margin-top: 50px;
        padding: 30px;
        background-color: #ffe0b2; /* Um laranja claro ou similar */
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.15);
        display: none; /* Escondido por padr√£o */
        text-align: center;
        font-size: 1.1em;
        color: #333;
    }

    .error-diagnosis-section h2 {
        color: #e65100; /* Laranja mais escuro */
        margin-bottom: 20px;
        font-size: 1.8em;
    }

    .error-diagnosis-section ul {
        list-style: none; /* Remove marcadores de lista */
        padding: 0;
        margin: 0;
    }

    .error-diagnosis-section li {
        background-color: #ff9800; /* Laranja */
        color: white;
        padding: 8px 15px;
        margin: 8px 0;
        border-radius: 5px;
        display: inline-block; /* Para que os itens fiquem lado a lado */
        margin-right: 10px;
        font-weight: bold;
    }
    .error-diagnosis-section li:last-child {
        margin-right: 0;
    }
 .card-bloco {
      border: 1px solid #ddd;
      border-radius: 6px;
      padding: 10px;
      background: #fff;
      margin-bottom: 20px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    }
  </style>
</head>
<body>
  <div class="quiz-container">
    <h1 style="text-align:center; margin-bottom: 30px;">Simulado Esquistossomose</h1>
    <div class="card-bloco" id="quiz"></div>
    <button class="submit-btn" id="verifyAnswersBtn">Verificar Respostas</button>

    <button class="generate-questions-btn submit-btn" id="generateNewQuestionsBtn" style="display:none;">
      Gerar Novas Perguntas
    </button>

    <div class="results card-bloco" id="results"></div>
    <div id="statusMessage" style="text-align: center; margin-top: 10px; font-weight: bold; color: #007bff;"></div>

    <div class="error-diagnosis-section card-bloco" id="errorDiagnosis">
      <h2>Diagn√≥stico de Erros</h2>
      <p>Parece que voc√™ precisa revisar os seguintes assuntos:</p>
      <ul id="topicsToReview"></ul>
    </div>

    <div class="generated-questions-section card-bloco" id="generatedQuestionsSection" style="display:none;">
      <h2>Novas Perguntas Geradas</h2>
      <div id="newQuestionsContent"></div>
    </div>
  </div>
  
  <button class="error-nav-btn" id="errorNavBtn" style="display:none;">
    <span class="arrow-icon"></span>
    <span class="button-text"></span>
  </button>

  <script>
    const quizContainer = document.getElementById("quiz");
    const resultsContainer = document.getElementById("results");
    const errorNavBtn = document.getElementById("errorNavBtn");
    const arrowIcon = errorNavBtn.querySelector(".arrow-icon");
    const buttonText = errorNavBtn.querySelector(".button-text");
    const errorDiagnosisSection = document.getElementById("errorDiagnosis");
    const topicsToReviewList = document.getElementById("topicsToReview");
    const generateNewQuestionsBtn = document.getElementById("generateNewQuestionsBtn");
    const generatedQuestionsSection = document.getElementById("generatedQuestionsSection");
    const newQuestionsContent = document.getElementById("newQuestionsContent");
    const statusMessage = document.getElementById("statusMessage");

    let wrongQuestionIndices = [];
    let errorCountByTopic = {};
    let totalAnsweredQuestionsByTopic = {};
    let currentWrongQuestionIndex = -1;
    let hasErrors = false;
    let isShowingErrors = false;
    let isShowingDiagnosis = false;

    // Inicializa a visibilidade das se√ß√µes no carregamento
    errorDiagnosisSection.style.display = 'none';
    topicsToReviewList.innerHTML = '';
    statusMessage.textContent = '';

    const questions = [       {         question: "1. Qual √© o procedimento fundamental que a Dra. Fernanda cita para se ter certeza sobre a cura ou semicura de uma parasitose como o Trichuris?",         options: [           "A) An√°lise do hemograma.",           "B) Avalia√ß√£o cl√≠nica dos sintomas do paciente.",           "C) An√°lise de exame parasitol√≥gico de fezes.",           "D) Realiza√ß√£o de teste r√°pido para detec√ß√£o de ant√≠genos.",           "E) Bi√≥psia intestinal para detec√ß√£o do parasita.",         ],         correctAnswer: "C) An√°lise de exame parasitol√≥gico de fezes.",         comment: "A Dra. Fernanda ressalta que, para saber se houve cura ou semicura de parasitoses como o Trichuris, √© necess√°rio realizar a an√°lise de exame parasitol√≥gico de fezes.",         topic: "Diagn√≥stico Laboratorial de Parasitoses Intestinais",       },       {         question: "2. Qual √© a principal causa geral de todas as parasitoses, segundo a Dra. Fernanda?",         options: [           "A) Consumo de √°gua contaminada por cloro.",           "B) Falta de investimento na ind√∫stria farmac√™utica.",           "C) Condi√ß√µes sanit√°rias e de higiene inadequadas.",           "D) Alto n√∫mero de viagens e migra√ß√µes urbanas.",           "E) Desequil√≠brio ambiental causado pela morte de caramujos.",         ],         correctAnswer: "C) Condi√ß√µes sanit√°rias e de higiene inadequadas.",         comment: "A Dra. Fernanda afirma que todas as parasitoses est√£o ligadas a condi√ß√µes de falta de saneamento b√°sico e higieniza√ß√£o.",         topic: "Epidemiologia e Fatores de Risco de Parasitoses",       },       {         question: "3. Qual fator √© citado como o principal respons√°vel por grandes incid√™ncias de parasitoses no Brasil?",         options: [           "A) O clima tropical, que favorece a prolifera√ß√£o de vetores.",           "B) A falta de m√©dicos capazes de interpretar os exames.",           "C) O baixo investimento em saneamento b√°sico.",           "D) A resist√™ncia de parasitas ao tratamento com cloro.",           "E) A alta densidade populacional nas grandes cidades.",         ],         correctAnswer: "C) O baixo investimento em saneamento b√°sico.",         comment: "O baixo investimento em saneamento b√°sico no Brasil √© apontado como a raz√£o pela qual o pa√≠s tem grandes incid√™ncias de parasitoses.",         topic: "Sa√∫de P√∫blica e Saneamento B√°sico no Brasil",       },       {         question: "4. A respeito da √°gua de consumo, o que a Dra. Fernanda relata como um problema de sa√∫de p√∫blica, mesmo em regi√µes com algum saneamento?",         options: [           "A) A aus√™ncia total de cloro na √°gua da torneira.",           "B) A contamina√ß√£o por coliformes fecais na √°gua da torneira.",           "C) A prefer√™ncia das pessoas por √°gua fervida em vez de filtrada.",           "D) O alto custo dos filtros de √°gua, que impedem a higieniza√ß√£o.",           "E) A resist√™ncia dos v√≠rus ao tratamento de √°gua, como visto em casos virais.",         ],         correctAnswer: "B) A contamina√ß√£o por coliformes fecais na √°gua da torneira.",         comment: "A an√°lise da √°gua da torneira, como visto em contas de √°gua, pode mostrar uma porcentagem de coliformes fecais, mesmo que dentro de limites aceit√°veis, indicando uma contamina√ß√£o.",         topic: "Qualidade da √Ågua e Indicadores de Contamina√ß√£o (Coliformes)",       },       {         question: "5. Qual m√©todo de higieniza√ß√£o de frutas, verduras e legumes √© recomendado na aula?",         options: [           "A) Uso de √°lcool 70%.",           "B) Apenas lavagem com √°gua corrente.",           "C) Ferver os alimentos por 5 minutos.",           "D) Utiliza√ß√£o de √°gua sanit√°ria (hipoclorito) e posterior enx√°gue.",           "E) Limpeza com sal grosso e vinagre.",         ],         correctAnswer: "D) Utiliza√ß√£o de √°gua sanit√°ria (hipoclorito) e posterior enx√°gue.",         comment: "O m√©todo recomendado √© a adi√ß√£o de algumas gotas de √°gua sanit√°ria (cloro) na √°gua para a higieniza√ß√£o e, posteriormente, um bom enx√°gue.",         topic: "Recomenda√ß√µes de Higiene de Alimentos e Uso de Hipoclorito",       },       {         question: "6. Segundo o conte√∫do, qual termo √© usado para classificar uma doen√ßa que √© prevalente em uma regi√£o, mas possui baixo investimento em pesquisa e desenvolvimento de tratamentos?",         options: [           "A) Doen√ßa cr√¥nica.",           "B) Doen√ßa end√™mica.",           "C) Doen√ßa tropical.",           "D) Doen√ßa negligenciada.",           "E) Doen√ßa parasit√°ria.",         ],         correctAnswer: "D) Doen√ßa negligenciada.",         comment: "Uma doen√ßa prevalente em uma regi√£o, mas com pouca pesquisa e desenvolvimento para tratamento, √© classificada como doen√ßa negligenciada.",         topic: "Doen√ßas Tropicais Negligenciadas (DTNs)",       },       {         question: "7. Por que as doen√ßas cr√¥nicas, como hipertens√£o e diabetes, atraem mais investimento da ind√∫stria farmac√™utica do que as parasitoses, segundo a aula?",         options: [           "A) Porque os antibi√≥ticos para parasitoses s√£o muito baratos.",           "B) Porque o tratamento de parasitoses dura apenas cerca de 15 dias.",           "C) Porque as doen√ßas cr√¥nicas s√£o mais prevalentes no Brasil.",           "D) Porque as parasitoses n√£o s√£o pass√≠veis de preven√ß√£o.",           "E) Porque as doen√ßas cr√¥nicas n√£o s√£o negligenciadas.",         ],         correctAnswer: "B) Porque o tratamento de parasitoses dura apenas cerca de 15 dias.",         comment: "A ind√∫stria farmac√™utica investe menos em parasitoses porque o tratamento √© de curta dura√ß√£o (cerca de 15 dias), ao contr√°rio das doen√ßas cr√¥nicas, que exigem tratamento cont√≠nuo e, portanto, s√£o mais lucrativas.",         topic: "Fatores Econ√¥micos da Ind√∫stria Farmac√™utica e Pesquisa",       },       {         question: "8. Qual √© a melhor forma de combater as parasitoses no Brasil, de acordo com a Dra. Fernanda?",         options: [           "A) Aumentar a produ√ß√£o de medicamentos antiparasit√°rios.",           "B) Exterminar os hospedeiros intermedi√°rios, como caramujos.",           "C) Melhorar o diagn√≥stico atrav√©s de exames parasitol√≥gicos.",           "D) Promover a educa√ß√£o e sa√∫de.",           "E) Tratar todos os pacientes com antiparasit√°rios de 6 em 6 meses.",         ],         correctAnswer: "D) Promover a educa√ß√£o e sa√∫de.",         comment: "A conclus√£o da Dra. Fernanda √© que a educa√ß√£o em sa√∫de √© a melhor forma de combater as parasitoses no Brasil.",         topic: "Educa√ß√£o em Sa√∫de e Preven√ß√£o de Parasitoses",       },       {         question: "9. A Esquistossomose (Schistosomose Mansoni) √© popularmente conhecida como \"Barriga D'√°gua\" por qual raz√£o?",         options: [           "A) Pela alta incid√™ncia em pessoas que bebem √°gua n√£o filtrada.",           "B) Pela forma√ß√£o de p√°pulas na pele ap√≥s o contato com a √°gua.",           "C) Pelo aumento do volume abdominal devido ao ac√∫mulo de l√≠quido (ascite).",           "D) Pela elimina√ß√£o de ovos nas fezes, que contaminam rios e lagos.",           "E) Pela prefer√™ncia do parasita por viver em veias do sistema porta-hep√°tico.",         ],         correctAnswer: "C) Pelo aumento do volume abdominal devido ao ac√∫mulo de l√≠quido (ascite).",         comment: "O nome popular \"Barriga D'√°gua\" se deve √† manifesta√ß√£o cr√¥nica da doen√ßa, que √© o aumento do volume abdominal por ac√∫mulo de l√≠quido, tamb√©m chamado de ascite.",         topic: "Manifesta√ß√µes Cl√≠nicas da Esquistossomose (Ascite)",       },       {         question: "10. Qual √© a rela√ß√£o entre a condi√ß√£o imunol√≥gica do hospedeiro e o desenvolvimento de uma parasitose?",         options: [           "A) A condi√ß√£o imunol√≥gica n√£o tem rela√ß√£o, apenas a carga de infec√ß√£o √© importante.",           "B) Um indiv√≠duo imunocompetente sempre combate a infec√ß√£o, independentemente da carga parasit√°ria.",           "C) Um indiv√≠duo imunocompetente tem um sistema responsivo, mas uma carga de infec√ß√£o muito grande ainda pode levar √† doen√ßa.",           "D) O sistema imunol√≥gico s√≥ √© capaz de combater parasitas se a contamina√ß√£o for por √°gua salgada.",           "E) O sistema imunol√≥gico fraco (imunocompetente) √© o principal fator de risco para a parasitose.",         ],         correctAnswer: "C) Um indiv√≠duo imunocompetente tem um sistema responsivo, mas uma carga de infec√ß√£o muito grande ainda pode levar √† doen√ßa.",         comment: "A condi√ß√£o imunol√≥gica √© um fator de risco; se o indiv√≠duo √© imunocompetente, seu sistema √© responsivo. No entanto, se a carga de infec√ß√£o for muito grande, a chance de desenvolver a doen√ßa ainda √© alta.",         topic: "Intera√ß√£o Hospedeiro-Parasita e Carga Parasit√°ria",       },       {         question: "11. Qual √© o papel da migra√ß√£o humana na incid√™ncia de parasitoses?",         options: [           "A) Reduz a incid√™ncia ao dispersar a popula√ß√£o.",           "B) Aumenta o risco de contato com a cerc√°ria em pa√≠ses tropicais.",           "C) Pode levar √† dissemina√ß√£o de esp√©cies de parasitas (como o *S. japonicum*) para novas regi√µes (como o Brasil).",           "D) √â um fator de risco apenas para mal√°ria em regi√µes do Norte do Brasil.",           "E) Diminui o investimento em saneamento b√°sico nas √°reas mais populosas.",         ],         correctAnswer: "C) Pode levar √† dissemina√ß√£o de esp√©cies de parasitas (como o *S. japonicum*) para novas regi√µes (como o Brasil).",         comment: "A migra√ß√£o humana pode introduzir esp√©cies de parasitas n√£o end√™micas (como o *Schistosoma japonicum*, prevalente na √Åsia) em outras regi√µes, como o Brasil, aumentando a incid√™ncia dessas esp√©cies.",         topic: "Doen√ßas Infecciosas e Migra√ß√£o Internacional",       },       {         question: "12. Qual √© a denomina√ß√£o correta para o hospedeiro em que ocorre a reprodu√ß√£o sexuada do parasita?",         options: [           "A) Hospedeiro intermedi√°rio.",           "B) Hospedeiro definitivo.",           "C) Hospedeiro acidental.",           "D) Vetor biol√≥gico.",           "E) Reservat√≥rio.",         ],         correctAnswer: "B) Hospedeiro definitivo.",         comment: "O hospedeiro definitivo √© aquele em que ocorre a reprodu√ß√£o sexuada do parasita. No caso da esquistossomose, o homem √© o hospedeiro definitivo.",         topic: "Conceitos B√°sicos de Parasitologia (Hospedeiros)",       },       {         question: "13. No ciclo da Esquistossomose, quem √© o hospedeiro definitivo?",         options: [           "A) O caramujo do g√™nero *Biomphalaria*.",           "B) O homem.",           "C) O mosquito *Anopheles* (vetor da Mal√°ria).",           "D) O ovo liberado nas fezes.",           "E) O esquistoss√¥mulo (larva sem cauda).",         ],         correctAnswer: "B) O homem.",         comment: "O homem √© o hospedeiro definitivo, pois √© onde os vermes adultos se alojam e realizam a reprodu√ß√£o sexuada.",         topic: "Ciclo de Vida do *Schistosoma mansoni*",       },       {         question: "14. Como os ovos do *Schistosoma mansoni* conseguem passar dos vasos sangu√≠neos para o l√∫men intestinal, a fim de serem eliminados nas fezes?",         options: [           "A) Atrav√©s da circula√ß√£o linf√°tica.",           "B) Atrav√©s da ingest√£o de alimentos contaminados.",           "C) Atrav√©s de microles√µes causadas pela sua morfologia (esp√≠cula).",           "D) Atrav√©s de uma rea√ß√£o al√©rgica que rompe as paredes do vaso.",           "E) Atrav√©s da migra√ß√£o do mirac√≠dio para a luz intestinal.",         ],         correctAnswer: "C) Atrav√©s de microles√µes causadas pela sua morfologia (esp√≠cula).",         comment: "O ovo possui uma esp√≠cula que lhe permite atravessar por microles√µes (que podem gerar sangue oculto nas fezes) e chegar ao intestino, onde √© eliminado.",         topic: "Morfologia e Patogenicidade dos Ovos do *Schistosoma*",       },       {         question: "15. Qual √© o nome dado √† primeira forma larval da esquistossomose, que √© liberada do ovo na √°gua doce?",         options: [           "A) Cerc√°ria.",           "B) Esquistoss√¥mulo.",           "C) Mirac√≠dio.",           "D) Esporocisto.",           "E) Vermes adultos.",         ],         correctAnswer: "C) Mirac√≠dio.",         comment: "A larva liberada do ovo na √°gua doce √© o mirac√≠dio.",         topic: "Est√°gios Larvais da Esquistossomose",       },       {         question: "16. Qual √© a forma infectante do *Schistosoma mansoni* para o hospedeiro definitivo (homem)?",         options: [           "A) Ovo.",           "B) Mirac√≠dio.",           "C) Cerc√°ria.",           "D) Esquistoss√¥mulo.",           "E) Verme adulto.",         ],         correctAnswer: "C) Cerc√°ria.",         comment: "A cerc√°ria √© a larva infectante para o homem, pois ela penetra na pele por via cut√¢nea.",         topic: "Transmiss√£o da Esquistossomose",       },       {         question: "17. O que √© o hospedeiro intermedi√°rio no ciclo biol√≥gico da esquistossomose?",         options: [           "A) O caramujo do g√™nero *Biomphalaria*, onde o ovo se transforma em mirac√≠dio.",           "B) O homem, onde o parasita atinge a fase adulta.",           "C) O caramujo do g√™nero *Biomphalaria*, onde a larva mirac√≠dio passa por matura√ß√£o at√© se transformar em cerc√°ria.",           "D) A √°gua doce, onde ocorre a explos√£o do ovo.",           "E) O verme adulto no sistema porta-hep√°tico.",         ],         correctAnswer: "C) O caramujo do g√™nero *Biomphalaria*, onde a larva mirac√≠dio passa por matura√ß√£o at√© se transformar em cerc√°ria.",         comment: "O caramujo do g√™nero *Biomphalaria* √© o hospedeiro intermedi√°rio; dentro dele, a larva mirac√≠dio se desenvolve em cerc√°ria (a forma infectante).",         topic: "Hospedeiro Intermedi√°rio e G√™nero *Biomphalaria*",       },       {         question: "18. Qual caracter√≠stica da cerc√°ria permite que ela se localize na superf√≠cie da √°gua doce, perto da luz e do calor?",         options: [           "A) O tropismo qu√≠mico, que a atrai para as fezes.",           "B) A sua grande cauda bifurcada, que permite movimentos r√°pidos.",           "C) O tropismo pela luz e pelo calor.",           "D) O fato de ser um esporocisto, que a faz boiar.",           "E) A presen√ßa de microles√µes em sua cabe√ßa.",         ],         correctAnswer: "C) O tropismo pela luz e pelo calor.",         comment: "A cerc√°ria √© fototr√≥pica (atra√ß√£o por luz) e termotr√≥pica (atra√ß√£o por calor), por isso fica na superf√≠cie em √°guas doces e limpas, favorecendo a infec√ß√£o por meio dos membros inferiores.",         topic: "Comportamento da Cerc√°ria (Fototropismo/Termotropismo)",       },       {         question: "19. Qual processo o esquistoss√¥mulo realiza ao penetrar na pele do hospedeiro definitivo?",         options: [           "A) Libera√ß√£o de √≥vulos para iniciar a reprodu√ß√£o.",           "B) Transforma√ß√£o em mirac√≠dio para atingir os vasos.",           "C) Perda da cauda.",           "D) Multiplica√ß√£o por fiss√£o bin√°ria.",           "E) Invas√£o por via oral.",         ],         correctAnswer: "C) Perda da cauda.",         comment: "No momento da penetra√ß√£o na pele, a cerc√°ria perde a cauda e se torna o esquistoss√¥mulo.",         topic: "Fase de Penetra√ß√£o e Transforma√ß√£o Larval",       },       {         question: "20. Onde o verme adulto do *Schistosoma mansoni* se aloja no hospedeiro definitivo?",         options: [           "A) Nas paredes do intestino grosso e delgado.",           "B) No par√™nquima pulmonar e nos rins.",           "C) Nas veias do sistema porta-hep√°tico (regi√£o do intestino e f√≠gado).",           "D) Na cavidade abdominal, causando a ascite.",           "E) No tecido celular subcut√¢neo do local da penetra√ß√£o.",         ],         correctAnswer: "C) Nas veias do sistema porta-hep√°tico (regi√£o do intestino e f√≠gado).",         comment: "Os vermes adultos se alojam e se reproduzem nas veias do sistema porta-hep√°tico, pr√≥ximo ao intestino e f√≠gado.",         topic: "Localiza√ß√£o do Verme Adulto (*S. mansoni*)",       },       {         question: "21. Qual √© o principal mecanismo pelo qual o *Schistosoma mansoni* causa o ac√∫mulo de l√≠quido na cavidade abdominal (ascite), caracterizando a \"Barriga D'√°gua\"?",         options: [           "A) O extravasamento de ovos que causam uma rea√ß√£o inflamat√≥ria.",           "B) A vasodilata√ß√£o dos vasos sangu√≠neos causada pelos vermes, permitindo o extravasamento de plasma e l√≠quido.",           "C) A obstru√ß√£o total da luz intestinal pelos vermes adultos.",           "D) A destrui√ß√£o completa do tecido epitelial dos vasos sangu√≠neos.",           "E) A produ√ß√£o de enzimas pelo verme adulto, que aumenta a press√£o osm√≥tica.",         ],         correctAnswer: "B) A vasodilata√ß√£o dos vasos sangu√≠neos causada pelos vermes, permitindo o extravasamento de plasma e l√≠quido.",         comment: "O ac√∫mulo de l√≠quido (ascite) ocorre devido √† vasodilata√ß√£o e distens√£o dos vasos sangu√≠neos pelo verme, o que causa o extravasamento de prote√≠nas e plasma (l√≠quido) para o espa√ßo intercelular e para a cavidade abdominal.",         topic: "Mecanismo Fisiopatol√≥gico da Ascite na Esquistossomose",       },       {         question: "22. O que √© o Mirac√≠dio no ciclo da esquistossomose?",         options: [           "A) A forma adulta do parasita.",           "B) O ovo maduro e infectante.",           "C) A primeira larva liberada pelo ovo na √°gua doce.",           "D) O caramujo contaminado.",           "E) A larva infectante que penetra na pele.",         ],         correctAnswer: "C) A primeira larva liberada pelo ovo na √°gua doce.",         comment: "A larva liberada do ovo na √°gua doce √© o mirac√≠dio.",         topic: "Morfologia e Libera√ß√£o do Mirac√≠dio",       },       {         question: "23. Qual tipo de tropismo o Mirac√≠dio possui pelos caramujos?",         options: [           "A) Tropismo pela luz e calor.",           "B) Tropismo qu√≠mico.",           "C) Tropismo el√©trico.",           "D) Tropismo f√≠sico.",           "E) Tropismo por gravidade.",         ],         correctAnswer: "B) Tropismo qu√≠mico.",         comment: "O Mirac√≠dio √© atra√≠do para os caramujos por um tropismo qu√≠mico, agindo como metal e √≠m√£.",         topic: "Tropismo Qu√≠mico em Parasitas",       },       {         question: "24. Qual a import√¢ncia do caramujo *Biomphalaria* no ciclo da Esquistossomose?",         options: [           "A) √â o local onde a cerc√°ria perde a cauda.",           "B) √â o local onde o ovo √© depositado para se tornar mirac√≠dio.",           "C) √â o local onde o verme adulto se reproduz sexuadamente.",           "D) √â o hospedeiro intermedi√°rio onde o mirac√≠dio se desenvolve em cerc√°ria.",           "E) √â o local onde ocorre a vasodilata√ß√£o dos vasos.",         ],         correctAnswer: "D) √â o hospedeiro intermedi√°rio onde o mirac√≠dio se desenvolve em cerc√°ria.",         comment: "O caramujo √© o hospedeiro intermedi√°rio; dentro dele, a larva mirac√≠dio passa por est√°gios (como esporocisto) e se desenvolve em cerc√°ria.",         topic: "Papel do Hospedeiro Intermedi√°rio no Ciclo",       },       {         question: "25. Qual a caracter√≠stica morfol√≥gica do ovo do *Schistosoma mansoni* que contribui para sua elimina√ß√£o nas fezes?",         options: [           "A) Ele ser ovalado e n√£o ter cauda.",           "B) A presen√ßa de uma esp√≠cula (rabicho).",           "C) O fato de ser rico em melanina.",           "D) Sua grande mobilidade na luz intestinal.",           "E) O fato de ter caudas que o movem.",         ],         correctAnswer: "B) A presen√ßa de uma esp√≠cula (rabicho).",         comment: "O ovo do *S. mansoni* (o mais comum no Brasil) possui uma esp√≠cula, que √© uma das caracter√≠sticas que o permite atravessar as paredes do vaso para a elimina√ß√£o.",         topic: "Identifica√ß√£o Morfol√≥gica de Ovos de *Schistosoma*",       },       {         question: "26. Quais s√£o os dois tipos de formas que o *Schistosoma mansoni* apresenta (dimorfismo sexual)?",         options: [           "A) Mirac√≠dio e cerc√°ria.",           "B) Verme jovem e verme adulto.",           "C) Macho (curvado e menor) e F√™mea (alongada e fina).",           "D) Ov√≠para e Viv√≠para.",           "E) Esquistoss√¥mulo e Cerc√°ria.",         ],         correctAnswer: "C) Macho (curvado e menor) e F√™mea (alongada e fina).",         comment: "Os vermes adultos apresentam dimorfismo sexual, sendo o macho mais curto e curvado e a f√™mea mais longa e fina. A f√™mea se anexa ao macho para a reprodu√ß√£o.",         topic: "Dimorfismo Sexual em Helmintos",       },       {         question: "27. Por que a infec√ß√£o por cerc√°ria tende a acontecer em regi√µes mais rasas do rio (membros inferiores/p√©), em vez de nas profundezas?",         options: [           "A) Porque os mirac√≠dios j√° foram consumidos pelos peixes.",           "B) Porque as cerc√°rias t√™m tropismo pela luz e calor, ficando na superf√≠cie.",           "C) Porque a densidade populacional √© maior na superf√≠cie da √°gua.",           "D) Porque a √°gua salgada inibe a penetra√ß√£o em √°guas mais fundas.",           "E) Porque a presen√ßa de esgoto s√≥ ocorre nas margens.",         ],         correctAnswer: "B) Porque as cerc√°rias t√™m tropismo pela luz e calor, ficando na superf√≠cie.",         comment: "A cerc√°ria √© fototr√≥pica (atra√ß√£o por luz) e termotr√≥pica (atra√ß√£o por calor), por isso fica na superf√≠cie em √°guas doces e limpas, favorecendo a infec√ß√£o por meio dos membros inferiores.",         topic: "Rela√ß√£o Temperatura/Luminosidade e Sobreviv√™ncia da Cerc√°ria",       },       {         question: "28. No ciclo biol√≥gico, a penetra√ß√£o da cerc√°ria na pele ocorre por qual via?",         options: [           "A) Via oral (ingest√£o).",           "B) Via cut√¢nea (pele).",           "C) Via respirat√≥ria (inala√ß√£o).",           "D) Via vertical (m√£e-feto).",           "E) Via sexual (contato sexual).",         ],         correctAnswer: "B) Via cut√¢nea (pele).",         comment: "A cerc√°ria √© a forma infectante que invade o hospedeiro definitivo pela via cut√¢nea (pele).",         topic: "Vias de Infec√ß√£o por Parasitas",       },       {         question: "29. O que √© o Esquistoss√¥mulo no ciclo da esquistossomose?",         options: [           "A) A larva que se aloja no caramujo.",           "B) A larva que tem vida livre na √°gua.",           "C) A cerc√°ria que perdeu a cauda e est√° no hospedeiro definitivo.",           "D) O ovo maduro antes da eclos√£o.",           "E) O verme adulto no sistema porta.",         ],         correctAnswer: "C) A cerc√°ria que perdeu a cauda e est√° no hospedeiro definitivo.",         comment: "O esquistoss√¥mulo √© a larva cerc√°ria sem cauda, j√° dentro do hospedeiro definitivo, ap√≥s a penetra√ß√£o na pele.",         topic: "Desenvolvimento do *Schistosoma* no Hospedeiro Definitivo",       },       {         question: "30. Qual enzima √© liberada pela cerc√°ria para facilitar a sua penetra√ß√£o na pele do hospedeiro?",         options: [           "A) Lipases.",           "B) Amilases.",           "C) Proteases (enzimas proteol√≠ticas).",           "D) Nucleases.",           "E) Glicolases.",         ],         correctAnswer: "C) Proteases (enzimas proteol√≠ticas).",         comment: "A cerc√°ria libera enzimas proteol√≠ticas (proteases) que degradam as prote√≠nas da pele, permitindo que ela a penetre.",         topic: "Enzimologia da Penetra√ß√£o Cut√¢nea de Parasitas",       },       {         question: "31. Qual exame laboratorial √© citado como √∫til para a detec√ß√£o de microles√µes nos vasos sangu√≠neos causadas pelos ovos no intestino?",         options: [           "A) Hemograma completo.",           "B) Pesquisa de sangue oculto nas fezes.",           "C) An√°lise de urina (EAS).",           "D) Pesquisa de coliformes fecais.",           "E) Teste sorol√≥gico para anticorpos.",         ],         correctAnswer: "B) Pesquisa de sangue oculto nas fezes.",         comment: "As microles√µes causadas pelos ovos no intestino podem ser detectadas pela pesquisa de sangue oculto nas fezes.",         topic: "Exames Laboratoriais na Esquistossomose (Sangue Oculto)",       },       {         question: "32. Qual a principal c√©lula de defesa que aumenta em n√∫mero no sangue (eosinofilia) para tentar combater parasitas, conforme a aula?",         options: [           "A) Linf√≥citos.",           "B) Neutr√≥filos.",           "C) Bas√≥filos.",           "D) Eosin√≥filos.",           "E) Mon√≥citos.",         ],         correctAnswer: "D) Eosin√≥filos.",         comment: "O aumento do n√∫mero de eosin√≥filos (eosinofilia) no hemograma √© uma resposta imunol√≥gica comum em infec√ß√µes parasit√°rias.",         topic: "Imunologia da Resposta Contra Helmintos (Eosinofilia)",       },       {         question: "33. Qual manifesta√ß√£o cl√≠nica ocorre no local da penetra√ß√£o da cerc√°ria (via cut√¢nea)?",         options: [           "A) Ascite abdominal.",           "B) Hepatomegalia e esplenomegalia.",           "C) Febre e calafrios.",           "D) Edema, hiperemia, prurido e forma√ß√£o de p√°pulas.",           "E) Perda de peso e anemia.",         ],         correctAnswer: "D) Edema, hiperemia, prurido e forma√ß√£o de p√°pulas.",         comment: "A infec√ß√£o inicial causa uma inflama√ß√£o no local de penetra√ß√£o, caracterizada por edema (incha√ßo), hiperemia (vermelhid√£o), prurido (coceira) e forma√ß√£o de p√°pulas (pequenos pontos).",         topic: "Dermatite Cercariana e Sinais de Inflama√ß√£o",       },       {         question: "34. Qual esp√©cie de *Schistosoma* n√£o end√™mica no Brasil, mas com relatos de aparecimento no pa√≠s e que afeta o trato urin√°rio, √© citada na aula?",         options: [           "A) *Schistosoma mansoni*.",           "B) *Schistosoma japonicum*.",           "C) *Schistosoma haematobium*.",           "D) *Trichuris trichiura*.",           "E) *Ascaris lumbricoides*.",         ],         correctAnswer: "C) *Schistosoma haematobium*.",         comment: "O *Schistosoma haematobium* √© citado como uma esp√©cie que afeta o trato urin√°rio e, embora n√£o fosse prevalente no Brasil, tem sido encontrado, exigindo a pesquisa de ovos na urina.",         topic: "Tipos de Esquistossomose (Intestinal vs. Urin√°ria)",       },       {         question: "35. A aus√™ncia de qual hospedeiro no ciclo da Esquistossomose resultaria na interrup√ß√£o do ciclo?",         options: [           "A) Apenas o homem, por ser o hospedeiro definitivo.",           "B) Apenas o caramujo, por ser o hospedeiro intermedi√°rio.",           "C) Tanto o homem quanto o caramujo, pois o ciclo √© di√≥ico.",           "D) Apenas o ovo, pois √© a forma de resist√™ncia no ambiente.",           "E) Apenas a √°gua doce, pois o mirac√≠dio morreria.",         ],         correctAnswer: "C) Tanto o homem quanto o caramujo, pois o ciclo √© di√≥ico.",         comment: "Por ser um ciclo di√≥ico (necessita de dois hospedeiros), a aus√™ncia do caramujo (hospedeiro intermedi√°rio) impede o desenvolvimento da cerc√°ria, e a aus√™ncia do homem (hospedeiro definitivo) impede a reprodu√ß√£o sexuada e a deposi√ß√£o de ovos. Portanto, ambos s√£o essenciais.",         topic: "Ciclo Di√≥ico e Interrup√ß√£o da Transmiss√£o",       },       {         question: "36. A respeito da penetra√ß√£o da cerc√°ria, qual √© uma caracter√≠stica importante citada na aula?",         options: [           "A) A cerc√°ria s√≥ consegue penetrar em pele com les√µes ou feridas abertas.",           "B) A cerc√°ria penetra na pele intacta, devido √†s enzimas proteol√≠ticas.",           "C) A cerc√°ria penetra na pele intacta apenas se a √°gua estiver salgada.",           "D) A cerc√°ria precisa da cauda para perfurar a pele.",           "E) A cerc√°ria penetra na pele por absor√ß√£o, sem necessidade de enzimas.",         ],         correctAnswer: "B) A cerc√°ria penetra na pele intacta, devido √†s enzimas proteol√≠ticas.",         comment: "A cerc√°ria √© capaz de penetrar na pele intacta devido √† produ√ß√£o de enzimas proteol√≠ticas.",         topic: "Barreiras Epiteliais e Invas√£o Parasit√°ria",       },       {         question: "37. Qual √© a denomina√ß√£o correta para o hospedeiro que, no ciclo da Esquistossomose, √© o caramujo?",         options: [           "A) Hospedeiro definitivo.",           "B) Hospedeiro vetor.",           "C) Hospedeiro intermedi√°rio.",           "D) Hospedeiro de reprodu√ß√£o assexuada.",           "E) Hospedeiro de reserva.",         ],         correctAnswer: "C) Hospedeiro intermedi√°rio.",         comment: "O caramujo √© o hospedeiro intermedi√°rio, pois a larva se transforma e se multiplica dentro dele (transforma√ß√£o de mirac√≠dio em cerc√°ria).",         topic: "Diferencia√ß√£o entre Hospedeiro Definitivo e Intermedi√°rio",       },       {         question: "38. Qual dos seguintes fatores n√£o √© listado como uma condi√ß√£o ambiental favor√°vel para as parasitoses?",         options: [           "A) Umidade.",           "B) Temperatura.",           "C) Ventila√ß√£o.",           "D) Clima tropical.",           "E) √Ågua salgada.",         ],         correctAnswer: "E) √Ågua salgada.",         comment: "As larvas da esquistossomose necessitam de √°gua doce, e o ovo n√£o explode em √°gua salgada, interrompendo o ciclo. Portanto, a √°gua salgada n√£o √© favor√°vel.",         topic: "Condi√ß√µes Ambientais e Fatores Abi√≥ticos do Ciclo",       },       {         question: "39. O que significa o termo \"eosinofilia\" em um hemograma, e com o que se relaciona na aula?",         options: [           "A) Diminui√ß√£o do n√∫mero de eosin√≥filos, indicando infec√ß√£o viral.",           "B) Aumento do n√∫mero de eosin√≥filos, sendo uma resposta contra parasitas.",           "C) Aumento da febre e mal-estar no paciente, sendo um sinal inespec√≠fico.",           "D) Processo inflamat√≥rio localizado, como o que ocorre na pele.",           "E) Diminui√ß√£o da febre no paciente, indicando que o parasita foi combatido.",         ],         correctAnswer: "B) Aumento do n√∫mero de eosin√≥filos, sendo uma resposta contra parasitas.",         comment: "Eosinofilia √© o aumento do n√∫mero de eosin√≥filos, uma das c√©lulas de defesa que o corpo utiliza para combater parasitas.",         topic: "Interpreta√ß√£o de Hemogramas em Parasitologia",       },       {         question: "40. Qual √© a denomina√ß√£o correta para a reprodu√ß√£o que ocorre no hospedeiro definitivo (homem) no ciclo da Esquistossomose?",         options: [           "A) Reprodu√ß√£o assexuada.",           "B) Reprodu√ß√£o vegetativa.",           "C) Reprodu√ß√£o sexuada.",           "D) Reprodu√ß√£o por esporocisto.",           "E) Reprodu√ß√£o por fiss√£o bin√°ria.",         ],         correctAnswer: "C) Reprodu√ß√£o sexuada.",         comment: "O hospedeiro definitivo √© o local onde os vermes adultos realizam a reprodu√ß√£o sexuada, resultando na deposi√ß√£o de ovos.",         topic: "Tipos de Reprodu√ß√£o em Parasitas (Assexuada vs. Sexuada)",       },     ];

    function buildQuiz() {
      const output = [];

      questions.forEach((currentQuestion, questionNumber) => {
        const options = [];
        for (let i = 0; i < currentQuestion.options.length; i++) {
          options.push(
            `<label class="option" data-question="${questionNumber}" data-value="${currentQuestion.options[i]}">
              <img src="tesouras.png" class="scissor-icon" onclick="event.stopPropagation(); this.parentNode.classList.toggle('struck-through');">
              ${currentQuestion.options[i]}
            </label>`
          );
        }

        output.push(
          `<div class="card" id="question-${questionNumber}" data-topic="${currentQuestion.topic}">
            <div class="question">${currentQuestion.question}</div>
            <div class="options">${options.join("")}</div>
            <div class="comment" id="comment-${questionNumber}"></div>
          </div>`
        );
      });

      quizContainer.innerHTML = output.join("");
    }

    function showResults() {
      wrongQuestionIndices = [];
      errorCountByTopic = {};
      totalAnsweredQuestionsByTopic = {};
      currentWrongQuestionIndex = -1;
      hasErrors = false;
      isShowingErrors = false;
      isShowingDiagnosis = false;

      errorDiagnosisSection.style.display = 'none';
      topicsToReviewList.innerHTML = '';
      statusMessage.textContent = '';

      // Busca por todas as perguntas: est√°ticas e din√¢micas
      const allQuestionCards = document.querySelectorAll('.quiz-container .card, #newQuestionsContent .card');
      let correctAnswersCount = 0;
      let totalQuestionsAnswered = 0;

      console.log('üîç Verificando', allQuestionCards.length, 'perguntas...');

      allQuestionCards.forEach((card, index) => {
        const questionEl = card.querySelector('.question') || card.querySelector('p');
        if (!questionEl) return;

        const questionText = questionEl.textContent.trim();
        const optionsContainer = card.querySelector('.options') || card;
        const allOptions = optionsContainer.querySelectorAll('.option, label.option, label');
        const userAnswerElement = optionsContainer.querySelector('.option.selected, label.selected');
        const commentDiv = card.querySelector('.comment');

        const questionTopic = card.dataset.topic || "T√≥pico n√£o informado";
        
        console.log(`üìù Pergunta ${index + 1}: T√≥pico = "${questionTopic}"`);
        console.log(`üîç Encontradas ${allOptions.length} alternativas`);
        
        // Remove classes anteriores
        allOptions.forEach(option => {
          option.classList.remove('correct', 'incorrect', 'selected');
        });
        if (commentDiv) commentDiv.classList.remove('show');

        let correctAnswerValue = null;
        let questionComment = null;

        // Verifica se √© pergunta est√°tica ou din√¢mica
        const isStatic = card.id && card.id.startsWith('question-');
        if (isStatic) {
          // Pergunta est√°tica - busca nos dados originais
          const questionData = questions.find(q => q.question.trim() === questionText);
          if (questionData) {
            correctAnswerValue = questionData.correctAnswer.trim();
            questionComment = questionData.comment;
          }
        } else {
          // Pergunta din√¢mica - busca pela op√ß√£o marcada como correta
          const correctOpt = optionsContainer.querySelector('.option[data-answer="true"], label[data-answer="true"]');
          if (correctOpt) {
            correctAnswerValue = correctOpt.dataset.value?.trim() || correctOpt.textContent.trim();
            console.log(`‚úÖ Resposta correta encontrada: "${correctAnswerValue}"`);
          } else {
            console.log('‚ùå Nenhuma resposta correta encontrada para pergunta din√¢mica');
          }
          
          // Busca coment√°rio no pr√≥prio card ou no div comment
          const commentElement = card.querySelector('.comment');
          if (commentElement && commentElement.textContent.trim()) {
            questionComment = commentElement.textContent.trim();
          }
        }

        // Processa resposta do usu√°rio e aplica colora√ß√£o
        let userAnswer = null;
        if (userAnswerElement) {
          userAnswerElement.classList.add('selected');
          userAnswer = userAnswerElement.dataset.value?.trim() || userAnswerElement.textContent.trim();
          totalQuestionsAnswered++;
          totalAnsweredQuestionsByTopic[questionTopic] = (totalAnsweredQuestionsByTopic[questionTopic] || 0) + 1;

          console.log(`üë§ Resposta do usu√°rio: "${userAnswer}"`);
          console.log(`üéØ Resposta correta: "${correctAnswerValue}"`);

          // Verifica se a resposta est√° correta
          if (userAnswer === correctAnswerValue) {
            correctAnswersCount++;
            console.log(`‚úÖ Resposta correta!`);
          } else {
            hasErrors = true;
            errorCountByTopic[questionTopic] = (errorCountByTopic[questionTopic] || 0) + 1;
            console.log(`‚ùå Resposta incorreta para t√≥pico: ${questionTopic}`);
          }
        }

        // Aplica colora√ß√£o: SEMPRE marca a correta de verde, e a errada de vermelho se foi marcada
        allOptions.forEach(option => {
          const optionValue = option.dataset.value?.trim() || option.textContent.trim();
          
          // Marca a resposta correta de verde SEMPRE
          if (optionValue === correctAnswerValue) {
            option.classList.add('correct');
            console.log(`üü¢ Marcando como correta: "${optionValue}"`);
          }
          
          // Se o usu√°rio marcou uma resposta E ela est√° errada, marca de vermelho
          if (userAnswer && optionValue === userAnswer && userAnswer !== correctAnswerValue) {
            option.classList.add('incorrect');
            console.log(`üî¥ Marcando como incorreta: "${optionValue}"`);
          }
        });

        // Mostra coment√°rio se dispon√≠vel
        if (commentDiv && questionComment) {
          commentDiv.textContent = questionComment;
          commentDiv.classList.add('show');
        }
      });

      // Exibe resultados
      resultsContainer.textContent = `Voc√™ acertou ${correctAnswersCount} de ${totalQuestionsAnswered} quest√µes respondidas.`;

      console.log('üìä Erros por t√≥pico:', errorCountByTopic);
      console.log('üìä Total por t√≥pico:', totalAnsweredQuestionsByTopic);

      // Gera diagn√≥stico de erros
      if (hasErrors) {
        for (const topic in errorCountByTopic) {
          const errors = errorCountByTopic[topic];
          const total = totalAnsweredQuestionsByTopic[topic] || 0;
          if (total > 0) {
            const percent = ((errors / total) * 100).toFixed(1);
            const li = document.createElement('li');
            li.textContent = `${topic}: ${percent}% de erros (${errors} de ${total} quest√µes respondidas)`;
            topicsToReviewList.appendChild(li);
          }
        }
      } else {
        const li = document.createElement('li');
        li.textContent = "ü•≥ Parab√©ns! Voc√™ n√£o teve erros nas quest√µes respondidas.";
        topicsToReviewList.appendChild(li);
      }

      errorDiagnosisSection.style.display = 'block';
      generatedQuestionsSection.style.display = 'block';
      generateNewQuestionsBtn.style.display = 'block';
      scrollToDiagnosis();
    }

    function scrollToQuestion(index) {
      const questionCard = document.getElementById(`question-${index}`);
      if (questionCard) {
        questionCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }
    }

    function scrollToDiagnosis() {
        errorDiagnosisSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    function scrollToGeneratedQuestions() {
        generatedQuestionsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    // Event listener para sele√ß√£o de op√ß√µes (funciona para est√°ticas e din√¢micas)
    document.addEventListener("click", function (event) {
      const clickedElement = event.target;
      const optionElement = clickedElement.closest('.option');

      if (optionElement) {
          if (clickedElement.classList.contains("scissor-icon")) {
              event.stopPropagation();
              optionElement.classList.toggle("struck-through");
          }
          else {
              const parentCard = optionElement.closest('.card');
              const currentQuestionOptions = parentCard.querySelectorAll('.option');

              currentQuestionOptions.forEach(opt => opt.classList.remove("selected"));
              optionElement.classList.add("selected");
          }
      }
    });

    generateNewQuestionsBtn.addEventListener("click", async function() {
        statusMessage.textContent = '‚è≥ Gerando novas perguntas...';
        generateNewQuestionsBtn.disabled = true;

        const topics = Object.keys(errorCountByTopic).filter(topic => {
            const errorsInTopic = errorCountByTopic[topic] || 0;
            const totalAnsweredInTopic = totalAnsweredQuestionsByTopic[topic] || 0;
            return errorsInTopic > 0 && totalAnsweredInTopic > 0;
        });

        const topicsToSend = topics.length > 0 ? topics : ["fisiologia celular", "biologia"];

        try {
            const response = await fetch('https://www.quizia.xyz/quiz', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ topicos: topicsToSend }),
            });

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const data = await response.json();

            newQuestionsContent.innerHTML = '';
            if (data && data.html) {
                console.log('üì• HTML recebido do Flask:', data.html);
                
                // Insere o HTML diretamente sem reconstru√ß√£o complexa
                newQuestionsContent.innerHTML = data.html.replace(/```html|```/g, '');
                
                // Adiciona tesouras e ajusta formata√ß√£o apenas se necess√°rio
                newQuestionsContent.querySelectorAll('.card').forEach((card, cardIndex) => {
                    // Garante que o elemento de pergunta tenha a classe correta
                    const questionElement = card.querySelector('p');
                    if (questionElement && !questionElement.classList.contains('question')) {
                       questionElement.classList.add('question');
                    }

                    // Remove qualquer input de radio que possa existir e adiciona tesouras
                    card.querySelectorAll('label').forEach((label) => {
                        // Remove inputs de radio MAS preserva o atributo data-answer
                        const radioInput = label.querySelector('input[type="radio"]');
                        if (radioInput) {
                            // PRESERVA o atributo data-answer do input no label
                            if (radioInput.hasAttribute('data-answer')) {
                                label.setAttribute('data-answer', radioInput.getAttribute('data-answer'));
                            }
                            radioInput.remove();
                        }
                        
                        // Garante que tenha a classe option
                        if (!label.classList.contains('option')) {
                            label.classList.add('option');
                        }

                        // Garante que tenha data-value
                        if (!label.dataset.value) {
                            label.dataset.value = label.textContent.trim();
                        }

                        // Adiciona tesoura se n√£o existir
                        if (!label.querySelector('.scissor-icon')) {
                            const scissorIcon = document.createElement('img');
                            scissorIcon.src = 'tesouras.png';
                            scissorIcon.className = 'scissor-icon';
                            scissorIcon.onclick = function(e) {
                                e.stopPropagation();
                                label.classList.toggle('struck-through');
                            };
                            label.insertBefore(scissorIcon, label.firstChild);
                        }
                    });

                    console.log(`üè∑Ô∏è Card ${cardIndex}: data-topic = "${card.dataset.topic}"`);
                    
                    // Verifica se h√° op√ß√£o correta marcada
                    const correctOption = card.querySelector('label[data-answer="true"]');
                    if (correctOption) {
                        console.log(`‚úÖ Op√ß√£o correta encontrada: "${correctOption.dataset.value}"`);
                    } else {
                        console.log('‚ùå Nenhuma op√ß√£o correta encontrada');
                    }
                });
            } else {
                newQuestionsContent.innerHTML = "<p>N√£o foi poss√≠vel gerar novas perguntas para os t√≥picos selecionados.</p>";
            }
            
            generatedQuestionsSection.style.display = 'block';
            scrollToGeneratedQuestions();
            statusMessage.textContent = '‚úÖ Perguntas geradas com sucesso!';
            setTimeout(() => { statusMessage.textContent = '' }, 3000);

        } catch (error) {
            console.error('Erro ao gerar novas perguntas:', error);
            newQuestionsContent.innerHTML = `<p>Erro ao carregar novas perguntas: ${error.message}. Por favor, tente novamente.</p>`;
            generatedQuestionsSection.style.display = 'block';
            scrollToGeneratedQuestions();
            statusMessage.textContent = '‚ùå Erro na requisi√ß√£o: ' + error.message;
            setTimeout(() => { statusMessage.textContent = '' }, 5000);
        } finally {
            generateNewQuestionsBtn.disabled = false;
        }
    });

    // Inicializa√ß√£o
    buildQuiz();
    errorDiagnosisSection.style.display = 'none';
    generatedQuestionsSection.style.display = 'none';
    generateNewQuestionsBtn.style.display = 'none';

    // Event listener para o bot√£o de verificar respostas
    document.getElementById("verifyAnswersBtn").addEventListener("click", showResults);
  </script>
</body>
<script src="navegacao.js"></script></html>
