<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>Simulado Esquistossomose</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      background-color: #f4f4f4;
    }

    .quiz-container {
      max-width: 800px;
      width: 100%;
    }

    h1 {
      color: #333;
      text-align: center;
      margin-bottom: 30px;
    }

    .card {
      background-color: white;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .question {
      font-weight: bold;
      margin-bottom: 10px;
      color: #333;
    }

    .options {
      margin-top: 15px;
    }

    /* Estilos unificados para todas as opções (estáticas e dinâmicas) */
    .option, label.option, label, #newQuestionsContent label {
      display: flex; /* Para alinhar imagem e texto */
      align-items: center;
      margin-bottom: 10px;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.2s ease;
      position: relative; /* Para posicionar a tesoura */
    }

    /* FORÇA a remoção de inputs de radio em QUALQUER lugar */
    .option input[type="radio"], 
    label input[type="radio"],
    #newQuestionsContent input[type="radio"],
    #newQuestionsContent label input[type="radio"] {
        display: none !important;
        visibility: hidden !important;
        opacity: 0 !important;
        position: absolute !important;
        left: -9999px !important;
    }

    .option:hover, 
    label.option:hover, 
    label:hover,
    #newQuestionsContent label:hover {
      background-color: #e9e9e9;
    }

    .option.selected, 
    label.option.selected, 
    label.selected,
    #newQuestionsContent label.selected {
      background-color: #d1e7dd;
      border-color: #28a745;
    }

    .option.correct, 
    label.option.correct, 
    label.correct,
    #newQuestionsContent label.correct {
      background-color: #d4edda;
      border-color: #28a745;
    }

    .option.incorrect, 
    label.option.incorrect, 
    label.incorrect,
    #newQuestionsContent label.incorrect {
      background-color: #f8d7da;
      border-color: #dc3545;
    }

    .submit-btn {
      display: block;
      width: 100%;
      padding: 15px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 18px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      margin-top: 30px;
    }

    .submit-btn:hover {
      background-color: #0056b3;
    }

    .results {
      text-align: center;
      margin-top: 30px;
      font-size: 20px;
      font-weight: bold;
      color: #333;
    }

    .scissor-icon {
      margin-right: 10px; /* Espaço entre a tesoura e o texto da opção */
      width: 20px; /* Ajuste conforme o tamanho da sua imagem */
      height: 20px; /* Ajuste conforme o tamanho da sua imagem */
      opacity: 0.5; /* Transparência como no original */
      cursor: pointer;
    }

    .scissor-icon.hidden {
      display: none;
    }

    .struck-through {
      text-decoration: line-through;
      color: #888;
    }

    .comment {
      margin-top: 10px;
      padding: 10px;
      background-color: #f0f0f0;
      border-left: 4px solid #007bff;
      font-style: italic;
      color: #555;
      display: none; /* Escondido por padrão */
    }
    .comment.show {
      display: block; /* Mostrado quando ativado */
    }

    /* Estilos para o botão de navegação de erro / diagnóstico */
    .error-nav-btn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: #dc3545; /* Vermelho para erro */
      color: white;
      border: none;
      border-radius: 50%; /* Torna o botão redondo */
      width: 60px;
      height: 60px;
      font-size: 24px;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      z-index: 1000;
      display: none; /* Escondido por padrão */
      flex-direction: column; /* Para empilhar o ícone e o contador */
      padding: 5px; /* Ajuste o padding para acomodar texto maior */
      box-sizing: border-box; /* Garante que padding não aumente o tamanho total */
      text-align: center;
    }

    .error-nav-btn:hover {
      background-color: #c82333;
    }

    .error-nav-btn .arrow-icon {
      font-size: 30px; /* Tamanho da seta */
      line-height: 1; /* Ajuste para centralizar */
    }

    .error-nav-btn .button-text {
      font-size: 12px; /* Tamanho do texto abaixo da seta */
      line-height: 1;
      margin-top: 2px; /* Espaço entre a seta e o texto */
    }

    /* Estilos para a seção de diagnóstico de erros */
    .error-diagnosis-section {
        margin-top: 50px;
        padding: 30px;
        background-color: #ffe0b2; /* Um laranja claro ou similar */
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.15);
        display: none; /* Escondido por padrão */
        text-align: center;
        font-size: 1.1em;
        color: #333;
    }

    .error-diagnosis-section h2 {
        color: #e65100; /* Laranja mais escuro */
        margin-bottom: 20px;
        font-size: 1.8em;
    }

    .error-diagnosis-section ul {
        list-style: none; /* Remove marcadores de lista */
        padding: 0;
        margin: 0;
    }

    .error-diagnosis-section li {
        background-color: #ff9800; /* Laranja */
        color: white;
        padding: 8px 15px;
        margin: 8px 0;
        border-radius: 5px;
        display: inline-block; /* Para que os itens fiquem lado a lado */
        margin-right: 10px;
        font-weight: bold;
    }
    .error-diagnosis-section li:last-child {
        margin-right: 0;
    }
 .card-bloco {
      border: 1px solid #ddd;
      border-radius: 6px;
      padding: 10px;
      background: #fff;
      margin-bottom: 20px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    }
  </style>
</head>
<body>
  <div class="quiz-container">
    <h1 style="text-align:center; margin-bottom: 30px;">Simulado Esquistossomose</h1>
    <div class="card-bloco" id="quiz"></div>
    <button class="submit-btn" id="verifyAnswersBtn">Verificar Respostas</button>

    <button class="generate-questions-btn submit-btn" id="generateNewQuestionsBtn" style="display:none;">
      Gerar Novas Perguntas
    </button>

    <div class="results card-bloco" id="results"></div>
    <div id="statusMessage" style="text-align: center; margin-top: 10px; font-weight: bold; color: #007bff;"></div>

    <div class="error-diagnosis-section card-bloco" id="errorDiagnosis">
      <h2>Diagnóstico de Erros</h2>
      <p>Parece que você precisa revisar os seguintes assuntos:</p>
      <ul id="topicsToReview"></ul>
    </div>

    <div class="generated-questions-section card-bloco" id="generatedQuestionsSection" style="display:none;">
      <h2>Novas Perguntas Geradas</h2>
      <div id="newQuestionsContent"></div>
    </div>
  </div>
  
  <button class="error-nav-btn" id="errorNavBtn" style="display:none;">
    <span class="arrow-icon"></span>
    <span class="button-text"></span>
  </button>

  <script>
    const quizContainer = document.getElementById("quiz");
    const resultsContainer = document.getElementById("results");
    const errorNavBtn = document.getElementById("errorNavBtn");
    const arrowIcon = errorNavBtn.querySelector(".arrow-icon");
    const buttonText = errorNavBtn.querySelector(".button-text");
    const errorDiagnosisSection = document.getElementById("errorDiagnosis");
    const topicsToReviewList = document.getElementById("topicsToReview");
    const generateNewQuestionsBtn = document.getElementById("generateNewQuestionsBtn");
    const generatedQuestionsSection = document.getElementById("generatedQuestionsSection");
    const newQuestionsContent = document.getElementById("newQuestionsContent");
    const statusMessage = document.getElementById("statusMessage");

    let wrongQuestionIndices = [];
    let errorCountByTopic = {};
    let totalAnsweredQuestionsByTopic = {};
    let currentWrongQuestionIndex = -1;
    let hasErrors = false;
    let isShowingErrors = false;
    let isShowingDiagnosis = false;

    // Inicializa a visibilidade das seções no carregamento
    errorDiagnosisSection.style.display = 'none';
    topicsToReviewList.innerHTML = '';
    statusMessage.textContent = '';

    const questions = [       {         question: "1. Qual é o procedimento fundamental que a Dra. Fernanda cita para se ter certeza sobre a cura ou semicura de uma parasitose como o Trichuris?",         options: [           "A) Análise do hemograma.",           "B) Avaliação clínica dos sintomas do paciente.",           "C) Análise de exame parasitológico de fezes.",           "D) Realização de teste rápido para detecção de antígenos.",           "E) Biópsia intestinal para detecção do parasita.",         ],         correctAnswer: "C) Análise de exame parasitológico de fezes.",         comment: "A Dra. Fernanda ressalta que, para saber se houve cura ou semicura de parasitoses como o Trichuris, é necessário realizar a análise de exame parasitológico de fezes.",         topic: "Diagnóstico Laboratorial de Parasitoses Intestinais",       },       {         question: "2. Qual é a principal causa geral de todas as parasitoses, segundo a Dra. Fernanda?",         options: [           "A) Consumo de água contaminada por cloro.",           "B) Falta de investimento na indústria farmacêutica.",           "C) Condições sanitárias e de higiene inadequadas.",           "D) Alto número de viagens e migrações urbanas.",           "E) Desequilíbrio ambiental causado pela morte de caramujos.",         ],         correctAnswer: "C) Condições sanitárias e de higiene inadequadas.",         comment: "A Dra. Fernanda afirma que todas as parasitoses estão ligadas a condições de falta de saneamento básico e higienização.",         topic: "Epidemiologia e Fatores de Risco de Parasitoses",       },       {         question: "3. Qual fator é citado como o principal responsável por grandes incidências de parasitoses no Brasil?",         options: [           "A) O clima tropical, que favorece a proliferação de vetores.",           "B) A falta de médicos capazes de interpretar os exames.",           "C) O baixo investimento em saneamento básico.",           "D) A resistência de parasitas ao tratamento com cloro.",           "E) A alta densidade populacional nas grandes cidades.",         ],         correctAnswer: "C) O baixo investimento em saneamento básico.",         comment: "O baixo investimento em saneamento básico no Brasil é apontado como a razão pela qual o país tem grandes incidências de parasitoses.",         topic: "Saúde Pública e Saneamento Básico no Brasil",       },       {         question: "4. A respeito da água de consumo, o que a Dra. Fernanda relata como um problema de saúde pública, mesmo em regiões com algum saneamento?",         options: [           "A) A ausência total de cloro na água da torneira.",           "B) A contaminação por coliformes fecais na água da torneira.",           "C) A preferência das pessoas por água fervida em vez de filtrada.",           "D) O alto custo dos filtros de água, que impedem a higienização.",           "E) A resistência dos vírus ao tratamento de água, como visto em casos virais.",         ],         correctAnswer: "B) A contaminação por coliformes fecais na água da torneira.",         comment: "A análise da água da torneira, como visto em contas de água, pode mostrar uma porcentagem de coliformes fecais, mesmo que dentro de limites aceitáveis, indicando uma contaminação.",         topic: "Qualidade da Água e Indicadores de Contaminação (Coliformes)",       },       {         question: "5. Qual método de higienização de frutas, verduras e legumes é recomendado na aula?",         options: [           "A) Uso de álcool 70%.",           "B) Apenas lavagem com água corrente.",           "C) Ferver os alimentos por 5 minutos.",           "D) Utilização de água sanitária (hipoclorito) e posterior enxágue.",           "E) Limpeza com sal grosso e vinagre.",         ],         correctAnswer: "D) Utilização de água sanitária (hipoclorito) e posterior enxágue.",         comment: "O método recomendado é a adição de algumas gotas de água sanitária (cloro) na água para a higienização e, posteriormente, um bom enxágue.",         topic: "Recomendações de Higiene de Alimentos e Uso de Hipoclorito",       },       {         question: "6. Segundo o conteúdo, qual termo é usado para classificar uma doença que é prevalente em uma região, mas possui baixo investimento em pesquisa e desenvolvimento de tratamentos?",         options: [           "A) Doença crônica.",           "B) Doença endêmica.",           "C) Doença tropical.",           "D) Doença negligenciada.",           "E) Doença parasitária.",         ],         correctAnswer: "D) Doença negligenciada.",         comment: "Uma doença prevalente em uma região, mas com pouca pesquisa e desenvolvimento para tratamento, é classificada como doença negligenciada.",         topic: "Doenças Tropicais Negligenciadas (DTNs)",       },       {         question: "7. Por que as doenças crônicas, como hipertensão e diabetes, atraem mais investimento da indústria farmacêutica do que as parasitoses, segundo a aula?",         options: [           "A) Porque os antibióticos para parasitoses são muito baratos.",           "B) Porque o tratamento de parasitoses dura apenas cerca de 15 dias.",           "C) Porque as doenças crônicas são mais prevalentes no Brasil.",           "D) Porque as parasitoses não são passíveis de prevenção.",           "E) Porque as doenças crônicas não são negligenciadas.",         ],         correctAnswer: "B) Porque o tratamento de parasitoses dura apenas cerca de 15 dias.",         comment: "A indústria farmacêutica investe menos em parasitoses porque o tratamento é de curta duração (cerca de 15 dias), ao contrário das doenças crônicas, que exigem tratamento contínuo e, portanto, são mais lucrativas.",         topic: "Fatores Econômicos da Indústria Farmacêutica e Pesquisa",       },       {         question: "8. Qual é a melhor forma de combater as parasitoses no Brasil, de acordo com a Dra. Fernanda?",         options: [           "A) Aumentar a produção de medicamentos antiparasitários.",           "B) Exterminar os hospedeiros intermediários, como caramujos.",           "C) Melhorar o diagnóstico através de exames parasitológicos.",           "D) Promover a educação e saúde.",           "E) Tratar todos os pacientes com antiparasitários de 6 em 6 meses.",         ],         correctAnswer: "D) Promover a educação e saúde.",         comment: "A conclusão da Dra. Fernanda é que a educação em saúde é a melhor forma de combater as parasitoses no Brasil.",         topic: "Educação em Saúde e Prevenção de Parasitoses",       },       {         question: "9. A Esquistossomose (Schistosomose Mansoni) é popularmente conhecida como \"Barriga D'água\" por qual razão?",         options: [           "A) Pela alta incidência em pessoas que bebem água não filtrada.",           "B) Pela formação de pápulas na pele após o contato com a água.",           "C) Pelo aumento do volume abdominal devido ao acúmulo de líquido (ascite).",           "D) Pela eliminação de ovos nas fezes, que contaminam rios e lagos.",           "E) Pela preferência do parasita por viver em veias do sistema porta-hepático.",         ],         correctAnswer: "C) Pelo aumento do volume abdominal devido ao acúmulo de líquido (ascite).",         comment: "O nome popular \"Barriga D'água\" se deve à manifestação crônica da doença, que é o aumento do volume abdominal por acúmulo de líquido, também chamado de ascite.",         topic: "Manifestações Clínicas da Esquistossomose (Ascite)",       },       {         question: "10. Qual é a relação entre a condição imunológica do hospedeiro e o desenvolvimento de uma parasitose?",         options: [           "A) A condição imunológica não tem relação, apenas a carga de infecção é importante.",           "B) Um indivíduo imunocompetente sempre combate a infecção, independentemente da carga parasitária.",           "C) Um indivíduo imunocompetente tem um sistema responsivo, mas uma carga de infecção muito grande ainda pode levar à doença.",           "D) O sistema imunológico só é capaz de combater parasitas se a contaminação for por água salgada.",           "E) O sistema imunológico fraco (imunocompetente) é o principal fator de risco para a parasitose.",         ],         correctAnswer: "C) Um indivíduo imunocompetente tem um sistema responsivo, mas uma carga de infecção muito grande ainda pode levar à doença.",         comment: "A condição imunológica é um fator de risco; se o indivíduo é imunocompetente, seu sistema é responsivo. No entanto, se a carga de infecção for muito grande, a chance de desenvolver a doença ainda é alta.",         topic: "Interação Hospedeiro-Parasita e Carga Parasitária",       },       {         question: "11. Qual é o papel da migração humana na incidência de parasitoses?",         options: [           "A) Reduz a incidência ao dispersar a população.",           "B) Aumenta o risco de contato com a cercária em países tropicais.",           "C) Pode levar à disseminação de espécies de parasitas (como o *S. japonicum*) para novas regiões (como o Brasil).",           "D) É um fator de risco apenas para malária em regiões do Norte do Brasil.",           "E) Diminui o investimento em saneamento básico nas áreas mais populosas.",         ],         correctAnswer: "C) Pode levar à disseminação de espécies de parasitas (como o *S. japonicum*) para novas regiões (como o Brasil).",         comment: "A migração humana pode introduzir espécies de parasitas não endêmicas (como o *Schistosoma japonicum*, prevalente na Ásia) em outras regiões, como o Brasil, aumentando a incidência dessas espécies.",         topic: "Doenças Infecciosas e Migração Internacional",       },       {         question: "12. Qual é a denominação correta para o hospedeiro em que ocorre a reprodução sexuada do parasita?",         options: [           "A) Hospedeiro intermediário.",           "B) Hospedeiro definitivo.",           "C) Hospedeiro acidental.",           "D) Vetor biológico.",           "E) Reservatório.",         ],         correctAnswer: "B) Hospedeiro definitivo.",         comment: "O hospedeiro definitivo é aquele em que ocorre a reprodução sexuada do parasita. No caso da esquistossomose, o homem é o hospedeiro definitivo.",         topic: "Conceitos Básicos de Parasitologia (Hospedeiros)",       },       {         question: "13. No ciclo da Esquistossomose, quem é o hospedeiro definitivo?",         options: [           "A) O caramujo do gênero *Biomphalaria*.",           "B) O homem.",           "C) O mosquito *Anopheles* (vetor da Malária).",           "D) O ovo liberado nas fezes.",           "E) O esquistossômulo (larva sem cauda).",         ],         correctAnswer: "B) O homem.",         comment: "O homem é o hospedeiro definitivo, pois é onde os vermes adultos se alojam e realizam a reprodução sexuada.",         topic: "Ciclo de Vida do *Schistosoma mansoni*",       },       {         question: "14. Como os ovos do *Schistosoma mansoni* conseguem passar dos vasos sanguíneos para o lúmen intestinal, a fim de serem eliminados nas fezes?",         options: [           "A) Através da circulação linfática.",           "B) Através da ingestão de alimentos contaminados.",           "C) Através de microlesões causadas pela sua morfologia (espícula).",           "D) Através de uma reação alérgica que rompe as paredes do vaso.",           "E) Através da migração do miracídio para a luz intestinal.",         ],         correctAnswer: "C) Através de microlesões causadas pela sua morfologia (espícula).",         comment: "O ovo possui uma espícula que lhe permite atravessar por microlesões (que podem gerar sangue oculto nas fezes) e chegar ao intestino, onde é eliminado.",         topic: "Morfologia e Patogenicidade dos Ovos do *Schistosoma*",       },       {         question: "15. Qual é o nome dado à primeira forma larval da esquistossomose, que é liberada do ovo na água doce?",         options: [           "A) Cercária.",           "B) Esquistossômulo.",           "C) Miracídio.",           "D) Esporocisto.",           "E) Vermes adultos.",         ],         correctAnswer: "C) Miracídio.",         comment: "A larva liberada do ovo na água doce é o miracídio.",         topic: "Estágios Larvais da Esquistossomose",       },       {         question: "16. Qual é a forma infectante do *Schistosoma mansoni* para o hospedeiro definitivo (homem)?",         options: [           "A) Ovo.",           "B) Miracídio.",           "C) Cercária.",           "D) Esquistossômulo.",           "E) Verme adulto.",         ],         correctAnswer: "C) Cercária.",         comment: "A cercária é a larva infectante para o homem, pois ela penetra na pele por via cutânea.",         topic: "Transmissão da Esquistossomose",       },       {         question: "17. O que é o hospedeiro intermediário no ciclo biológico da esquistossomose?",         options: [           "A) O caramujo do gênero *Biomphalaria*, onde o ovo se transforma em miracídio.",           "B) O homem, onde o parasita atinge a fase adulta.",           "C) O caramujo do gênero *Biomphalaria*, onde a larva miracídio passa por maturação até se transformar em cercária.",           "D) A água doce, onde ocorre a explosão do ovo.",           "E) O verme adulto no sistema porta-hepático.",         ],         correctAnswer: "C) O caramujo do gênero *Biomphalaria*, onde a larva miracídio passa por maturação até se transformar em cercária.",         comment: "O caramujo do gênero *Biomphalaria* é o hospedeiro intermediário; dentro dele, a larva miracídio se desenvolve em cercária (a forma infectante).",         topic: "Hospedeiro Intermediário e Gênero *Biomphalaria*",       },       {         question: "18. Qual característica da cercária permite que ela se localize na superfície da água doce, perto da luz e do calor?",         options: [           "A) O tropismo químico, que a atrai para as fezes.",           "B) A sua grande cauda bifurcada, que permite movimentos rápidos.",           "C) O tropismo pela luz e pelo calor.",           "D) O fato de ser um esporocisto, que a faz boiar.",           "E) A presença de microlesões em sua cabeça.",         ],         correctAnswer: "C) O tropismo pela luz e pelo calor.",         comment: "A cercária é fototrópica (atração por luz) e termotrópica (atração por calor), por isso fica na superfície em águas doces e limpas, favorecendo a infecção por meio dos membros inferiores.",         topic: "Comportamento da Cercária (Fototropismo/Termotropismo)",       },       {         question: "19. Qual processo o esquistossômulo realiza ao penetrar na pele do hospedeiro definitivo?",         options: [           "A) Liberação de óvulos para iniciar a reprodução.",           "B) Transformação em miracídio para atingir os vasos.",           "C) Perda da cauda.",           "D) Multiplicação por fissão binária.",           "E) Invasão por via oral.",         ],         correctAnswer: "C) Perda da cauda.",         comment: "No momento da penetração na pele, a cercária perde a cauda e se torna o esquistossômulo.",         topic: "Fase de Penetração e Transformação Larval",       },       {         question: "20. Onde o verme adulto do *Schistosoma mansoni* se aloja no hospedeiro definitivo?",         options: [           "A) Nas paredes do intestino grosso e delgado.",           "B) No parênquima pulmonar e nos rins.",           "C) Nas veias do sistema porta-hepático (região do intestino e fígado).",           "D) Na cavidade abdominal, causando a ascite.",           "E) No tecido celular subcutâneo do local da penetração.",         ],         correctAnswer: "C) Nas veias do sistema porta-hepático (região do intestino e fígado).",         comment: "Os vermes adultos se alojam e se reproduzem nas veias do sistema porta-hepático, próximo ao intestino e fígado.",         topic: "Localização do Verme Adulto (*S. mansoni*)",       },       {         question: "21. Qual é o principal mecanismo pelo qual o *Schistosoma mansoni* causa o acúmulo de líquido na cavidade abdominal (ascite), caracterizando a \"Barriga D'água\"?",         options: [           "A) O extravasamento de ovos que causam uma reação inflamatória.",           "B) A vasodilatação dos vasos sanguíneos causada pelos vermes, permitindo o extravasamento de plasma e líquido.",           "C) A obstrução total da luz intestinal pelos vermes adultos.",           "D) A destruição completa do tecido epitelial dos vasos sanguíneos.",           "E) A produção de enzimas pelo verme adulto, que aumenta a pressão osmótica.",         ],         correctAnswer: "B) A vasodilatação dos vasos sanguíneos causada pelos vermes, permitindo o extravasamento de plasma e líquido.",         comment: "O acúmulo de líquido (ascite) ocorre devido à vasodilatação e distensão dos vasos sanguíneos pelo verme, o que causa o extravasamento de proteínas e plasma (líquido) para o espaço intercelular e para a cavidade abdominal.",         topic: "Mecanismo Fisiopatológico da Ascite na Esquistossomose",       },       {         question: "22. O que é o Miracídio no ciclo da esquistossomose?",         options: [           "A) A forma adulta do parasita.",           "B) O ovo maduro e infectante.",           "C) A primeira larva liberada pelo ovo na água doce.",           "D) O caramujo contaminado.",           "E) A larva infectante que penetra na pele.",         ],         correctAnswer: "C) A primeira larva liberada pelo ovo na água doce.",         comment: "A larva liberada do ovo na água doce é o miracídio.",         topic: "Morfologia e Liberação do Miracídio",       },       {         question: "23. Qual tipo de tropismo o Miracídio possui pelos caramujos?",         options: [           "A) Tropismo pela luz e calor.",           "B) Tropismo químico.",           "C) Tropismo elétrico.",           "D) Tropismo físico.",           "E) Tropismo por gravidade.",         ],         correctAnswer: "B) Tropismo químico.",         comment: "O Miracídio é atraído para os caramujos por um tropismo químico, agindo como metal e ímã.",         topic: "Tropismo Químico em Parasitas",       },       {         question: "24. Qual a importância do caramujo *Biomphalaria* no ciclo da Esquistossomose?",         options: [           "A) É o local onde a cercária perde a cauda.",           "B) É o local onde o ovo é depositado para se tornar miracídio.",           "C) É o local onde o verme adulto se reproduz sexuadamente.",           "D) É o hospedeiro intermediário onde o miracídio se desenvolve em cercária.",           "E) É o local onde ocorre a vasodilatação dos vasos.",         ],         correctAnswer: "D) É o hospedeiro intermediário onde o miracídio se desenvolve em cercária.",         comment: "O caramujo é o hospedeiro intermediário; dentro dele, a larva miracídio passa por estágios (como esporocisto) e se desenvolve em cercária.",         topic: "Papel do Hospedeiro Intermediário no Ciclo",       },       {         question: "25. Qual a característica morfológica do ovo do *Schistosoma mansoni* que contribui para sua eliminação nas fezes?",         options: [           "A) Ele ser ovalado e não ter cauda.",           "B) A presença de uma espícula (rabicho).",           "C) O fato de ser rico em melanina.",           "D) Sua grande mobilidade na luz intestinal.",           "E) O fato de ter caudas que o movem.",         ],         correctAnswer: "B) A presença de uma espícula (rabicho).",         comment: "O ovo do *S. mansoni* (o mais comum no Brasil) possui uma espícula, que é uma das características que o permite atravessar as paredes do vaso para a eliminação.",         topic: "Identificação Morfológica de Ovos de *Schistosoma*",       },       {         question: "26. Quais são os dois tipos de formas que o *Schistosoma mansoni* apresenta (dimorfismo sexual)?",         options: [           "A) Miracídio e cercária.",           "B) Verme jovem e verme adulto.",           "C) Macho (curvado e menor) e Fêmea (alongada e fina).",           "D) Ovípara e Vivípara.",           "E) Esquistossômulo e Cercária.",         ],         correctAnswer: "C) Macho (curvado e menor) e Fêmea (alongada e fina).",         comment: "Os vermes adultos apresentam dimorfismo sexual, sendo o macho mais curto e curvado e a fêmea mais longa e fina. A fêmea se anexa ao macho para a reprodução.",         topic: "Dimorfismo Sexual em Helmintos",       },       {         question: "27. Por que a infecção por cercária tende a acontecer em regiões mais rasas do rio (membros inferiores/pé), em vez de nas profundezas?",         options: [           "A) Porque os miracídios já foram consumidos pelos peixes.",           "B) Porque as cercárias têm tropismo pela luz e calor, ficando na superfície.",           "C) Porque a densidade populacional é maior na superfície da água.",           "D) Porque a água salgada inibe a penetração em águas mais fundas.",           "E) Porque a presença de esgoto só ocorre nas margens.",         ],         correctAnswer: "B) Porque as cercárias têm tropismo pela luz e calor, ficando na superfície.",         comment: "A cercária é fototrópica (atração por luz) e termotrópica (atração por calor), por isso fica na superfície em águas doces e limpas, favorecendo a infecção por meio dos membros inferiores.",         topic: "Relação Temperatura/Luminosidade e Sobrevivência da Cercária",       },       {         question: "28. No ciclo biológico, a penetração da cercária na pele ocorre por qual via?",         options: [           "A) Via oral (ingestão).",           "B) Via cutânea (pele).",           "C) Via respiratória (inalação).",           "D) Via vertical (mãe-feto).",           "E) Via sexual (contato sexual).",         ],         correctAnswer: "B) Via cutânea (pele).",         comment: "A cercária é a forma infectante que invade o hospedeiro definitivo pela via cutânea (pele).",         topic: "Vias de Infecção por Parasitas",       },       {         question: "29. O que é o Esquistossômulo no ciclo da esquistossomose?",         options: [           "A) A larva que se aloja no caramujo.",           "B) A larva que tem vida livre na água.",           "C) A cercária que perdeu a cauda e está no hospedeiro definitivo.",           "D) O ovo maduro antes da eclosão.",           "E) O verme adulto no sistema porta.",         ],         correctAnswer: "C) A cercária que perdeu a cauda e está no hospedeiro definitivo.",         comment: "O esquistossômulo é a larva cercária sem cauda, já dentro do hospedeiro definitivo, após a penetração na pele.",         topic: "Desenvolvimento do *Schistosoma* no Hospedeiro Definitivo",       },       {         question: "30. Qual enzima é liberada pela cercária para facilitar a sua penetração na pele do hospedeiro?",         options: [           "A) Lipases.",           "B) Amilases.",           "C) Proteases (enzimas proteolíticas).",           "D) Nucleases.",           "E) Glicolases.",         ],         correctAnswer: "C) Proteases (enzimas proteolíticas).",         comment: "A cercária libera enzimas proteolíticas (proteases) que degradam as proteínas da pele, permitindo que ela a penetre.",         topic: "Enzimologia da Penetração Cutânea de Parasitas",       },       {         question: "31. Qual exame laboratorial é citado como útil para a detecção de microlesões nos vasos sanguíneos causadas pelos ovos no intestino?",         options: [           "A) Hemograma completo.",           "B) Pesquisa de sangue oculto nas fezes.",           "C) Análise de urina (EAS).",           "D) Pesquisa de coliformes fecais.",           "E) Teste sorológico para anticorpos.",         ],         correctAnswer: "B) Pesquisa de sangue oculto nas fezes.",         comment: "As microlesões causadas pelos ovos no intestino podem ser detectadas pela pesquisa de sangue oculto nas fezes.",         topic: "Exames Laboratoriais na Esquistossomose (Sangue Oculto)",       },       {         question: "32. Qual a principal célula de defesa que aumenta em número no sangue (eosinofilia) para tentar combater parasitas, conforme a aula?",         options: [           "A) Linfócitos.",           "B) Neutrófilos.",           "C) Basófilos.",           "D) Eosinófilos.",           "E) Monócitos.",         ],         correctAnswer: "D) Eosinófilos.",         comment: "O aumento do número de eosinófilos (eosinofilia) no hemograma é uma resposta imunológica comum em infecções parasitárias.",         topic: "Imunologia da Resposta Contra Helmintos (Eosinofilia)",       },       {         question: "33. Qual manifestação clínica ocorre no local da penetração da cercária (via cutânea)?",         options: [           "A) Ascite abdominal.",           "B) Hepatomegalia e esplenomegalia.",           "C) Febre e calafrios.",           "D) Edema, hiperemia, prurido e formação de pápulas.",           "E) Perda de peso e anemia.",         ],         correctAnswer: "D) Edema, hiperemia, prurido e formação de pápulas.",         comment: "A infecção inicial causa uma inflamação no local de penetração, caracterizada por edema (inchaço), hiperemia (vermelhidão), prurido (coceira) e formação de pápulas (pequenos pontos).",         topic: "Dermatite Cercariana e Sinais de Inflamação",       },       {         question: "34. Qual espécie de *Schistosoma* não endêmica no Brasil, mas com relatos de aparecimento no país e que afeta o trato urinário, é citada na aula?",         options: [           "A) *Schistosoma mansoni*.",           "B) *Schistosoma japonicum*.",           "C) *Schistosoma haematobium*.",           "D) *Trichuris trichiura*.",           "E) *Ascaris lumbricoides*.",         ],         correctAnswer: "C) *Schistosoma haematobium*.",         comment: "O *Schistosoma haematobium* é citado como uma espécie que afeta o trato urinário e, embora não fosse prevalente no Brasil, tem sido encontrado, exigindo a pesquisa de ovos na urina.",         topic: "Tipos de Esquistossomose (Intestinal vs. Urinária)",       },       {         question: "35. A ausência de qual hospedeiro no ciclo da Esquistossomose resultaria na interrupção do ciclo?",         options: [           "A) Apenas o homem, por ser o hospedeiro definitivo.",           "B) Apenas o caramujo, por ser o hospedeiro intermediário.",           "C) Tanto o homem quanto o caramujo, pois o ciclo é dióico.",           "D) Apenas o ovo, pois é a forma de resistência no ambiente.",           "E) Apenas a água doce, pois o miracídio morreria.",         ],         correctAnswer: "C) Tanto o homem quanto o caramujo, pois o ciclo é dióico.",         comment: "Por ser um ciclo dióico (necessita de dois hospedeiros), a ausência do caramujo (hospedeiro intermediário) impede o desenvolvimento da cercária, e a ausência do homem (hospedeiro definitivo) impede a reprodução sexuada e a deposição de ovos. Portanto, ambos são essenciais.",         topic: "Ciclo Dióico e Interrupção da Transmissão",       },       {         question: "36. A respeito da penetração da cercária, qual é uma característica importante citada na aula?",         options: [           "A) A cercária só consegue penetrar em pele com lesões ou feridas abertas.",           "B) A cercária penetra na pele intacta, devido às enzimas proteolíticas.",           "C) A cercária penetra na pele intacta apenas se a água estiver salgada.",           "D) A cercária precisa da cauda para perfurar a pele.",           "E) A cercária penetra na pele por absorção, sem necessidade de enzimas.",         ],         correctAnswer: "B) A cercária penetra na pele intacta, devido às enzimas proteolíticas.",         comment: "A cercária é capaz de penetrar na pele intacta devido à produção de enzimas proteolíticas.",         topic: "Barreiras Epiteliais e Invasão Parasitária",       },       {         question: "37. Qual é a denominação correta para o hospedeiro que, no ciclo da Esquistossomose, é o caramujo?",         options: [           "A) Hospedeiro definitivo.",           "B) Hospedeiro vetor.",           "C) Hospedeiro intermediário.",           "D) Hospedeiro de reprodução assexuada.",           "E) Hospedeiro de reserva.",         ],         correctAnswer: "C) Hospedeiro intermediário.",         comment: "O caramujo é o hospedeiro intermediário, pois a larva se transforma e se multiplica dentro dele (transformação de miracídio em cercária).",         topic: "Diferenciação entre Hospedeiro Definitivo e Intermediário",       },       {         question: "38. Qual dos seguintes fatores não é listado como uma condição ambiental favorável para as parasitoses?",         options: [           "A) Umidade.",           "B) Temperatura.",           "C) Ventilação.",           "D) Clima tropical.",           "E) Água salgada.",         ],         correctAnswer: "E) Água salgada.",         comment: "As larvas da esquistossomose necessitam de água doce, e o ovo não explode em água salgada, interrompendo o ciclo. Portanto, a água salgada não é favorável.",         topic: "Condições Ambientais e Fatores Abióticos do Ciclo",       },       {         question: "39. O que significa o termo \"eosinofilia\" em um hemograma, e com o que se relaciona na aula?",         options: [           "A) Diminuição do número de eosinófilos, indicando infecção viral.",           "B) Aumento do número de eosinófilos, sendo uma resposta contra parasitas.",           "C) Aumento da febre e mal-estar no paciente, sendo um sinal inespecífico.",           "D) Processo inflamatório localizado, como o que ocorre na pele.",           "E) Diminuição da febre no paciente, indicando que o parasita foi combatido.",         ],         correctAnswer: "B) Aumento do número de eosinófilos, sendo uma resposta contra parasitas.",         comment: "Eosinofilia é o aumento do número de eosinófilos, uma das células de defesa que o corpo utiliza para combater parasitas.",         topic: "Interpretação de Hemogramas em Parasitologia",       },       {         question: "40. Qual é a denominação correta para a reprodução que ocorre no hospedeiro definitivo (homem) no ciclo da Esquistossomose?",         options: [           "A) Reprodução assexuada.",           "B) Reprodução vegetativa.",           "C) Reprodução sexuada.",           "D) Reprodução por esporocisto.",           "E) Reprodução por fissão binária.",         ],         correctAnswer: "C) Reprodução sexuada.",         comment: "O hospedeiro definitivo é o local onde os vermes adultos realizam a reprodução sexuada, resultando na deposição de ovos.",         topic: "Tipos de Reprodução em Parasitas (Assexuada vs. Sexuada)",       },     ];

    function buildQuiz() {
      const output = [];

      questions.forEach((currentQuestion, questionNumber) => {
        const options = [];
        for (let i = 0; i < currentQuestion.options.length; i++) {
          options.push(
            `<label class="option" data-question="${questionNumber}" data-value="${currentQuestion.options[i]}">
              <img src="tesouras.png" class="scissor-icon" onclick="event.stopPropagation(); this.parentNode.classList.toggle('struck-through');">
              ${currentQuestion.options[i]}
            </label>`
          );
        }

        output.push(
          `<div class="card" id="question-${questionNumber}" data-topic="${currentQuestion.topic}">
            <div class="question">${currentQuestion.question}</div>
            <div class="options">${options.join("")}</div>
            <div class="comment" id="comment-${questionNumber}"></div>
          </div>`
        );
      });

      quizContainer.innerHTML = output.join("");
    }

    function showResults() {
      wrongQuestionIndices = [];
      errorCountByTopic = {};
      totalAnsweredQuestionsByTopic = {};
      currentWrongQuestionIndex = -1;
      hasErrors = false;
      isShowingErrors = false;
      isShowingDiagnosis = false;

      errorDiagnosisSection.style.display = 'none';
      topicsToReviewList.innerHTML = '';
      statusMessage.textContent = '';

      // Busca por todas as perguntas: estáticas e dinâmicas
      const allQuestionCards = document.querySelectorAll('.quiz-container .card, #newQuestionsContent .card');
      let correctAnswersCount = 0;
      let totalQuestionsAnswered = 0;

      console.log('🔍 Verificando', allQuestionCards.length, 'perguntas...');

      allQuestionCards.forEach((card, index) => {
        const questionEl = card.querySelector('.question') || card.querySelector('p');
        if (!questionEl) return;

        const questionText = questionEl.textContent.trim();
        const optionsContainer = card.querySelector('.options') || card;
        const allOptions = optionsContainer.querySelectorAll('.option, label.option, label');
        const userAnswerElement = optionsContainer.querySelector('.option.selected, label.selected');
        const commentDiv = card.querySelector('.comment');

        const questionTopic = card.dataset.topic || "Tópico não informado";
        
        console.log(`📝 Pergunta ${index + 1}: Tópico = "${questionTopic}"`);
        console.log(`🔍 Encontradas ${allOptions.length} alternativas`);
        
        // Remove classes anteriores
        allOptions.forEach(option => {
          option.classList.remove('correct', 'incorrect', 'selected');
        });
        if (commentDiv) commentDiv.classList.remove('show');

        let correctAnswerValue = null;
        let questionComment = null;

        // Verifica se é pergunta estática ou dinâmica
        const isStatic = card.id && card.id.startsWith('question-');
        if (isStatic) {
          // Pergunta estática - busca nos dados originais
          const questionData = questions.find(q => q.question.trim() === questionText);
          if (questionData) {
            correctAnswerValue = questionData.correctAnswer.trim();
            questionComment = questionData.comment;
          }
        } else {
          // Pergunta dinâmica - busca pela opção marcada como correta
          const correctOpt = optionsContainer.querySelector('.option[data-answer="true"], label[data-answer="true"]');
          if (correctOpt) {
            correctAnswerValue = correctOpt.dataset.value?.trim() || correctOpt.textContent.trim();
            console.log(`✅ Resposta correta encontrada: "${correctAnswerValue}"`);
          } else {
            console.log('❌ Nenhuma resposta correta encontrada para pergunta dinâmica');
          }
          
          // Busca comentário no próprio card ou no div comment
          const commentElement = card.querySelector('.comment');
          if (commentElement && commentElement.textContent.trim()) {
            questionComment = commentElement.textContent.trim();
          }
        }

        // Processa resposta do usuário e aplica coloração
        let userAnswer = null;
        if (userAnswerElement) {
          userAnswerElement.classList.add('selected');
          userAnswer = userAnswerElement.dataset.value?.trim() || userAnswerElement.textContent.trim();
          totalQuestionsAnswered++;
          totalAnsweredQuestionsByTopic[questionTopic] = (totalAnsweredQuestionsByTopic[questionTopic] || 0) + 1;

          console.log(`👤 Resposta do usuário: "${userAnswer}"`);
          console.log(`🎯 Resposta correta: "${correctAnswerValue}"`);

          // Verifica se a resposta está correta
          if (userAnswer === correctAnswerValue) {
            correctAnswersCount++;
            console.log(`✅ Resposta correta!`);
          } else {
            hasErrors = true;
            errorCountByTopic[questionTopic] = (errorCountByTopic[questionTopic] || 0) + 1;
            console.log(`❌ Resposta incorreta para tópico: ${questionTopic}`);
          }
        }

        // Aplica coloração: SEMPRE marca a correta de verde, e a errada de vermelho se foi marcada
        allOptions.forEach(option => {
          const optionValue = option.dataset.value?.trim() || option.textContent.trim();
          
          // Marca a resposta correta de verde SEMPRE
          if (optionValue === correctAnswerValue) {
            option.classList.add('correct');
            console.log(`🟢 Marcando como correta: "${optionValue}"`);
          }
          
          // Se o usuário marcou uma resposta E ela está errada, marca de vermelho
          if (userAnswer && optionValue === userAnswer && userAnswer !== correctAnswerValue) {
            option.classList.add('incorrect');
            console.log(`🔴 Marcando como incorreta: "${optionValue}"`);
          }
        });

        // Mostra comentário se disponível
        if (commentDiv && questionComment) {
          commentDiv.textContent = questionComment;
          commentDiv.classList.add('show');
        }
      });

      // Exibe resultados
      resultsContainer.textContent = `Você acertou ${correctAnswersCount} de ${totalQuestionsAnswered} questões respondidas.`;

      console.log('📊 Erros por tópico:', errorCountByTopic);
      console.log('📊 Total por tópico:', totalAnsweredQuestionsByTopic);

      // Gera diagnóstico de erros
      if (hasErrors) {
        for (const topic in errorCountByTopic) {
          const errors = errorCountByTopic[topic];
          const total = totalAnsweredQuestionsByTopic[topic] || 0;
          if (total > 0) {
            const percent = ((errors / total) * 100).toFixed(1);
            const li = document.createElement('li');
            li.textContent = `${topic}: ${percent}% de erros (${errors} de ${total} questões respondidas)`;
            topicsToReviewList.appendChild(li);
          }
        }
      } else {
        const li = document.createElement('li');
        li.textContent = "🥳 Parabéns! Você não teve erros nas questões respondidas.";
        topicsToReviewList.appendChild(li);
      }

      errorDiagnosisSection.style.display = 'block';
      generatedQuestionsSection.style.display = 'block';
      generateNewQuestionsBtn.style.display = 'block';
      scrollToDiagnosis();
    }

    function scrollToQuestion(index) {
      const questionCard = document.getElementById(`question-${index}`);
      if (questionCard) {
        questionCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }
    }

    function scrollToDiagnosis() {
        errorDiagnosisSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    function scrollToGeneratedQuestions() {
        generatedQuestionsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    // Event listener para seleção de opções (funciona para estáticas e dinâmicas)
    document.addEventListener("click", function (event) {
      const clickedElement = event.target;
      const optionElement = clickedElement.closest('.option');

      if (optionElement) {
          if (clickedElement.classList.contains("scissor-icon")) {
              event.stopPropagation();
              optionElement.classList.toggle("struck-through");
          }
          else {
              const parentCard = optionElement.closest('.card');
              const currentQuestionOptions = parentCard.querySelectorAll('.option');

              currentQuestionOptions.forEach(opt => opt.classList.remove("selected"));
              optionElement.classList.add("selected");
          }
      }
    });

    generateNewQuestionsBtn.addEventListener("click", async function() {
        statusMessage.textContent = '⏳ Gerando novas perguntas...';
        generateNewQuestionsBtn.disabled = true;

        const topics = Object.keys(errorCountByTopic).filter(topic => {
            const errorsInTopic = errorCountByTopic[topic] || 0;
            const totalAnsweredInTopic = totalAnsweredQuestionsByTopic[topic] || 0;
            return errorsInTopic > 0 && totalAnsweredInTopic > 0;
        });

        const topicsToSend = topics.length > 0 ? topics : ["fisiologia celular", "biologia"];

        try {
            const response = await fetch('https://www.quizia.xyz/quiz', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ topicos: topicsToSend }),
            });

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const data = await response.json();

            newQuestionsContent.innerHTML = '';
            if (data && data.html) {
                console.log('📥 HTML recebido do Flask:', data.html);
                
                // Insere o HTML diretamente sem reconstrução complexa
                newQuestionsContent.innerHTML = data.html.replace(/```html|```/g, '');
                
                // Adiciona tesouras e ajusta formatação apenas se necessário
                newQuestionsContent.querySelectorAll('.card').forEach((card, cardIndex) => {
                    // Garante que o elemento de pergunta tenha a classe correta
                    const questionElement = card.querySelector('p');
                    if (questionElement && !questionElement.classList.contains('question')) {
                       questionElement.classList.add('question');
                    }

                    // Remove qualquer input de radio que possa existir e adiciona tesouras
                    card.querySelectorAll('label').forEach((label) => {
                        // Remove inputs de radio MAS preserva o atributo data-answer
                        const radioInput = label.querySelector('input[type="radio"]');
                        if (radioInput) {
                            // PRESERVA o atributo data-answer do input no label
                            if (radioInput.hasAttribute('data-answer')) {
                                label.setAttribute('data-answer', radioInput.getAttribute('data-answer'));
                            }
                            radioInput.remove();
                        }
                        
                        // Garante que tenha a classe option
                        if (!label.classList.contains('option')) {
                            label.classList.add('option');
                        }

                        // Garante que tenha data-value
                        if (!label.dataset.value) {
                            label.dataset.value = label.textContent.trim();
                        }

                        // Adiciona tesoura se não existir
                        if (!label.querySelector('.scissor-icon')) {
                            const scissorIcon = document.createElement('img');
                            scissorIcon.src = 'tesouras.png';
                            scissorIcon.className = 'scissor-icon';
                            scissorIcon.onclick = function(e) {
                                e.stopPropagation();
                                label.classList.toggle('struck-through');
                            };
                            label.insertBefore(scissorIcon, label.firstChild);
                        }
                    });

                    console.log(`🏷️ Card ${cardIndex}: data-topic = "${card.dataset.topic}"`);
                    
                    // Verifica se há opção correta marcada
                    const correctOption = card.querySelector('label[data-answer="true"]');
                    if (correctOption) {
                        console.log(`✅ Opção correta encontrada: "${correctOption.dataset.value}"`);
                    } else {
                        console.log('❌ Nenhuma opção correta encontrada');
                    }
                });
            } else {
                newQuestionsContent.innerHTML = "<p>Não foi possível gerar novas perguntas para os tópicos selecionados.</p>";
            }
            
            generatedQuestionsSection.style.display = 'block';
            scrollToGeneratedQuestions();
            statusMessage.textContent = '✅ Perguntas geradas com sucesso!';
            setTimeout(() => { statusMessage.textContent = '' }, 3000);

        } catch (error) {
            console.error('Erro ao gerar novas perguntas:', error);
            newQuestionsContent.innerHTML = `<p>Erro ao carregar novas perguntas: ${error.message}. Por favor, tente novamente.</p>`;
            generatedQuestionsSection.style.display = 'block';
            scrollToGeneratedQuestions();
            statusMessage.textContent = '❌ Erro na requisição: ' + error.message;
            setTimeout(() => { statusMessage.textContent = '' }, 5000);
        } finally {
            generateNewQuestionsBtn.disabled = false;
        }
    });

    // Inicialização
    buildQuiz();
    errorDiagnosisSection.style.display = 'none';
    generatedQuestionsSection.style.display = 'none';
    generateNewQuestionsBtn.style.display = 'none';

    // Event listener para o botão de verificar respostas
    document.getElementById("verifyAnswersBtn").addEventListener("click", showResults);
  </script>
</body>
</html>
