<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>Simulado de Fisiologia Celular</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      background-color: #f4f4f4;
    }

    .quiz-container {
      max-width: 800px;
      width: 100%;
    }

    h1 {
      color: #333;
      text-align: center;
      margin-bottom: 30px;
    }

    .card {
      background-color: white;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .question {
      font-weight: bold;
      margin-bottom: 10px;
      color: #333;
    }

    .options {
      margin-top: 15px;
    }

    /* Estilos unificados para todas as opções (estáticas e dinâmicas) */
    .option, label.option, label, #newQuestionsContent label {
      display: flex; /* Para alinhar imagem e texto */
      align-items: center;
      margin-bottom: 10px;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.2s ease;
      position: relative; /* Para posicionar a tesoura */
    }

    /* FORÇA a remoção de inputs de radio em QUALQUER lugar */
    .option input[type="radio"], 
    label input[type="radio"],
    #newQuestionsContent input[type="radio"],
    #newQuestionsContent label input[type="radio"] {
        display: none !important;
        visibility: hidden !important;
        opacity: 0 !important;
        position: absolute !important;
        left: -9999px !important;
    }

    .option:hover, 
    label.option:hover, 
    label:hover,
    #newQuestionsContent label:hover {
      background-color: #e9e9e9;
    }

    .option.selected, 
    label.option.selected, 
    label.selected,
    #newQuestionsContent label.selected {
      background-color: #d1e7dd;
      border-color: #28a745;
    }

    .option.correct, 
    label.option.correct, 
    label.correct,
    #newQuestionsContent label.correct {
      background-color: #d4edda;
      border-color: #28a745;
    }

    .option.incorrect, 
    label.option.incorrect, 
    label.incorrect,
    #newQuestionsContent label.incorrect {
      background-color: #f8d7da;
      border-color: #dc3545;
    }

    .submit-btn {
      display: block;
      width: 100%;
      padding: 15px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 18px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      margin-top: 30px;
    }

    .submit-btn:hover {
      background-color: #0056b3;
    }

    .results {
      text-align: center;
      margin-top: 30px;
      font-size: 20px;
      font-weight: bold;
      color: #333;
    }

    .scissor-icon {
      margin-right: 10px; /* Espaço entre a tesoura e o texto da opção */
      width: 20px; /* Ajuste conforme o tamanho da sua imagem */
      height: 20px; /* Ajuste conforme o tamanho da sua imagem */
      opacity: 0.5; /* Transparência como no original */
      cursor: pointer;
    }

    .scissor-icon.hidden {
      display: none;
    }

    .struck-through {
      text-decoration: line-through;
      color: #888;
    }

    .comment {
      margin-top: 10px;
      padding: 10px;
      background-color: #f0f0f0;
      border-left: 4px solid #007bff;
      font-style: italic;
      color: #555;
      display: none; /* Escondido por padrão */
    }
    .comment.show {
      display: block; /* Mostrado quando ativado */
    }

    /* Estilos para o botão de navegação de erro / diagnóstico */
    .error-nav-btn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: #dc3545; /* Vermelho para erro */
      color: white;
      border: none;
      border-radius: 50%; /* Torna o botão redondo */
      width: 60px;
      height: 60px;
      font-size: 24px;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      z-index: 1000;
      display: none; /* Escondido por padrão */
      flex-direction: column; /* Para empilhar o ícone e o contador */
      padding: 5px; /* Ajuste o padding para acomodar texto maior */
      box-sizing: border-box; /* Garante que padding não aumente o tamanho total */
      text-align: center;
    }

    .error-nav-btn:hover {
      background-color: #c82333;
    }

    .error-nav-btn .arrow-icon {
      font-size: 30px; /* Tamanho da seta */
      line-height: 1; /* Ajuste para centralizar */
    }

    .error-nav-btn .button-text {
      font-size: 12px; /* Tamanho do texto abaixo da seta */
      line-height: 1;
      margin-top: 2px; /* Espaço entre a seta e o texto */
    }

    /* Estilos para a seção de diagnóstico de erros */
    .error-diagnosis-section {
        margin-top: 50px;
        padding: 30px;
        background-color: #ffe0b2; /* Um laranja claro ou similar */
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.15);
        display: none; /* Escondido por padrão */
        text-align: center;
        font-size: 1.1em;
        color: #333;
    }

    .error-diagnosis-section h2 {
        color: #e65100; /* Laranja mais escuro */
        margin-bottom: 20px;
        font-size: 1.8em;
    }

    .error-diagnosis-section ul {
        list-style: none; /* Remove marcadores de lista */
        padding: 0;
        margin: 0;
    }

    .error-diagnosis-section li {
        background-color: #ff9800; /* Laranja */
        color: white;
        padding: 8px 15px;
        margin: 8px 0;
        border-radius: 5px;
        display: inline-block; /* Para que os itens fiquem lado a lado */
        margin-right: 10px;
        font-weight: bold;
    }
    .error-diagnosis-section li:last-child {
        margin-right: 0;
    }
 .card-bloco {
      border: 1px solid #ddd;
      border-radius: 6px;
      padding: 10px;
      background: #fff;
      margin-bottom: 20px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    }
  </style>
</head>
<body>
  <div class="quiz-container">
    <h1 style="text-align:center; margin-bottom: 30px;">Simulado de Fisiologia Celular</h1>
    <div class="card-bloco" id="quiz"></div>
    <button class="submit-btn" id="verifyAnswersBtn">Verificar Respostas</button>

    <button class="generate-questions-btn submit-btn" id="generateNewQuestionsBtn" style="display:none;">
      Gerar Novas Perguntas
    </button>

    <div class="results card-bloco" id="results"></div>
    <div id="statusMessage" style="text-align: center; margin-top: 10px; font-weight: bold; color: #007bff;"></div>

    <div class="error-diagnosis-section card-bloco" id="errorDiagnosis">
      <h2>Diagnóstico de Erros</h2>
      <p>Parece que você precisa revisar os seguintes assuntos:</p>
      <ul id="topicsToReview"></ul>
    </div>

    <div class="generated-questions-section card-bloco" id="generatedQuestionsSection" style="display:none;">
      <h2>Novas Perguntas Geradas</h2>
      <div id="newQuestionsContent"></div>
    </div>
  </div>
  
  <button class="error-nav-btn" id="errorNavBtn" style="display:none;">
    <span class="arrow-icon"></span>
    <span class="button-text"></span>
  </button>

  <script>
    const quizContainer = document.getElementById("quiz");
    const resultsContainer = document.getElementById("results");
    const errorNavBtn = document.getElementById("errorNavBtn");
    const arrowIcon = errorNavBtn.querySelector(".arrow-icon");
    const buttonText = errorNavBtn.querySelector(".button-text");
    const errorDiagnosisSection = document.getElementById("errorDiagnosis");
    const topicsToReviewList = document.getElementById("topicsToReview");
    const generateNewQuestionsBtn = document.getElementById("generateNewQuestionsBtn");
    const generatedQuestionsSection = document.getElementById("generatedQuestionsSection");
    const newQuestionsContent = document.getElementById("newQuestionsContent");
    const statusMessage = document.getElementById("statusMessage");

    let wrongQuestionIndices = [];
    let errorCountByTopic = {};
    let totalAnsweredQuestionsByTopic = {};
    let currentWrongQuestionIndex = -1;
    let hasErrors = false;
    let isShowingErrors = false;
    let isShowingDiagnosis = false;

    // Inicializa a visibilidade das seções no carregamento
    errorDiagnosisSection.style.display = 'none';
    topicsToReviewList.innerHTML = '';
    statusMessage.textContent = '';

    const questions = [       {         question: "1. A imagem abaixo mostra uma vista superior de uma vértebra lombar. Qual é a principal função do corpo vertebral (vertebral body) na constituição da parede posterior do abdômen?<br><br><img src='https://brunooofernandesss.github.io/index.html/Anatomia/Michigan/Abdominal_Wall_Peritoneum_and_Intestines/EmbeddedImage.jpg' alt='Vértebra Lombar' style='max-width: 400px; max-height: 300px;'>",         options: [           "a) Ponto de inserção para o músculo reto abdominal.",           "b) Prover um pilar de suporte de peso e servir de fixação para os músculos psoas maior.",           "c) Articulação com as costelas flutuantes.",           "d) Formar a parede lateral do canal vertebral.",         ],         correctAnswer: "b) Prover um pilar de suporte de peso e servir de fixação para os músculos psoas maior.",         comment: "O corpo vertebral das vértebras lombares é a principal estrutura de suporte de peso da coluna e serve como origem para músculos importantes da parede posterior do abdômen, como o psoas maior, que se fixa em suas faces laterais.",         topic: "Parede Abdominal Posterior",       },       {         question: "2. Esta imagem exibe uma vista anterior da cintura pélvica. A espinha ilíaca ântero-superior (não rotulada, mas localizada na extremidade superior da crista ilíaca) serve como um importante ponto de referência para a fixação de qual estrutura?<br><br><img src='https://brunooofernandesss.github.io/index.html/Anatomia/Michigan/Abdominal_Wall_Peritoneum_and_Intestines/EmbeddedImage-1.jpg' alt='Cintura Pélvica' style='max-width: 400px; max-height: 300px;'>",         options: [           "a) Ligamento sacrotuberal.",           "b) Músculo reto femoral.",           "c) Ligamento inguinal.",           "d) Tendão conjunto.",         ],         correctAnswer: "c) Ligamento inguinal.",         comment: "O ligamento inguinal estende-se da espinha ilíaca ântero-superior até o tubérculo púbico, formando a base do canal inguinal.",         topic: "Anatomia Óssea da Pelve",       },       {         question: "3. Na vista lateral de um osso coxal esquerdo, a parte laranja representa o ísquio (ischium). Qual músculo da parede abdominal lateral se origina parcialmente na crista ilíaca (borda superior da parte azul)?<br><br><img src='https://brunooofernandesss.github.io/index.html/Anatomia/Michigan/Abdominal_Wall_Peritoneum_and_Intestines/EmbeddedImage-2.jpg' alt='Osso Coxal' style='max-width: 400px; max-height: 300px;'>",         options: [           "a) Músculo reto do abdômen.",           "b) Músculo piramidal.",           "c) Músculo transverso do abdômen.",           "d) Músculo psoas maior.",         ],         correctAnswer: "c) Músculo transverso do abdômen.",         comment: "O músculo transverso do abdômen, a camada mais profunda dos músculos abdominais laterais, origina-se, entre outros locais, nos dois terços anteriores da crista ilíaca.",         topic: "Músculos da Parede Abdominal",       },       {         question: "4. A imagem destaca a crista ilíaca (iliac crest) e a espinha ilíaca ântero-superior (anterior superior iliac spine). A palpação dessas estruturas é clinicamente relevante para localizar qual ponto de referência para apendicectomias?<br><br><img src='https://brunooofernandesss.github.io/index.html/Anatomia/Michigan/Abdominal_Wall_Peritoneum_and_Intestines/EmbeddedImage-3.jpg' alt='Crista Ilíaca' style='max-width: 400px; max-height: 300px;'>",         options: [           "a) Ponto de Murphy.",           "b) Ponto de McBurney.",           "c) Linha semilunar.",           "d) Linha arqueada.",         ],         correctAnswer: "b) Ponto de McBurney.",         comment: "O ponto de McBurney, que indica a localização aproximada da base do apêndice, está localizado a um terço da distância da espinha ilíaca ântero-superior para o umbigo.",         topic: "Anatomia Clínica do Abdômen",       },       {         question: "5. A imagem mostra o corpo do púbis e o tubérculo púbico. Qual músculo importante da parede abdominal anterior se insere na crista púbica (pubic crest) e sínfise púbica?<br><br><img src='https://brunooofernandesss.github.io/index.html/Anatomia/Michigan/Abdominal_Wall_Peritoneum_and_Intestines/EmbeddedImage-4.jpg' alt='Púbis' style='max-width: 400px; max-height: 300px;'>",         options: [           "a) Músculo oblíquo externo.",           "b) Músculo oblíquo interno.",           "c) Músculo transverso do abdômen.",           "d) Músculo reto do abdômen.",         ],         correctAnswer: "d) Músculo reto do abdômen.",         comment: "O músculo reto do abdômen, principal flexor do tronco, tem sua inserção inferior na crista púbica e na sínfise púbica.",         topic: "Músculos da Parede Abdominal",       },       {         question: "6. A imagem é uma vista superior da cintura pélvica. O ligamento inguinal se estende de um ponto na borda da entrada pélvica (pelvic inlet) até o tubérculo púbico (pubic tubercle). Qual é esse ponto de origem?<br><br><img src='https://brunooofernandesss.github.io/index.html/Anatomia/Michigan/Abdominal_Wall_Peritoneum_and_Intestines/EmbeddedImage-5.jpg' alt='Entrada Pélvica' style='max-width: 400px; max-height: 300px;'>",         options: [           "a) Promontório sacral.",           "b) Espinha isquiática.",           "c) Espinha ilíaca ântero-superior.",           "d) Asa do sacro.",         ],         correctAnswer: "c) Espinha ilíaca ântero-superior.",         comment: "O ligamento inguinal é formado pela borda inferior espessada da aponeurose do músculo oblíquo externo, estendendo-se entre a espinha ilíaca ântero-superior e o tubérculo púbico.",         topic: "Região Inguinal",       },       {         question: "7. Em uma vista superior da cintura pélvica, vemos o promontório sacral e a asa do sacro. Essas estruturas formam parte da margem posterior de qual abertura?<br><br><img src='https://brunooofernandesss.github.io/index.html/Anatomia/Michigan/Abdominal_Wall_Peritoneum_and_Intestines/EmbeddedImage-6.jpg' alt='Sacro' style='max-width: 400px; max-height: 300px;'>",         options: [           "a) Abertura pélvica superior (entrada pélvica).",           "b) Abertura pélvica inferior.",           "c) Forame obturado.",           "d) Forame isquiático maior.",         ],         correctAnswer: "a) Abertura pélvica superior (entrada pélvica).",         comment: "A borda posterior da abertura pélvica superior, ou entrada da pelve, é formada pelo promontório sacral e pelas asas do sacro.",         topic: "Anatomia Óssea da Pelve",       },       {         question: "8. A imagem exibe a musculatura superficial do abdômen. A bainha do reto (rectus sheath) é formada pela aponeurose de quais músculos?<br><br><img src='https://brunooofernandesss.github.io/index.html/Anatomia/Michigan/Abdominal_Wall_Peritoneum_and_Intestines/EmbeddedImage-7.jpg' alt='Musculatura Abdominal' style='max-width: 400px; max-height: 300px;'>",         options: [           "a) Apenas do músculo oblíquo externo.",           "b) Apenas do músculo reto do abdômen.",           "c) Músculos oblíquo externo, oblíquo interno e transverso do abdômen.",           "d) Músculos psoas maior e quadrado lombar.",         ],         correctAnswer: "c) Músculos oblíquo externo, oblíquo interno e transverso do abdômen.",         comment: "A bainha do reto é uma estrutura aponeurótica complexa formada pelas aponeuroses dos três músculos planos da parede abdominal anterolateral (oblíquo externo, oblíquo interno e transverso do abdômen).",         topic: "Músculos da Parede Abdominal",       },       {         question: "9. A imagem mostra a linha alba (linea alba) e o músculo oblíquo externo. Qual a importância clínica da linha alba?<br><br><img src='https://brunooofernandesss.github.io/index.html/Anatomia/Michigan/Abdominal_Wall_Peritoneum_and_Intestines/EmbeddedImage-8.jpg' alt='Linha Alba' style='max-width: 400px; max-height: 300px;'>",         options: [           "a) É a principal área de inervação da parede abdominal.",           "b) Contém os vasos epigástricos superiores.",           "c) É um local preferencial para incisões cirúrgicas medianas por ser relativamente avascular.",           "d) É o principal músculo responsável pela flexão do tronco.",         ],         correctAnswer: "c) É um local preferencial para incisões cirúrgicas medianas por ser relativamente avascular.",         comment: "A linha alba é uma rafe fibrosa formada pelo entrelaçamento das aponeuroses dos músculos abdominais. Por ser pouco vascularizada e não envolver corte de fibras musculares, é um local comum para incisões na linha média em cirurgias abdominais.",         topic: "Anatomia Cirúrgica do Abdômen",       },       {         question: "10. O ligamento inguinal (inguinal ligament) é visível nesta imagem. Ele é a borda inferior enrolada da aponeurose de qual músculo?<br><br><img src='https://brunooofernandesss.github.io/index.html/Anatomia/Michigan/Abdominal_Wall_Peritoneum_and_Intestines/EmbeddedImage-9.jpg' alt='Ligamento Inguinal' style='max-width: 400px; max-height: 300px;'>",         options: [           "a) Músculo oblíquo interno.",           "b) Músculo transverso do abdômen.",           "c) Músculo reto do abdômen.",           "d) Músculo oblíquo externo.",         ],         correctAnswer: "d) Músculo oblíquo externo.",         comment: "O ligamento inguinal não é um ligamento verdadeiro, mas sim a porção inferior da aponeurose do músculo oblíquo externo, que se espessa e se dobra sobre si mesma.",         topic: "Região Inguinal",       },       {         question: "11. Esta imagem da região inguinal mostra o anel inguinal superficial (superficial inguinal ring). Qual estrutura passa através deste anel no sexo masculino?<br><br><img src='https://brunooofernandesss.github.io/index.html/Anatomia/Michigan/Abdominal_Wall_Peritoneum_and_Intestines/EmbeddedImage-10.jpg' alt='Anel Inguinal Superficial' style='max-width: 400px; max-height: 300px;'>",         options: [           "a) O ligamento redondo do útero.",           "b) O nervo femoral.",           "c) O funículo espermático.",           "d) A artéria epigástrica inferior.",         ],         correctAnswer: "c) O funículo espermático.",         comment: "O anel inguinal superficial é a saída do canal inguinal. No homem, ele permite a passagem do funículo espermático. Na mulher, permite a passagem do ligamento redondo do útero.",         topic: "Canal Inguinal",       },       {         question: "12. A imagem mostra o ligamento redondo do útero (round ligament of the uterus) emergindo na região inguinal. Qual é a função deste ligamento?<br><br><img src='https://brunooofernandesss.github.io/index.html/Anatomia/Michigan/Abdominal_Wall_Peritoneum_and_Intestines/EmbeddedImage-11.jpg' alt='Ligamento Redondo do Útero' style='max-width: 400px; max-height: 300px;'>",         options: [           "a) Suspender o ovário na parede pélvica.",           "b) Conduzir os vasos ovarianos.",           "c) Manter a anteversão do útero.",           "d) Ligar o útero ao sacro.",         ],         correctAnswer: "c) Manter a anteversão do útero.",         comment: "O ligamento redondo do útero é um resquício do gubernáculo fetal e ajuda a manter o útero em sua posição normal de anteversão, tracionando o fundo do útero para a frente.",         topic: "Anatomia Pélvica Feminina",       },       {         question: "13. Nesta vista da região inguinal masculina, o funículo espermático (spermatic cord) é proeminente. Qual das seguintes estruturas NÃO faz parte do conteúdo do funículo espermático?<br><br><img src='https://brunooofernandesss.github.io/index.html/Anatomia/Michigan/Abdominal_Wall_Peritoneum_and_Intestines/EmbeddedImage-12.jpg' alt='Funículo Espermático' style='max-width: 400px; max-height: 300px;'>",         options: [           "a) Ducto deferente.",           "b) Artéria testicular.",           "c) Plexo pampiniforme.",           "d) Nervo ilio-inguinal.",         ],         correctAnswer: "d) Nervo ilio-inguinal.",         comment: "O nervo ilio-inguinal viaja junto com o funículo espermático por parte do canal inguinal, mas não é considerado um componente do funículo em si. Os componentes principais são o ducto deferente, artéria testicular, artéria do ducto deferente, plexo venoso pampiniforme, e ramos nervosos autonômicos.",         topic: "Canal Inguinal",       },       {         question: "14. A imagem destaca a bainha do reto (rectus sheath) e a linha alba (linea alba). A diástase dos retos abdominais é uma condição clínica que envolve o afastamento dos músculos retos do abdômen. Qual estrutura é alargada ou enfraquecida nesta condição?<br><br><img src='https://brunooofernandesss.github.io/index.html/Anatomia/Michigan/Abdominal_Wall_Peritoneum_and_Intestines/EmbeddedImage-13.jpg' alt='Bainha do Reto' style='max-width: 400px; max-height: 300px;'>",         options: [           "a) O ligamento inguinal.",           "b) A linha arqueada.",           "c) A linha alba.",           "d) A fáscia transversal.",         ],         correctAnswer: "c) A linha alba.",         comment: "A diástase dos retos é o estiramento e alargamento da linha alba, que causa a separação dos músculos retos do abdômen. É comum após a gravidez.",         topic: "Anatomia Clínica da Parede Abdominal",       },       {         question: "15. Com a bainha do reto rebatida, o músculo reto do abdômen (rectus abdominis m.) é exposto. Qual é a principal ação deste músculo quando contraído bilateralmente?<br><br><img src='https://brunooofernandesss.github.io/index.html/Anatomia/Michigan/Abdominal_Wall_Peritoneum_and_Intestines/EmbeddedImage-14.jpg' alt='Músculo Reto do Abdômen' style='max-width: 400px; max-height: 300px;'>",         options: [           "a) Rotação do tronco para o lado oposto.",           "b) Flexão lateral do tronco.",           "c) Flexão da coluna vertebral e compressão das vísceras abdominais.",           "d) Extensão da coluna lombar.",         ],         correctAnswer: "c) Flexão da coluna vertebral e compressão das vísceras abdominais.",         comment: "A principal função do músculo reto do abdômen é a flexão do tronco (como em um abdominal) e a compressão do conteúdo abdominal, auxiliando na expiração forçada, defecação e parto.",         topic: "Músculos da Parede Abdominal",       },       {         question: "16. A imagem mostra os vasos epigástricos superior e inferior. A anastomose entre esses vasos dentro da bainha do reto é clinicamente importante. De quais artérias maiores se originam a artéria epigástrica superior e a inferior, respectivamente?<br><br><img src='https://brunooofernandesss.github.io/index.html/Anatomia/Michigan/Abdominal_Wall_Peritoneum_and_Intestines/EmbeddedImage-15.jpg' alt='Vasos Epigástricos' style='max-width: 400px; max-height: 300px;'>",         options: [           "a) Aorta abdominal e artéria femoral.",           "b) Artéria torácica interna e artéria ilíaca externa.",           "c) Artéria subclávia e artéria ilíaca interna.",           "d) Artéria intercostal e artéria femoral.",         ],         correctAnswer: "b) Artéria torácica interna e artéria ilíaca externa.",         comment: "A artéria epigástrica superior é um ramo terminal da artéria torácica interna. A artéria epigástrica inferior origina-se da artéria ilíaca externa, um pouco acima do ligamento inguinal. A anastomose entre elas fornece uma via colateral de suprimento sanguíneo.",         topic: "Vascularização da Parede Abdominal",       },       {         question: "17. A linha arqueada (arcuate line) é um marco importante na parede abdominal posterior. O que muda na composição da bainha do reto abaixo da linha arqueada?<br><br><img src='https://brunooofernandesss.github.io/index.html/Anatomia/Michigan/Abdominal_Wall_Peritoneum_and_Intestines/EmbeddedImage-16.jpg' alt='Linha Arqueada' style='max-width: 400px; max-height: 300px;'>",         options: [           "a) A bainha do reto deixa de existir.",           "b) Todas as aponeuroses dos músculos abdominais planos passam anteriormente ao músculo reto do abdômen.",           "c) O músculo reto do abdômen fica em contato direto com o peritônio parietal.",           "d) A bainha do reto se torna mais espessa, com todas as aponeuroses passando posteriormente.",         ],         correctAnswer: "b) Todas as aponeuroses dos músculos abdominais planos passam anteriormente ao músculo reto do abdômen.",         comment: "Abaixo da linha arqueada, as aponeuroses dos músculos oblíquo externo, oblíquo interno e transverso do abdômen passam todas anteriormente ao músculo reto. Isso deixa a face posterior do reto coberta apenas pela fáscia transversal e pelo peritônio.",         topic: "Bainha do Reto e Linha Arqueada",       },       {         question: "18. Nesta seção coronal, as camadas da parede abdominal são visíveis. Qual é a ordem correta das camadas, da mais superficial para a mais profunda, começando pelo músculo oblíquo externo?<br><br><img src='https://brunooofernandesss.github.io/index.html/Anatomia/Michigan/Abdominal_Wall_Peritoneum_and_Intestines/EmbeddedImage-17.jpg' alt='Camadas da Parede Abdominal' style='max-width: 400px; max-height: 300px;'>",         options: [           "a) Oblíquo externo, transverso do abdômen, oblíquo interno, fáscia transversal.",           "b) Oblíquo externo, oblíquo interno, transverso do abdômen, fáscia transversal.",           "c) Oblíquo interno, oblíquo externo, fáscia transversal, transverso do abdômen.",           "d) Fáscia transversal, oblíquo externo, oblíquo interno, transverso do abdômen.",         ],         correctAnswer: "b) Oblíquo externo, oblíquo interno, transverso do abdômen, fáscia transversal.",         comment: "As camadas da parede abdominal anterolateral, de superficial para profundo, são: pele, fáscia superficial (Camper e Scarpa), músculo oblíquo externo, músculo oblíquo interno, músculo transverso do abdômen, fáscia transversal, gordura extraperitoneal e peritônio parietal.",         topic: "Camadas da Parede Abdominal",       },       {         question: "19. A imagem mostra as pregas umbilicais na superfície posterior da parede abdominal anterior. A prega umbilical mediana (median umbilical fold) contém o remanescente de qual estrutura embrionária?<br><br><img src='https://brunooofernandesss.github.io/index.html/Anatomia/Michigan/Abdominal_Wall_Peritoneum_and_Intestines/EmbeddedImage-18.jpg' alt='Pregas Umbilicais' style='max-width: 400px; max-height: 300px;'>",         options: [           "a) Veia umbilical.",           "b) Artéria umbilical.",           "c) Ducto vitelino.",           "d) Úraco.",         ],         correctAnswer: "d) Úraco.",         comment: "A prega umbilical mediana contém o ligamento umbilical mediano, que é o remanescente fibroso do úraco. O úraco conectava a bexiga fetal ao umbigo.",         topic: "Embriologia da Parede Abdominal",       },       {         question: "20. Nesta vista posterior, o anel inguinal profundo (deep inguinal ring) é visível. Este anel é uma abertura em qual camada da parede abdominal?<br><br><img src='https://brunooofernandesss.github.io/index.html/Anatomia/Michigan/Abdominal_Wall_Peritoneum_and_Intestines/EmbeddedImage-19.jpg' alt='Anel Inguinal Profundo' style='max-width: 400px; max-height: 300px;'>",         options: [           "a) Aponeurose do músculo oblíquo externo.",           "b) Fáscia do músculo oblíquo interno.",           "c) Fáscia transversal.",           "d) Peritônio parietal.",         ],         correctAnswer: "c) Fáscia transversal.",         comment: "O anel inguinal profundo é a entrada para o canal inguinal e é formado por uma evaginação da fáscia transversal, localizada lateralmente aos vasos epigástricos inferiores.",         topic: "Canal Inguinal",       },       {         question: "21. A imagem delimita o triângulo inguinal (de Hesselbach). Hérnias que se projetam através deste triângulo são classificadas como de que tipo?<br><br><img src='https://brunooofernandesss.github.io/index.html/Anatomia/Michigan/Abdominal_Wall_Peritoneum_and_Intestines/EmbeddedImage-20.jpg' alt='Triângulo Inguinal' style='max-width: 400px; max-height: 300px;'>",         options: [           "a) Hérnias inguinais indiretas.",           "b) Hérnias femorais.",           "c) Hérnias umbilicais.",           "d) Hérnias inguinais diretas.",         ],         correctAnswer: "d) Hérnias inguinais diretas.",         comment: "As hérnias inguinais diretas ocorrem devido a uma fraqueza na parede posterior do canal inguinal, protruindo através do triângulo de Hesselbach, medialmente aos vasos epigástricos inferiores.",         topic: "Hérnias Abdominais",       },       {         question: "22. Esta é uma vista anterossuperior do diafragma. Em que nível vertebral aproximado a abertura da veia cava (caval opening) está localizada?<br><br><img src='https://brunooofernandesss.github.io/index.html/Anatomia/Michigan/Abdominal_Wall_Peritoneum_and_Intestines/EmbeddedImage-21.jpg' alt='Diafragma' style='max-width: 400px; max-height: 300px;'>",         options: [           "a) T8.",           "b) T10.",           "c) T12.",           "d) L1.",         ],         correctAnswer: "a) T8.",         comment: "As principais aberturas do diafragma têm níveis vertebrais mnemônicos: a abertura da Cava está em T8, o hiato Esofágico em T10, e o hiato Aórtico em T12. (C.E.A = 8, 10, 12).",         topic: "Anatomia do Diafragma",       },       {         question: "23. A cavidade abdominal é mostrada com o avental omental (omental apron) em evidência. Qual é uma das principais funções desta estrutura, também conhecida como omento maior?<br><br><img src='https://brunooofernandesss.github.io/index.html/Anatomia/Michigan/Abdominal_Wall_Peritoneum_and_Intestines/EmbeddedImage-22.jpg' alt='Omento Maior' style='max-width: 400px; max-height: 300px;'>",         options: [           "a) Produção de bile.",           "b) Absorção primária de nutrientes.",           "c) Localizar infecções e inflamações, atuando como 'policial do abdômen'.",           "d) Ancorar o baço à parede posterior do abdômen.",         ],         correctAnswer: "c) Localizar infecções e inflamações, atuando como 'policial do abdômen'.",         comment: "O omento maior é uma dobra dupla de peritônio rica em vasos e tecido linfoide. Ele pode migrar para áreas de inflamação ou infecção na cavidade peritoneal e aderir a elas, ajudando a conter a disseminação.",         topic: "Peritônio e Omento",       },       {         question: "24. A imagem mostra o ligamento falciforme (falciform ligament) conectando o fígado à parede abdominal anterior. O que corre na margem livre deste ligamento?<br><br><img src='https://brunooofernandesss.github.io/index.html/Anatomia/Michigan/Abdominal_Wall_Peritoneum_and_Intestines/EmbeddedImage-23.jpg' alt='Ligamento Falciforme' style='max-width: 400px; max-height: 300px;'>",         options: [           "a) A artéria hepática própria.",           "b) O ducto colédoco.",           "c) O ligamento redondo do fígado (remanescente da veia umbilical).",           "d) A veia porta hepática.",         ],         correctAnswer: "c) O ligamento redondo do fígado (remanescente da veia umbilical).",         comment: "O ligamento falciforme é um remanescente do mesentério ventral fetal. Sua borda inferior livre contém o ligamento redondo do fígado, que é o remanescente fibroso da veia umbilical fetal que transportava sangue oxigenado da placenta.",         topic: "Anatomia do Fígado e Peritônio",       },       {         question: "25. Com o cólon transverso rebatido, o intestino delgado e o ceco são visíveis. Qual é a principal função do intestino delgado (small intestine)?<br><br><img src='https://brunooofernandesss.github.io/index.html/Anatomia/Michigan/Abdominal_Wall_Peritoneum_and_Intestines/EmbeddedImage-24.jpg' alt='Intestino Delgado' style='max-width: 400px; max-height: 300px;'>",         options: [           "a) Absorção de água e eletrólitos.",           "b) Digestão química e absorção da maioria dos nutrientes.",           "c) Armazenamento e compactação das fezes.",           "d) Produção de hormônios para o controle da glicemia.",         ],         correctAnswer: "b) Digestão química e absorção da maioria dos nutrientes.",         comment: "O intestino delgado é o principal local do sistema digestório onde ocorre a digestão enzimática e a absorção de nutrientes, como carboidratos, gorduras, proteínas, vitaminas e minerais.",         topic: "Fisiologia do Intestino Delgado",       },       {         question: "26. Esta imagem mostra o jejuno e o íleo, as duas partes distais do intestino delgado, suspensos pelo mesentério. Comparado ao íleo, o jejuno (jejunum of small intestine) é caracterizado por ter:<br><br><img src='https://brunooofernandesss.github.io/index.html/Anatomia/Michigan/Abdominal_Wall_Peritoneum_and_Intestines/EmbeddedImage-25.jpg' alt='Jejuno e Íleo' style='max-width: 400px; max-height: 300px;'>",         options: [           "a) Parede mais fina e menos pregas circulares.",           "b) Menos arcadas arteriais e vasos retos mais longos.",           "c) Maior quantidade de placas de Peyer.",           "d) Cor mais pálida e diâmetro menor.",         ],         correctAnswer: "b) Menos arcadas arteriais e vasos retos mais longos.",         comment: "Morfologicamente, o jejuno (geralmente no quadrante superior esquerdo) tem uma parede mais espessa, mais pregas circulares, e seu mesentério possui menos arcadas arteriais (arcadas vasculares) e vasos retos (artérias retas) mais longos em comparação com o íleo.",         topic: "Anatomia do Intestino Delgado",       },       {         question: "27. As pregas circulares (circular folds), ou válvulas de Kerckring, são visíveis na mucosa do jejuno. Qual é a função primária dessas pregas?<br><br><img src='https://brunooofernandesss.github.io/index.html/Anatomia/Michigan/Abdominal_Wall_Peritoneum_and_Intestines/EmbeddedImage-26.jpg' alt='Pregas Circulares' style='max-width: 400px; max-height: 300px;'>",         options: [           "a) Aumentar a velocidade do trânsito do quimo.",           "b) Produzir muco para lubrificação.",           "c) Aumentar a área de superfície para absorção de nutrientes.",           "d) Secretar enzimas digestivas.",         ],         correctAnswer: "c) Aumentar a área de superfície para absorção de nutrientes.",         comment: "As pregas circulares são dobras permanentes da mucosa e submucosa que aumentam drasticamente a área de superfície interna do intestino delgado, maximizando a eficiência da absorção de nutrientes. Elas também ajudam a espiralar o quimo, aumentando seu tempo de contato com a mucosa.",         topic: "Histologia e Fisiologia Intestinal",       },       {         question: "28. A imagem mostra a junção ileocecal (ileocecal junction), onde o íleo terminal se encontra com o ceco. Qual é a principal função desta junção?<br><br><img src='https://brunooofernandesss.github.io/index.html/Anatomia/Michigan/Abdominal_Wall_Peritoneum_and_Intestines/EmbeddedImage-27.jpg' alt='Junção Ileocecal' style='max-width: 400px; max-height: 300px;'>",         options: [           "a) Regular o fluxo de quimo do intestino delgado para o grosso e prevenir o refluxo de material fecal.",           "b) Secretar bicarbonato para neutralizar o ácido estomacal.",           "c) Iniciar a digestão de carboidratos.",           "d) Absorver a vitamina B12.",         ],         correctAnswer: "a) Regular o fluxo de quimo do intestino delgado para o grosso e prevenir o refluxo de material fecal.",         comment: "A junção ileocecal, com sua válvula, atua como um esfíncter que controla a passagem do conteúdo do íleo para o ceco e, crucialmente, impede o refluxo de bactérias do intestino grosso para o intestino delgado, que é relativamente estéril.",         topic: "Anatomia do Intestino Grosso",       },       {         question: "29. A válvula ileocecal (ileocecal valve) é mostrada em detalhe. A incompetência desta válvula pode levar a qual condição clínica?<br><br><img src='https://brunooofernandesss.github.io/index.html/Anatomia/Michigan/Abdominal_Wall_Peritoneum_and_Intestines/EmbeddedImage-28.jpg' alt='Válvula Ileocecal' style='max-width: 400px; max-height: 300px;'>",         options: [           "a) Úlcera duodenal.",           "b) Doença do refluxo gastroesofágico (DRGE).",           "c) Supercrescimento bacteriano no intestino delgado (SIBO).",           "d) Apendicite.",         ],         correctAnswer: "c) Supercrescimento bacteriano no intestino delgado (SIBO).",         comment: "Se a válvula ileocecal for incompetente e permitir o refluxo de material do cólon (rico em bactérias) para o íleo, pode ocorrer um supercrescimento bacteriano no intestino delgado (SIBO), levando a sintomas como inchaço, diarreia e má absorção.",         topic: "Fisiopatologia Gastrointestinal",       },       {         question: "30. A imagem exibe o cólon ascendente e a flexura cólica direita (hepática). Qual é a relação anatômica desta flexura com o fígado?<br><br><img src='https://brunooofernandesss.github.io/index.html/Anatomia/Michigan/Abdominal_Wall_Peritoneum_and_Intestines/EmbeddedImage-29.jpg' alt='Cólon Ascendente' style='max-width: 400px; max-height: 300px;'>",         options: [           "a) Está localizada superiormente ao lobo esquerdo do fígado.",           "b) Está em contato direto com a face visceral do lobo direito do fígado.",           "c) Passa posteriormente ao fígado.",           "d) É suspensa do fígado pelo ligamento gastrocólico.",         ],         correctAnswer: "b) Está em contato direto com a face visceral do lobo direito do fígado.",         comment: "A flexura cólica direita, ou flexura hepática, está localizada na junção do cólon ascendente e transverso. Ela se encontra inferior e em contato com a superfície visceral do lobo direito do fígado.",         topic: "Relações Anatômicas Abdominais",       },       {         question: "31. A flexura cólica esquerda (esplênica) é mostrada. Em comparação com a flexura direita, a flexura esplênica está localizada:<br><br><img src='https://brunooofernandesss.github.io/index.html/Anatomia/Michigan/Abdominal_Wall_Peritoneum_and_Intestines/EmbeddedImage-30.jpg' alt='Cólon Descendente' style='max-width: 400px; max-height: 300px;'>",         options: [           "a) Mais inferior e mais anterior.",           "b) No mesmo nível horizontal.",           "c) Mais superior e mais posterior.",           "d) Mais medialmente.",         ],         correctAnswer: "c) Mais superior e mais posterior.",         comment: "A flexura cólica esquerda (esplênica) é tipicamente mais alta (superior), mais posterior e forma um ângulo mais agudo que a flexura direita (hepática). Ela é fixada ao diafragma pelo ligamento frenocólico.",         topic: "Anatomia do Intestino Grosso",       },       {         question: "32. O apêndice (appendix) é visto originando-se do ceco. Em qual ponto da convergência de estruturas da parede do ceco o apêndice pode ser localizado de forma confiável durante uma cirurgia?<br><br><img src='https://brunooofernandesss.github.io/index.html/Anatomia/Michigan/Abdominal_Wall_Peritoneum_and_Intestines/EmbeddedImage-31.jpg' alt='Apêndice' style='max-width: 400px; max-height: 300px;'>",         options: [           "a) Na junção dos haustros.",           "b) Na convergência das três tênias do cólon.",           "c) Oposto à válvula ileocecal.",           "d) Na parte mais superior do ceco.",         ],         correctAnswer: "b) Na convergência das três tênias do cólon.",         comment: "Apesar da posição variável da ponta do apêndice, sua base tem uma localização constante. Ela pode ser encontrada seguindo as tênias do cólon (as três faixas longitudinais de músculo liso) até o ponto onde elas convergem na superfície do ceco.",         topic: "Anatomia Cirúrgica do Apêndice",       },       {         question: "33. A imagem mostra as características externas do intestino grosso: tênias do cólon (taeniae coli), haustros (haustrum) e apêndices omentais (omental appendage). Qual dessas estruturas é responsável pela formação dos haustros?<br><br><img src='https://brunooofernandesss.github.io/index.html/Anatomia/Michigan/Abdominal_Wall_Peritoneum_and_Intestines/EmbeddedImage-32.jpg' alt='Características do Cólon' style='max-width: 400px; max-height: 300px;'>",         options: [           "a) Os apêndices omentais, por acúmulo de gordura.",           "b) A contração tônica das tênias do cólon, que são mais curtas que o resto do intestino.",           "c) As pregas circulares internas.",           "d) O mesentério que puxa a parede do cólon.",         ],         correctAnswer: "b) A contração tônica das tênias do cólon, que são mais curtas que o resto do intestino.",         comment: "As tênias do cólon são três faixas de músculo liso longitudinal que são mais curtas que o restante da parede do cólon. Sua contração constante (tônus) franze o intestino, criando as saculações características conhecidas como haustros.",         topic: "Anatomia do Intestino Grosso",       },       {         question: "34. Divertículos (diverticula) são visíveis na parede do cólon. A diverticulose, a presença desses divertículos, é mais comum em qual segmento do cólon?<br><br><img src='https://brunooofernandesss.github.io/index.html/Anatomia/Michigan/Abdominal_Wall_Peritoneum_and_Intestines/EmbeddedImage-33.jpg' alt='Divertículos' style='max-width: 400px; max-height: 300px;'>",         options: [           "a) Ceco.",           "b) Cólon ascendente.",           "c) Cólon transverso.",           "d) Cólon sigmoide.",         ],         correctAnswer: "d) Cólon sigmoide.",         comment: "A diverticulose ocorre com mais frequência no cólon sigmoide. Acredita-se que a alta pressão intraluminal necessária para mover as fezes mais sólidas nesta porção estreita do cólon contribui para a herniação da mucosa através de pontos fracos na parede muscular.",         topic: "Doença Diverticular",       },       {         question: "35. A imagem mostra o interior do cólon ascendente com suas pregas semilunares (semilunar folds). Como essas pregas diferem funcionalmente das pregas circulares do intestino delgado?<br><br><img src='https://brunooofernandesss.github.io/index.html/Anatomia/Michigan/Abdominal_Wall_Peritoneum_and_Intestines/EmbeddedImage-34.jpg' alt='Pregas Semilunares' style='max-width: 400px; max-height: 300px;'>",         options: [           "a) Elas aumentam significativamente a área para absorção de nutrientes.",           "b) Elas são principalmente responsáveis pela propulsão das fezes.",           "c) Elas não aumentam significativamente a área de superfície e marcam a separação entre os haustros.",           "d) Elas secretam grandes quantidades de enzimas digestivas.",         ],         correctAnswer: "c) Elas não aumentam significativamente a área de superfície e marcam a separação entre os haustros.",         comment: "Ao contrário das pregas circulares do intestino delgado, que são para absorção, as pregas semilunares do cólon são dobras da mucosa que se formam entre os haustros e não circundam completamente o lúmen. Elas não têm um papel significativo no aumento da área de superfície.",         topic: "Histologia e Fisiologia Intestinal",       },       {         question: "36. O cólon transverso foi rebatido para mostrar seu mesocólon transverso (transverse mesocolon). Quais vasos sanguíneos importantes cursam dentro desta estrutura para suprir o cólon transverso?<br><br><img src='https://brunooofernandesss.github.io/index.html/Anatomia/Michigan/Abdominal_Wall_Peritoneum_and_Intestines/EmbeddedImage-35.jpg' alt='Mesocólon Transverso' style='max-width: 400px; max-height: 300px;'>",         options: [           "a) As artérias gástricas.",           "b) A artéria cólica média.",           "c) As artérias sigmoides.",           "d) A artéria ileocólica.",         ],         correctAnswer: "b) A artéria cólica média.",         comment: "O mesocólon transverso é uma dobra do peritônio que suspende o cólon transverso. Ele contém a artéria cólica média (ramo da artéria mesentérica superior), veias correspondentes, nervos e linfáticos que irrigam esta porção do intestino.",         topic: "Peritônio e Mesentério",       },       {         question: "37. A imagem mostra a artéria mesentérica superior (superior mesenteric a.) e seus ramos. A oclusão aguda desta artéria é uma emergência médica que causa isquemia em quais partes do intestino?<br><br><img src='https://brunooofernandesss.github.io/index.html/Anatomia/Michigan/Abdominal_Wall_Peritoneum_and_Intestines/EmbeddedImage-36.jpg' alt='Artéria Mesentérica Superior' style='max-width: 400px; max-height: 300px;'>",         options: [           "a) Estômago e duodeno proximal.",           "b) Cólon descendente, cólon sigmoide e reto.",           "c) A totalidade do intestino delgado e o cólon até a flexura esplênica.",           "d) Fígado, vesícula biliar e pâncreas.",         ],         correctAnswer: "c) A totalidade do intestino delgado e o cólon até a flexura esplênica.",         comment: "A artéria mesentérica superior (AMS) irriga todo o intestino derivado do intestino médio embrionário. Isso inclui a parte distal do duodeno, jejuno, íleo, ceco, apêndice, cólon ascendente e os dois terços proximais do cólon transverso.",         topic: "Vascularização Abdominal",       },       {         question: "38. A imagem mostra os ramos da artéria mesentérica superior que suprem o cólon. A artéria marginal (marginal a.) corre ao longo da borda do cólon. Qual é a importância clínica desta artéria?<br><br><img src='https://brunooofernandesss.github.io/index.html/Anatomia/Michigan/Abdominal_Wall_Peritoneum_and_Intestines/EmbeddedImage-37.jpg' alt='Vascularização do Cólon' style='max-width: 400px; max-height: 300px;'>",         options: [           "a) É a única fonte de sangue para o ceco.",           "b) Causa apendicite quando obstruída.",           "c) Fornece uma via de circulação colateral importante entre a artéria mesentérica superior e a inferior.",           "d) Irriga diretamente a parede do estômago.",         ],         correctAnswer: "c) Fornece uma via de circulação colateral importante entre a artéria mesentérica superior e a inferior.",         comment: "A artéria marginal (de Drummond) é formada por anastomoses entre os ramos das artérias mesentéricas superior e inferior. Ela fornece uma circulação colateral crucial que pode manter o cólon perfundido se uma das artérias principais for ocluída lentamente.",         topic: "Vascularização do Cólon",       },       {         question: "39. As artérias mesentéricas superior (superior mesenteric a.) e inferior (inferior mesenteric a.) são visíveis. A junção entre os territórios irrigados por estas duas artérias é uma 'área de transição' (watershed area) e mais suscetível à isquemia. Onde esta área está localizada?<br><br><img src='https://brunooofernandesss.github.io/index.html/Anatomia/Michigan/Abdominal_Wall_Peritoneum_and_Intestines/EmbeddedImage-38.jpg' alt='Artérias Mesentéricas' style='max-width: 400px; max-height: 300px;'>",         options: [           "a) Na junção duodenojejunal.",           "b) Na válvula ileocecal.",           "c) Na flexura cólica esquerda (esplênica).",           "d) Na junção retossigmoide.",         ],         correctAnswer: "c) Na flexura cólica esquerda (esplênica).",         comment: "A flexura esplênica e o terço distal do cólon transverso representam a transição entre o intestino médio (suprido pela AMS) e o intestino posterior (suprido pela AMI). Essa área, especialmente no ponto de Griffith, tem circulação colateral mais tênue e é vulnerável à isquemia em estados de baixo fluxo sanguíneo.",         topic: "Anatomia Vascular Clínica",       },       {         question: "40. A imagem mostra o cólon sigmoide e seu mesocólon sigmoide (sigmoid mesocolon). Uma torção anormal (volvo) é mais comum neste segmento do cólon. Por quê?<br><br><img src='https://brunooofernandesss.github.io/index.html/Anatomia/Michigan/Abdominal_Wall_Peritoneum_and_Intestines/EmbeddedImage-39.jpg' alt='Cólon Sigmoide' style='max-width: 400px; max-height: 300px;'>",         options: [           "a) Porque é a parte mais estreita do cólon.",           "b) Devido à ausência de tênias do cólon nesta região.",           "c) Porque possui um mesentério longo e móvel com uma base de fixação estreita.",           "d) Por sua proximidade com a bexiga urinária.",         ],         correctAnswer: "c) Porque possui um mesentério longo e móvel com uma base de fixação estreita.",         comment: "O volvo sigmoide ocorre quando o cólon sigmoide se torce sobre seu próprio mesentério. A combinação de um sigmoide longo e redundante e um mesocólon sigmoide com uma base de fixação estreita na parede pélvica predispõe a essa torção, que pode levar à obstrução e isquemia.",         topic: "Patologia do Intestino Grosso",       } ];

    function buildQuiz() {
      const output = [];

      questions.forEach((currentQuestion, questionNumber) => {
        const options = [];
        for (let i = 0; i < currentQuestion.options.length; i++) {
          options.push(
            `<label class="option" data-question="${questionNumber}" data-value="${currentQuestion.options[i]}">
              <img src="tesouras.png" class="scissor-icon" onclick="event.stopPropagation(); this.parentNode.classList.toggle('struck-through');">
              ${currentQuestion.options[i]}
            </label>`
          );
        }

        output.push(
          `<div class="card" id="question-${questionNumber}" data-topic="${currentQuestion.topic}">
            <div class="question">${currentQuestion.question}</div>
            <div class="options">${options.join("")}</div>
            <div class="comment" id="comment-${questionNumber}"></div>
          </div>`
        );
      });

      quizContainer.innerHTML = output.join("");
    }

    function showResults() {
      wrongQuestionIndices = [];
      errorCountByTopic = {};
      totalAnsweredQuestionsByTopic = {};
      currentWrongQuestionIndex = -1;
      hasErrors = false;
      isShowingErrors = false;
      isShowingDiagnosis = false;

      errorDiagnosisSection.style.display = 'none';
      topicsToReviewList.innerHTML = '';
      statusMessage.textContent = '';

      // Busca por todas as perguntas: estáticas e dinâmicas
      const allQuestionCards = document.querySelectorAll('.quiz-container .card, #newQuestionsContent .card');
      let correctAnswersCount = 0;
      let totalQuestionsAnswered = 0;

      console.log('🔍 Verificando', allQuestionCards.length, 'perguntas...');

      allQuestionCards.forEach((card, index) => {
        const questionEl = card.querySelector('.question') || card.querySelector('p');
        if (!questionEl) return;

        const questionText = questionEl.textContent.trim();
        const optionsContainer = card.querySelector('.options') || card;
        const allOptions = optionsContainer.querySelectorAll('.option, label.option, label');
        const userAnswerElement = optionsContainer.querySelector('.option.selected, label.selected');
        const commentDiv = card.querySelector('.comment');

        const questionTopic = card.dataset.topic || "Tópico não informado";
        
        console.log(`📝 Pergunta ${index + 1}: Tópico = "${questionTopic}"`);
        console.log(`🔍 Encontradas ${allOptions.length} alternativas`);
        
        // Remove classes anteriores
        allOptions.forEach(option => {
          option.classList.remove('correct', 'incorrect', 'selected');
        });
        if (commentDiv) commentDiv.classList.remove('show');

        let correctAnswerValue = null;
        let questionComment = null;

        // Verifica se é pergunta estática ou dinâmica
        const isStatic = card.id && card.id.startsWith('question-');
        if (isStatic) {
          // Pergunta estática - busca nos dados originais
          const questionData = questions.find(q => q.question.includes(questionText.substring(0, 50)));
          if (questionData) {
            correctAnswerValue = questionData.correctAnswer.trim();
            questionComment = questionData.comment;
          }
        } else {
          // Pergunta dinâmica - busca pela opção marcada como correta
          const correctOpt = optionsContainer.querySelector('.option[data-answer="true"], label[data-answer="true"]');
          if (correctOpt) {
            correctAnswerValue = correctOpt.dataset.value?.trim() || correctOpt.textContent.trim();
            console.log(`✅ Resposta correta encontrada: "${correctAnswerValue}"`);
          } else {
            console.log('❌ Nenhuma resposta correta encontrada para pergunta dinâmica');
          }
          
          // Busca comentário no próprio card ou no div comment
          const commentElement = card.querySelector('.comment');
          if (commentElement && commentElement.textContent.trim()) {
            questionComment = commentElement.textContent.trim();
          }
        }

        // Processa resposta do usuário e aplica coloração
        let userAnswer = null;
        if (userAnswerElement) {
          userAnswerElement.classList.add('selected');
          userAnswer = userAnswerElement.dataset.value?.trim() || userAnswerElement.textContent.trim();
          totalQuestionsAnswered++;
          totalAnsweredQuestionsByTopic[questionTopic] = (totalAnsweredQuestionsByTopic[questionTopic] || 0) + 1;

          console.log(`👤 Resposta do usuário: "${userAnswer}"`);
          console.log(`🎯 Resposta correta: "${correctAnswerValue}"`);

          // Verifica se a resposta está correta
          if (userAnswer === correctAnswerValue) {
            correctAnswersCount++;
            console.log(`✅ Resposta correta!`);
          } else {
            hasErrors = true;
            errorCountByTopic[questionTopic] = (errorCountByTopic[questionTopic] || 0) + 1;
            console.log(`❌ Resposta incorreta para tópico: ${questionTopic}`);
          }
        }

        // Aplica coloração: SEMPRE marca a correta de verde, e a errada de vermelho se foi marcada
        allOptions.forEach(option => {
          const optionValue = option.dataset.value?.trim() || option.textContent.trim();
          
          // Marca a resposta correta de verde SEMPRE
          if (optionValue === correctAnswerValue) {
            option.classList.add('correct');
            console.log(`🟢 Marcando como correta: "${optionValue}"`);
          }
          
          // Se o usuário marcou uma resposta E ela está errada, marca de vermelho
          if (userAnswer && optionValue === userAnswer && userAnswer !== correctAnswerValue) {
            option.classList.add('incorrect');
            console.log(`🔴 Marcando como incorreta: "${optionValue}"`);
          }
        });

        // Mostra comentário se disponível
        if (commentDiv && questionComment) {
          commentDiv.textContent = questionComment;
          commentDiv.classList.add('show');
        }
      });

      // Exibe resultados
      resultsContainer.textContent = `Você acertou ${correctAnswersCount} de ${totalQuestionsAnswered} questões respondidas.`;

      console.log('📊 Erros por tópico:', errorCountByTopic);
      console.log('📊 Total por tópico:', totalAnsweredQuestionsByTopic);

      // Gera diagnóstico de erros
      if (hasErrors) {
        for (const topic in errorCountByTopic) {
          const errors = errorCountByTopic[topic];
          const total = totalAnsweredQuestionsByTopic[topic] || 0;
          if (total > 0) {
            const percent = ((errors / total) * 100).toFixed(1);
            const li = document.createElement('li');
            li.textContent = `${topic}: ${percent}% de erros (${errors} de ${total} questões respondidas)`;
            topicsToReviewList.appendChild(li);
          }
        }
      } else {
        const li = document.createElement('li');
        li.textContent = "🥳 Parabéns! Você não teve erros nas questões respondidas.";
        topicsToReviewList.appendChild(li);
      }

      errorDiagnosisSection.style.display = 'block';
      generatedQuestionsSection.style.display = 'block';
      generateNewQuestionsBtn.style.display = 'block';
      scrollToDiagnosis();
    }

    function scrollToQuestion(index) {
      const questionCard = document.getElementById(`question-${index}`);
      if (questionCard) {
        questionCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }
    }

    function scrollToDiagnosis() {
        errorDiagnosisSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    function scrollToGeneratedQuestions() {
        generatedQuestionsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    // Event listener para seleção de opções (funciona para estáticas e dinâmicas)
    document.addEventListener("click", function (event) {
      const clickedElement = event.target;
      const optionElement = clickedElement.closest('.option');

      if (optionElement) {
          if (clickedElement.classList.contains("scissor-icon")) {
              event.stopPropagation();
              optionElement.classList.toggle("struck-through");
          }
          else {
              const parentCard = optionElement.closest('.card');
              const currentQuestionOptions = parentCard.querySelectorAll('.option');

              currentQuestionOptions.forEach(opt => opt.classList.remove("selected"));
              optionElement.classList.add("selected");
          }
      }
    });

    generateNewQuestionsBtn.addEventListener("click", async function() {
        statusMessage.textContent = '⏳ Gerando novas perguntas...';
        generateNewQuestionsBtn.disabled = true;

        const topics = Object.keys(errorCountByTopic).filter(topic => {
            const errorsInTopic = errorCountByTopic[topic] || 0;
            const totalAnsweredInTopic = totalAnsweredQuestionsByTopic[topic] || 0;
            return errorsInTopic > 0 && totalAnsweredInTopic > 0;
        });

        const topicsToSend = topics.length > 0 ? topics : ["fisiologia celular", "biologia"];

        try {
            const response = await fetch('https://www.quizia.xyz/quiz', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ topicos: topicsToSend }),
            });

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const data = await response.json();

            newQuestionsContent.innerHTML = '';
            if (data && data.html) {
                console.log('📥 HTML recebido do Flask:', data.html);
                
                // Insere o HTML diretamente sem reconstrução complexa
                newQuestionsContent.innerHTML = data.html.replace(/```html|```/g, '');
                
                // Adiciona tesouras e ajusta formatação apenas se necessário
                newQuestionsContent.querySelectorAll('.card').forEach((card, cardIndex) => {
                    // Garante que o elemento de pergunta tenha a classe correta
                    const questionElement = card.querySelector('p');
                    if (questionElement && !questionElement.classList.contains('question')) {
                       questionElement.classList.add('question');
                    }

                    // Remove qualquer input de radio que possa existir e adiciona tesouras
                    card.querySelectorAll('label').forEach((label) => {
                        // Remove inputs de radio MAS preserva o atributo data-answer
                        const radioInput = label.querySelector('input[type="radio"]');
                        if (radioInput) {
                            // PRESERVA o atributo data-answer do input no label
                            if (radioInput.hasAttribute('data-answer')) {
                                label.setAttribute('data-answer', radioInput.getAttribute('data-answer'));
                            }
                            radioInput.remove();
                        }
                        
                        // Garante que tenha a classe option
                        if (!label.classList.contains('option')) {
                            label.classList.add('option');
                        }

                        // Garante que tenha data-value
                        if (!label.dataset.value) {
                            label.dataset.value = label.textContent.trim();
                        }

                        // Adiciona tesoura se não existir
                        if (!label.querySelector('.scissor-icon')) {
                            const scissorIcon = document.createElement('img');
                            scissorIcon.src = 'tesouras.png';
                            scissorIcon.className = 'scissor-icon';
                            scissorIcon.onclick = function(e) {
                                e.stopPropagation();
                                label.classList.toggle('struck-through');
                            };
                            label.insertBefore(scissorIcon, label.firstChild);
                        }
                    });

                    console.log(`🏷️ Card ${cardIndex}: data-topic = "${card.dataset.topic}"`);
                    
                    // Verifica se há opção correta marcada
                    const correctOption = card.querySelector('label[data-answer="true"]');
                    if (correctOption) {
                        console.log(`✅ Opção correta encontrada: "${correctOption.dataset.value}"`);
                    } else {
                        console.log('❌ Nenhuma opção correta encontrada');
                    }
                });
            } else {
                newQuestionsContent.innerHTML = "<p>Não foi possível gerar novas perguntas para os tópicos selecionados.</p>";
            }
            
            generatedQuestionsSection.style.display = 'block';
            scrollToGeneratedQuestions();
            statusMessage.textContent = '✅ Perguntas geradas com sucesso!';
            setTimeout(() => { statusMessage.textContent = '' }, 3000);

        } catch (error) {
            console.error('Erro ao gerar novas perguntas:', error);
            newQuestionsContent.innerHTML = `<p>Erro ao carregar novas perguntas: ${error.message}. Por favor, tente novamente.</p>`;
            generatedQuestionsSection.style.display = 'block';
            scrollToGeneratedQuestions();
            statusMessage.textContent = '❌ Erro na requisição: ' + error.message;
            setTimeout(() => { statusMessage.textContent = '' }, 5000);
        } finally {
            generateNewQuestionsBtn.disabled = false;
        }
    });

    // Inicialização
    buildQuiz();
    errorDiagnosisSection.style.display = 'none';
    generatedQuestionsSection.style.display = 'none';
    generateNewQuestionsBtn.style.display = 'none';

    // Event listener para o botão de verificar respostas
    document.getElementById("verifyAnswersBtn").addEventListener("click", showResults);
  </script>
</body>
</html>
