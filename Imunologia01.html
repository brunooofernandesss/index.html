<!DOCTYPE html>
<!DOCTYPE html>
<!DOCTYPE html>
</body><!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>Simulado de Imunologia 01</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      background-color: #f4f4f4;
    }

    .quiz-container {
      max-width: 800px;
      width: 100%;
    }

    h1 {
      color: #333;
      text-align: center;
      margin-bottom: 30px;
    }

    .card {
      background-color: white;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .question {
      font-weight: bold;
      margin-bottom: 10px;
      color: #333;
    }

    .options {
      margin-top: 15px;
    }

    /* Estilos unificados para todas as op√ß√µes (est√°ticas e din√¢micas) */
    .option, label.option, label, #newQuestionsContent label {
      display: flex; /* Para alinhar imagem e texto */
      align-items: center;
      margin-bottom: 10px;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.2s ease;
      position: relative; /* Para posicionar a tesoura */
    }

    /* FOR√áA a remo√ß√£o de inputs de radio em QUALQUER lugar */
    .option input[type="radio"], 
    label input[type="radio"],
    #newQuestionsContent input[type="radio"],
    #newQuestionsContent label input[type="radio"] {
        display: none !important;
        visibility: hidden !important;
        opacity: 0 !important;
        position: absolute !important;
        left: -9999px !important;
    }

    .option:hover, 
    label.option:hover, 
    label:hover,
    #newQuestionsContent label:hover {
      background-color: #e9e9e9;
    }

    .option.selected, 
    label.option.selected, 
    label.selected,
    #newQuestionsContent label.selected {
      background-color: #d1e7dd;
      border-color: #28a745;
    }

    .option.correct, 
    label.option.correct, 
    label.correct,
    #newQuestionsContent label.correct {
      background-color: #d4edda;
      border-color: #28a745;
    }

    .option.incorrect, 
    label.option.incorrect, 
    label.incorrect,
    #newQuestionsContent label.incorrect {
      background-color: #f8d7da;
      border-color: #dc3545;
    }

    .submit-btn {
      display: block;
      width: 100%;
      padding: 15px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 18px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      margin-top: 30px;
    }

    .submit-btn:hover {
      background-color: #0056b3;
    }

    .results {
      text-align: center;
      margin-top: 30px;
      font-size: 20px;
      font-weight: bold;
      color: #333;
    }

    .scissor-icon {
      margin-right: 10px; /* Espa√ßo entre a tesoura e o texto da op√ß√£o */
      width: 20px; /* Ajuste conforme o tamanho da sua imagem */
      height: 20px; /* Ajuste conforme o tamanho da sua imagem */
      opacity: 0.5; /* Transpar√™ncia como no original */
      cursor: pointer;
    }

    .scissor-icon.hidden {
      display: none;
    }

    .struck-through {
      text-decoration: line-through;
      color: #888;
    }

    .comment {
      margin-top: 10px;
      padding: 10px;
      background-color: #f0f0f0;
      border-left: 4px solid #007bff;
      font-style: italic;
      color: #555;
      display: none; /* Escondido por padr√£o */
    }
    .comment.show {
      display: block; /* Mostrado quando ativado */
    }

    /* Estilos para o bot√£o de navega√ß√£o de erro / diagn√≥stico */
    .error-nav-btn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: #dc3545; /* Vermelho para erro */
      color: white;
      border: none;
      border-radius: 50%; /* Torna o bot√£o redondo */
      width: 60px;
      height: 60px;
      font-size: 24px;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      z-index: 1000;
      display: none; /* Escondido por padr√£o */
      flex-direction: column; /* Para empilhar o √≠cone e o contador */
      padding: 5px; /* Ajuste o padding para acomodar texto maior */
      box-sizing: border-box; /* Garante que padding n√£o aumente o tamanho total */
      text-align: center;
    }

    .error-nav-btn:hover {
      background-color: #c82333;
    }

    .error-nav-btn .arrow-icon {
      font-size: 30px; /* Tamanho da seta */
      line-height: 1; /* Ajuste para centralizar */
    }

    .error-nav-btn .button-text {
      font-size: 12px; /* Tamanho do texto abaixo da seta */
      line-height: 1;
      margin-top: 2px; /* Espa√ßo entre a seta e o texto */
    }

    /* Estilos para a se√ß√£o de diagn√≥stico de erros */
    .error-diagnosis-section {
        margin-top: 50px;
        padding: 30px;
        background-color: #ffe0b2; /* Um laranja claro ou similar */
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.15);
        display: none; /* Escondido por padr√£o */
        text-align: center;
        font-size: 1.1em;
        color: #333;
    }

    .error-diagnosis-section h2 {
        color: #e65100; /* Laranja mais escuro */
        margin-bottom: 20px;
        font-size: 1.8em;
    }

    .error-diagnosis-section ul {
        list-style: none; /* Remove marcadores de lista */
        padding: 0;
        margin: 0;
    }

    .error-diagnosis-section li {
        background-color: #ff9800; /* Laranja */
        color: white;
        padding: 8px 15px;
        margin: 8px 0;
        border-radius: 5px;
        display: inline-block; /* Para que os itens fiquem lado a lado */
        margin-right: 10px;
        font-weight: bold;
    }
    .error-diagnosis-section li:last-child {
        margin-right: 0;
    }
 .card-bloco {
      border: 1px solid #ddd;
      border-radius: 6px;
      padding: 10px;
      background: #fff;
      margin-bottom: 20px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    }
  </style>
</head>
<body>
  <div class="quiz-container">
    <h1 style="text-align:center; margin-bottom: 30px;">Simulado de Imunologia 01</h1>
    <div class="card-bloco" id="quiz"></div>
    <button class="submit-btn" id="verifyAnswersBtn">Verificar Respostas</button>

    <button class="generate-questions-btn submit-btn" id="generateNewQuestionsBtn" style="display:none;">
      Gerar Novas Perguntas
    </button>

    <div class="results card-bloco" id="results"></div>
    <div id="statusMessage" style="text-align: center; margin-top: 10px; font-weight: bold; color: #007bff;"></div>

    <div class="error-diagnosis-section card-bloco" id="errorDiagnosis">
      <h2>Diagn√≥stico de Erros</h2>
      <p>Parece que voc√™ precisa revisar os seguintes assuntos:</p>
      <ul id="topicsToReview"></ul>
    </div>

    <div class="generated-questions-section card-bloco" id="generatedQuestionsSection" style="display:none;">
      <h2>Novas Perguntas Geradas</h2>
      <div id="newQuestionsContent"></div>
    </div>
  </div>
  
  <button class="error-nav-btn" id="errorNavBtn" style="display:none;">
    <span class="arrow-icon"></span>
    <span class="button-text"></span>
  </button>

  <script>
    const quizContainer = document.getElementById("quiz");
    const resultsContainer = document.getElementById("results");
    const errorNavBtn = document.getElementById("errorNavBtn");
    const arrowIcon = errorNavBtn.querySelector(".arrow-icon");
    const buttonText = errorNavBtn.querySelector(".button-text");
    const errorDiagnosisSection = document.getElementById("errorDiagnosis");
    const topicsToReviewList = document.getElementById("topicsToReview");
    const generateNewQuestionsBtn = document.getElementById("generateNewQuestionsBtn");
    const generatedQuestionsSection = document.getElementById("generatedQuestionsSection");
    const newQuestionsContent = document.getElementById("newQuestionsContent");
    const statusMessage = document.getElementById("statusMessage");

    let wrongQuestionIndices = [];
    let errorCountByTopic = {};
    let totalAnsweredQuestionsByTopic = {};
    let currentWrongQuestionIndex = -1;
    let hasErrors = false;
    let isShowingErrors = false;
    let isShowingDiagnosis = false;

    // Inicializa a visibilidade das se√ß√µes no carregamento
    errorDiagnosisSection.style.display = 'none';
    topicsToReviewList.innerHTML = '';
    statusMessage.textContent = '';

    const questions = [       {         question: "1. A Imunidade Adquirida (ou Adaptativa) se diferencia da Imunidade Inata principalmente por qual caracter√≠stica?",         options: [           "A) √â a primeira a ser acionada na presen√ßa de um agente invasor.",           "B) √â uma resposta inespec√≠fica e com a qual j√° nascemos.",           "C) √â uma resposta que desenvolve mem√≥ria e especificidade ap√≥s exposi√ß√£o a um agente.",           "D) √â comparada aos \"soldados que chegam primeiro\" na defesa do organismo.",         ],         correctAnswer: "C) √â uma resposta que desenvolve mem√≥ria e especificidade ap√≥s exposi√ß√£o a um agente.",         comment: "A imunidade adquirida √© caracterizada por ser uma resposta que se torna diferente ap√≥s um contato pr√©vio, pois o organismo adquire mem√≥ria e especificidade para o agente, o que n√£o ocorre na imunidade inata.",         topic: "Imunidade: Inata vs. Adquirida",       },       {         question: "2. Na analogia utilizada pela Dra. Fl√°via, a Imunidade Adquirida √© comparada a qual figura?",         options: [           "A) Soldados que chegam primeiro.",           "B) Barreira f√≠sica.",           "C) Soldado mercen√°rio ou o que \"fica atr√°s da mesa\".",           "D) Complexo de ataque √† membrana.",         ],         correctAnswer: "C) Soldado mercen√°rio ou o que \"fica atr√°s da mesa\".",         comment: "A professora utilizou a analogia do \"soldado mercen√°rio\" ou o que \"fica atr√°s da mesa\" para se referir √† imunidade adquirida (ou adaptativa).",         topic: "Imunidade Adquirida: Analogias",       },       {         question: "3. Qual √© a defini√ß√£o mais abrangente de Ant√≠geno, segundo a aula?",         options: [           "A) Qualquer agente que cause infec√ß√£o e seja patog√™nico.",           "B) Qualquer subst√¢ncia invasora do corpo que cause danos imediatos.",           "C) Agente invasor que pode ser tanto patog√™nico quanto n√£o patog√™nico, como p√≥len ou poeira.",           "D) Mol√©cula de baixo peso molecular que necessita de uma prote√≠na carreadora para induzir resposta imune.",         ],         correctAnswer: "C) Agente invasor que pode ser tanto patog√™nico quanto n√£o patog√™nico, como p√≥len ou poeira.",         comment: "O ant√≠geno √© definido de forma ampla como um agente invasor que pode ser patog√™nico ou n√£o patog√™nico (como p√≥len ou poeira), enquanto o imun√≥geno √© especificamente o agente patog√™nico.",         topic: "Ant√≠geno: Defini√ß√£o e Exemplos",       },       {         question: "4. A afirma√ß√£o \"Todo imun√≥geno √© um ant√≠geno, mas nem todo ant√≠geno √© um imun√≥geno\" √© verdadeira, pois:",         options: [           "A) Imun√≥genos s√£o sempre n√£o patog√™nicos, enquanto ant√≠genos s√£o sempre patog√™nicos.",           "B) O ant√≠geno √© o agente causador da doen√ßa, e o imun√≥geno √© qualquer invasor.",           "C) Imun√≥geno √© o agente patog√™nico, e ant√≠genos podem ser n√£o patog√™nicos.",           "D) Ant√≠genos desenvolvem mem√≥ria, mas imun√≥genos n√£o s√£o capazes de gerar anticorpos.",         ],         correctAnswer: "C) Imun√≥geno √© o agente patog√™nico, e ant√≠genos podem ser n√£o patog√™nicos.",         comment: "O Imun√≥geno √© definido como o agente patog√™nico (que causa doen√ßa), enquanto o Ant√≠geno abrange qualquer agente invasor, incluindo subst√¢ncias n√£o patog√™nicas como p√≥len ou poeira.",         topic: "Ant√≠geno vs. Imun√≥geno",       },       {         question: "5. Qual termo descreve uma mol√©cula de baixo peso molecular que, sozinha, n√£o √© capaz de desencadear uma resposta imune, necessitando de uma prote√≠na carreadora?",         options: [           "A) Imun√≥geno.",           "B) Ep√≠topo.",           "C) IgA.",           "D) Hapteno (Apteno).",         ],         correctAnswer: "D) Hapteno (Apteno).",         comment: "O Hapteno (ou Apteno) √© uma mol√©cula pequena e de baixo peso molecular que s√≥ se torna imunog√™nica quando se liga a uma prote√≠na carreadora.",         topic: "Hapteno (Apteno)",       },       {         question: "6. A alergia √† penicilina √© citada como um exemplo cl√≠nico de Hapteno porque a penicilina:",         options: [           "A) √â um agente patog√™nico que causa a libera√ß√£o de anticorpos IgE.",           "B) √â uma mol√©cula que se liga a prote√≠nas carreadoras do corpo, tornando-se um ant√≠geno e desencadeando uma resposta imune.",           "C) Possui alto peso molecular, sendo facilmente reconhecida pelo sistema imune.",           "D) √â uma prote√≠na complexa que se torna um imun√≥geno ao entrar em contato com a mucosa.",         ],         correctAnswer: "B) √â uma mol√©cula que se liga a prote√≠nas carreadoras do corpo, tornando-se um ant√≠geno e desencadeando uma resposta imune.",         topic: "Aplica√ß√µes Cl√≠nicas: Haptenos e Alergia",       },       {         question: "7. O que a Dra. Fl√°via define como Imunogenicidade?",         options: [           "A) A capacidade de um agente de se ligar √† regi√£o Fab do anticorpo.",           "B) O potencial de causar doen√ßa (o qu√£o patog√™nico o agente √©).",           "C) A capacidade de um anticorpo atravessar a placenta.",           "D) A degrada√ß√£o de prote√≠nas por c√©lulas do sistema complemento.",         ],         correctAnswer: "B) O potencial de causar doen√ßa (o qu√£o patog√™nico o agente √©).",         comment: "Imunogenicidade √© o potencial de causar doen√ßa, ou seja, o qu√£o patog√™nico o agente √©.",         topic: "Imunogenicidade: Defini√ß√£o",       },       {         question: "8. Por que a Degrada√ß√£o √© uma caracter√≠stica importante de um bom imun√≥geno?",         options: [           "A) Garante que o ant√≠geno n√£o seja reconhecido pelo sistema imune.",           "B) Permite que a mol√©cula seja est√°vel, como o chumbo.",           "C) Facilita a fagocitose e a apresenta√ß√£o de fragmentos para a ativa√ß√£o da resposta imune.",           "D) Aumenta a complexidade qu√≠mica, o que o torna mais estranho.",         ],         correctAnswer: "C) Facilita a fagocitose e a apresenta√ß√£o de fragmentos para a ativa√ß√£o da resposta imune.",         comment: "Quanto mais degrad√°vel o agente, mais f√°cil √© para o sistema imune fagocit√°-lo e apresentar seus fragmentos para ativa√ß√£o de uma resposta.",         topic: "Caracter√≠sticas de um Bom Imun√≥geno: Degradabilidade",       },       {         question: "9. Por que a febre alta pode ser perigosa durante um processo de infec√ß√£o, mesmo sendo uma resposta inflamat√≥ria ben√©fica?",         options: [           "A) Ela desnatura o anticorpo, impedindo a opsoniza√ß√£o.",           "B) Ela desnatura prote√≠nas, podendo impedir o reconhecimento do ep√≠topo pelo sistema imune.",           "C) Ela ativa excessivamente a Via Cl√°ssica do complemento.",           "D) Ela inibe a produ√ß√£o de Linf√≥citos B.",         ],         correctAnswer: "B) Ela desnatura prote√≠nas, podendo impedir o reconhecimento do ep√≠topo pelo sistema imune.",         comment: "A febre √© importante, mas temperaturas muito elevadas podem desnaturar prote√≠nas. Se o ep√≠topo do microrganismo for desnaturado, o sistema imune n√£o o reconhece, prejudicando o combate ao agente.",         topic: "Relev√¢ncia Cl√≠nica: Febre e Desnatura√ß√£o",       },       {         question: "10. Qual √© a pequena regi√£o do ant√≠geno que √© especificamente reconhecida pelo sistema imune?",         options: [           "A) Regi√£o Constante (Fc).",           "B) Hapteno.",           "C) Ep√≠topo.",           "D) Complexo de Ataque √† Membrana (MAC).",         ],         correctAnswer: "C) Ep√≠topo.",         comment: "O Ep√≠topo √© a pequena regi√£o do ant√≠geno que o anticorpo se liga de forma espec√≠fica, funcionando como a \"fechadura\" na analogia da chave-fechadura.",         topic: "Ep√≠topo: Defini√ß√£o e Estrutura",       },       {         question: "11. Qual parte da estrutura do anticorpo √© respons√°vel pela especificidade da liga√ß√£o ao ant√≠geno?",         options: [           "A) A Regi√£o Constante (Fc).",           "B) O bra√ßo Fab (Regi√£o Vari√°vel).",           "C) O d√≠mero de IgA.",           "D) O pent√¢mero de IgM.",         ],         correctAnswer: "B) O bra√ßo Fab (Regi√£o Vari√°vel).",         comment: "A regi√£o Fab (Fragmento de liga√ß√£o ao ant√≠geno), localizada na ponta dos bra√ßos do \"Y\", √© a regi√£o vari√°vel que se liga ao ep√≠topo do ant√≠geno, conferindo a especificidade.",         topic: "Anticorpo: Regi√£o Fab e Especificidade",       },       {         question: "12. O que caracteriza o formato em \"Y\" do anticorpo, segundo a aula?",         options: [           "A) Duas cadeias leves e duas cadeias m√©dias.",           "B) Duas regi√µes vari√°veis e uma regi√£o constante.",           "C) Ser um pent√¢mero que se liga a 10 ep√≠topos.",           "D) Possuir duas regi√µes pesadas e duas regi√µes leves, com bra√ßos vari√°veis e uma base constante.",         ],         correctAnswer: "D) Possuir duas regi√µes pesadas e duas regi√µes leves, com bra√ßos vari√°veis e uma base constante.",         comment: "O anticorpo em \"Y\" √© formado por duas regi√µes pesadas e duas regi√µes leves. As pontas (Fab) s√£o vari√°veis (especificidade), e a base (Fc) √© constante (fun√ß√£o efetora).",         topic: "Anticorpo: Estrutura B√°sica",       },       {         question: "13. Qual imunoglobulina √© a principal no sangue, sendo respons√°vel pela mem√≥ria imunol√≥gica e a √∫nica capaz de atravessar a placenta?",         options: [           "A) IgA.",           "B) IgE.",           "C) IgM.",           "D) IgG.",         ],         correctAnswer: "D) IgG.",         comment: "O IgG √© o anticorpo principal no sangue, o respons√°vel pela mem√≥ria e o √∫nico que pode atravessar a placenta, conferindo imunidade passiva ao feto e rec√©m-nascido.",         topic: "Imunoglobulinas (IgG): Fun√ß√£o e Passagem Placent√°ria",       },       {         question: "14. A defici√™ncia de qual imunoglobulina est√° associada a infec√ß√µes recorrentes nas mucosas (sinusite, otite, colite) e a alergias alimentares?",         options: [           "A) IgM.",           "B) IgD.",           "C) IgE.",           "D) IgA.",         ],         correctAnswer: "D) IgA.",         comment: "O IgA √© encontrado nas mucosas, saliva e leite materno. Sua defici√™ncia compromete a prote√ß√£o dessas barreiras, levando a infec√ß√µes e problemas como a doen√ßa cel√≠aca e alergias alimentares.",         topic: "Imunoglobulinas (IgA): Localiza√ß√£o e Defici√™ncia Cl√≠nica",       },       {         question: "15. O IgM √© caracterizado por ser um pent√¢mero e ter qual principal fun√ß√£o?",         options: [           "A) Atravessar a placenta e conferir imunidade passiva.",           "B) Defesa contra parasitas e rea√ß√µes al√©rgicas imediatas.",           "C) Resposta de primeira linha e ativa√ß√£o potente da via cl√°ssica do complemento na fase aguda da infec√ß√£o.",           "D) Ativar linf√≥citos B imaturos e conferir imunidade cr√¥nica.",         ],         correctAnswer: "C) Resposta de primeira linha e ativa√ß√£o potente da via cl√°ssica do complemento na fase aguda da infec√ß√£o.",         comment: "O IgM √© a resposta r√°pida de primeira linha, ativando potentemente a via cl√°ssica do complemento e estimulando a produ√ß√£o de outros anticorpos (como IgG) na fase aguda da infec√ß√£o.",         topic: "Imunoglobulinas (IgM): Fase Aguda e Estrutura",       },       {         question: "16. O que √© a \"Troca de Classe\" de anticorpos (Class Switching)?",         options: [           "A) A mudan√ßa da regi√£o Fab do anticorpo para aumentar a especificidade.",           "B) A substitui√ß√£o do anticorpo de mem√≥ria pelo anticorpo de fase aguda.",           "C) A altera√ß√£o na regi√£o Fc do anticorpo para mudar o tipo de fun√ß√£o efetora, mantendo a mesma especificidade (Fab).",           "D) A desnatura√ß√£o das prote√≠nas do anticorpo devido √† febre alta.",         ],         correctAnswer: "C) A altera√ß√£o na regi√£o Fc do anticorpo para mudar o tipo de fun√ß√£o efetora, mantendo a mesma especificidade (Fab).",         comment: "A troca de classe √© a altera√ß√£o na regi√£o Fc do anticorpo para mudar sua classe (por exemplo, de IgM para IgG), o que muda a fun√ß√£o efetora, mas mant√©m a mesma especificidade para o microrganismo.",         topic: "Troca de Classe (Class Switching)",       },       {         question: "17. O que s√£o anafilatoxinas (C3a e C5a) geradas pelo Sistema Complemento?",         options: [           "A) Enzimas que destroem as membranas dos microrganismos.",           "B) Fragmentos pr√≥-inflamat√≥rios que induzem vasodilata√ß√£o, calor, dor e atraem c√©lulas imunes.",           "C) Mol√©culas que se ligam ao ant√≠geno para facilitar a fagocitose (opsoniza√ß√£o).",           "D) Complexos proteicos que bloqueiam a forma√ß√£o do MAC.",         ],         correctAnswer: "B) Fragmentos pr√≥-inflamat√≥rios que induzem vasodilata√ß√£o, calor, dor e atraem c√©lulas imunes.",         comment: "Os fragmentos C3a e C5a s√£o pr√≥-inflamat√≥rios (anafilatoxinas) que aumentam o processo inflamat√≥rio ao induzir vasodilata√ß√£o, aumentar a permeabilidade vascular e ativar mast√≥citos, causando os sintomas cl√°ssicos de inflama√ß√£o.",         topic: "Sistema Complemento: Anafilatoxinas (C3a e C5a)",       },       {         question: "18. O que √© Hemoglobin√∫ria Parox√≠stica Noturna (HPN) e qual defici√™ncia est√° relacionada a ela?",         options: [           "A) Doen√ßa que destr√≥i os gl√≥bulos vermelhos, relacionada √† defici√™ncia do regulador C1-INH.",           "B) Infec√ß√£o grave, caracterizada pela defici√™ncia da C3 convertase.",           "C) Doen√ßa que destr√≥i os gl√≥bulos vermelhos, causada pela defici√™ncia do regulador CD59.",           "D) Infec√ß√£o recorrente nas mucosas, devido √† defici√™ncia de IgA.",         ],         correctAnswer: "C) Doen√ßa que destr√≥i os gl√≥bulos vermelhos, causada pela defici√™ncia do regulador CD59.",         comment: "A HPN √© uma doen√ßa que destr√≥i os gl√≥bulos vermelhos (hem√≥lise), principalmente √† noite, liberando hemoglobina que √© excretada na urina (urina cor de chocolate), e est√° relacionada √† defici√™ncia do regulador CD59.",         topic: "Relev√¢ncia Cl√≠nica: Hemoglobin√∫ria Parox√≠stica Noturna (HPN)",       },       {         question: "19. A via de ativa√ß√£o do Sistema Complemento que √© ativada por um complexo Ant√≠geno-Anticorpo (IgG ou IgM) e √© a via da mem√≥ria √© a:",         options: [           "A) Via Alternativa.",           "B) Via das Lectinas.",           "C) Via Comum.",           "D) Via Cl√°ssica.",         ],         correctAnswer: "D) Via Cl√°ssica.",         comment: "A Via Cl√°ssica √© ativada quando o organismo j√° tem anticorpos (IgG ou IgM) para o agente, sendo, portanto, a via da mem√≥ria imunol√≥gica do Sistema Complemento.",         topic: "Sistema Complemento: Via Cl√°ssica",       },       {         question: "20. A via de ativa√ß√£o do Sistema Complemento que √© ativada diretamente pela superf√≠cie do microrganismo, sem depender de anticorpos, √© a:",         options: [           "A) Via Alternativa.",           "B) Via Cl√°ssica.",           "C) Via das Lectinas.",           "D) Via Comum.",         ],         correctAnswer: "A) Via Alternativa.",         comment: "A Via Alternativa √© ativada diretamente pelo microrganismo, sem a necessidade de anticorpos, sendo a via da defesa precoce.",         topic: "Sistema Complemento: Via Alternativa",       },       {         question: "21. A ativa√ß√£o do Sistema Complemento pela Via das Lectinas √© mais comum na defesa contra quais tipos de agentes, devido √† presen√ßa de a√ß√∫cares em suas superf√≠cies?",         options: [           "A) Parasitas e bact√©rias.",           "B) Bact√©rias e v√≠rus.",           "C) Fungos e v√≠rus.",           "D) Protozo√°rios e bact√©rias.",         ],         correctAnswer: "C) Fungos e v√≠rus.",         comment: "A Via das Lectinas √© ativada pela liga√ß√£o a a√ß√∫cares presentes na superf√≠cie dos microrganismos, sendo citados como exemplos cl√≠nicos a defesa contra Candida (fungo) e alguns v√≠rus respirat√≥rios. Bact√©rias podem ativar tanto a via da lectina quanto a via alternativa.",         topic: "Sistema Complemento: Via das Lectinas",       },       {         question: "22. O que √© o Complexo de Ataque √† Membrana (MAC) e qual seu objetivo final na cascata do complemento?",         options: [           "A) √â o complexo C3 Convertase, respons√°vel pela opsoniza√ß√£o.",           "B) √â o complexo formado ap√≥s a C5 Convertase, respons√°vel por causar lise e destrui√ß√£o do microrganismo.",           "C) √â o fragmento C3a, respons√°vel por induzir a inflama√ß√£o local.",           "D) √â um regulador que impede o dano tecidual.",         ],         correctAnswer: "B) √â o complexo formado ap√≥s a C5 Convertase, respons√°vel por causar lise e destrui√ß√£o do microrganismo.",         topic: "Sistema Complemento: Complexo de Ataque √† Membrana (MAC)",       },       {         question: "23. Qual prote√≠na inibidora √© respons√°vel por bloquear a Via Cl√°ssica do Sistema Complemento?",         options: [           "A) CD59.",           "B) Fator H.",           "C) Inibidor de C1 (C1-INH).",           "D) Fator I.",         ],         correctAnswer: "C) Inibidor de C1 (C1-INH).",         comment: "O Inibidor de C1 (C1-INH) tem a fun√ß√£o de bloquear a Via Cl√°ssica, prevenindo sua autoativa√ß√£o descontrolada, que pode levar a doen√ßas como o Angioedema Heredit√°rio.",         topic: "Sistema Complemento: Regula√ß√£o da Via Cl√°ssica (C1-INH)",       },       {         question: "24. Qual √© a consequ√™ncia cl√≠nica da defici√™ncia do Inibidor de C1 (C1-INH)?",         options: [           "A) Hemoglobin√∫ria Parox√≠stica Noturna (HPN).",           "B) Defici√™ncia de IgA.",           "C) Angioedema Heredit√°rio.",           "D) L√∫pus Eritematoso Sist√™mico (LES).",         ],         correctAnswer: "C) Angioedema Heredit√°rio.",         comment: "A defici√™ncia do inibidor de C1 (C1-INH) leva √† autoativa√ß√£o descontrolada da via cl√°ssica, que pode causar Angioedema Heredit√°rio.",         topic: "Relev√¢ncia Cl√≠nica: Angioedema Heredit√°rio",       },       {         question: "25. Qual √© o papel das prote√≠nas Fator H e Fator I?",         options: [           "A) Bloquear a forma√ß√£o do Complexo de Ataque √† Membrana (MAC).",           "B) Regular a Via Cl√°ssica do Sistema Complemento.",           "C) Inativar o C3, regulando a Via Alternativa e impedindo a forma√ß√£o da C3 Convertase.",           "D) Promover a vasodilata√ß√£o na resposta inflamat√≥ria.",         ],         correctAnswer: "C) Inativar o C3, regulando a Via Alternativa e impedindo a forma√ß√£o da C3 Convertase.",         comment: "O Fator H e o Fator I regulam a Via Alternativa, inativando a C3 para impedir a forma√ß√£o da C3 Convertase e, consequentemente, a progress√£o da cascata.",         topic: "Sistema Complemento: Regula√ß√£o da Via Alternativa (Fator H e I)",       },       {         question: "26. A defici√™ncia dos fatores H e I √© citada como causa de maior susceptibilidade a infec√ß√µes por qual tipo de bact√©ria?",         options: [           "A) Candida.",           "B) Neisseria (causadora de meningite).",           "C) Streptococcus.",           "D) V√≠rus respirat√≥rios.",         ],         correctAnswer: "B) Neisseria (causadora de meningite).",         comment: "A defici√™ncia do Fator H e I est√° associada √† susceptibilidade a infec√ß√µes por Neisseria, que pode causar meningite.",         topic: "Relev√¢ncia Cl√≠nica: Fatores H e I e Infec√ß√µes",       },       {         question: "27. Por que a regula√ß√£o do Sistema Complemento √© \"extremamente importante\"?",         options: [           "A) Para garantir que a Via das Lectinas seja a √∫nica ativada.",           "B) Para prevenir o desvio para a Via Cl√°ssica, que √© menos eficiente.",           "C) Para n√£o causar dano tecidual e inflama√ß√£o descontrolada.",           "D) Para que a C3 Convertase n√£o se forme.",         ],         correctAnswer: "C) Para n√£o causar dano tecidual e inflama√ß√£o descontrolada.",         comment: "A regula√ß√£o √© vital para evitar que o sistema, que √© muito potente, permane√ßa ativo, o que causaria dano tecidual (destrui√ß√£o de c√©lulas pr√≥prias) e inflama√ß√£o descontrolada.",         topic: "Sistema Complemento: Import√¢ncia da Regula√ß√£o",       },       {         question: "28. Qual √© a prote√≠na reguladora cuja defici√™ncia leva √† destrui√ß√£o dos gl√≥bulos vermelhos (hem√≥lise) por n√£o conseguir bloquear a forma√ß√£o do MAC nas c√©lulas pr√≥prias?",         options: [           "A) Inibidor de C1 (C1-INH).",           "B) CD59.",           "C) Fator H.",           "D) C3 Convertase.",         ],         correctAnswer: "B) CD59.",         comment: "O CD59 (prolectina) √© respons√°vel por bloquear a forma√ß√£o do Complexo de Ataque √† Membrana (MAC) nas c√©lulas pr√≥prias, e sua defici√™ncia est√° ligada √† Hemoglobin√∫ria Parox√≠stica Noturna (HPN).",         topic: "Sistema Complemento: Regulador CD59",       },       {         question: "29. O que ocorre na C3 Convertase, o denominador comum das tr√™s vias de ativa√ß√£o do complemento?",         options: [           "A) Forma√ß√£o do Complexo de Ataque √† Membrana (MAC).",           "B) Opsoniza√ß√£o do pat√≥geno pelo C5a.",           "C) Clivagem da prote√≠na C3 em C3a (pr√≥-inflamat√≥rio) e C3b (opsonizador).",           "D) Bloqueio da via alternativa pelo Fator H.",         ],         correctAnswer: "C) Clivagem da prote√≠na C3 em C3a (pr√≥-inflamat√≥rio) e C3b (opsonizador).",         comment: "Todas as tr√™s vias (Cl√°ssica, Alternativa e Lectinas) convergem para a C3 Convertase, cuja fun√ß√£o √© clivar a prote√≠na C3 em C3a e C3b, essenciais para a opsoniza√ß√£o e inflama√ß√£o.",         topic: "Sistema Complemento: C3 Convertase",       },       {         question: "30. Qual imunoglobulina √© descrita como um d√≠mero que se encontra nas mucosas, saliva e leite materno?",         options: [           "A) IgG.",           "B) IgM.",           "C) IgA.",           "D) IgE.",         ],         correctAnswer: "C) IgA.",         comment: "O IgA √© o anticorpo que se apresenta como um d√≠mero (duas mol√©culas de Y ligadas) e √© o principal nas secre√ß√µes, como mucosas e leite materno.",         topic: "Imunoglobulinas (IgA): Estrutura e Localiza√ß√£o",       },       {         question: "31. O sistema complemento √© um conjunto de mais de 30 prote√≠nas que atuam em cascata. Onde essas prote√≠nas s√£o principalmente produzidas?",         options: [           "A) Na medula √≥ssea.",           "B) No ba√ßo.",           "C) No f√≠gado.",           "D) Nos linfonodos.",         ],         correctAnswer: "C) No f√≠gado.",         comment: "O sistema complemento √© um conjunto de mais de 30 prote√≠nas plasm√°ticas, produzidas principalmente no f√≠gado.",         topic: "Sistema Complemento: Produ√ß√£o",       },       {         question: "32. Qual a principal fun√ß√£o do fragmento C3b?",         options: [           "A) Atuar como anafilatoxina, causando vasodilata√ß√£o.",           "B) Bloquear a forma√ß√£o do MAC na superf√≠cie celular.",           "C) Opsonizar o pat√≥geno, facilitando a fagocitose.",           "D) Recrutar neutr√≥filos para o local da infec√ß√£o.",         ],         correctAnswer: "C) Opsonizar o pat√≥geno, facilitando a fagocitose.",         comment: "O C3b opsoniza o pat√≥geno (marca para destrui√ß√£o), facilitando a fagocitose pelas c√©lulas imunes.",         topic: "Sistema Complemento: Fragmento C3b e Opsoniza√ß√£o",       },       {         question: "33. As subclasses de IgG (IgG1, IgG2, IgG3 e IgG4) s√£o clinicamente relevantes devido a qual caracter√≠stica?",         options: [           "A) Sua capacidade de regular a via alternativa.",           "B) Sua defici√™ncia estar ligada a problemas na opsoniza√ß√£o pelo C3b.",           "C) Varia√ß√µes na efici√™ncia de ativa√ß√£o do Sistema Complemento e sua defici√™ncia estar ligada a doen√ßas autoimunes e alergias.",           "D) Serem os √∫nicos anticorpos produzidos na fase aguda da infec√ß√£o.",         ],         correctAnswer: "C) Varia√ß√µes na efici√™ncia de ativa√ß√£o do Sistema Complemento e sua defici√™ncia estar ligada a doen√ßas autoimunes e alergias.",         comment: "As subclasses de IgG t√™m diferentes efici√™ncias de ativa√ß√£o do complemento (IgG3 √© o mais eficiente), e sua defici√™ncia est√° associada a alergias e doen√ßas autoimunes.",         topic: "Imunoglobulinas (IgG): Subclasses e Relev√¢ncia Cl√≠nica",       },       {         question: "34. Em um exame sorol√≥gico para diagn√≥stico de COVID, qual anticorpo estaria positivo na fase aguda (infec√ß√£o ativa) da doen√ßa?",         options: [           "A) IgG.",           "B) IgA.",           "C) IgD.",           "D) IgM.",         ],         correctAnswer: "D) IgM.",         comment: "O IgM √© o anticorpo de primeira resposta, sendo positivo na fase ativa ou aguda da doen√ßa.",         topic: "Aplica√ß√µes Cl√≠nicas: Sorologia (IgM vs. IgG)",       },       {         question: "35. O que a professora cita como principal exemplo cl√≠nico da fun√ß√£o pr√≥-inflamat√≥ria do complemento (C3a e C5a)?",         options: [           "A) Doen√ßas autoimunes como o L√∫pus.",           "B) A Hemoglobin√∫ria Parox√≠stica Noturna.",           "C) O Choque Anafil√°tico, relacionado √† ativa√ß√£o excessiva.",           "D) Defici√™ncia de IgA, que leva a infec√ß√µes de mucosa.",         ],         correctAnswer: "C) O Choque Anafil√°tico, relacionado √† ativa√ß√£o excessiva.",         comment: "A produ√ß√£o excessiva das anafilatoxinas (C3a e C5a), que induzem vasodilata√ß√£o e inflama√ß√£o, est√° ligada √† rea√ß√£o al√©rgica extrema que pode levar ao choque anafil√°tico.",         topic: "Relev√¢ncia Cl√≠nica: Choque Anafil√°tico e Complemento",       },       {         question: "36. A articula√ß√£o entre a Imunidade Inata e Adaptativa, no que diz respeito ao Sistema Complemento, reside no fato de que o sistema:",         options: [           "A) Apenas ativa a via cl√°ssica.",           "B) Auxilia a imunidade adaptativa pela via cl√°ssica (com anticorpos) e participa da inata pela via alternativa (sem anticorpos).",           "C) √â regulado apenas por fatores espec√≠ficos de linf√≥citos T.",           "D) Tem como √∫nico papel a remo√ß√£o de imunocomplexos.",         ],         correctAnswer: "B) Auxilia a imunidade adaptativa pela via cl√°ssica (com anticorpos) e participa da inata pela via alternativa (sem anticorpos).",         comment: "O sistema complemento participa da imunidade inata (via alternativa e lectinas) e auxilia a adaptativa (via cl√°ssica), atuando em ambas as linhas de defesa.",         topic: "Sistema Complemento: Integra√ß√£o Inata e Adaptativa",       },       {         question: "37. Qual imunoglobulina est√° presente em alergias (hipersensibilidade imediata) e √© fundamental na defesa contra parasitas grandes?",         options: [           "A) IgG.",           "B) IgD.",           "C) IgM.",           "D) IgE.",         ],         correctAnswer: "D) IgE.",         comment: "O IgE √© o anticorpo envolvido nas rea√ß√µes al√©rgicas (hipersensibilidade imediata) e na defesa contra parasitas, chamando as c√©lulas citot√≥xicas (eosin√≥filos) para o combate.",         topic: "Imunoglobulinas (IgE): Alergia e Parasitas",       },       {         question: "38. Qual das seguintes caracter√≠sticas N√ÉO torna um agente um \"Bom Imun√≥geno\"?",         options: [           "A) Ser uma macromol√©cula de alto peso molecular.",           "B) Possuir alta complexidade qu√≠mica.",           "C) Ser muito parecido com as c√©lulas do nosso corpo (pouca estranheza).",           "D) Possuir alta degradabilidade.",         ],         correctAnswer: "C) Ser muito parecido com as c√©lulas do nosso corpo (pouca estranheza).",         comment: "A estranheza (ser \"n√£o pr√≥prio\") √© uma caracter√≠stica de um bom imun√≥geno. Quanto mais parecido com as c√©lulas pr√≥prias (pouca estranheza), mais dif√≠cil √© o reconhecimento.",         topic: "Caracter√≠sticas de um Bom Imun√≥geno: Estranheza",       },       {         question: "39. O que significa o clareamento de imunocomplexos pelo sistema complemento?",         options: [           "A) A neutraliza√ß√£o do v√≠rus por anticorpos.",           "B) A atra√ß√£o de neutr√≥filos e mast√≥citos para o local da infec√ß√£o.",           "C) A fagocitose e remo√ß√£o de material morto (microrganismos e anticorpos ligados) dos tecidos, evitando o dep√≥sito de complexos.",           "D) A clivagem da prote√≠na C5 pelo Complexo de Ataque √† Membrana (MAC).",         ],         correctAnswer: "C) A fagocitose e remo√ß√£o de material morto (microrganismos e anticorpos ligados) dos tecidos, evitando o dep√≥sito de complexos.",         topic: "Sistema Complemento: Clareamento de Imunocomplexos",       },       {         question: "40. O que as tr√™s vias de ativa√ß√£o do Sistema Complemento (Cl√°ssica, Alternativa e Lectinas) t√™m em comum em sua fase de amplifica√ß√£o?",         options: [           "A) A ativa√ß√£o da prote√≠na C1.",           "B) A forma√ß√£o da C3 Convertase e a subsequente forma√ß√£o da C5 Convertase.",           "C) O uso de anticorpos como requisito para a ativa√ß√£o.",           "D) A regula√ß√£o pelo fator H e I.",         ],         correctAnswer: "B) A forma√ß√£o da C3 Convertase e a subsequente forma√ß√£o da C5 Convertase.",         comment: "Todas as tr√™s vias (Cl√°ssica, Alternativa e Lectinas) convergem para a forma√ß√£o da C3 Convertase, que amplifica a cascata e leva √† forma√ß√£o da C5 Convertase, o precursor do Complexo de Ataque √† Membrana (MAC).",         topic: "Sistema Complemento: Converg√™ncia das Vias",       },     ];

    function buildQuiz() {
      const output = [];

      questions.forEach((currentQuestion, questionNumber) => {
        const options = [];
        for (let i = 0; i < currentQuestion.options.length; i++) {
          options.push(
            `<label class="option" data-question="${questionNumber}" data-value="${currentQuestion.options[i]}">
              <img src="tesouras.png" class="scissor-icon" onclick="event.stopPropagation(); this.parentNode.classList.toggle('struck-through');">
              ${currentQuestion.options[i]}
            </label>`
          );
        }

        output.push(
          `<div class="card" id="question-${questionNumber}" data-topic="${currentQuestion.topic}">
            <div class="question">${currentQuestion.question}</div>
            <div class="options">${options.join("")}</div>
            <div class="comment" id="comment-${questionNumber}"></div>
          </div>`
        );
      });

      quizContainer.innerHTML = output.join("");
    }

    function showResults() {
      wrongQuestionIndices = [];
      errorCountByTopic = {};
      totalAnsweredQuestionsByTopic = {};
      currentWrongQuestionIndex = -1;
      hasErrors = false;
      isShowingErrors = false;
      isShowingDiagnosis = false;

      errorDiagnosisSection.style.display = 'none';
      topicsToReviewList.innerHTML = '';
      statusMessage.textContent = '';

      // Busca por todas as perguntas: est√°ticas e din√¢micas
      const allQuestionCards = document.querySelectorAll('.quiz-container .card, #newQuestionsContent .card');
      let correctAnswersCount = 0;
      let totalQuestionsAnswered = 0;

      console.log('üîç Verificando', allQuestionCards.length, 'perguntas...');

      allQuestionCards.forEach((card, index) => {
        const questionEl = card.querySelector('.question') || card.querySelector('p');
        if (!questionEl) return;

        const questionText = questionEl.textContent.trim();
        const optionsContainer = card.querySelector('.options') || card;
        const allOptions = optionsContainer.querySelectorAll('.option, label.option, label');
        const userAnswerElement = optionsContainer.querySelector('.option.selected, label.selected');
        const commentDiv = card.querySelector('.comment');

        const questionTopic = card.dataset.topic || "T√≥pico n√£o informado";
        
        console.log(`üìù Pergunta ${index + 1}: T√≥pico = "${questionTopic}"`);
        console.log(`üîç Encontradas ${allOptions.length} alternativas`);
        
        // Remove classes anteriores
        allOptions.forEach(option => {
          option.classList.remove('correct', 'incorrect', 'selected');
        });
        if (commentDiv) commentDiv.classList.remove('show');

        let correctAnswerValue = null;
        let questionComment = null;

        // Verifica se √© pergunta est√°tica ou din√¢mica
        const isStatic = card.id && card.id.startsWith('question-');
        if (isStatic) {
          // Pergunta est√°tica - busca nos dados originais
          const questionData = questions.find(q => q.question.trim() === questionText);
          if (questionData) {
            correctAnswerValue = questionData.correctAnswer.trim();
            questionComment = questionData.comment;
          }
        } else {
          // Pergunta din√¢mica - busca pela op√ß√£o marcada como correta
          const correctOpt = optionsContainer.querySelector('.option[data-answer="true"], label[data-answer="true"]');
          if (correctOpt) {
            correctAnswerValue = correctOpt.dataset.value?.trim() || correctOpt.textContent.trim();
            console.log(`‚úÖ Resposta correta encontrada: "${correctAnswerValue}"`);
          } else {
            console.log('‚ùå Nenhuma resposta correta encontrada para pergunta din√¢mica');
          }
          
          // Busca coment√°rio no pr√≥prio card ou no div comment
          const commentElement = card.querySelector('.comment');
          if (commentElement && commentElement.textContent.trim()) {
            questionComment = commentElement.textContent.trim();
          }
        }

        // Processa resposta do usu√°rio e aplica colora√ß√£o
        let userAnswer = null;
        if (userAnswerElement) {
          userAnswerElement.classList.add('selected');
          userAnswer = userAnswerElement.dataset.value?.trim() || userAnswerElement.textContent.trim();
          totalQuestionsAnswered++;
          totalAnsweredQuestionsByTopic[questionTopic] = (totalAnsweredQuestionsByTopic[questionTopic] || 0) + 1;

          console.log(`üë§ Resposta do usu√°rio: "${userAnswer}"`);
          console.log(`üéØ Resposta correta: "${correctAnswerValue}"`);

          // Verifica se a resposta est√° correta
          if (userAnswer === correctAnswerValue) {
            correctAnswersCount++;
            console.log(`‚úÖ Resposta correta!`);
          } else {
            hasErrors = true;
            errorCountByTopic[questionTopic] = (errorCountByTopic[questionTopic] || 0) + 1;
            console.log(`‚ùå Resposta incorreta para t√≥pico: ${questionTopic}`);
          }
        }

        // Aplica colora√ß√£o: SEMPRE marca a correta de verde, e a errada de vermelho se foi marcada
        allOptions.forEach(option => {
          const optionValue = option.dataset.value?.trim() || option.textContent.trim();
          
          // Marca a resposta correta de verde SEMPRE
          if (optionValue === correctAnswerValue) {
            option.classList.add('correct');
            console.log(`üü¢ Marcando como correta: "${optionValue}"`);
          }
          
          // Se o usu√°rio marcou uma resposta E ela est√° errada, marca de vermelho
          if (userAnswer && optionValue === userAnswer && userAnswer !== correctAnswerValue) {
            option.classList.add('incorrect');
            console.log(`üî¥ Marcando como incorreta: "${optionValue}"`);
          }
        });

        // Mostra coment√°rio se dispon√≠vel
        if (commentDiv && questionComment) {
          commentDiv.textContent = questionComment;
          commentDiv.classList.add('show');
        }
      });

      // Exibe resultados
      resultsContainer.textContent = `Voc√™ acertou ${correctAnswersCount} de ${totalQuestionsAnswered} quest√µes respondidas.`;

      console.log('üìä Erros por t√≥pico:', errorCountByTopic);
      console.log('üìä Total por t√≥pico:', totalAnsweredQuestionsByTopic);

      // Gera diagn√≥stico de erros
      if (hasErrors) {
        for (const topic in errorCountByTopic) {
          const errors = errorCountByTopic[topic];
          const total = totalAnsweredQuestionsByTopic[topic] || 0;
          if (total > 0) {
            const percent = ((errors / total) * 100).toFixed(1);
            const li = document.createElement('li');
            li.textContent = `${topic}: ${percent}% de erros (${errors} de ${total} quest√µes respondidas)`;
            topicsToReviewList.appendChild(li);
          }
        }
      } else {
        const li = document.createElement('li');
        li.textContent = "ü•≥ Parab√©ns! Voc√™ n√£o teve erros nas quest√µes respondidas.";
        topicsToReviewList.appendChild(li);
      }

      errorDiagnosisSection.style.display = 'block';
      generatedQuestionsSection.style.display = 'block';
      generateNewQuestionsBtn.style.display = 'block';
      scrollToDiagnosis();
    }

    function scrollToQuestion(index) {
      const questionCard = document.getElementById(`question-${index}`);
      if (questionCard) {
        questionCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }
    }

    function scrollToDiagnosis() {
        errorDiagnosisSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    function scrollToGeneratedQuestions() {
        generatedQuestionsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    // Event listener para sele√ß√£o de op√ß√µes (funciona para est√°ticas e din√¢micas)
    document.addEventListener("click", function (event) {
      const clickedElement = event.target;
      const optionElement = clickedElement.closest('.option');

      if (optionElement) {
          if (clickedElement.classList.contains("scissor-icon")) {
              event.stopPropagation();
              optionElement.classList.toggle("struck-through");
          }
          else {
              const parentCard = optionElement.closest('.card');
              const currentQuestionOptions = parentCard.querySelectorAll('.option');

              currentQuestionOptions.forEach(opt => opt.classList.remove("selected"));
              optionElement.classList.add("selected");
          }
      }
    });

    generateNewQuestionsBtn.addEventListener("click", async function() {
        statusMessage.textContent = '‚è≥ Gerando novas perguntas...';
        generateNewQuestionsBtn.disabled = true;

        const topics = Object.keys(errorCountByTopic).filter(topic => {
            const errorsInTopic = errorCountByTopic[topic] || 0;
            const totalAnsweredInTopic = totalAnsweredQuestionsByTopic[topic] || 0;
            return errorsInTopic > 0 && totalAnsweredInTopic > 0;
        });

        const topicsToSend = topics.length > 0 ? topics : ["fisiologia celular", "biologia"];

        try {
            const response = await fetch('https://www.quizia.xyz/quiz', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ topicos: topicsToSend }),
            });

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const data = await response.json();

            newQuestionsContent.innerHTML = '';
            if (data && data.html) {
                console.log('üì• HTML recebido do Flask:', data.html);
                
                // Insere o HTML diretamente sem reconstru√ß√£o complexa
                newQuestionsContent.innerHTML = data.html.replace(/```html|```/g, '');
                
                // Adiciona tesouras e ajusta formata√ß√£o apenas se necess√°rio
                newQuestionsContent.querySelectorAll('.card').forEach((card, cardIndex) => {
                    // Garante que o elemento de pergunta tenha a classe correta
                    const questionElement = card.querySelector('p');
                    if (questionElement && !questionElement.classList.contains('question')) {
                       questionElement.classList.add('question');
                    }

                    // Remove qualquer input de radio que possa existir e adiciona tesouras
                    card.querySelectorAll('label').forEach((label) => {
                        // Remove inputs de radio MAS preserva o atributo data-answer
                        const radioInput = label.querySelector('input[type="radio"]');
                        if (radioInput) {
                            // PRESERVA o atributo data-answer do input no label
                            if (radioInput.hasAttribute('data-answer')) {
                                label.setAttribute('data-answer', radioInput.getAttribute('data-answer'));
                            }
                            radioInput.remove();
                        }
                        
                        // Garante que tenha a classe option
                        if (!label.classList.contains('option')) {
                            label.classList.add('option');
                        }

                        // Garante que tenha data-value
                        if (!label.dataset.value) {
                            label.dataset.value = label.textContent.trim();
                        }

                        // Adiciona tesoura se n√£o existir
                        if (!label.querySelector('.scissor-icon')) {
                            const scissorIcon = document.createElement('img');
                            scissorIcon.src = 'tesouras.png';
                            scissorIcon.className = 'scissor-icon';
                            scissorIcon.onclick = function(e) {
                                e.stopPropagation();
                                label.classList.toggle('struck-through');
                            };
                            label.insertBefore(scissorIcon, label.firstChild);
                        }
                    });

                    console.log(`üè∑Ô∏è Card ${cardIndex}: data-topic = "${card.dataset.topic}"`);
                    
                    // Verifica se h√° op√ß√£o correta marcada
                    const correctOption = card.querySelector('label[data-answer="true"]');
                    if (correctOption) {
                        console.log(`‚úÖ Op√ß√£o correta encontrada: "${correctOption.dataset.value}"`);
                    } else {
                        console.log('‚ùå Nenhuma op√ß√£o correta encontrada');
                    }
                });
            } else {
                newQuestionsContent.innerHTML = "<p>N√£o foi poss√≠vel gerar novas perguntas para os t√≥picos selecionados.</p>";
            }
            
            generatedQuestionsSection.style.display = 'block';
            scrollToGeneratedQuestions();
            statusMessage.textContent = '‚úÖ Perguntas geradas com sucesso!';
            setTimeout(() => { statusMessage.textContent = '' }, 3000);

        } catch (error) {
            console.error('Erro ao gerar novas perguntas:', error);
            newQuestionsContent.innerHTML = `<p>Erro ao carregar novas perguntas: ${error.message}. Por favor, tente novamente.</p>`;
            generatedQuestionsSection.style.display = 'block';
            scrollToGeneratedQuestions();
            statusMessage.textContent = '‚ùå Erro na requisi√ß√£o: ' + error.message;
            setTimeout(() => { statusMessage.textContent = '' }, 5000);
        } finally {
            generateNewQuestionsBtn.disabled = false;
        }
    });

    // Inicializa√ß√£o
    buildQuiz();
    errorDiagnosisSection.style.display = 'none';
    generatedQuestionsSection.style.display = 'none';
    generateNewQuestionsBtn.style.display = 'none';

    // Event listener para o bot√£o de verificar respostas
    document.getElementById("verifyAnswersBtn").addEventListener("click", showResults);
  </script>
</body>
</html>
