<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>Órgãos Linfoides Parte 01</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      background-color: #f4f4f4;
    }

    .quiz-container {
      max-width: 800px;
      width: 100%;
    }

    h1 {
      color: #333;
      text-align: center;
      margin-bottom: 30px;
    }

    .card {
      background-color: white;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .question {
      font-weight: bold;
      margin-bottom: 10px;
      color: #333;
    }

    .options {
      margin-top: 15px;
    }

    /* Estilos unificados para todas as opções (estáticas e dinâmicas) */
    .option, label.option, label, #newQuestionsContent label {
      display: flex; /* Para alinhar imagem e texto */
      align-items: center;
      margin-bottom: 10px;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.2s ease;
      position: relative; /* Para posicionar a tesoura */
    }

    /* FORÇA a remoção de inputs de radio em QUALQUER lugar */
    .option input[type="radio"], 
    label input[type="radio"],
    #newQuestionsContent input[type="radio"],
    #newQuestionsContent label input[type="radio"] {
        display: none !important;
        visibility: hidden !important;
        opacity: 0 !important;
        position: absolute !important;
        left: -9999px !important;
    }

    .option:hover, 
    label.option:hover, 
    label:hover,
    #newQuestionsContent label:hover {
      background-color: #e9e9e9;
    }

    .option.selected, 
    label.option.selected, 
    label.selected,
    #newQuestionsContent label.selected {
      background-color: #d1e7dd;
      border-color: #28a745;
    }

    .option.correct, 
    label.option.correct, 
    label.correct,
    #newQuestionsContent label.correct {
      background-color: #d4edda;
      border-color: #28a745;
    }

    .option.incorrect, 
    label.option.incorrect, 
    label.incorrect,
    #newQuestionsContent label.incorrect {
      background-color: #f8d7da;
      border-color: #dc3545;
    }

    .submit-btn {
      display: block;
      width: 100%;
      padding: 15px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 18px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      margin-top: 30px;
    }

    .submit-btn:hover {
      background-color: #0056b3;
    }

    .results {
      text-align: center;
      margin-top: 30px;
      font-size: 20px;
      font-weight: bold;
      color: #333;
    }

    .scissor-icon {
      margin-right: 10px; /* Espaço entre a tesoura e o texto da opção */
      width: 20px; /* Ajuste conforme o tamanho da sua imagem */
      height: 20px; /* Ajuste conforme o tamanho da sua imagem */
      opacity: 0.5; /* Transparência como no original */
      cursor: pointer;
    }

    .scissor-icon.hidden {
      display: none;
    }

    .struck-through {
      text-decoration: line-through;
      color: #888;
    }

    .comment {
      margin-top: 10px;
      padding: 10px;
      background-color: #f0f0f0;
      border-left: 4px solid #007bff;
      font-style: italic;
      color: #555;
      display: none; /* Escondido por padrão */
    }
    .comment.show {
      display: block; /* Mostrado quando ativado */
    }

    /* Estilos para o botão de navegação de erro / diagnóstico */
    .error-nav-btn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: #dc3545; /* Vermelho para erro */
      color: white;
      border: none;
      border-radius: 50%; /* Torna o botão redondo */
      width: 60px;
      height: 60px;
      font-size: 24px;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      z-index: 1000;
      display: none; /* Escondido por padrão */
      flex-direction: column; /* Para empilhar o ícone e o contador */
      padding: 5px; /* Ajuste o padding para acomodar texto maior */
      box-sizing: border-box; /* Garante que padding não aumente o tamanho total */
      text-align: center;
    }

    .error-nav-btn:hover {
      background-color: #c82333;
    }

    .error-nav-btn .arrow-icon {
      font-size: 30px; /* Tamanho da seta */
      line-height: 1; /* Ajuste para centralizar */
    }

    .error-nav-btn .button-text {
      font-size: 12px; /* Tamanho do texto abaixo da seta */
      line-height: 1;
      margin-top: 2px; /* Espaço entre a seta e o texto */
    }

    /* Estilos para a seção de diagnóstico de erros */
    .error-diagnosis-section {
        margin-top: 50px;
        padding: 30px;
        background-color: #ffe0b2; /* Um laranja claro ou similar */
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.15);
        display: none; /* Escondido por padrão */
        text-align: center;
        font-size: 1.1em;
        color: #333;
    }

    .error-diagnosis-section h2 {
        color: #e65100; /* Laranja mais escuro */
        margin-bottom: 20px;
        font-size: 1.8em;
    }

    .error-diagnosis-section ul {
        list-style: none; /* Remove marcadores de lista */
        padding: 0;
        margin: 0;
    }

    .error-diagnosis-section li {
        background-color: #ff9800; /* Laranja */
        color: white;
        padding: 8px 15px;
        margin: 8px 0;
        border-radius: 5px;
        display: inline-block; /* Para que os itens fiquem lado a lado */
        margin-right: 10px;
        font-weight: bold;
    }
    .error-diagnosis-section li:last-child {
        margin-right: 0;
    }
 .card-bloco {
      border: 1px solid #ddd;
      border-radius: 6px;
      padding: 10px;
      background: #fff;
      margin-bottom: 20px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    }
  </style>
</head>
<body>
  <div class="quiz-container">
    <h1 style="text-align:center; margin-bottom: 30px;">Órgãos Linfoides Parte 01</h1>
    <div class="card-bloco" id="quiz"></div>
    <button class="submit-btn" id="verifyAnswersBtn">Verificar Respostas</button>

    <button class="generate-questions-btn submit-btn" id="generateNewQuestionsBtn" style="display:none;">
      Gerar Novas Perguntas
    </button>

    <div class="results card-bloco" id="results"></div>
    <div id="statusMessage" style="text-align: center; margin-top: 10px; font-weight: bold; color: #007bff;"></div>

    <div class="error-diagnosis-section card-bloco" id="errorDiagnosis">
      <h2>Diagnóstico de Erros</h2>
      <p>Parece que você precisa revisar os seguintes assuntos:</p>
      <ul id="topicsToReview"></ul>
    </div>

    <div class="generated-questions-section card-bloco" id="generatedQuestionsSection" style="display:none;">
      <h2>Novas Perguntas Geradas</h2>
      <div id="newQuestionsContent"></div>
    </div>
  </div>
  
  <button class="error-nav-btn" id="errorNavBtn" style="display:none;">
    <span class="arrow-icon"></span>
    <span class="button-text"></span>
  </button>

  <script>
    const quizContainer = document.getElementById("quiz");
    const resultsContainer = document.getElementById("results");
    const errorNavBtn = document.getElementById("errorNavBtn");
    const arrowIcon = errorNavBtn.querySelector(".arrow-icon");
    const buttonText = errorNavBtn.querySelector(".button-text");
    const errorDiagnosisSection = document.getElementById("errorDiagnosis");
    const topicsToReviewList = document.getElementById("topicsToReview");
    const generateNewQuestionsBtn = document.getElementById("generateNewQuestionsBtn");
    const generatedQuestionsSection = document.getElementById("generatedQuestionsSection");
    const newQuestionsContent = document.getElementById("newQuestionsContent");
    const statusMessage = document.getElementById("statusMessage");

    let wrongQuestionIndices = [];
    let errorCountByTopic = {};
    let totalAnsweredQuestionsByTopic = {};
    let currentWrongQuestionIndex = -1;
    let hasErrors = false;
    let isShowingErrors = false;
    let isShowingDiagnosis = false;

    // Inicializa a visibilidade das seções no carregamento
    errorDiagnosisSection.style.display = 'none';
    topicsToReviewList.innerHTML = '';
    statusMessage.textContent = '';

    const questions = [       {         question: "1. Qual é a principal característica dos órgãos linfoides primários, conforme a classificação abordada na aula?",         options: [           "A) São locais de ativação do sistema imune em resposta a antígenos.",           "B) São os locais onde ocorre a produção e diferenciação das células sanguíneas e de defesa.",           "C) São as estruturas que incluem as tonsilas, por serem semi-encapsuladas.",           "D) São os órgãos responsáveis pela seleção e apoptose de linfócitos autorreativos.",         ],         correctAnswer: "B) São os locais onde ocorre a produção e diferenciação das células sanguíneas e de defesa.",         comment: "Os órgãos linfoides primários são definidos como os locais onde ocorre a produção e diferenciação das células sanguíneas e células de defesa, processo conhecido como hematopoiese.",         topic: "Órgãos Linfoides: Classificação e Função",       },       {         question: "2. A hematopoiese, que ocorre nos órgãos linfoides primários, é o processo de formação de quais tipos de células?",         options: [           "A) Apenas células da linhagem branca de defesa.",           "B) Exclusivamente os fragmentos celulares conhecidos como plaquetas.",           "C) Células sanguíneas, abrangendo as linhagens branca e vermelha, e megacariócitos.",           "D) Somente linfócitos, que são ativados no timo.",         ],         correctAnswer: "C) Células sanguíneas, abrangendo as linhagens branca e vermelha, e megacariócitos.",         comment: "O processo de hematopoiese abrange a formação de todas as células sanguíneas. Isso inclui a linhagem branca (defesa), a linhagem vermelha (hemácias ou eritrócitos) e os megacariócitos (que formam as plaquetas).",         topic: "Medula Óssea e Hematopoiese",       },       {         question: "3. Qual é a principal função atribuída aos órgãos linfoides secundários?",         options: [           "A) Produção de células-tronco hematopoéticas.",           "B) Seleção e maturação de linfócitos T.",           "C) Ativação do sistema imune, onde as células de defesa encontram antígenos.",           "D) Produção das plaquetas a partir dos megacariócitos.",         ],         correctAnswer: "C) Ativação do sistema imune, onde as células de defesa encontram antígenos.",         comment: "Os órgãos linfoides secundários são os locais onde as células de defesa já maduras encontram um agente etiológico (antígeno) e iniciam a ativação da resposta imunológica.",         topic: "Órgãos Linfoides Secundários: Função",       },       {         question: "4. As plaquetas, que participam do processo de coagulação, são classificadas estruturalmente como:",         options: [           "A) Células completas da linhagem vermelha.",           "B) Fragmentos celulares, provenientes dos megacariócitos.",           "C) Células-tronco hematopoéticas pluripotentes.",           "D) Granulócitos eosinofílicos.",         ],         correctAnswer: "B) Fragmentos celulares, provenientes dos megacariócitos.",         comment: "De acordo com a aula, as plaquetas não são consideradas células, mas sim fragmentos celulares que se originam da fragmentação de megacariócitos.",         topic: "Plaquetas e Megacariócitos",       },       {         question: "5. Qual dos seguintes órgãos é classificado como linfoide encapsulado?",         options: [           "A) GALT (tecido linfoide associado à mucosa).",           "B) Tonsilas (amígdalas).",           "C) Medula óssea.",           "D) Timo.",         ],         correctAnswer: "D) Timo.",         comment: "A classificação de órgãos linfoides encapsulados inclui o timo, o baço e os linfonodos.",         topic: "Órgãos Linfoides Encapsulados",       },       {         question: "6. As tonsilas (amígdalas) são um exemplo de órgão linfoide classificado como:",         options: [           "A) Encapsulado.",           "B) Semi-encapsulado.",           "C) Não encapsulado (difuso).",           "D) Primário e de localização central.",         ],         correctAnswer: "B) Semi-encapsulado.",         comment: "As tonsilas são citadas na aula como órgãos linfoides semi-encapsulados, com a ressalva de que sua retirada é desaconselhada na prática clínica atual.",         topic: "Órgãos Linfoides Semi-encapsulados",       },       {         question: "7. O que representa o GALT na classificação dos órgãos linfoides?",         options: [           "A) É um órgão encapsulado de defesa.",           "B) É um órgão linfoide primário de produção celular.",           "C) É um tecido linfoide associado à mucosa, classificado como não encapsulado (difuso).",           "D) É um órgão linfoide semi-encapsulado encontrado no mediastino.",         ],         correctAnswer: "C) É um tecido linfoide associado à mucosa, classificado como não encapsulado (difuso).",         comment: "O GALT (tecido linfoide associado à mucosa) é um exemplo de órgão linfoide não encapsulado (difuso), onde as células se encontram aglomeradas em um tecido conjuntivo.",         topic: "Órgãos Linfoides Não Encapsulados (Difusos)",       },       {         question: "8. Onde a medula óssea, o primeiro órgão linfoide primário detalhado na aula, está localizada?",         options: [           "A) Na região do mediastino superior.",           "B) No interior dos vasos linfáticos.",           "C) No interior dos ossos longos.",           "D) Na forma de corpúsculos de Hassall.",         ],         correctAnswer: "C) No interior dos ossos longos.",         comment: "A medula óssea é um tecido que fica no interior dos ossos longos, sendo um dos principais locais de hematopoiese.",         topic: "Localização da Medula Óssea",       },       {         question: "9. Qual é o nome do processo de formação de células sanguíneas que ocorre na medula óssea?",         options: [           "A) Apoptose.",           "B) Diapedese.",           "C) Hematoiese (ou Hematopoiese).",           "D) Diferenciação tímica.",         ],         correctAnswer: "C) Hematoiese (ou Hematopoiese).",         comment: "O processo de formação das células sanguíneas, que ocorre na medula óssea, é denominado hematopoiese.",         topic: "Definição de Hematopoiese",       },       {         question: "10. Qual é a principal característica da célula-tronco hematopoética pluripotente que dá origem a todas as linhagens sanguíneas?",         options: [           "A) Núcleo pequeno e citoplasma grande.",           "B) Capacidade de multiplicação infinita e ampla diferenciação.",           "C) Incapacidade de sofrer divisão mitótica.",           "D) É uma célula exclusivamente especializada na defesa.",         ],         correctAnswer: "B) Capacidade de multiplicação infinita e ampla diferenciação.",         comment: "A célula-tronco hematopoética é caracterizada pela capacidade de multiplicação infinita e ampla capacidade de diferenciação em várias linhagens celulares.",         topic: "Célula-Tronco Hematopoética",       },       {         question: "11. Qual é a condição da medula óssea que explica a maior propensão de idosos a terem anemia e serem imunossuprimidos?",         options: [           "A) Aumento da produção de megacariócitos.",           "B) Redução da celularidade do tecido hematopoético, com substituição por adipócitos.",           "C) Aumento da seleção tímica de linfócitos.",           "D) Alta concentração de células-tronco pluripotentes.",         ],         correctAnswer: "B) Redução da celularidade do tecido hematopoético, com substituição por adipócitos.",         comment: "O envelhecimento traz como consequência a redução progressiva do tecido hematopoético, que é substituído por adipócitos, o que leva a uma menor produção de células sanguíneas e de defesa.",         topic: "Medula Óssea: Envelhecimento e Adipócitos",       },       {         question: "12. Qual é a linhagem de leucócitos que inclui os linfócitos B, linfócitos T e células Natural Killer, caracterizada pela ausência de grânulos no citoplasma?",         options: [           "A) Linhagem Mieloide.",           "B) Linhagem Granulocítica.",           "C) Linhagem Linfóide (Agranulócitos).",           "D) Linhagem Eritroblástica.",         ],         correctAnswer: "C) Linhagem Linfóide (Agranulócitos).",         comment: "Os linfócitos B, T e células Natural Killer pertencem à linhagem linfoide, que é classificada como agranulócitos por não possuírem grânulos em seu citoplasma.",         topic: "Linhagem Linfóide: Agranulócitos",       },       {         question: "13. A linhagem mieloide é responsável pela formação de quais tipos de leucócitos?",         options: [           "A) Apenas linfócitos T e B.",           "B) Monócitos e Granulócitos (Neutrófilos, Eosinófilos e Basófilos).",           "C) Megacariócitos e plaquetas.",           "D) Células epiteliais e macrófagos.",         ],         correctAnswer: "B) Monócitos e Granulócitos (Neutrófilos, Eosinófilos e Basófilos).",         comment: "A linhagem mieloide dá origem ao mieloblasto, que se diferencia em monócitos (precursores de macrófagos e células dendríticas) e granulócitos (neutrófilos, eosinófilos e basófilos).",         topic: "Linhagem Mieloide: Granulócitos e Monócitos",       },       {         question: "14. A presença de um número aumentado de Eosinófilos no hemograma está tipicamente associada a qual tipo de condição de saúde?",         options: [           "A) Infecções virais.",           "B) Infecções bacterianas.",           "C) Infecções parasitárias ou alergias.",           "D) Doenças autoimunes crônicas.",         ],         correctAnswer: "C) Infecções parasitárias ou alergias.",         comment: "Os eosinófilos aumentam em resposta a infecções parasitárias e reações alérgicas, devido à liberação de sinalização celular que promove sua diferenciação e atuação.",         topic: "Eosinófilos e Condições Associadas",       },       {         question: "15. Qual tipo de leucócito tende a estar aumentado em casos de infecções bacterianas?",         options: [           "A) Linfócitos.",           "B) Monócitos.",           "C) Neutrófilos.",           "D) Basófilos.",         ],         correctAnswer: "C) Neutrófilos.",         comment: "Os neutrófilos são os granulócitos cuja contagem tende a aumentar em resposta a infecções bacterianas.",         topic: "Neutrófilos e Infecções Bacterianas",       },       {         question: "16. O segundo órgão linfoide primário abordado na aula, que não produz células, mas é local de diferenciação e maturação dos linfócitos T, é o(a):",         options: [           "A) Baço.",           "B) Tonsilas.",           "C) Medula óssea.",           "D) Timo.",         ],         correctAnswer: "D) Timo.",         comment: "O timo é o segundo órgão linfoide primário no adulto. Ele não produz as células, mas é responsável pela diferenciação e maturação dos linfócitos T (timócitos).",         topic: "Timo: Estrutura e Função Principal",       },       {         question: "17. O que representa a Seleção Tímica no contexto do timo?",         options: [           "A) O processo de produção de linfoblastos.",           "B) A diferenciação dos monócitos em macrófagos.",           "C) A garantia de que apenas linfócitos T funcionais e não autorreativos sejam liberados para a circulação.",           "D) A regulação da produção de hemácias.",         ],         correctAnswer: "C) A garantia de que apenas linfócitos T funcionais e não autorreativos sejam liberados para a circulação.",         comment: "A seleção tímica é a função essencial do timo, garantindo que os linfócitos T maduros e liberados para a circulação sejam funcionais e não ataquem estruturas do próprio organismo (linfócitos T autorreativos).",         topic: "Função do Timo: Seleção Tímica",       },       {         question: "18. Qual é a região do lóbulo tímico que possui maior densidade de células (linfócitos imaturos e macrófagos) e recebe as arteríolas com os linfócitos?",         options: [           "A) Região Medular.",           "B) Cápsula de tecido conjuntivo.",           "C) Região Cortical (Córtex).",           "D) Corpúsculo de Hassall.",         ],         correctAnswer: "C) Região Cortical (Córtex).",         comment: "A região cortical (córtex) é a porção mais externa do lóbulo, caracterizada pela maior densidade de células, onde os linfócitos imaturos chegam ao timo.",         topic: "Timo: Região Cortical (Córtex)",       },       {         question: "19. Onde se localiza o corpúsculo de Hassall, uma estrutura que participa da seleção tímica?",         options: [           "A) Na medula da medula óssea.",           "B) Exclusivamente na região cortical do timo.",           "C) Exclusivamente na região medular do timo.",           "D) Nas tonsilas, por serem órgãos semi-encapsulados.",         ],         correctAnswer: "C) Exclusivamente na região medular do timo.",         comment: "O corpúsculo de Hassall, estrutura eosinofílica formada por células epiteliais organizadas em camadas concêntricas, é encontrado exclusivamente na região medular do timo.",         topic: "Timo: Corpúsculo de Hassall",       },       {         question: "20. O que acontece com os linfócitos T que não são aprovados durante a seleção tímica (linfócitos autorreativos)?",         options: [           "A) São armazenados na medula óssea para futuras tentativas de maturação.",           "B) São induzidos à apoptose (morte celular programada) e removidos.",           "C) São liberados para circulação para serem ativados nos órgãos secundários.",           "D) São diferenciados em linfócitos B para compensar.",         ],         correctAnswer: "B) São induzidos à apoptose (morte celular programada) e removidos.",         comment: "Os linfócitos T autorreativos, que atacariam o próprio organismo, não conseguem migrar para a medula, sendo induzidos à apoptose (morte celular programada) e removidos.",         topic: "Seleção Tímica e Linfócitos Autorreativos",       },       {         question: "21. Qual é o nome do processo pelo qual as células de defesa, como neutrófilos, saem do vaso sanguíneo para o tecido inflamado?",         options: [           "A) Hematoiese.",           "B) Apoptose.",           "C) Diapedese.",           "D) Seleção tímica.",         ],         correctAnswer: "C) Diapedese.",         comment: "O processo de saída de células de defesa do vaso sanguíneo para o tecido lesionado/inflamado é chamado diapedese.",         topic: "Diapedese e Resposta Inflamatória",       },       {         question: "22. A diapedese é um processo regulado por quais tipos de moléculas, citadas na aula, que selecionam a célula de defesa a ser enviada ao local da lesão?",         options: [           "A) Megacariócitos.",           "B) Citocinas.",           "C) Moléculas sinalizadoras, como seletinas e integrinas.",           "D) Corpúsculos de Hassall.",         ],         correctAnswer: "C) Moléculas sinalizadoras, como seletinas e integrinas.",         comment: "A diapedese é um processo complexo, regulado pela expressão de moléculas sinalizadoras, como seletinas e integrinas, na parede dos vasos, que selecionam a célula de defesa apropriada.",         topic: "Regulação da Diapedese",       },       {         question: "23. Qual é o termo utilizado para os linfócitos que, em casos de falha da seleção tímica, atacam o próprio organismo?",         options: [           "A) Linfócitos-B.",           "B) Linfoblastos.",           "C) Linfócitos autorreativos.",           "D) Linfócitos eferentes.",         ],         correctAnswer: "C) Linfócitos autorreativos.",         comment: "Os linfócitos que, em decorrência de uma falha de seleção, atacam o próprio organismo (causando doenças autoimunes) são chamados de linfócitos autorreativos.",         topic: "Linfócitos Autorreativos",       },       {         question: "24. Qual é o nome da estrutura, encontrada na região medular do timo, que é formada por células epiteliais organizadas em camadas concêntricas?",         options: [           "A) Região cortical.",           "B) Corpúsculo de Hassall.",           "C) Barreira hematoencefálica.",           "D) Tecido conjuntivo denso.",         ],         correctAnswer: "B) Corpúsculo de Hassall.",         comment: "O corpúsculo de Hassall é a estrutura eosinofílica, semelhante a uma cebola em camadas concêntricas, encontrada na região medular do timo. Ele participa da seleção tímica.",         topic: "Corpúsculo de Hassall: Estrutura",       },       {         question: "25. Qual é o papel principal do timo após o processo de maturação dos linfócitos T?",         options: [           "A) Produzir novas células-tronco.",           "B) Ser o local de ativação da resposta imune a antígenos.",           "C) Distribuir os linfócitos T maduros para os órgãos linfoides secundários.",           "D) Iniciar o processo de diapedese para os tecidos.",         ],         correctAnswer: "C) Distribuir os linfócitos T maduros para os órgãos linfoides secundários.",         comment: "Depois que os linfócitos T passam pela seleção e maturação no timo, eles são distribuídos para os órgãos linfoides secundários para estarem prontos para a ativação da resposta imune.",         topic: "Função Pós-maturação do Timo",       },       {         question: "26. Qual é a classificação dos leucócitos (glóbulos brancos) que possuem grânulos em seu citoplasma?",         options: [           "A) Agranulócitos.",           "B) Granulócitos.",           "C) Eritrócitos.",           "D) Megacariócitos.",         ],         correctAnswer: "B) Granulócitos.",         comment: "Os leucócitos com grânulos no citoplasma são classificados como granulócitos e incluem neutrófilos, eosinófilos e basófilos.",         topic: "Classificação dos Leucócitos (Granulócitos)",       },       {         question: "27. Qual é a cor dos grânulos dos Basófilos, que os distingue de outros granulócitos, quando corados em histologia?",         options: [           "A) Rosa (eosinofílicos).",           "B) Azul-claro (neutros).",           "C) Roxo (basofílicos).",           "D) Vermelho (associado à hemoglobina).",         ],         correctAnswer: "C) Roxo (basofílicos).",         comment: "Os basófilos são caracterizados por possuírem grânulos com forte coloração roxa, o que indica basofilia, ou seja, afinidade por corantes básicos como a hematoxilina.",         topic: "Basófilos: Coloração dos Grânulos",       },       {         question: "28. Qual granulócito é tipicamente caracterizado por grânulos rosa (eosinofílicos) e um núcleo multilobulado?",         options: [           "A) Neutrófilo.",           "B) Linfócito.",           "C) Monócito.",           "D) Eosinófilo.",         ],         correctAnswer: "D) Eosinófilo.",         comment: "Os eosinófilos (ou eusófilos) são reconhecidos pela cor rosa (eosinofílica) dos seus grânulos e núcleo tipicamente multilobulado.",         topic: "Eosinófilos: Características Morfológicas",       },       {         question: "29. O núcleo do linfócito, observado em esfregaço sanguíneo, é tipicamente descrito como:",         options: [           "A) Forma de 'C' (riniforme).",           "B) Multilobulado, com 3 ou mais lóbulos.",           "C) Grande e redondo, ocupando a maior parte da célula.",           "D) Fragmentado e disperso no citoplasma.",         ],         correctAnswer: "C) Grande e redondo, ocupando a maior parte da célula.",         comment: "Os linfócitos são caracterizados por terem um núcleo grande e redondo, que ocupa grande parte do volume celular.",         topic: "Linfócitos: Morfologia Nuclear",       },       {         question: "30. Qual estrutura o monócito apresenta em seu núcleo, que é tipicamente diferente dos linfócitos?",         options: [           "A) Um núcleo multilobulado com mais de três porções.",           "B) Um núcleo com formato de 'C' ou riniforme.",           "C) Um núcleo fragmentado em pequenos pontos roxos.",           "D) Um núcleo muito pequeno em relação ao citoplasma.",         ],         correctAnswer: "B) Um núcleo com formato de 'C' ou riniforme.",         comment: "O monócito, precursor do macrófago, é caracterizado por um núcleo grande que geralmente assume o formato de 'C' ou de rim (riniforme).",         topic: "Monócitos: Morfologia Nuclear",       },       {         question: "31. O que são os vasos aferentes, no contexto da vascularização dos órgãos linfoides?",         options: [           "A) Vasos por onde o sangue (ou linfa) sai de um órgão ou tecido.",           "B) Vasos por onde o sangue (ou linfa) chega a um órgão ou tecido.",           "C) Vasos que conectam diretamente a medula óssea ao timo.",           "D) Vasos que formam a barreira hemato-tímica.",         ],         correctAnswer: "B) Vasos por onde o sangue (ou linfa) chega a um órgão ou tecido.",         comment: "Vasos aferentes são definidos como aqueles por onde o sangue (ou linfa) chega ao tecido ou órgão, enquanto os eferentes são os vasos de saída.",         topic: "Vasos Aferentes e Eferentes",       },       {         question: "32. Qual a principal diferença na função do timo em relação à medula óssea, ambos classificados como órgãos linfoides primários?",         options: [           "A) A medula óssea faz a maturação, e o timo faz a ativação.",           "B) A medula óssea só produz células de defesa, enquanto o timo produz todas as células sanguíneas.",           "C) A medula óssea produz as células, e o timo as amadurece e seleciona.",           "D) Ambos realizam a hematopoiese, mas apenas a medula óssea envelhece.",         ],         correctAnswer: "C) A medula óssea produz as células, e o timo as amadurece e seleciona.",         comment: "A medula óssea é o local de produção de todas as células sanguíneas. Já o timo, não produz as células, mas é o local de maturação e seleção dos linfócitos T.",         topic: "Diferença Funcional entre Timo e Medula Óssea",       },       {         question: "33. As células epiteliais do timo que se modificam e fazem parte do parênquima são classificadas, quando estão no córtex, como:",         options: [           "A) Células epiteliais medulares.",           "B) Corpúsculo de Hassall.",           "C) Células epiteliais corticais.",           "D) Adipócitos.",         ],         correctAnswer: "C) Células epiteliais corticais.",         comment: "As células epiteliais do parênquima do timo são chamadas de células epiteliais corticais quando estão no córtex.",         topic: "Células Epiteliais Corticais",       },       {         question: "34. Em qual fase da vida o fígado é considerado um órgão linfoide primário?",         options: [           "A) Apenas na velhice.",           "B) Na vida adulta.",           "C) Na condição fetal.",           "D) Após a seleção tímica.",         ],         correctAnswer: "C) Na condição fetal.",         comment: "O fígado é considerado um órgão linfoide primário durante a condição fetal, até que a medula óssea esteja madura para assumir a função.",         topic: "Fígado como Órgão Linfoide Primário",       },       {         question: "35. A região medular (centro) do timo é visualizada microscopicamente como mais clara em comparação com o córtex por quê?",         options: [           "A) É onde ocorre a apoptose dos linfócitos.",           "B) Possui maior concentração de adipócitos.",           "C) Possui menor quantidade de células, pois os linfócitos prontos migram para fora.",           "D) Possui apenas macrófagos, que não coram com Hematoxilina e Eosina (H&E).",         ],         correctAnswer: "C) Possui menor quantidade de células, pois os linfócitos prontos migram para fora.",         comment: "A região medular é mais clara porque, após a seleção, os linfócitos T maduros saem do timo, resultando em uma menor densidade celular comparada ao córtex.",         topic: "Timo: Região Medular (Medula)",       },       {         question: "36. A alta produção de células-tronco hematopoéticas na medula óssea é estimulada principalmente por:",         options: [           "A) Integrinas.",           "B) Proteínas sinalizadoras e citocinas.",           "C) Células epiteliais subcapsulares.",           "D) Corpúsculos de Hassall.",         ],         correctAnswer: "B) Proteínas sinalizadoras e citocinas.",         comment: "A diferenciação da célula-tronco hematopoética é regulada pela expressão de proteínas e moléculas sinalizadoras, como as citocinas.",         topic: "Regulação da Hematopoiese",       },       {         question: "37. Os linfócitos que conseguem passar pela barreira de células epiteliais corticais no timo chegam a qual região?",         options: [           "A) Cápsula de tecido conjuntivo.",           "B) Região medular.",           "C) Vasos eferentes.",           "D) Periferia do órgão.",         ],         correctAnswer: "B) Região medular.",         comment: "Os linfócitos T que conseguem passar a barreira de seleção imposta pelas células epiteliais corticais migram para a região medular.",         topic: "Seleção Tímica: Migração de Linfócitos",       },       {         question: "38. O que é o plasma sanguíneo, a porção líquida do sangue?",         options: [           "A) A porção sólida do sangue, rica em células de defesa.",           "B) O componente extracelular líquido e rico em proteínas.",           "C) A matriz extracelular do tecido adiposo.",           "D) A porção do sangue que contém apenas as plaquetas.",         ],         correctAnswer: "B) O componente extracelular líquido e rico em proteínas.",         comment: "O sangue é um tecido conjuntivo líquido, cuja matriz extracelular (parte líquida) é o plasma sanguíneo, que é rico em proteínas.",         topic: "Composição do Sangue (Plasma)",       },       {         question: "39. Qual é a principal característica da célula do neutrófilo, que o distingue de outros granulócitos?",         options: [           "A) Núcleo grande e redondo, sem citoplasma.",           "B) Grânulos basofílicos que condensam o núcleo.",           "C) Núcleo multilobulado (3 ou mais lóbulos) e grânulos de coloração neutra (rosa-pálido/branco).",           "D) Núcleo riniforme e citoplasma com grânulos eosinofílicos.",         ],         correctAnswer: "C) Núcleo multilobulado (3 ou mais lóbulos) e grânulos de coloração neutra (rosa-pálido/branco).",         comment: "Os neutrófilos, o granulócito mais comum, são caracterizados por um núcleo multilobulado (tipicamente com 3 ou mais lóbulos conectados) e grânulos de coloração neutra, corando-se de forma mais discreta (rosa-pálido a branco).",         topic: "Neutrófilos: Morfologia",       },       {         question: "40. A redução da quantidade de tecido hematopoético, observada no gráfico de celularidade da medula óssea em função da idade, é um processo denominado:",         options: [           "A) Infiltração linfoide.",           "B) Degeneração tímica.",           "C) Substituição adiposa.",           "D) Leucemia.",         ],         correctAnswer: "C) Substituição adiposa.",         comment: "A redução da celularidade do tecido hematopoético na medula óssea é um processo progressivo com o envelhecimento, onde as células são substituídas por adipócitos, processo conhecido como substituição adiposa.",         topic: "Envelhecimento da Medula Óssea",       },     ];

    function buildQuiz() {
      const output = [];

      questions.forEach((currentQuestion, questionNumber) => {
        const options = [];
        for (let i = 0; i < currentQuestion.options.length; i++) {
          options.push(
            `<label class="option" data-question="${questionNumber}" data-value="${currentQuestion.options[i]}">
              <img src="tesouras.png" class="scissor-icon" onclick="event.stopPropagation(); this.parentNode.classList.toggle('struck-through');">
              ${currentQuestion.options[i]}
            </label>`
          );
        }

        output.push(
          `<div class="card" id="question-${questionNumber}" data-topic="${currentQuestion.topic}">
            <div class="question">${currentQuestion.question}</div>
            <div class="options">${options.join("")}</div>
            <div class="comment" id="comment-${questionNumber}"></div>
          </div>`
        );
      });

      quizContainer.innerHTML = output.join("");
    }

    function showResults() {
      wrongQuestionIndices = [];
      errorCountByTopic = {};
      totalAnsweredQuestionsByTopic = {};
      currentWrongQuestionIndex = -1;
      hasErrors = false;
      isShowingErrors = false;
      isShowingDiagnosis = false;

      errorDiagnosisSection.style.display = 'none';
      topicsToReviewList.innerHTML = '';
      statusMessage.textContent = '';

      // Busca por todas as perguntas: estáticas e dinâmicas
      const allQuestionCards = document.querySelectorAll('.quiz-container .card, #newQuestionsContent .card');
      let correctAnswersCount = 0;
      let totalQuestionsAnswered = 0;

      console.log('🔍 Verificando', allQuestionCards.length, 'perguntas...');

      allQuestionCards.forEach((card, index) => {
        const questionEl = card.querySelector('.question') || card.querySelector('p');
        if (!questionEl) return;

        const questionText = questionEl.textContent.trim();
        const optionsContainer = card.querySelector('.options') || card;
        const allOptions = optionsContainer.querySelectorAll('.option, label.option, label');
        const userAnswerElement = optionsContainer.querySelector('.option.selected, label.selected');
        const commentDiv = card.querySelector('.comment');

        const questionTopic = card.dataset.topic || "Tópico não informado";
        
        console.log(`📝 Pergunta ${index + 1}: Tópico = "${questionTopic}"`);
        console.log(`🔍 Encontradas ${allOptions.length} alternativas`);
        
        // Remove classes anteriores
        allOptions.forEach(option => {
          option.classList.remove('correct', 'incorrect', 'selected');
        });
        if (commentDiv) commentDiv.classList.remove('show');

        let correctAnswerValue = null;
        let questionComment = null;

        // Verifica se é pergunta estática ou dinâmica
        const isStatic = card.id && card.id.startsWith('question-');
        if (isStatic) {
          // Pergunta estática - busca nos dados originais
          const questionData = questions.find(q => q.question.trim() === questionText);
          if (questionData) {
            correctAnswerValue = questionData.correctAnswer.trim();
            questionComment = questionData.comment;
          }
        } else {
          // Pergunta dinâmica - busca pela opção marcada como correta
          const correctOpt = optionsContainer.querySelector('.option[data-answer="true"], label[data-answer="true"]');
          if (correctOpt) {
            correctAnswerValue = correctOpt.dataset.value?.trim() || correctOpt.textContent.trim();
            console.log(`✅ Resposta correta encontrada: "${correctAnswerValue}"`);
          } else {
            console.log('❌ Nenhuma resposta correta encontrada para pergunta dinâmica');
          }
          
          // Busca comentário no próprio card ou no div comment
          const commentElement = card.querySelector('.comment');
          if (commentElement && commentElement.textContent.trim()) {
            questionComment = commentElement.textContent.trim();
          }
        }

        // Processa resposta do usuário e aplica coloração
        let userAnswer = null;
        if (userAnswerElement) {
          userAnswerElement.classList.add('selected');
          userAnswer = userAnswerElement.dataset.value?.trim() || userAnswerElement.textContent.trim();
          totalQuestionsAnswered++;
          totalAnsweredQuestionsByTopic[questionTopic] = (totalAnsweredQuestionsByTopic[questionTopic] || 0) + 1;

          console.log(`👤 Resposta do usuário: "${userAnswer}"`);
          console.log(`🎯 Resposta correta: "${correctAnswerValue}"`);

          // Verifica se a resposta está correta
          if (userAnswer === correctAnswerValue) {
            correctAnswersCount++;
            console.log(`✅ Resposta correta!`);
          } else {
            hasErrors = true;
            errorCountByTopic[questionTopic] = (errorCountByTopic[questionTopic] || 0) + 1;
            console.log(`❌ Resposta incorreta para tópico: ${questionTopic}`);
          }
        }

        // Aplica coloração: SEMPRE marca a correta de verde, e a errada de vermelho se foi marcada
        allOptions.forEach(option => {
          const optionValue = option.dataset.value?.trim() || option.textContent.trim();
          
          // Marca a resposta correta de verde SEMPRE
          if (optionValue === correctAnswerValue) {
            option.classList.add('correct');
            console.log(`🟢 Marcando como correta: "${optionValue}"`);
          }
          
          // Se o usuário marcou uma resposta E ela está errada, marca de vermelho
          if (userAnswer && optionValue === userAnswer && userAnswer !== correctAnswerValue) {
            option.classList.add('incorrect');
            console.log(`🔴 Marcando como incorreta: "${optionValue}"`);
          }
        });

        // Mostra comentário se disponível
        if (commentDiv && questionComment) {
          commentDiv.textContent = questionComment;
          commentDiv.classList.add('show');
        }
      });

      // Exibe resultados
      resultsContainer.textContent = `Você acertou ${correctAnswersCount} de ${totalQuestionsAnswered} questões respondidas.`;

      console.log('📊 Erros por tópico:', errorCountByTopic);
      console.log('📊 Total por tópico:', totalAnsweredQuestionsByTopic);

      // Gera diagnóstico de erros
      if (hasErrors) {
        for (const topic in errorCountByTopic) {
          const errors = errorCountByTopic[topic];
          const total = totalAnsweredQuestionsByTopic[topic] || 0;
          if (total > 0) {
            const percent = ((errors / total) * 100).toFixed(1);
            const li = document.createElement('li');
            li.textContent = `${topic}: ${percent}% de erros (${errors} de ${total} questões respondidas)`;
            topicsToReviewList.appendChild(li);
          }
        }
      } else {
        const li = document.createElement('li');
        li.textContent = "🥳 Parabéns! Você não teve erros nas questões respondidas.";
        topicsToReviewList.appendChild(li);
      }

      errorDiagnosisSection.style.display = 'block';
      generatedQuestionsSection.style.display = 'block';
      generateNewQuestionsBtn.style.display = 'block';
      scrollToDiagnosis();
    }

    function scrollToQuestion(index) {
      const questionCard = document.getElementById(`question-${index}`);
      if (questionCard) {
        questionCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }
    }

    function scrollToDiagnosis() {
        errorDiagnosisSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    function scrollToGeneratedQuestions() {
        generatedQuestionsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    // Event listener para seleção de opções (funciona para estáticas e dinâmicas)
    document.addEventListener("click", function (event) {
      const clickedElement = event.target;
      const optionElement = clickedElement.closest('.option');

      if (optionElement) {
          if (clickedElement.classList.contains("scissor-icon")) {
              event.stopPropagation();
              optionElement.classList.toggle("struck-through");
          }
          else {
              const parentCard = optionElement.closest('.card');
              const currentQuestionOptions = parentCard.querySelectorAll('.option');

              currentQuestionOptions.forEach(opt => opt.classList.remove("selected"));
              optionElement.classList.add("selected");
          }
      }
    });

    generateNewQuestionsBtn.addEventListener("click", async function() {
        statusMessage.textContent = '⏳ Gerando novas perguntas...';
        generateNewQuestionsBtn.disabled = true;

        const topics = Object.keys(errorCountByTopic).filter(topic => {
            const errorsInTopic = errorCountByTopic[topic] || 0;
            const totalAnsweredInTopic = totalAnsweredQuestionsByTopic[topic] || 0;
            return errorsInTopic > 0 && totalAnsweredInTopic > 0;
        });

        const topicsToSend = topics.length > 0 ? topics : ["fisiologia celular", "biologia"];

        try {
            const response = await fetch('https://www.quizia.xyz/quiz', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ topicos: topicsToSend }),
            });

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const data = await response.json();

            newQuestionsContent.innerHTML = '';
            if (data && data.html) {
                console.log('📥 HTML recebido do Flask:', data.html);
                
                // Insere o HTML diretamente sem reconstrução complexa
                newQuestionsContent.innerHTML = data.html.replace(/```html|```/g, '');
                
                // Adiciona tesouras e ajusta formatação apenas se necessário
                newQuestionsContent.querySelectorAll('.card').forEach((card, cardIndex) => {
                    // Garante que o elemento de pergunta tenha a classe correta
                    const questionElement = card.querySelector('p');
                    if (questionElement && !questionElement.classList.contains('question')) {
                       questionElement.classList.add('question');
                    }

                    // Remove qualquer input de radio que possa existir e adiciona tesouras
                    card.querySelectorAll('label').forEach((label) => {
                        // Remove inputs de radio MAS preserva o atributo data-answer
                        const radioInput = label.querySelector('input[type="radio"]');
                        if (radioInput) {
                            // PRESERVA o atributo data-answer do input no label
                            if (radioInput.hasAttribute('data-answer')) {
                                label.setAttribute('data-answer', radioInput.getAttribute('data-answer'));
                            }
                            radioInput.remove();
                        }
                        
                        // Garante que tenha a classe option
                        if (!label.classList.contains('option')) {
                            label.classList.add('option');
                        }

                        // Garante que tenha data-value
                        if (!label.dataset.value) {
                            label.dataset.value = label.textContent.trim();
                        }

                        // Adiciona tesoura se não existir
                        if (!label.querySelector('.scissor-icon')) {
                            const scissorIcon = document.createElement('img');
                            scissorIcon.src = 'tesouras.png';
                            scissorIcon.className = 'scissor-icon';
                            scissorIcon.onclick = function(e) {
                                e.stopPropagation();
                                label.classList.toggle('struck-through');
                            };
                            label.insertBefore(scissorIcon, label.firstChild);
                        }
                    });

                    console.log(`🏷️ Card ${cardIndex}: data-topic = "${card.dataset.topic}"`);
                    
                    // Verifica se há opção correta marcada
                    const correctOption = card.querySelector('label[data-answer="true"]');
                    if (correctOption) {
                        console.log(`✅ Opção correta encontrada: "${correctOption.dataset.value}"`);
                    } else {
                        console.log('❌ Nenhuma opção correta encontrada');
                    }
                });
            } else {
                newQuestionsContent.innerHTML = "<p>Não foi possível gerar novas perguntas para os tópicos selecionados.</p>";
            }
            
            generatedQuestionsSection.style.display = 'block';
            scrollToGeneratedQuestions();
            statusMessage.textContent = '✅ Perguntas geradas com sucesso!';
            setTimeout(() => { statusMessage.textContent = '' }, 3000);

        } catch (error) {
            console.error('Erro ao gerar novas perguntas:', error);
            newQuestionsContent.innerHTML = `<p>Erro ao carregar novas perguntas: ${error.message}. Por favor, tente novamente.</p>`;
            generatedQuestionsSection.style.display = 'block';
            scrollToGeneratedQuestions();
            statusMessage.textContent = '❌ Erro na requisição: ' + error.message;
            setTimeout(() => { statusMessage.textContent = '' }, 5000);
        } finally {
            generateNewQuestionsBtn.disabled = false;
        }
    });

    // Inicialização
    buildQuiz();
    errorDiagnosisSection.style.display = 'none';
    generatedQuestionsSection.style.display = 'none';
    generateNewQuestionsBtn.style.display = 'none';

    // Event listener para o botão de verificar respostas
    document.getElementById("verifyAnswersBtn").addEventListener("click", showResults);
  </script>
</body>
</html>
