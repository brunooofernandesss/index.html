<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>Simulado de Metabolismo 02</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      background-color: #f4f4f4;
    }

    .quiz-container {
      max-width: 800px;
      width: 100%;
    }

    h1 {
      color: #333;
      text-align: center;
      margin-bottom: 30px;
    }

    .card {
      background-color: white;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .question {
      font-weight: bold;
      margin-bottom: 10px;
      color: #333;
    }

    .options {
      margin-top: 15px;
    }

    /* Estilos unificados para todas as opções (estáticas e dinâmicas) */
    .option, label.option, label, #newQuestionsContent label {
      display: flex; /* Para alinhar imagem e texto */
      align-items: center;
      margin-bottom: 10px;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.2s ease;
      position: relative; /* Para posicionar a tesoura */
    }

    /* FORÇA a remoção de inputs de radio em QUALQUER lugar */
    .option input[type="radio"], 
    label input[type="radio"],
    #newQuestionsContent input[type="radio"],
    #newQuestionsContent label input[type="radio"] {
        display: none !important;
        visibility: hidden !important;
        opacity: 0 !important;
        position: absolute !important;
        left: -9999px !important;
    }

    .option:hover, 
    label.option:hover, 
    label:hover,
    #newQuestionsContent label:hover {
      background-color: #e9e9e9;
    }

    .option.selected, 
    label.option.selected, 
    label.selected,
    #newQuestionsContent label.selected {
      background-color: #d1e7dd;
      border-color: #28a745;
    }

    .option.correct, 
    label.option.correct, 
    label.correct,
    #newQuestionsContent label.correct {
      background-color: #d4edda;
      border-color: #28a745;
    }

    .option.incorrect, 
    label.option.incorrect, 
    label.incorrect,
    #newQuestionsContent label.incorrect {
      background-color: #f8d7da;
      border-color: #dc3545;
    }

    .submit-btn {
      display: block;
      width: 100%;
      padding: 15px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 18px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      margin-top: 30px;
    }

    .submit-btn:hover {
      background-color: #0056b3;
    }

    .results {
      text-align: center;
      margin-top: 30px;
      font-size: 20px;
      font-weight: bold;
      color: #333;
    }

    .scissor-icon {
      margin-right: 10px; /* Espaço entre a tesoura e o texto da opção */
      width: 20px; /* Ajuste conforme o tamanho da sua imagem */
      height: 20px; /* Ajuste conforme o tamanho da sua imagem */
      opacity: 0.5; /* Transparência como no original */
      cursor: pointer;
    }

    .scissor-icon.hidden {
      display: none;
    }

    .struck-through {
      text-decoration: line-through;
      color: #888;
    }

    .comment {
      margin-top: 10px;
      padding: 10px;
      background-color: #f0f0f0;
      border-left: 4px solid #007bff;
      font-style: italic;
      color: #555;
      display: none; /* Escondido por padrão */
    }
    .comment.show {
      display: block; /* Mostrado quando ativado */
    }

    /* Estilos para o botão de navegação de erro / diagnóstico */
    .error-nav-btn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: #dc3545; /* Vermelho para erro */
      color: white;
      border: none;
      border-radius: 50%; /* Torna o botão redondo */
      width: 60px;
      height: 60px;
      font-size: 24px;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      z-index: 1000;
      display: none; /* Escondido por padrão */
      flex-direction: column; /* Para empilhar o ícone e o contador */
      padding: 5px; /* Ajuste o padding para acomodar texto maior */
      box-sizing: border-box; /* Garante que padding não aumente o tamanho total */
      text-align: center;
    }

    .error-nav-btn:hover {
      background-color: #c82333;
    }

    .error-nav-btn .arrow-icon {
      font-size: 30px; /* Tamanho da seta */
      line-height: 1; /* Ajuste para centralizar */
    }

    .error-nav-btn .button-text {
      font-size: 12px; /* Tamanho do texto abaixo da seta */
      line-height: 1;
      margin-top: 2px; /* Espaço entre a seta e o texto */
    }

    /* Estilos para a seção de diagnóstico de erros */
    .error-diagnosis-section {
        margin-top: 50px;
        padding: 30px;
        background-color: #ffe0b2; /* Um laranja claro ou similar */
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.15);
        display: none; /* Escondido por padrão */
        text-align: center;
        font-size: 1.1em;
        color: #333;
    }

    .error-diagnosis-section h2 {
        color: #e65100; /* Laranja mais escuro */
        margin-bottom: 20px;
        font-size: 1.8em;
    }

    .error-diagnosis-section ul {
        list-style: none; /* Remove marcadores de lista */
        padding: 0;
        margin: 0;
    }

    .error-diagnosis-section li {
        background-color: #ff9800; /* Laranja */
        color: white;
        padding: 8px 15px;
        margin: 8px 0;
        border-radius: 5px;
        display: inline-block; /* Para que os itens fiquem lado a lado */
        margin-right: 10px;
        font-weight: bold;
    }
    .error-diagnosis-section li:last-child {
        margin-right: 0;
    }
 .card-bloco {
      border: 1px solid #ddd;
      border-radius: 6px;
      padding: 10px;
      background: #fff;
      margin-bottom: 20px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    }
  </style>
</head>
<body>
  <div class="quiz-container">
    <h1 style="text-align:center; margin-bottom: 30px;">Simulado de Metabolismo 02</h1>
    <div class="card-bloco" id="quiz"></div>
    <button class="submit-btn" id="verifyAnswersBtn">Verificar Respostas</button>

    <button class="generate-questions-btn submit-btn" id="generateNewQuestionsBtn" style="display:none;">
      Gerar Novas Perguntas
    </button>

    <div class="results card-bloco" id="results"></div>
    <div id="statusMessage" style="text-align: center; margin-top: 10px; font-weight: bold; color: #007bff;"></div>

    <div class="error-diagnosis-section card-bloco" id="errorDiagnosis">
      <h2>Diagnóstico de Erros</h2>
      <p>Parece que você precisa revisar os seguintes assuntos:</p>
      <ul id="topicsToReview"></ul>
    </div>

    <div class="generated-questions-section card-bloco" id="generatedQuestionsSection" style="display:none;">
      <h2>Novas Perguntas Geradas</h2>
      <div id="newQuestionsContent"></div>
    </div>
  </div>
  
  <button class="error-nav-btn" id="errorNavBtn" style="display:none;">
    <span class="arrow-icon"></span>
    <span class="button-text"></span>
  </button>

  <script>
    const quizContainer = document.getElementById("quiz");
    const resultsContainer = document.getElementById("results");
    const errorNavBtn = document.getElementById("errorNavBtn");
    const arrowIcon = errorNavBtn.querySelector(".arrow-icon");
    const buttonText = errorNavBtn.querySelector(".button-text");
    const errorDiagnosisSection = document.getElementById("errorDiagnosis");
    const topicsToReviewList = document.getElementById("topicsToReview");
    const generateNewQuestionsBtn = document.getElementById("generateNewQuestionsBtn");
    const generatedQuestionsSection = document.getElementById("generatedQuestionsSection");
    const newQuestionsContent = document.getElementById("newQuestionsContent");
    const statusMessage = document.getElementById("statusMessage");

    let wrongQuestionIndices = [];
    let errorCountByTopic = {};
    let totalAnsweredQuestionsByTopic = {};
    let currentWrongQuestionIndex = -1;
    let hasErrors = false;
    let isShowingErrors = false;
    let isShowingDiagnosis = false;

    // Inicializa a visibilidade das seções no carregamento
    errorDiagnosisSection.style.display = 'none';
    topicsToReviewList.innerHTML = '';
    statusMessage.textContent = '';

    const questions = [       {         question: "1. A desnaturação de uma proteína é um processo que altera sua estrutura, mas mantém intacta a sua sequência de aminoácidos. Qual dos seguintes fatores é mencionado como causa da desnaturação?",         options: [           "a) Calor e quebra de ligações peptídicas.",           "b) Mudança brusca de pH e aumento da agitação molecular.",           "c) Hidrólise e ligações covalentes.",           "d) Frio e alcalose metabólica.",         ],         correctAnswer: "b) Mudança brusca de pH e aumento da agitação molecular.",         comment: "A desnaturação é um processo que desdobra a proteína de sua forma nativa, sendo causado por fatores como o aumento da agitação molecular devido ao calor ou alterações no pH. As ligações peptídicas não são quebradas na desnaturação, mas sim na hidrólise.",         topic: "Desnaturação de Proteínas",       },       {         question: "2. Qual a principal característica das enzimas, conforme descrito na aula?",         options: [           "a) São carboidratos que armazenam energia.",           "b) São lipídios que formam barreiras de proteção.",           "c) São proteínas que atuam como catalisadores biológicos, acelerando reações.",           "d) São ácidos nucleicos que carregam informações genéticas.",         ],         correctAnswer: "c) São proteínas que atuam como catalisadores biológicos, acelerando reações.",         comment: "O Dr. Marcelo menciona explicitamente que as enzimas são proteínas com a função de catalisadores biológicos, acelerando as reações químicas no corpo.",         topic: "Enzimas e Catálise",       },       {         question: "3. O que acontece com as ligações peptídicas durante o processo de desnaturação de uma proteína?",         options: [           "a) Elas são quebradas, resultando em aminoácidos.",           "b) Elas são fortalecidas, mantendo a estrutura da proteína.",           "c) Elas permanecem intactas, mas a proteína perde sua forma nativa.",           "d) Elas se transformam em ligações de hidrogênio.",         ],         correctAnswer: "c) Elas permanecem intactas, mas a proteína perde sua forma nativa.",         comment: "A desnaturação é uma alteração na forma da proteína (enovelamento), mas não rompe as ligações peptídicas. A quebra dessas ligações é característica da hidrólise.",         topic: "Desnaturação e Ligações Químicas",       },       {         question: "4. A hidrólise de uma proteína, que a divide em pedaços menores, é conhecida como qual tipo de reação?",         options: [           "a) Reação de condensação.",           "b) Reação de desnaturação.",           "c) Reação de oxidação.",           "d) Reação de quebra (lise).",         ],         correctAnswer: "d) Reação de quebra (lise).",         comment: "A hidrólise é o processo de quebra das ligações peptídicas das proteínas. O termo 'lise' significa quebra, e a aula a diferencia da desnaturação.",         topic: "Hidrólise de Proteínas",       },       {         question: "5. Qual a função de um cofator ou coenzima na atividade enzimática?",         options: [           "a) Desnaturar a enzima para torná-la mais eficiente.",           "b) Fornecer energia diretamente para a reação.",           "c) Ajudar a enzima a desempenhar seu trabalho, auxiliando em sua conformação.",           "d) Se ligar ao substrato para inibir a reação.",         ],         correctAnswer: "c) Ajudar a enzima a desempenhar seu trabalho, auxiliando em sua conformação.",         comment: "Cofatores e coenzimas são substâncias que auxiliam a atividade enzimática, complementando sua estrutura para que possam atuar.",         topic: "Cofatores e Coenzimas",       },       {         question: "6. Como a energia que nos mantém vivos é obtida, segundo a aula?",         options: [           "a) Diretamente do calor do sol.",           "b) Roubando energia de outros animais.",           "c) Da energia química contida nas ligações dos alimentos, que originalmente vem do sol.",           "d) Da energia liberada na respiração.",         ],         correctAnswer: "c) Da energia química contida nas ligações dos alimentos, que originalmente vem do sol.",         comment: "A aula explica que os vegetais capturam a energia solar por meio da fotossíntese e a armazenam em ligações químicas. Nós, ao nos alimentarmos, consumimos essa energia.",         topic: "Energia e Metabolismo",       },       {         question: "7. Quais são os dois tipos de metabolismo mencionados, que estão interconectados?",         options: [           "a) Respiração e Digestão.",           "b) Catabolismo e Anabolismo.",           "c) Síntese e Absorção.",           "d) Oxidação e Redução.",         ],         correctAnswer: "b) Catabolismo e Anabolismo.",         comment: "O metabolismo é um conjunto de reações que se dividem em catabolismo (quebra) e anabolismo (construção). O catabolismo fornece a energia para o anabolismo.",         topic: "Tipos de Metabolismo",       },       {         question: "8. Qual das seguintes afirmações sobre catabolismo está correta?",         options: [           "a) É a construção de moléculas complexas a partir de moléculas menores.",           "b) É um processo que consome energia (endotérmico).",           "c) É uma reação de quebra que libera energia (exotérmica).",           "d) É um processo que só acontece quando há falta de oxigênio.",         ],         correctAnswer: "c) É uma reação de quebra que libera energia (exotérmica).",         comment: "O catabolismo é o processo de degradação de moléculas e é caracterizado por liberar energia, sendo portanto uma reação exotérmica.",         topic: "Catabolismo",       },       {         question: "9. A molécula de ATP é comparada a uma 'pilha' ou 'bateria'. Qual o processo que 'carrega' essa molécula?",         options: [           "a) Desnaturação.",           "b) Hidrólise.",           "c) Fosforilação.",           "d) Fermentação.",         ],         correctAnswer: "c) Fosforilação.",         comment: "O Dr. Marcelo explica que a fosforilação é o processo de adição de um fosfato ao ADP, convertendo-o em ATP, que armazena energia.",         topic: "ATP e Fosforilação",       },       {         question: "10. Qual a principal enzima envolvida na digestão de amido na boca e qual o seu destino no estômago?",         options: [           "a) Lactase, que é ativada no estômago.",           "b) Sacarase, que é desnaturada no estômago.",           "c) Amilase, que é desnaturada no estômago.",           "d) Maltase, que é ativada no estômago.",         ],         correctAnswer: "c) Amilase, que é desnaturada no estômago.",         comment: "A digestão do amido começa na boca com a amilase, mas a enzima é desnaturada pelo pH ácido do estômago, parando sua ação.",         topic: "Digestão de Carboidratos",       },       {         question: "11. Qual é o produto final da digestão completa de carboidratos, como amido e lactose, no intestino?",         options: [           "a) Peptídeos e aminoácidos.",           "b) Maltose e sacarose.",           "c) Glicose, frutose e galactose (monossacarídeos).",           "d) Cetoácidos e lactato.",         ],         correctAnswer: "c) Glicose, frutose e galactose (monossacarídeos).",         comment: "O Dr. Marcelo explica que a digestão de amido, lactose e sacarose resulta, respectivamente, em monossacarídeos: glicose, glicose+frutose e glicose+galactose.",         topic: "Produtos da Digestão de Carboidratos",       },       {         question: "12. A intolerância à lactose ocorre devido a que fator, de acordo com a aula?",         options: [           "a) Falta da enzima amilase.",           "b) Produção excessiva de lactase.",           "c) Deficiência ou ineficiência da enzima lactase no intestino.",           "d) Desnaturação da sacarase no estômago.",         ],         correctAnswer: "c) Deficiência ou ineficiência da enzima lactase no intestino.",         comment: "A intolerância à lactose é causada pela incapacidade de quebrar a lactose, que é devido à ausência ou ineficácia da enzima lactase.",         topic: "Intolerância à Lactose",       },       {         question: "13. A glicólise é o processo metabólico que converte uma molécula de glicose em quantas moléculas de piruvato?",         options: [           "a) 1.",           "b) 2.",           "c) 3.",           "d) 4.",         ],         correctAnswer: "b) 2.",         comment: "O Dr. Marcelo menciona que a glicólise transforma uma molécula de glicose em duas moléculas de piruvato.",         topic: "Glicólise",       },       {         question: "14. Qual o saldo líquido de ATPs gerado na glicólise, após considerar o gasto inicial de energia?",         options: [           "a) 4 ATPs.",           "b) 1 ATP.",           "c) 2 ATPs.",           "d) 0 ATPs.",         ],         correctAnswer: "c) 2 ATPs.",         comment: "Embora a glicólise produza 4 ATPs, há um consumo inicial de 2 ATPs, resultando em um saldo líquido de 2.",         topic: "Balanço Energético da Glicólise",       },       {         question: "15. Qual molécula é descrita como um 'caminhão de frete' que transporta hidrogênios e elétrons durante a glicólise?",         options: [           "a) GTP.",           "b) FADH2.",           "c) ATP.",           "d) NAD+.",         ],         correctAnswer: "d) NAD+.",         comment: "O Dr. Marcelo usa essa analogia para explicar a função da NAD+, que é transportadora de hidrogênios e elétrons nas reações metabólicas.",         topic: "NAD+ como Transportador",       },       {         question: "16. A fermentação lática ocorre quando há ausência ou baixa quantidade de qual substância?",         options: [           "a) Glicose.",           "b) Piruvato.",           "c) Lactato.",           "d) Oxigênio.",         ],         correctAnswer: "d) Oxigênio.",         comment: "A fermentação lática é apresentada como uma via alternativa para o piruvato quando o oxigênio não é suficiente para a respiração celular aeróbica.",         topic: "Fermentação Lática",       },       {         question: "17. O que acontece com o NADH gerado na glicólise durante a fermentação lática?",         options: [           "a) Ele é consumido para produzir ATP.",           "b) Ele é usado para regenerar o NAD+.",           "c) Ele é convertido em lactato.",           "d) Ele é levado para a cadeia respiratória.",         ],         correctAnswer: "b) Ele é usado para regenerar o NAD+.",         comment: "Na fermentação lática, o NADH doa seus hidrogênios para o piruvato, transformando-o em lactato e regenerando o NAD+ para que a glicólise continue.",         topic: "Regeneração de NAD+",       },       {         question: "18. O processo de gliconeogênese é a síntese de uma nova glicose a partir de substâncias que não são carboidratos. Qual a substância pode ser reciclada em glicose, segundo a aula?",         options: [           "a) Lactato.",           "b) Lipídios.",           "c) Ácidos graxos.",           "d) ATP.",         ],         correctAnswer: "a) Lactato.",         comment: "O lactato, resíduo da fermentação lática, pode ser levado ao fígado para ser transformado novamente em glicose através da gliconeogênese.",         topic: "Gliconeogênese",       },       {         question: "19. A via das pentoses, além de gerar ribose, produz uma molécula importante para o metabolismo de lipídios. Que molécula é essa?",         options: [           "a) FAD.",           "b) ADP.",           "c) ATP.",           "d) NADPH.",         ],         correctAnswer: "d) NADPH.",         comment: "A aula menciona que a via das pentoses produz NADPH, uma molécula que, ao contrário do NADH, participa do metabolismo de lipídios.",         topic: "Via das Pentoses",       },       {         question: "20. A energia que originalmente vem do sol é capturada pelos vegetais através de qual processo?",         options: [           "a) Glicólise.",           "b) Gliconeogênese.",           "c) Fermentação.",           "d) Fotossíntese.",         ],         correctAnswer: "d) Fotossíntese.",         comment: "É a fotossíntese o processo pelo qual os vegetais captam a energia luminosa do sol e a convertem em energia química.",         topic: "Fotossíntese",       },       {         question: "21. A energia liberada no catabolismo é armazenada principalmente na forma de qual molécula?",         options: [           "a) Glicose.",           "b) DNA.",           "c) Proteína.",           "d) ATP.",         ],         correctAnswer: "d) ATP.",         comment: "O Dr. Marcelo afirma que a energia liberada nas reações catabólicas é armazenada em moléculas, principalmente o ATP.",         topic: "Armazenamento de Energia",       },       {         question: "22. O que a aula menciona sobre a natureza das vias metabólicas em nosso corpo?",         options: [           "a) Elas ocorrem uma de cada vez.",           "b) Elas ocorrem 100% o tempo todo e nunca param.",           "c) Elas se intensificam ou diminuem sua velocidade, mas não param completamente.",           "d) Elas são desativadas quando não há necessidade de energia.",         ],         correctAnswer: "c) Elas se intensificam ou diminuem sua velocidade, mas não param completamente.",         comment: "O Dr. Marcelo explica que todas as vias funcionam 24 horas por dia, embora com intensidades diferentes, e que não existe processo que pare por completo em um ser vivo.",         topic: "Dinâmica das Vias Metabólicas",       },       {         question: "23. Por que a fermentação lática não é considerada 'interessante' do ponto de vista energético para a célula?",         options: [           "a) Porque ela consome mais ATP do que produz.",           "b) Porque não produz ATP ou produz uma quantidade mínima em comparação a outras vias.",           "c) Porque ela produz resíduos tóxicos para o corpo.",           "d) Porque ela causa a desnaturação de proteínas.",         ],         correctAnswer: "b) Porque não produz ATP ou produz uma quantidade mínima em comparação a outras vias.",         comment: "A fermentação lática não gera ATP, e seu propósito é apenas regenerar o NAD+ para que a glicólise continue, produzindo o saldo de 2 ATPs.",         topic: "Eficiência Energética da Fermentação Lática",       },       {         question: "24. O que é o ciclo de Cori, conforme descrito na aula?",         options: [           "a) O processo de quebra de proteínas em aminoácidos.",           "b) A via metabólica onde a glicose é convertida em piruvato.",           "c) A reciclagem do lactato, onde ele é convertido em glicose pelo fígado e retorna ao músculo.",           "d) A produção de ATP na cadeia respiratória.",         ],         correctAnswer: "c) A reciclagem do lactato, onde ele é convertido em glicose pelo fígado e retorna ao músculo.",         comment: "O Dr. Marcelo explica que o ciclo de Cori é a via onde o lactato é reciclado pelo fígado e transformado em glicose.",         topic: "Ciclo de Cori",       },       {         question: "25. Qual é a molécula que se liga ao lactato e o transforma de volta em piruvato, de acordo com o mapa metabólico apresentado?",         options: [           "a) NAD+.",           "b) ATP.",           "c) NADH.",           "d) GDP.",         ],         correctAnswer: "a) NAD+.",         comment: "A aula mostra que a NAD+ entra vazia e, ao receber os hidrogênios do lactato, o converte em piruvato, regenerando-se em NADH.",         topic: "Conversão de Lactato para Piruvato",       },       {         question: "26. A gliconeogênese é um processo anabólico, o que significa que:",         options: [           "a) Ele gera energia em forma de ATP.",           "b) Ele consome energia.",           "c) Ele quebra moléculas grandes em pequenas.",           "d) Ele só ocorre na ausência de oxigênio.",         ],         correctAnswer: "b) Ele consome energia.",         comment: "A gliconeogênese é um processo de construção de glicose (anabolismo) a partir de outras moléculas, e como todo processo anabólico, ele consome energia.",         topic: "Gliconeogênese como Processo Anabólico",       },       {         question: "27. Qual a principal enzima que controla a velocidade da glicólise, referida como 'enzima marca-passo'?",         options: [           "a) Lactase.",           "b) Amilase.",           "c) Fosfofrutoquinase (PFK).",           "d) ATP sintase.",         ],         correctAnswer: "c) Fosfofrutoquinase (PFK).",         comment: "O Dr. Marcelo menciona a fosfofrutoquinase como a enzima que controla a velocidade dessa via.",         topic: "Enzima Marca-Passo da Glicólise",       },       {         question: "28. A baixa quantidade de ATP estimula a fosfofrutoquinase (PFK) para que a glicólise aconteça mais rapidamente. O que acontece quando há excesso de ATP?",         options: [           "a) A PFK é inibida e a glicólise diminui a velocidade.",           "b) A PFK é estimulada para produzir mais ATP.",           "c) A glicólise continua na mesma velocidade.",           "d) A célula passa a usar a via das pentoses.",         ],         correctAnswer: "a) A PFK é inibida e a glicólise diminui a velocidade.",         comment: "A aula explica que se há excesso de ATP, o corpo não precisa de mais energia, então a enzima marca-passo (PFK) da glicólise é inibida para diminuir a velocidade da via.",         topic: "Regulação da Glicólise",       },       {         question: "29. O que acontece com a glicose que não é utilizada imediatamente para a produção de energia?",         options: [           "a) É eliminada como lixo metabólico.",           "b) É guardada na forma de glicogênio no fígado e nos músculos.",           "c) É convertida em lactato.",           "d) É convertida em ribose na via das pentoses.",         ],         correctAnswer: "b) É guardada na forma de glicogênio no fígado e nos músculos.",         comment: "O glicogênio é a forma de armazenamento da glicose para uso posterior, que ocorre principalmente no fígado e nos músculos.",         topic: "Armazenamento de Glicose",       },       {         question: "30. Na via das pentoses, a glicose é convertida em um açúcar de cinco carbonos (pentose), que é a ribose. Por que a ribose é importante?",         options: [           "a) Para a produção de energia na cadeia respiratória.",           "b) Para a síntese de ácidos nucleicos e ATP.",           "c) Para ser reciclada e formar glicose novamente.",           "d) Para a fermentação lática em células musculares.",         ],         correctAnswer: "b) Para a síntese de ácidos nucleicos e ATP.",         comment: "A ribose é um açúcar fundamental para a estrutura do DNA, RNA e ATP.",         topic: "Importância da Ribose",       },       {         question: "31. Qual a molécula que transporta hidrogênios no metabolismo de lipídios, produzida na via das pentoses?",         options: [           "a) NAD+.",           "b) FAD+.",           "c) NADPH.",           "d) ATP.",         ],         correctAnswer: "c) NADPH.",         comment: "O Dr. Marcelo diferencia o NADH do NADPH, mencionando que este último é produzido na via das pentoses e participa do metabolismo de lipídios.",         topic: "NADPH no Metabolismo de Lipídios",       },       {         question: "32. Qual a via metabólica da glicose que ocorre no citosol da célula?",         options: [           "a) Glicólise.",           "b) Ciclo de Krebs.",           "c) Cadeia respiratória.",           "d) Fermentação alcoólica.",         ],         correctAnswer: "a) Glicólise.",         comment: "A aula menciona que a glicólise é a via que ocorre no citosol (citoplasma) da célula.",         topic: "Localização da Glicólise",       },       {         question: "33. Qual a principal diferença, em termos de gasto ou produção de energia, entre o catabolismo e o anabolismo?",         options: [           "a) O catabolismo gasta energia, e o anabolismo a produz.",           "b) O anabolismo gasta energia, e o catabolismo a produz.",           "c) Ambos os processos produzem energia.",           "d) Ambos os processos gastam energia.",         ],         correctAnswer: "b) O anabolismo gasta energia, e o catabolismo a produz.",         comment: "O catabolismo (quebra) é exotérmico e libera energia, enquanto o anabolismo (construção) é endotérmico e consome energia.",         topic: "Diferença entre Catabolismo e Anabolismo",       },       {         question: "34. Por que a lactase, enzima que digere a lactose, é considerada específica?",         options: [           "a) Porque ela só funciona em pH neutro.",           "b) Porque ela só atua sobre a molécula de lactose, quebrando-a em glicose e galactose.",           "c) Porque ela só é produzida quando há falta de oxigênio.",           "d) Porque ela é um catalisador universal para todos os carboidratos.",         ],         correctAnswer: "b) Porque ela só atua sobre a molécula de lactose, quebrando-a em glicose e galactose.",         comment: "A especificidade de uma enzima, conforme a analogia da chave e fechadura, significa que ela atua sobre um único substrato. A lactase, por exemplo, atua somente na lactose.",         topic: "Especificidade das Enzimas",       },       {         question: "35. A quebra completa da sacarose pela sacarase resulta em quais monossacarídeos?",         options: [           "a) Glicose e glicose.",           "b) Frutose e frutose.",           "c) Glicose e frutose.",           "d) Glicose e galactose.",         ],         correctAnswer: "c) Glicose e frutose.",         comment: "A aula detalha que a sacarose é um dissacarídeo composto por glicose e frutose.",         topic: "Quebra da Sacarose",       },       {         question: "36. Por que o jejum prolongado é mencionado na aula em relação à gliconeogênese?",         options: [           "a) Porque intensifica o processo de gliconeogênese para produzir glicose a partir de outras substâncias.",           "b) Porque o corpo para de produzir glicose.",           "c) Porque o corpo passa a quebrar glicogênio.",           "d) Porque o corpo aumenta o consumo de glicose.",         ],         correctAnswer: "a) Porque intensifica o processo de gliconeogênese para produzir glicose a partir de outras substâncias.",         comment: "Em períodos de jejum, a via da gliconeogênese é ativada para que o corpo possa continuar produzindo glicose para suas necessidades energéticas.",         topic: "Jejum e Gliconeogênese",       },       {         question: "37. Qual a função da insulina no metabolismo da glicose?",         options: [           "a) Quebrar a glicose em piruvato.",           "b) Estimular a produção de ATP.",           "c) Ajudar a glicose a entrar nas células.",           "d) Converter glicose em glicogênio.",         ],         correctAnswer: "c) Ajudar a glicose a entrar nas células.",         comment: "A insulina é o hormônio que estimula a proteína transportadora (GLUT4) para que a glicose adentre a célula, onde será metabolizada.",         topic: "Insulina e Glicose",       },       {         question: "38. Na via das pentoses, o que acontece com o excesso de ribulose que não é usado para a síntese de outras moléculas?",         options: [           "a) É eliminado do corpo.",           "b) É transformado de volta em glicose.",           "c) É reciclado em substâncias como frutose e gliceraldeído para a glicólise.",           "d) É armazenado como glicogênio.",         ],         correctAnswer: "c) É reciclado em substâncias como frutose e gliceraldeído para a glicólise.",         comment: "A aula descreve um sistema de reciclagem na via das pentoses, onde a ribulose excedente pode ser convertida em intermediários da glicólise para gerar energia.",         topic: "Reciclagem de Ribulose",       },       {         question: "39. O que acontece com a NAD+ na fermentação lática?",         options: [           "a) Ela é consumida e não pode ser regenerada.",           "b) Ela é convertida em lactato.",           "c) Ela é regenerada a partir de NADH.",           "d) Ela é transportada para a cadeia respiratória.",         ],         correctAnswer: "c) Ela é regenerada a partir de NADH.",         comment: "O NADH transfere seus hidrogênios para o piruvato para formar lactato, e o NAD+ é regenerado para ser utilizado em novas rodadas de glicólise.",         topic: "Papel do NAD+ na Fermentação Lática",       },       {         question: "40. O que significa uma enzima ser um catalisador biológico?",         options: [           "a) Ela é a única responsável por iniciar a reação.",           "b) Ela aumenta a velocidade de uma reação sem ser consumida no processo.",           "c) Ela atua como um reagente na reação.",           "d) Ela é inibida pela presença de substrato.",         ],         correctAnswer: "b) Ela aumenta a velocidade de uma reação sem ser consumida no processo.",         comment: "O Dr. Marcelo define um catalisador como uma substância que acelera uma reação, e as enzimas se encaixam nessa definição no contexto biológico.",         topic: "Catalisadores Biológicos",       },     ];

    function buildQuiz() {
      const output = [];

      questions.forEach((currentQuestion, questionNumber) => {
        const options = [];
        for (let i = 0; i < currentQuestion.options.length; i++) {
          options.push(
            `<label class="option" data-question="${questionNumber}" data-value="${currentQuestion.options[i]}">
              <img src="tesouras.png" class="scissor-icon" onclick="event.stopPropagation(); this.parentNode.classList.toggle('struck-through');">
              ${currentQuestion.options[i]}
            </label>`
          );
        }

        output.push(
          `<div class="card" id="question-${questionNumber}" data-topic="${currentQuestion.topic}">
            <div class="question">${currentQuestion.question}</div>
            <div class="options">${options.join("")}</div>
            <div class="comment" id="comment-${questionNumber}"></div>
          </div>`
        );
      });

      quizContainer.innerHTML = output.join("");
    }

    function showResults() {
      wrongQuestionIndices = [];
      errorCountByTopic = {};
      totalAnsweredQuestionsByTopic = {};
      currentWrongQuestionIndex = -1;
      hasErrors = false;
      isShowingErrors = false;
      isShowingDiagnosis = false;

      errorDiagnosisSection.style.display = 'none';
      topicsToReviewList.innerHTML = '';
      statusMessage.textContent = '';

      // Busca por todas as perguntas: estáticas e dinâmicas
      const allQuestionCards = document.querySelectorAll('.quiz-container .card, #newQuestionsContent .card');
      let correctAnswersCount = 0;
      let totalQuestionsAnswered = 0;

      console.log('🔍 Verificando', allQuestionCards.length, 'perguntas...');

      allQuestionCards.forEach((card, index) => {
        const questionEl = card.querySelector('.question') || card.querySelector('p');
        if (!questionEl) return;

        const questionText = questionEl.textContent.trim();
        const optionsContainer = card.querySelector('.options') || card;
        const allOptions = optionsContainer.querySelectorAll('.option, label.option, label');
        const userAnswerElement = optionsContainer.querySelector('.option.selected, label.selected');
        const commentDiv = card.querySelector('.comment');

        const questionTopic = card.dataset.topic || "Tópico não informado";
        
        console.log(`📝 Pergunta ${index + 1}: Tópico = "${questionTopic}"`);
        console.log(`🔍 Encontradas ${allOptions.length} alternativas`);
        
        // Remove classes anteriores
        allOptions.forEach(option => {
          option.classList.remove('correct', 'incorrect', 'selected');
        });
        if (commentDiv) commentDiv.classList.remove('show');

        let correctAnswerValue = null;
        let questionComment = null;

        // Verifica se é pergunta estática ou dinâmica
        const isStatic = card.id && card.id.startsWith('question-');
        if (isStatic) {
          // Pergunta estática - busca nos dados originais
          const questionData = questions.find(q => q.question.trim() === questionText);
          if (questionData) {
            correctAnswerValue = questionData.correctAnswer.trim();
            questionComment = questionData.comment;
          }
        } else {
          // Pergunta dinâmica - busca pela opção marcada como correta
          const correctOpt = optionsContainer.querySelector('.option[data-answer="true"], label[data-answer="true"]');
          if (correctOpt) {
            correctAnswerValue = correctOpt.dataset.value?.trim() || correctOpt.textContent.trim();
            console.log(`✅ Resposta correta encontrada: "${correctAnswerValue}"`);
          } else {
            console.log('❌ Nenhuma resposta correta encontrada para pergunta dinâmica');
          }
          
          // Busca comentário no próprio card ou no div comment
          const commentElement = card.querySelector('.comment');
          if (commentElement && commentElement.textContent.trim()) {
            questionComment = commentElement.textContent.trim();
          }
        }

        // Processa resposta do usuário e aplica coloração
        let userAnswer = null;
        if (userAnswerElement) {
          userAnswerElement.classList.add('selected');
          userAnswer = userAnswerElement.dataset.value?.trim() || userAnswerElement.textContent.trim();
          totalQuestionsAnswered++;
          totalAnsweredQuestionsByTopic[questionTopic] = (totalAnsweredQuestionsByTopic[questionTopic] || 0) + 1;

          console.log(`👤 Resposta do usuário: "${userAnswer}"`);
          console.log(`🎯 Resposta correta: "${correctAnswerValue}"`);

          // Verifica se a resposta está correta
          if (userAnswer === correctAnswerValue) {
            correctAnswersCount++;
            console.log(`✅ Resposta correta!`);
          } else {
            hasErrors = true;
            errorCountByTopic[questionTopic] = (errorCountByTopic[questionTopic] || 0) + 1;
            console.log(`❌ Resposta incorreta para tópico: ${questionTopic}`);
          }
        }

        // Aplica coloração: SEMPRE marca a correta de verde, e a errada de vermelho se foi marcada
        allOptions.forEach(option => {
          const optionValue = option.dataset.value?.trim() || option.textContent.trim();
          
          // Marca a resposta correta de verde SEMPRE
          if (optionValue === correctAnswerValue) {
            option.classList.add('correct');
            console.log(`🟢 Marcando como correta: "${optionValue}"`);
          }
          
          // Se o usuário marcou uma resposta E ela está errada, marca de vermelho
          if (userAnswer && optionValue === userAnswer && userAnswer !== correctAnswerValue) {
            option.classList.add('incorrect');
            console.log(`🔴 Marcando como incorreta: "${optionValue}"`);
          }
        });

        // Mostra comentário se disponível
        if (commentDiv && questionComment) {
          commentDiv.textContent = questionComment;
          commentDiv.classList.add('show');
        }
      });

      // Exibe resultados
      resultsContainer.textContent = `Você acertou ${correctAnswersCount} de ${totalQuestionsAnswered} questões respondidas.`;

      console.log('📊 Erros por tópico:', errorCountByTopic);
      console.log('📊 Total por tópico:', totalAnsweredQuestionsByTopic);

      // Gera diagnóstico de erros
      if (hasErrors) {
        for (const topic in errorCountByTopic) {
          const errors = errorCountByTopic[topic];
          const total = totalAnsweredQuestionsByTopic[topic] || 0;
          if (total > 0) {
            const percent = ((errors / total) * 100).toFixed(1);
            const li = document.createElement('li');
            li.textContent = `${topic}: ${percent}% de erros (${errors} de ${total} questões respondidas)`;
            topicsToReviewList.appendChild(li);
          }
        }
      } else {
        const li = document.createElement('li');
        li.textContent = "🥳 Parabéns! Você não teve erros nas questões respondidas.";
        topicsToReviewList.appendChild(li);
      }

      errorDiagnosisSection.style.display = 'block';
      generatedQuestionsSection.style.display = 'block';
      generateNewQuestionsBtn.style.display = 'block';
      scrollToDiagnosis();
    }

    function scrollToQuestion(index) {
      const questionCard = document.getElementById(`question-${index}`);
      if (questionCard) {
        questionCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }
    }

    function scrollToDiagnosis() {
        errorDiagnosisSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    function scrollToGeneratedQuestions() {
        generatedQuestionsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    // Event listener para seleção de opções (funciona para estáticas e dinâmicas)
    document.addEventListener("click", function (event) {
      const clickedElement = event.target;
      const optionElement = clickedElement.closest('.option');

      if (optionElement) {
          if (clickedElement.classList.contains("scissor-icon")) {
              event.stopPropagation();
              optionElement.classList.toggle("struck-through");
          }
          else {
              const parentCard = optionElement.closest('.card');
              const currentQuestionOptions = parentCard.querySelectorAll('.option');

              currentQuestionOptions.forEach(opt => opt.classList.remove("selected"));
              optionElement.classList.add("selected");
          }
      }
    });

    generateNewQuestionsBtn.addEventListener("click", async function() {
        statusMessage.textContent = '⏳ Gerando novas perguntas...';
        generateNewQuestionsBtn.disabled = true;

        const topics = Object.keys(errorCountByTopic).filter(topic => {
            const errorsInTopic = errorCountByTopic[topic] || 0;
            const totalAnsweredInTopic = totalAnsweredQuestionsByTopic[topic] || 0;
            return errorsInTopic > 0 && totalAnsweredInTopic > 0;
        });

        const topicsToSend = topics.length > 0 ? topics : ["fisiologia celular", "biologia"];

        try {
            const response = await fetch('https://www.quizia.xyz/quiz', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ topicos: topicsToSend }),
            });

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const data = await response.json();

            newQuestionsContent.innerHTML = '';
            if (data && data.html) {
                console.log('📥 HTML recebido do Flask:', data.html);
                
                // Insere o HTML diretamente sem reconstrução complexa
                newQuestionsContent.innerHTML = data.html.replace(/```html|```/g, '');
                
                // Adiciona tesouras e ajusta formatação apenas se necessário
                newQuestionsContent.querySelectorAll('.card').forEach((card, cardIndex) => {
                    // Garante que o elemento de pergunta tenha a classe correta
                    const questionElement = card.querySelector('p');
                    if (questionElement && !questionElement.classList.contains('question')) {
                       questionElement.classList.add('question');
                    }

                    // Remove qualquer input de radio que possa existir e adiciona tesouras
                    card.querySelectorAll('label').forEach((label) => {
                        // Remove inputs de radio MAS preserva o atributo data-answer
                        const radioInput = label.querySelector('input[type="radio"]');
                        if (radioInput) {
                            // PRESERVA o atributo data-answer do input no label
                            if (radioInput.hasAttribute('data-answer')) {
                                label.setAttribute('data-answer', radioInput.getAttribute('data-answer'));
                            }
                            radioInput.remove();
                        }
                        
                        // Garante que tenha a classe option
                        if (!label.classList.contains('option')) {
                            label.classList.add('option');
                        }

                        // Garante que tenha data-value
                        if (!label.dataset.value) {
                            label.dataset.value = label.textContent.trim();
                        }

                        // Adiciona tesoura se não existir
                        if (!label.querySelector('.scissor-icon')) {
                            const scissorIcon = document.createElement('img');
                            scissorIcon.src = 'tesouras.png';
                            scissorIcon.className = 'scissor-icon';
                            scissorIcon.onclick = function(e) {
                                e.stopPropagation();
                                label.classList.toggle('struck-through');
                            };
                            label.insertBefore(scissorIcon, label.firstChild);
                        }
                    });

                    console.log(`🏷️ Card ${cardIndex}: data-topic = "${card.dataset.topic}"`);
                    
                    // Verifica se há opção correta marcada
                    const correctOption = card.querySelector('label[data-answer="true"]');
                    if (correctOption) {
                        console.log(`✅ Opção correta encontrada: "${correctOption.dataset.value}"`);
                    } else {
                        console.log('❌ Nenhuma opção correta encontrada');
                    }
                });
            } else {
                newQuestionsContent.innerHTML = "<p>Não foi possível gerar novas perguntas para os tópicos selecionados.</p>";
            }
            
            generatedQuestionsSection.style.display = 'block';
            scrollToGeneratedQuestions();
            statusMessage.textContent = '✅ Perguntas geradas com sucesso!';
            setTimeout(() => { statusMessage.textContent = '' }, 3000);

        } catch (error) {
            console.error('Erro ao gerar novas perguntas:', error);
            newQuestionsContent.innerHTML = `<p>Erro ao carregar novas perguntas: ${error.message}. Por favor, tente novamente.</p>`;
            generatedQuestionsSection.style.display = 'block';
            scrollToGeneratedQuestions();
            statusMessage.textContent = '❌ Erro na requisição: ' + error.message;
            setTimeout(() => { statusMessage.textContent = '' }, 5000);
        } finally {
            generateNewQuestionsBtn.disabled = false;
        }
    });

    // Inicialização
    buildQuiz();
    errorDiagnosisSection.style.display = 'none';
    generatedQuestionsSection.style.display = 'none';
    generateNewQuestionsBtn.style.display = 'none';

    // Event listener para o botão de verificar respostas
    document.getElementById("verifyAnswersBtn").addEventListener("click", showResults);
  </script>
</body>
</html>
