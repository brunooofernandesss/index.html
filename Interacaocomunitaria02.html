<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>Simulado de Interação Comunitária 02</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      background-color: #f4f4f4;
    }

    .quiz-container {
      max-width: 800px;
      width: 100%;
    }

    h1 {
      color: #333;
      text-align: center;
      margin-bottom: 30px;
    }

    .card {
      background-color: white;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .question {
      font-weight: bold;
      margin-bottom: 10px;
      color: #333;
    }

    .options {
      margin-top: 15px;
    }

    /* Estilos unificados para todas as opções (estáticas e dinâmicas) */
    .option, label.option, label, #newQuestionsContent label {
      display: flex; /* Para alinhar imagem e texto */
      align-items: center;
      margin-bottom: 10px;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.2s ease;
      position: relative; /* Para posicionar a tesoura */
    }

    /* FORÇA a remoção de inputs de radio em QUALQUER lugar */
    .option input[type="radio"], 
    label input[type="radio"],
    #newQuestionsContent input[type="radio"],
    #newQuestionsContent label input[type="radio"] {
        display: none !important;
        visibility: hidden !important;
        opacity: 0 !important;
        position: absolute !important;
        left: -9999px !important;
    }

    .option:hover, 
    label.option:hover, 
    label:hover,
    #newQuestionsContent label:hover {
      background-color: #e9e9e9;
    }

    .option.selected, 
    label.option.selected, 
    label.selected,
    #newQuestionsContent label.selected {
      background-color: #d1e7dd;
      border-color: #28a745;
    }

    .option.correct, 
    label.option.correct, 
    label.correct,
    #newQuestionsContent label.correct {
      background-color: #d4edda;
      border-color: #28a745;
    }

    .option.incorrect, 
    label.option.incorrect, 
    label.incorrect,
    #newQuestionsContent label.incorrect {
      background-color: #f8d7da;
      border-color: #dc3545;
    }

    .submit-btn {
      display: block;
      width: 100%;
      padding: 15px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 18px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      margin-top: 30px;
    }

    .submit-btn:hover {
      background-color: #0056b3;
    }

    .results {
      text-align: center;
      margin-top: 30px;
      font-size: 20px;
      font-weight: bold;
      color: #333;
    }

    .scissor-icon {
      margin-right: 10px; /* Espaço entre a tesoura e o texto da opção */
      width: 20px; /* Ajuste conforme o tamanho da sua imagem */
      height: 20px; /* Ajuste conforme o tamanho da sua imagem */
      opacity: 0.5; /* Transparência como no original */
      cursor: pointer;
    }

    .scissor-icon.hidden {
      display: none;
    }

    .struck-through {
      text-decoration: line-through;
      color: #888;
    }

    .comment {
      margin-top: 10px;
      padding: 10px;
      background-color: #f0f0f0;
      border-left: 4px solid #007bff;
      font-style: italic;
      color: #555;
      display: none; /* Escondido por padrão */
    }
    .comment.show {
      display: block; /* Mostrado quando ativado */
    }

    /* Estilos para o botão de navegação de erro / diagnóstico */
    .error-nav-btn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: #dc3545; /* Vermelho para erro */
      color: white;
      border: none;
      border-radius: 50%; /* Torna o botão redondo */
      width: 60px;
      height: 60px;
      font-size: 24px;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      z-index: 1000;
      display: none; /* Escondido por padrão */
      flex-direction: column; /* Para empilhar o ícone e o contador */
      padding: 5px; /* Ajuste o padding para acomodar texto maior */
      box-sizing: border-box; /* Garante que padding não aumente o tamanho total */
      text-align: center;
    }

    .error-nav-btn:hover {
      background-color: #c82333;
    }

    .error-nav-btn .arrow-icon {
      font-size: 30px; /* Tamanho da seta */
      line-height: 1; /* Ajuste para centralizar */
    }

    .error-nav-btn .button-text {
      font-size: 12px; /* Tamanho do texto abaixo da seta */
      line-height: 1;
      margin-top: 2px; /* Espaço entre a seta e o texto */
    }

    /* Estilos para a seção de diagnóstico de erros */
    .error-diagnosis-section {
        margin-top: 50px;
        padding: 30px;
        background-color: #ffe0b2; /* Um laranja claro ou similar */
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.15);
        display: none; /* Escondido por padrão */
        text-align: center;
        font-size: 1.1em;
        color: #333;
    }

    .error-diagnosis-section h2 {
        color: #e65100; /* Laranja mais escuro */
        margin-bottom: 20px;
        font-size: 1.8em;
    }

    .error-diagnosis-section ul {
        list-style: none; /* Remove marcadores de lista */
        padding: 0;
        margin: 0;
    }

    .error-diagnosis-section li {
        background-color: #ff9800; /* Laranja */
        color: white;
        padding: 8px 15px;
        margin: 8px 0;
        border-radius: 5px;
        display: inline-block; /* Para que os itens fiquem lado a lado */
        margin-right: 10px;
        font-weight: bold;
    }
    .error-diagnosis-section li:last-child {
        margin-right: 0;
    }
 .card-bloco {
      border: 1px solid #ddd;
      border-radius: 6px;
      padding: 10px;
      background: #fff;
      margin-bottom: 20px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    }
  </style>
</head>
<body>
  <div class="quiz-container">
    <h1 style="text-align:center; margin-bottom: 30px;">Simulado de Interação Comunitária 02</h1>
    <div class="card-bloco" id="quiz"></div>
    <button class="submit-btn" id="verifyAnswersBtn">Verificar Respostas</button>

    <button class="generate-questions-btn submit-btn" id="generateNewQuestionsBtn" style="display:none;">
      Gerar Novas Perguntas
    </button>

    <div class="results card-bloco" id="results"></div>
    <div id="statusMessage" style="text-align: center; margin-top: 10px; font-weight: bold; color: #007bff;"></div>

    <div class="error-diagnosis-section card-bloco" id="errorDiagnosis">
      <h2>Diagnóstico de Erros</h2>
      <p>Parece que você precisa revisar os seguintes assuntos:</p>
      <ul id="topicsToReview"></ul>
    </div>

    <div class="generated-questions-section card-bloco" id="generatedQuestionsSection" style="display:none;">
      <h2>Novas Perguntas Geradas</h2>
      <div id="newQuestionsContent"></div>
    </div>
  </div>
  
  <button class="error-nav-btn" id="errorNavBtn" style="display:none;">
    <span class="arrow-icon"></span>
    <span class="button-text"></span>
  </button>

  <script>
    const quizContainer = document.getElementById("quiz");
    const resultsContainer = document.getElementById("results");
    const errorNavBtn = document.getElementById("errorNavBtn");
    const arrowIcon = errorNavBtn.querySelector(".arrow-icon");
    const buttonText = errorNavBtn.querySelector(".button-text");
    const errorDiagnosisSection = document.getElementById("errorDiagnosis");
    const topicsToReviewList = document.getElementById("topicsToReview");
    const generateNewQuestionsBtn = document.getElementById("generateNewQuestionsBtn");
    const generatedQuestionsSection = document.getElementById("generatedQuestionsSection");
    const newQuestionsContent = document.getElementById("newQuestionsContent");
    const statusMessage = document.getElementById("statusMessage");

    let wrongQuestionIndices = [];
    let errorCountByTopic = {};
    let totalAnsweredQuestionsByTopic = {};
    let currentWrongQuestionIndex = -1;
    let hasErrors = false;
    let isShowingErrors = false;
    let isShowingDiagnosis = false;

    // Inicializa a visibilidade das seções no carregamento
    errorDiagnosisSection.style.display = 'none';
    topicsToReviewList.innerHTML = '';
    statusMessage.textContent = '';

    const questions = [       {         question: "1. De acordo com a transcrição, qual é a principal diferença entre a visita domiciliar de cuidados básicos e o serviço de atenção domiciliar?",         options: [           "a) A visita domiciliar é realizada por médicos, enquanto a atenção domiciliar é feita por enfermeiros.",           "b) A visita domiciliar é focada em pacientes com baixa complexidade, enquanto a atenção domiciliar é para pacientes com alta complexidade.",           "c) A visita domiciliar é para pacientes acamados, e a atenção domiciliar é para pacientes que podem se locomover.",           "d) A visita domiciliar é realizada pela equipe de EMAD, e a atenção domiciliar é feita pela Estratégia de Saúde da Família (ESF).",           "e) A visita domiciliar ocorre apenas em áreas rurais.",         ],         correctAnswer: "b) A visita domiciliar é focada em pacientes com baixa complexidade, enquanto a atenção domiciliar é para pacientes com alta complexidade.",         comment: "A aula distingue claramente os dois tipos de serviço, indicando que a visita domiciliar, realizada pela ESF, é para casos menos complexos, enquanto a atenção domiciliar, de alta complexidade, é para pacientes que necessitam de cuidados intensivos e contínuos.",         topic: "Diferença entre Visita Domiciliar e Atenção Domiciliar",       },       {         question: "2. Qual é o principal foco dos cuidados básicos, segundo a transcrição?",         options: [           "a) Pacientes com múltiplas comorbidades.",           "b) Pacientes que necessitam de respiradores e outros equipamentos.",           "c) Avaliações e suporte a pacientes com baixa complexidade.",           "d) Pacientes em fase terminal.",           "e) Pacientes com superinfecções.",         ],         correctAnswer: "c) Avaliações e suporte a pacientes com baixa complexidade.",         comment: "A transcrição afirma que a visita domiciliar de cuidados básicos é voltada para avaliações e suporte a pacientes com baixa complexidade, como aqueles que estão acamados ou se recuperando de um acidente.",         topic: "Foco dos Cuidados Básicos",       },       {         question: "3. Um paciente que utiliza respirador, sonda nasoenteral, sonda vesical de demora e bolsa de colostomia se enquadra em qual modalidade de cuidado, de acordo com a Dra. Michele?",         options: [           "a) Assistência Domiciliar (AD).",           "b) Visita Domiciliar (VD).",           "c) Cuidados Básicos.",           "d) Atenção Domiciliar de alta complexidade.",           "e) Cuidados Prolongados.",         ],         correctAnswer: "d) Atenção Domiciliar de alta complexidade.",         comment: "A Dra. Michele usa exatamente esses exemplos para descrever os pacientes que necessitam de cuidados intensivos e contínuos, característicos da atenção domiciliar de alta complexidade.",         topic: "Atenção Domiciliar de Alta Complexidade",       },       {         question: "4. A transcrição menciona que a internação domiciliar é um modelo de substituição da:",         options: [           "a) Visita domiciliar.",           "b) Cuidados prolongados.",           "c) Internação hospitalar.",           "d) Assistência Domiciliar (AD).",           "e) Estratégia de Saúde da Família (ESF).",         ],         correctAnswer: "c) Internação hospitalar.",         comment: "O texto afirma que a internação domiciliar é um modelo de substituição da internação hospitalar para pacientes que podem ter alta, mas ainda precisam de cuidados especializados.",         topic: "Internação Domiciliar",       },       {         question: "5. Qual é a condição necessária para um paciente ir para a internação domiciliar, além de ter perfil de alta hospitalar?",         options: [           "a) Ter uma equipe médica dedicada 24 horas.",           "b) Ter um cuidador principal.",           "c) Viver em uma área urbana.",           "d) Ser capaz de se locomover.",           "e) Ter um plano de saúde particular.",         ],         correctAnswer: "b) Ter um cuidador principal.",         comment: "A palestrante menciona que o paciente precisa ter um cuidador principal, além da equipe de saúde de atenção domiciliar (EMAD).",         topic: "Condições para Internação Domiciliar",       },       {         question: "6. De acordo com a aula, qual é o tipo de cuidado simples, voltado para pacientes que não são acamados e que precisam apenas de apoio e avaliação?",         options: [           "a) Internação Domiciliar (ID).",           "b) Visita Domiciliar (VD).",           "c) Assistência Domiciliar (AD).",           "d) Cuidados Prolongados.",           "e) Atenção Domiciliar de alta complexidade.",         ],         correctAnswer: "c) Assistência Domiciliar (AD).",         comment: "A transcrição classifica a Assistência Domiciliar (AD) como o cuidado simples, para pacientes que não são acamados.",         topic: "Assistência Domiciliar (AD)",       },       {         question: "7. A transcrição afirma que o atestado de acompanhante é de responsabilidade exclusiva do médico.",         options: [           "a) Verdadeiro.",           "b) Falso.",         ],         correctAnswer: "b) Falso.",         comment: "A Dra. Michele esclarece que o atestado de acompanhante não é de responsabilidade exclusiva do médico e que o enfermeiro também pode emitir.",         topic: "Atestado de Acompanhante",       },       {         question: "8. Qual resolução do COFEN é mencionada na aula, estabelecendo diretrizes para a atuação do enfermeiro em atenção domiciliar?",         options: [           "a) Resolução 509/2016.",           "b) Resolução 450/2015.",           "c) Resolução 123/2010.",           "d) Resolução 222/2018.",           "e) Resolução 300/2014.",         ],         correctAnswer: "a) Resolução 509/2016.",         comment: "A transcrição cita explicitamente a Resolução 509/2016 do COFEN.",         topic: "Resolução COFEN 509/2016",       },       {         question: "9. O que a Dra. Michele discute como sendo um modelo de cuidado contínuo para qualquer pessoa que tenha uma doença crônica grave?",         options: [           "a) Cuidados Básicos.",           "b) Cuidados Prolongados.",           "c) Internação Domiciliar.",           "d) Cuidados Paliativos.",           "e) Visita Domiciliar.",         ],         correctAnswer: "d) Cuidados Paliativos.",         comment: "A palestrante explica que os cuidados paliativos não se restringem a pacientes em fase terminal, sendo um modelo de cuidado contínuo para doenças crônicas graves.",         topic: "Cuidados Paliativos",       },       {         question: "10. Qual é o principal objetivo dos cuidados paliativos, segundo a transcrição?",         options: [           "a) Curar a doença crônica.",           "b) Apenas controlar a dor de pacientes terminais.",           "c) Proporcionar a melhor qualidade de vida possível para o paciente e sua família.",           "d) Reabilitar o paciente para que ele possa se mover sozinho.",           "e) Aumentar a sobrevida do paciente a qualquer custo.",         ],         correctAnswer: "c) Proporcionar a melhor qualidade de vida possível para o paciente e sua família.",         comment: "A Dra. Michele enfatiza que o objetivo dos cuidados paliativos é controlar os sintomas e oferecer suporte para garantir a melhor qualidade de vida.",         topic: "Objetivos dos Cuidados Paliativos",       },       {         question: "11. A transcrição menciona que a equipe de saúde de atenção domiciliar (EMAD) é um serviço de:",         options: [           "a) Baixa complexidade.",           "b) Cuidados básicos.",           "c) Alta complexidade.",           "d) Visita domiciliar.",           "e) Cuidados paliativos.",         ],         correctAnswer: "c) Alta complexidade.",         comment: "O texto afirma que a EMAD é um serviço de alta complexidade.",         topic: "Equipe EMAD",       },       {         question: "12. Em relação à autonomia do paciente e da família, qual é o papel da enfermagem, segundo a aula?",         options: [           "a) Forçar o paciente a seguir o plano de cuidados.",           "b) Tomar todas as decisões pelo paciente.",           "c) Atuar como mediadora, garantindo que o paciente receba o melhor cuidado possível.",           "d) Ignorar a vontade do paciente.",           "e) Apenas seguir as ordens do médico.",         ],         correctAnswer: "c) Atuar como mediadora, garantindo que o paciente receba o melhor cuidado possível.",         comment: "A palestrante ressalta que a enfermagem deve atuar como mediadora, respeitando a autonomia do paciente.",         topic: "Autonomia do Paciente e Papel da Enfermagem",       },       {         question: "13. A Dra. Michele menciona um caso de um paciente com infecção por “superbactéria” para ilustrar qual ponto?",         options: [           "a) A necessidade de antibióticos potentes.",           "b) A importância do isolamento do paciente.",           "c) A falta de leitos em hospitais.",           "d) A responsabilidade do médico no tratamento.",           "e) A ineficácia da atenção domiciliar.",         ],         correctAnswer: "b) A importância do isolamento do paciente.",         comment: "A Dra. Michele usa esse caso para ilustrar a necessidade de cuidados especializados, incluindo o isolamento, na atenção domiciliar.",         topic: "Cuidados Específicos: Infecções",       },       {         question: "14. A falta de qual item resultou em lesões de pele em um paciente, segundo um dos casos clínicos apresentados na aula?",         options: [           "a) Equipe médica disponível.",           "b) Medicamentos.",           "c) Plano de cuidados de enfermagem.",           "d) Cuidador principal.",           "e) Sondas vesicais.",         ],         correctAnswer: "c) Plano de cuidados de enfermagem.",         comment: "A Dra. Michele relata que a falta de um plano de cuidados de enfermagem resultou em lesões de pele no paciente, que precisou ser internado.",         topic: "Plano de Cuidados de Enfermagem",       },       {         question: "15. O que a Dra. Michele enfatiza como essencial para o profissional de enfermagem se proteger de problemas judiciais?",         options: [           "a) Ter um seguro de vida.",           "b) Documentar todas as orientações e recusas.",           "c) Trabalhar apenas em hospitais.",           "d) Evitar casos de alta complexidade.",           "e) Seguir apenas as ordens do médico.",         ],         correctAnswer: "b) Documentar todas as orientações e recusas.",         comment: "A palestrante reforça a necessidade de documentar tudo para se proteger de problemas legais.",         topic: "Aspectos Legais e Documentação",       },       {         question: "16. O que significa a sigla 'EMAD', conforme o resumo da aula?",         options: [           "a) Equipe de Monitoramento e Avaliação Domiciliar.",           "b) Estratégia Médica de Atendimento Domiciliar.",           "c) Equipe Multiprofissional de Atendimento Domiciliar.",           "d) Equipe de Médico e Atendimento Direto.",           "e) Equipe de Enfermagem para Atendimento Domiciliar.",         ],         correctAnswer: "c) Equipe Multiprofissional de Atendimento Domiciliar.",         comment: "A sigla EMAD é mencionada no contexto da equipe de saúde de atenção domiciliar, que é multiprofissional.",         topic: "Significado da Sigla EMAD",       },       {         question: "17. O que a transcrição define como 'Cuidados Prolongados'?",         options: [           "a) Cuidado intensivo, com equipe de alta complexidade.",           "b) Cuidado simples, voltado para pacientes não acamados.",           "c) Cuidado para pacientes que já não precisam de hospital de alta complexidade, mas ainda necessitam de cuidados especializados.",           "d) Cuidado paliativo para pacientes terminais.",           "e) Cuidado fornecido apenas pela Estratégia de Saúde da Família.",         ],         correctAnswer: "c) Cuidado para pacientes que já não precisam de hospital de alta complexidade, mas ainda necessitam de cuidados especializados.",         comment: "A Dra. Michele introduz os Cuidados Prolongados como uma modalidade para pacientes que, após a alta hospitalar, ainda precisam de suporte especializado.",         topic: "Definição de Cuidados Prolongados",       },       {         question: "18. A Dra. Michele descreve a importância da equipe de enfermagem nos Cuidados Prolongados para qual finalidade?",         options: [           "a) Fornecer o suporte necessário para a reabilitação do paciente.",           "b) Fazer a gestão financeira do tratamento.",           "c) Controlar a alimentação do paciente.",           "d) Apenas medicar o paciente.",           "e) Apenas auxiliar o cuidador principal.",         ],         correctAnswer: "a) Fornecer o suporte necessário para a reabilitação do paciente.",         comment: "O texto menciona que a equipe de enfermagem nos Cuidados Prolongados fornece o suporte necessário para a reabilitação.",         topic: "Papel da Enfermagem em Cuidados Prolongados",       },       {         question: "19. Qual a principal função da enfermagem, além dos procedimentos, segundo a aula?",         options: [           "a) Apenas prescrever medicamentos.",           "b) Apenas solicitar exames.",           "c) O manejo do paciente em todas as suas necessidades, como alimentação, hidratação e higiene.",           "d) Apenas preencher formulários.",           "e) Apenas emitir atestados.",         ],         correctAnswer: "c) O manejo do paciente em todas as suas necessidades, como alimentação, hidratação e higiene.",         comment: "A palestrante destaca que a assistência de enfermagem vai além dos procedimentos, cobrindo todas as necessidades do paciente.",         topic: "Funções da Enfermagem na Atenção Domiciliar",       },       {         question: "20. O que a Dra. Michele menciona sobre a ética e a responsabilidade profissional ao final da aula?",         options: [           "a) É responsabilidade exclusiva do médico.",           "b) Apenas a documentação é importante.",           "c) A articulação entre a equipe de saúde é crucial para o bem-estar do paciente.",           "d) O profissional não deve subestimar a complexidade dos casos.",           "e) As opções c e d estão corretas.",         ],         correctAnswer: "e) As opções c e d estão corretas.",         comment: "A Dra. Michele conclui a aula ressaltando a importância da ética, da articulação da equipe e da responsabilidade em não subestimar os casos.",         topic: "Ética e Responsabilidade Profissional",       },       {         question: "21. Qual dos seguintes dispositivos é mencionado pela Dra. Michele como exemplo de um paciente que necessita de atenção domiciliar de alta complexidade?",         options: [           "a) Cadeira de rodas.",           "b) Bengala.",           "c) Termômetro.",           "d) Respirador.",           "e) Aparelho de pressão.",         ],         correctAnswer: "d) Respirador.",         comment: "A palestrante utiliza o uso de respiradores como um dos exemplos de equipamentos que demandam cuidados de alta complexidade.",         topic: "Dispositivos em Atenção Domiciliar",       },       {         question: "22. A decisão de ir para a internação domiciliar é feita por:",         options: [           "a) Apenas o médico.",           "b) O paciente e sua família.",           "c) Uma equipe de saúde.",           "d) O cuidador principal.",           "e) O enfermeiro.",         ],         correctAnswer: "c) Uma equipe de saúde.",         comment: "O texto diz que a decisão de ir para a internação domiciliar é tomada por uma equipe de saúde.",         topic: "Tomada de Decisão para Internação Domiciliar",       },       {         question: "23. O que a transcrição menciona como principal característica de um paciente que está em cuidados básicos?",         options: [           "a) Necessita de cuidado intensivo.",           "b) Está em fase terminal.",           "c) A família consegue manejar a maior parte do cuidado.",           "d) Utiliza respiradores.",           "e) Possui múltiplas sondas.",         ],         correctAnswer: "c) A família consegue manejar a maior parte do cuidado.",         comment: "A Dra. Michele menciona que os cuidados básicos são para pacientes que a família consegue manejar a maior parte do cuidado.",         topic: "Características de Pacientes em Cuidados Básicos",       },       {         question: "24. Qual é o tipo de cuidado intensivo, com equipe de alta complexidade, conforme o resumo da aula?",         options: [           "a) Assistência Domiciliar (AD).",           "b) Internação Domiciliar (ID).",           "c) Visita Domiciliar (VD).",           "d) Cuidados Paliativos.",           "e) Cuidados Prolongados.",         ],         correctAnswer: "b) Internação Domiciliar (ID).",         comment: "O texto classifica a Internação Domiciliar (ID) como cuidado intensivo, com equipe de alta complexidade.",         topic: "Cuidados Intensivos",       },       {         question: "25. A Dra. Michele enfatiza que, em casos de atenção domiciliar de alta complexidade, o paciente não sobrevive sem o cuidado da equipe de:",         options: [           "a) Nutrição.",           "b) Fisioterapia.",           "c) Enfermagem.",           "d) Psicologia.",           "e) Farmácia.",         ],         correctAnswer: "c) Enfermagem.",         comment: "A palestrante destaca que, nesses casos, o paciente não sobrevive sem o cuidado da equipe de enfermagem.",         topic: "Importância da Equipe de Enfermagem",       },       {         question: "26. A Estratégia de Saúde da Família (ESF) realiza qual tipo de cuidado, segundo a transcrição?",         options: [           "a) Internação Domiciliar.",           "b) Atenção Domiciliar de alta complexidade.",           "c) Visita Domiciliar.",           "d) Cuidados Prolongados.",           "e) Cuidados Paliativos.",         ],         correctAnswer: "c) Visita Domiciliar.",         comment: "A aula menciona que a ESF realiza a visita domiciliar.",         topic: "Estratégia de Saúde da Família (ESF)",       },       {         question: "27. O resumo da aula afirma que o enfermeiro tem um papel fundamental no cuidado integral do paciente?",         options: [           "a) Apenas em casos de emergência.",           "b) Apenas na administração de medicamentos.",           "c) Sempre, incluindo a emissão de atestados para acompanhantes.",           "d) Apenas quando o médico não está presente.",           "e) Somente em pacientes acamados.",         ],         correctAnswer: "c) Sempre, incluindo a emissão de atestados para acompanhantes.",         comment: "O texto ressalta o papel fundamental do enfermeiro no cuidado integral, incluindo a emissão de atestados.",         topic: "Cuidado Integral pelo Enfermeiro",       },       {         question: "28. Qual dos seguintes cenários é um exemplo de Cuidados Prolongados?",         options: [           "a) Um paciente que se recupera de uma gripe em casa.",           "b) Um paciente que necessita de hospitalização contínua.",           "c) Um paciente que já teve alta do hospital, mas ainda precisa de cuidados especializados para reabilitação.",           "d) Um paciente que precisa apenas de acompanhamento médico.",           "e) Um paciente que está em cuidados paliativos.",         ],         correctAnswer: "c) Um paciente que já teve alta do hospital, mas ainda precisa de cuidados especializados para reabilitação.",         comment: "O texto define Cuidados Prolongados como sendo para pacientes que, embora não precisem mais de hospital, ainda não podem retornar para casa devido à necessidade de cuidados especializados.",         topic: "Exemplos de Cuidados Prolongados",       },       {         question: "29. Segundo a aula, o que a assistência de enfermagem inclui, além de procedimentos?",         options: [           "a) Apenas a prescrição de dietas.",           "b) O manejo do paciente em todas as suas necessidades, como alimentação, hidratação e higiene.",           "c) Apenas a comunicação com o cuidador principal.",           "d) Apenas a gestão de equipamentos.",           "e) Apenas a medição de sinais vitais.",         ],         correctAnswer: "b) O manejo do paciente em todas as suas necessidades, como alimentação, hidratação e higiene.",         comment: "A palestrante enfatiza que a assistência de enfermagem abrange todas as necessidades do paciente.",         topic: "Abrangência da Assistência de Enfermagem",       },       {         question: "30. A Dra. Michele menciona a necessidade de um técnico de enfermagem ser deslocado para cuidados diários em quais casos?",         options: [           "a) Em todos os casos de visita domiciliar.",           "b) Em casos de baixa complexidade.",           "c) Em casos de alta complexidade.",           "d) Em casos de cuidados paliativos.",           "e) Em casos de cuidados prolongados.",         ],         correctAnswer: "c) Em casos de alta complexidade.",         comment: "O texto discute a necessidade de um técnico de enfermagem para cuidados diários em casos de alta complexidade.",         topic: "Atuação do Técnico de Enfermagem",       },       {         question: "31. O que o caso clínico do paciente com 'superbactéria' reforça?",         options: [           "a) A necessidade de antibióticos mais fortes.",           "b) A importância do isolamento e cuidados especializados.",           "c) A ineficácia da atenção domiciliar.",           "d) A importância de internação hospitalar.",           "e) A necessidade de um plano de cuidados de enfermagem.",         ],         correctAnswer: "b) A importância do isolamento e cuidados especializados.",         comment: "O caso é usado para exemplificar a necessidade de isolamento e cuidados especializados na atenção domiciliar.",         topic: "Casos Clínicos: Superbactérias",       },       {         question: "32. O caso do paciente com lesões de pele é utilizado para ilustrar o que?",         options: [           "a) A importância de uma boa higiene.",           "b) A falta de um plano de cuidados de enfermagem.",           "c) A negligência do cuidador principal.",           "d) A responsabilidade do médico no tratamento.",           "e) A necessidade de mais medicamentos.",         ],         correctAnswer: "b) A falta de um plano de cuidados de enfermagem.",         comment: "A Dra. Michele usa o caso para destacar a importância de um plano de cuidados para prevenir lesões.",         topic: "Casos Clínicos: Lesões de Pele",       },       {         question: "33. Qual é o papel da enfermagem na decisão sobre o plano de cuidados, de acordo com a transcrição?",         options: [           "a) Tomar a decisão final.",           "b) Apenas seguir a vontade do paciente.",           "c) Ser mediadora para garantir o melhor cuidado possível.",           "d) Ignorar a vontade do paciente para seguir o protocolo.",           "e) Apenas documentar a decisão do médico.",         ],         correctAnswer: "c) Ser mediadora para garantir o melhor cuidado possível.",         comment: "A palestrante ressalta que a enfermagem deve atuar como mediadora, respeitando a autonomia do paciente.",         topic: "Enfermagem e a Tomada de Decisão",       },       {         question: "34. A transcrição afirma que a responsabilidade legal do enfermeiro é:",         options: [           "a) Inexistente na atenção domiciliar.",           "b) Apenas seguir as ordens médicas.",           "c) Apenas documentar o que foi feito.",           "d) Proteger-se de possíveis problemas judiciais documentando todas as orientações e recusas.",           "e) Exclusiva do cuidador principal.",         ],         correctAnswer: "d) Proteger-se de possíveis problemas judiciais documentando todas as orientações e recusas.",         comment: "O texto enfatiza a importância da documentação para a proteção legal do enfermeiro.",         topic: "Responsabilidade Legal do Enfermeiro",       },       {         question: "35. A transcrição afirma que os cuidados paliativos se limitam a pacientes em fase terminal.",         options: [           "a) Verdadeiro.",           "b) Falso.",         ],         correctAnswer: "b) Falso.",         comment: "A palestrante explica que os cuidados paliativos não se restringem a pacientes em fase terminal.",         topic: "Conceito de Cuidados Paliativos",       },       {         question: "36. A aula conclui com um lembrete sobre a responsabilidade do profissional de enfermagem em:",         options: [           "a) Subestimar a complexidade dos casos.",           "b) Delegar as tarefas ao cuidador.",           "c) Garantir que o paciente receba o tratamento adequado.",           "d) Priorizar apenas a medicação.",           "e) Evitar casos de alta complexidade.",         ],         correctAnswer: "c) Garantir que o paciente receba o tratamento adequado.",         comment: "A Dra. Michele finaliza reforçando a importância de garantir o tratamento adequado e não subestimar a complexidade dos casos.",         topic: "Responsabilidade Profissional",       },       {         question: "37. Qual a definição de Visita Domiciliar (VD) dada pela transcrição?",         options: [           "a) Um cuidado intensivo.",           "b) Um cuidado de alta complexidade.",           "c) Um cuidado realizado pela Estratégia de Saúde da Família (ESF).",           "d) Um cuidado para pacientes que utilizam respiradores.",           "e) Um cuidado para pacientes que estão se recuperando de um acidente e precisam apenas de apoio.",         ],         correctAnswer: "c) Um cuidado realizado pela Estratégia de Saúde da Família (ESF).",         comment: "O texto classifica a Visita Domiciliar (VD) como aquela realizada pela ESF.",         topic: "Definição de Visita Domiciliar (VD)",       },       {         question: "38. O resumo da aula menciona que a internação domiciliar é um modelo de substituição da internação hospitalar para pacientes que:",         options: [           "a) Não querem mais ir para o hospital.",           "b) Já estão em cuidados paliativos.",           "c) Necessitam de múltiplos equipamentos.",           "d) Têm perfil de alta hospitalar, mas ainda precisam de cuidados que a família não pode prestar sozinha.",           "e) Estão em Cuidados Prolongados.",         ],         correctAnswer: "d) Têm perfil de alta hospitalar, mas ainda precisam de cuidados que a família não pode prestar sozinha.",         comment: "A aula descreve a internação domiciliar como uma opção para pacientes que podem ter alta, mas ainda necessitam de cuidados que a família não consegue oferecer.",         topic: "Internação Domiciliar e Perfil do Paciente",       },       {         question: "39. O que a Dra. Michele menciona como papel da equipe multiprofissional na atenção domiciliar?",         options: [           "a) Apenas prescrever medicamentos.",           "b) Apenas realizar exames.",           "c) Apenas gerenciar os equipamentos.",           "d) A atuação conjunta para o bem-estar do paciente.",           "e) Apenas a comunicação com o cuidador principal.",         ],         correctAnswer: "d) A atuação conjunta para o bem-estar do paciente.",         comment: "A palestrante finaliza a aula ressaltando a importância da articulação entre a equipe de saúde para o bem-estar do paciente.",         topic: "Papel da Equipe Multiprofissional",       },       {         question: "40. A Dra. Michele utiliza a Resolução 509/2016 do COFEN para reforçar qual conceito?",         options: [           "a) O papel do enfermeiro em hospitais.",           "b) A importância do papel do enfermeiro em atenção domiciliar.",           "c) A definição de Cuidados Paliativos.",           "d) A necessidade de documentar o plano de cuidados.",           "e) A autonomia do paciente.",         ],         correctAnswer: "b) A importância do papel do enfermeiro em atenção domiciliar.",         comment: "O texto cita a resolução como diretriz para a atuação do enfermeiro em atenção domiciliar, reforçando seu papel.",         topic: "Resolução COFEN",       }, ];

    function buildQuiz() {
      const output = [];

      questions.forEach((currentQuestion, questionNumber) => {
        const options = [];
        for (let i = 0; i < currentQuestion.options.length; i++) {
          options.push(
            `<label class="option" data-question="${questionNumber}" data-value="${currentQuestion.options[i]}">
              <img src="tesouras.png" class="scissor-icon" onclick="event.stopPropagation(); this.parentNode.classList.toggle('struck-through');">
              ${currentQuestion.options[i]}
            </label>`
          );
        }

        output.push(
          `<div class="card" id="question-${questionNumber}" data-topic="${currentQuestion.topic}">
            <div class="question">${currentQuestion.question}</div>
            <div class="options">${options.join("")}</div>
            <div class="comment" id="comment-${questionNumber}"></div>
          </div>`
        );
      });

      quizContainer.innerHTML = output.join("");
    }

    function showResults() {
      wrongQuestionIndices = [];
      errorCountByTopic = {};
      totalAnsweredQuestionsByTopic = {};
      currentWrongQuestionIndex = -1;
      hasErrors = false;
      isShowingErrors = false;
      isShowingDiagnosis = false;

      errorDiagnosisSection.style.display = 'none';
      topicsToReviewList.innerHTML = '';
      statusMessage.textContent = '';

      // Busca por todas as perguntas: estáticas e dinâmicas
      const allQuestionCards = document.querySelectorAll('.quiz-container .card, #newQuestionsContent .card');
      let correctAnswersCount = 0;
      let totalQuestionsAnswered = 0;

      console.log('🔍 Verificando', allQuestionCards.length, 'perguntas...');

      allQuestionCards.forEach((card, index) => {
        const questionEl = card.querySelector('.question') || card.querySelector('p');
        if (!questionEl) return;

        const questionText = questionEl.textContent.trim();
        const optionsContainer = card.querySelector('.options') || card;
        const allOptions = optionsContainer.querySelectorAll('.option, label.option, label');
        const userAnswerElement = optionsContainer.querySelector('.option.selected, label.selected');
        const commentDiv = card.querySelector('.comment');

        const questionTopic = card.dataset.topic || "Tópico não informado";
        
        console.log(`📝 Pergunta ${index + 1}: Tópico = "${questionTopic}"`);
        console.log(`🔍 Encontradas ${allOptions.length} alternativas`);
        
        // Remove classes anteriores
        allOptions.forEach(option => {
          option.classList.remove('correct', 'incorrect', 'selected');
        });
        if (commentDiv) commentDiv.classList.remove('show');

        let correctAnswerValue = null;
        let questionComment = null;

        // Verifica se é pergunta estática ou dinâmica
        const isStatic = card.id && card.id.startsWith('question-');
        if (isStatic) {
          // Pergunta estática - busca nos dados originais
          const questionData = questions.find(q => q.question.trim() === questionText);
          if (questionData) {
            correctAnswerValue = questionData.correctAnswer.trim();
            questionComment = questionData.comment;
          }
        } else {
          // Pergunta dinâmica - busca pela opção marcada como correta
          const correctOpt = optionsContainer.querySelector('.option[data-answer="true"], label[data-answer="true"]');
          if (correctOpt) {
            correctAnswerValue = correctOpt.dataset.value?.trim() || correctOpt.textContent.trim();
            console.log(`✅ Resposta correta encontrada: "${correctAnswerValue}"`);
          } else {
            console.log('❌ Nenhuma resposta correta encontrada para pergunta dinâmica');
          }
          
          // Busca comentário no próprio card ou no div comment
          const commentElement = card.querySelector('.comment');
          if (commentElement && commentElement.textContent.trim()) {
            questionComment = commentElement.textContent.trim();
          }
        }

        // Processa resposta do usuário e aplica coloração
        let userAnswer = null;
        if (userAnswerElement) {
          userAnswerElement.classList.add('selected');
          userAnswer = userAnswerElement.dataset.value?.trim() || userAnswerElement.textContent.trim();
          totalQuestionsAnswered++;
          totalAnsweredQuestionsByTopic[questionTopic] = (totalAnsweredQuestionsByTopic[questionTopic] || 0) + 1;

          console.log(`👤 Resposta do usuário: "${userAnswer}"`);
          console.log(`🎯 Resposta correta: "${correctAnswerValue}"`);

          // Verifica se a resposta está correta
          if (userAnswer === correctAnswerValue) {
            correctAnswersCount++;
            console.log(`✅ Resposta correta!`);
          } else {
            hasErrors = true;
            errorCountByTopic[questionTopic] = (errorCountByTopic[questionTopic] || 0) + 1;
            console.log(`❌ Resposta incorreta para tópico: ${questionTopic}`);
          }
        }

        // Aplica coloração: SEMPRE marca a correta de verde, e a errada de vermelho se foi marcada
        allOptions.forEach(option => {
          const optionValue = option.dataset.value?.trim() || option.textContent.trim();
          
          // Marca a resposta correta de verde SEMPRE
          if (optionValue === correctAnswerValue) {
            option.classList.add('correct');
            console.log(`🟢 Marcando como correta: "${optionValue}"`);
          }
          
          // Se o usuário marcou uma resposta E ela está errada, marca de vermelho
          if (userAnswer && optionValue === userAnswer && userAnswer !== correctAnswerValue) {
            option.classList.add('incorrect');
            console.log(`🔴 Marcando como incorreta: "${optionValue}"`);
          }
        });

        // Mostra comentário se disponível
        if (commentDiv && questionComment) {
          commentDiv.textContent = questionComment;
          commentDiv.classList.add('show');
        }
      });

      // Exibe resultados
      resultsContainer.textContent = `Você acertou ${correctAnswersCount} de ${totalQuestionsAnswered} questões respondidas.`;

      console.log('📊 Erros por tópico:', errorCountByTopic);
      console.log('📊 Total por tópico:', totalAnsweredQuestionsByTopic);

      // Gera diagnóstico de erros
      if (hasErrors) {
        for (const topic in errorCountByTopic) {
          const errors = errorCountByTopic[topic];
          const total = totalAnsweredQuestionsByTopic[topic] || 0;
          if (total > 0) {
            const percent = ((errors / total) * 100).toFixed(1);
            const li = document.createElement('li');
            li.textContent = `${topic}: ${percent}% de erros (${errors} de ${total} questões respondidas)`;
            topicsToReviewList.appendChild(li);
          }
        }
      } else {
        const li = document.createElement('li');
        li.textContent = "🥳 Parabéns! Você não teve erros nas questões respondidas.";
        topicsToReviewList.appendChild(li);
      }

      errorDiagnosisSection.style.display = 'block';
      generatedQuestionsSection.style.display = 'block';
      generateNewQuestionsBtn.style.display = 'block';
      scrollToDiagnosis();
    }

    function scrollToQuestion(index) {
      const questionCard = document.getElementById(`question-${index}`);
      if (questionCard) {
        questionCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }
    }

    function scrollToDiagnosis() {
        errorDiagnosisSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    function scrollToGeneratedQuestions() {
        generatedQuestionsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    // Event listener para seleção de opções (funciona para estáticas e dinâmicas)
    document.addEventListener("click", function (event) {
      const clickedElement = event.target;
      const optionElement = clickedElement.closest('.option');

      if (optionElement) {
          if (clickedElement.classList.contains("scissor-icon")) {
              event.stopPropagation();
              optionElement.classList.toggle("struck-through");
          }
          else {
              const parentCard = optionElement.closest('.card');
              const currentQuestionOptions = parentCard.querySelectorAll('.option');

              currentQuestionOptions.forEach(opt => opt.classList.remove("selected"));
              optionElement.classList.add("selected");
          }
      }
    });

    generateNewQuestionsBtn.addEventListener("click", async function() {
        statusMessage.textContent = '⏳ Gerando novas perguntas...';
        generateNewQuestionsBtn.disabled = true;

        const topics = Object.keys(errorCountByTopic).filter(topic => {
            const errorsInTopic = errorCountByTopic[topic] || 0;
            const totalAnsweredInTopic = totalAnsweredQuestionsByTopic[topic] || 0;
            return errorsInTopic > 0 && totalAnsweredInTopic > 0;
        });

        const topicsToSend = topics.length > 0 ? topics : ["fisiologia celular", "biologia"];

        try {
            const response = await fetch('https://www.quizia.xyz/quiz', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ topicos: topicsToSend }),
            });

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const data = await response.json();

            newQuestionsContent.innerHTML = '';
            if (data && data.html) {
                console.log('📥 HTML recebido do Flask:', data.html);
                
                // Insere o HTML diretamente sem reconstrução complexa
                newQuestionsContent.innerHTML = data.html.replace(/```html|```/g, '');
                
                // Adiciona tesouras e ajusta formatação apenas se necessário
                newQuestionsContent.querySelectorAll('.card').forEach((card, cardIndex) => {
                    // Garante que o elemento de pergunta tenha a classe correta
                    const questionElement = card.querySelector('p');
                    if (questionElement && !questionElement.classList.contains('question')) {
                       questionElement.classList.add('question');
                    }

                    // Remove qualquer input de radio que possa existir e adiciona tesouras
                    card.querySelectorAll('label').forEach((label) => {
                        // Remove inputs de radio MAS preserva o atributo data-answer
                        const radioInput = label.querySelector('input[type="radio"]');
                        if (radioInput) {
                            // PRESERVA o atributo data-answer do input no label
                            if (radioInput.hasAttribute('data-answer')) {
                                label.setAttribute('data-answer', radioInput.getAttribute('data-answer'));
                            }
                            radioInput.remove();
                        }
                        
                        // Garante que tenha a classe option
                        if (!label.classList.contains('option')) {
                            label.classList.add('option');
                        }

                        // Garante que tenha data-value
                        if (!label.dataset.value) {
                            label.dataset.value = label.textContent.trim();
                        }

                        // Adiciona tesoura se não existir
                        if (!label.querySelector('.scissor-icon')) {
                            const scissorIcon = document.createElement('img');
                            scissorIcon.src = 'tesouras.png';
                            scissorIcon.className = 'scissor-icon';
                            scissorIcon.onclick = function(e) {
                                e.stopPropagation();
                                label.classList.toggle('struck-through');
                            };
                            label.insertBefore(scissorIcon, label.firstChild);
                        }
                    });

                    console.log(`🏷️ Card ${cardIndex}: data-topic = "${card.dataset.topic}"`);
                    
                    // Verifica se há opção correta marcada
                    const correctOption = card.querySelector('label[data-answer="true"]');
                    if (correctOption) {
                        console.log(`✅ Opção correta encontrada: "${correctOption.dataset.value}"`);
                    } else {
                        console.log('❌ Nenhuma opção correta encontrada');
                    }
                });
            } else {
                newQuestionsContent.innerHTML = "<p>Não foi possível gerar novas perguntas para os tópicos selecionados.</p>";
            }
            
            generatedQuestionsSection.style.display = 'block';
            scrollToGeneratedQuestions();
            statusMessage.textContent = '✅ Perguntas geradas com sucesso!';
            setTimeout(() => { statusMessage.textContent = '' }, 3000);

        } catch (error) {
            console.error('Erro ao gerar novas perguntas:', error);
            newQuestionsContent.innerHTML = `<p>Erro ao carregar novas perguntas: ${error.message}. Por favor, tente novamente.</p>`;
            generatedQuestionsSection.style.display = 'block';
            scrollToGeneratedQuestions();
            statusMessage.textContent = '❌ Erro na requisição: ' + error.message;
            setTimeout(() => { statusMessage.textContent = '' }, 5000);
        } finally {
            generateNewQuestionsBtn.disabled = false;
        }
    });

    // Inicialização
    buildQuiz();
    errorDiagnosisSection.style.display = 'none';
    generatedQuestionsSection.style.display = 'none';
    generateNewQuestionsBtn.style.display = 'none';

    // Event listener para o botão de verificar respostas
    document.getElementById("verifyAnswersBtn").addEventListener("click", showResults);
  </script>
</body>
</html>
