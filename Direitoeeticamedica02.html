<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>Simulado de Direito e Ética Médica</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      background-color: #f4f4f4;
    }

    .quiz-container {
      max-width: 800px;
      width: 100%;
    }

    h1 {
      color: #333;
      text-align: center;
      margin-bottom: 30px;
    }

    .card {
      background-color: white;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .question {
      font-weight: bold;
      margin-bottom: 10px;
      color: #333;
    }

    .options {
      margin-top: 15px;
    }

    /* Estilos unificados para todas as opções (estáticas e dinâmicas) */
    .option, label.option, label, #newQuestionsContent label {
      display: flex; /* Para alinhar imagem e texto */
      align-items: center;
      margin-bottom: 10px;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.2s ease;
      position: relative; /* Para posicionar a tesoura */
    }

    /* FORÇA a remoção de inputs de radio em QUALQUER lugar */
    .option input[type="radio"], 
    label input[type="radio"],
    #newQuestionsContent input[type="radio"],
    #newQuestionsContent label input[type="radio"] {
        display: none !important;
        visibility: hidden !important;
        opacity: 0 !important;
        position: absolute !important;
        left: -9999px !important;
    }

    .option:hover, 
    label.option:hover, 
    label:hover,
    #newQuestionsContent label:hover {
      background-color: #e9e9e9;
    }

    .option.selected, 
    label.option.selected, 
    label.selected,
    #newQuestionsContent label.selected {
      background-color: #d1e7dd;
      border-color: #28a745;
    }

    .option.correct, 
    label.option.correct, 
    label.correct,
    #newQuestionsContent label.correct {
      background-color: #d4edda;
      border-color: #28a745;
    }

    .option.incorrect, 
    label.option.incorrect, 
    label.incorrect,
    #newQuestionsContent label.incorrect {
      background-color: #f8d7da;
      border-color: #dc3545;
    }

    .submit-btn {
      display: block;
      width: 100%;
      padding: 15px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 18px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      margin-top: 30px;
    }

    .submit-btn:hover {
      background-color: #0056b3;
    }

    .results {
      text-align: center;
      margin-top: 30px;
      font-size: 20px;
      font-weight: bold;
      color: #333;
    }

    .scissor-icon {
      margin-right: 10px; /* Espaço entre a tesoura e o texto da opção */
      width: 20px; /* Ajuste conforme o tamanho da sua imagem */
      height: 20px; /* Ajuste conforme o tamanho da sua imagem */
      opacity: 0.5; /* Transparência como no original */
      cursor: pointer;
    }

    .scissor-icon.hidden {
      display: none;
    }

    .struck-through {
      text-decoration: line-through;
      color: #888;
    }

    .comment {
      margin-top: 10px;
      padding: 10px;
      background-color: #f0f0f0;
      border-left: 4px solid #007bff;
      font-style: italic;
      color: #555;
      display: none; /* Escondido por padrão */
    }
    .comment.show {
      display: block; /* Mostrado quando ativado */
    }

    /* Estilos para o botão de navegação de erro / diagnóstico */
    .error-nav-btn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: #dc3545; /* Vermelho para erro */
      color: white;
      border: none;
      border-radius: 50%; /* Torna o botão redondo */
      width: 60px;
      height: 60px;
      font-size: 24px;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      z-index: 1000;
      display: none; /* Escondido por padrão */
      flex-direction: column; /* Para empilhar o ícone e o contador */
      padding: 5px; /* Ajuste o padding para acomodar texto maior */
      box-sizing: border-box; /* Garante que padding não aumente o tamanho total */
      text-align: center;
    }

    .error-nav-btn:hover {
      background-color: #c82333;
    }

    .error-nav-btn .arrow-icon {
      font-size: 30px; /* Tamanho da seta */
      line-height: 1; /* Ajuste para centralizar */
    }

    .error-nav-btn .button-text {
      font-size: 12px; /* Tamanho do texto abaixo da seta */
      line-height: 1;
      margin-top: 2px; /* Espaço entre a seta e o texto */
    }

    /* Estilos para a seção de diagnóstico de erros */
    .error-diagnosis-section {
        margin-top: 50px;
        padding: 30px;
        background-color: #ffe0b2; /* Um laranja claro ou similar */
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.15);
        display: none; /* Escondido por padrão */
        text-align: center;
        font-size: 1.1em;
        color: #333;
    }

    .error-diagnosis-section h2 {
        color: #e65100; /* Laranja mais escuro */
        margin-bottom: 20px;
        font-size: 1.8em;
    }

    .error-diagnosis-section ul {
        list-style: none; /* Remove marcadores de lista */
        padding: 0;
        margin: 0;
    }

    .error-diagnosis-section li {
        background-color: #ff9800; /* Laranja */
        color: white;
        padding: 8px 15px;
        margin: 8px 0;
        border-radius: 5px;
        display: inline-block; /* Para que os itens fiquem lado a lado */
        margin-right: 10px;
        font-weight: bold;
    }
    .error-diagnosis-section li:last-child {
        margin-right: 0;
    }
 .card-bloco {
      border: 1px solid #ddd;
      border-radius: 6px;
      padding: 10px;
      background: #fff;
      margin-bottom: 20px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    }
  </style>
</head>
<body>
  <div class="quiz-container">
    <h1 style="text-align:center; margin-bottom: 30px;">Simulado de Direito e Ética Médica</h1>
    <div class="card-bloco" id="quiz"></div>
    <button class="submit-btn" id="verifyAnswersBtn">Verificar Respostas</button>

    <button class="generate-questions-btn submit-btn" id="generateNewQuestionsBtn" style="display:none;">
      Gerar Novas Perguntas
    </button>

    <div class="results card-bloco" id="results"></div>
    <div id="statusMessage" style="text-align: center; margin-top: 10px; font-weight: bold; color: #007bff;"></div>

    <div class="error-diagnosis-section card-bloco" id="errorDiagnosis">
      <h2>Diagnóstico de Erros</h2>
      <p>Parece que você precisa revisar os seguintes assuntos:</p>
      <ul id="topicsToReview"></ul>
    </div>

    <div class="generated-questions-section card-bloco" id="generatedQuestionsSection" style="display:none;">
      <h2>Novas Perguntas Geradas</h2>
      <div id="newQuestionsContent"></div>
    </div>
  </div>
  
  <button class="error-nav-btn" id="errorNavBtn" style="display:none;">
    <span class="arrow-icon"></span>
    <span class="button-text"></span>
  </button>

  <script>
    const quizContainer = document.getElementById("quiz");
    const resultsContainer = document.getElementById("results");
    const errorNavBtn = document.getElementById("errorNavBtn");
    const arrowIcon = errorNavBtn.querySelector(".arrow-icon");
    const buttonText = errorNavBtn.querySelector(".button-text");
    const errorDiagnosisSection = document.getElementById("errorDiagnosis");
    const topicsToReviewList = document.getElementById("topicsToReview");
    const generateNewQuestionsBtn = document.getElementById("generateNewQuestionsBtn");
    const generatedQuestionsSection = document.getElementById("generatedQuestionsSection");
    const newQuestionsContent = document.getElementById("newQuestionsContent");
    const statusMessage = document.getElementById("statusMessage");

    let wrongQuestionIndices = [];
    let errorCountByTopic = {};
    let totalAnsweredQuestionsByTopic = {};
    let currentWrongQuestionIndex = -1;
    let hasErrors = false;
    let isShowingErrors = false;
    let isShowingDiagnosis = false;

    // Inicializa a visibilidade das seções no carregamento
    errorDiagnosisSection.style.display = 'none';
    topicsToReviewList.innerHTML = '';
    statusMessage.textContent = '';

    const questions = [     {       question: "1. Qual a principal temática abordada pela aula sob a perspectiva do direito?",       options: [         "A história da medicina no Brasil.",         "A responsabilidade do profissional de medicina.",         "Novas tecnologias em cirurgia.",         "O funcionamento do sistema público de saúde.",         "A ética jornalística.",       ],       correctAnswer: "A responsabilidade do profissional de medicina.",       comment: "A aula foca na responsabilidade do profissional de medicina sob a perspectiva do direito, sendo o erro médico um assunto de grande impacto [1].",       topic: "Introdução à Responsabilidade Médica",     },     {       question: "2. Que tipo de recurso o professor sugere que os alunos utilizem para pesquisar decisões judiciais sobre responsabilidade médica?",       options: [         "Livros de medicina.",         "Bases de dados jurídicas.",         "Entrevistas com pacientes.",         "Revistas científicas.",         "Documentários sobre direito.",       ],       correctAnswer: "Bases de dados jurídicas.",       comment: "O professor sugere que os alunos utilizem bases de dados jurídicas para pesquisar decisões sobre o tema, usando termos como “médico” e a especialidade escolhida [1].",       topic: "Pesquisa de Jurisprudência em Direito Médico",     },     {       question: "3. A responsabilidade do médico decorre de qual princípio legal?",       options: [         "O direito à saúde universal.",         "O dever de sigilo profissional.",         "O direito, que determina que um profissional que pratica um ato ilícito deve responder por ele.",         "A autonomia do paciente.",         "O juramento de Hipócrates.",       ],       correctAnswer: "O direito, que determina que um profissional que pratica um ato ilícito deve responder por ele.",       comment: "A responsabilidade do médico decorre do direito, que determina que um profissional que pratica um ato ilícito deve responder por ele [1].",       topic: "Princípios Legais da Responsabilidade Profissional",     },     {       question: "4. Quais são os dois tipos de responsabilidade que podem ser aplicados ao médico no contexto de erro médico?",       options: [         "Administrativa e Disciplinar.",         "Moral e Social.",         "Civil e Criminal.",         "Ética e Filosófica.",         "Patrimonial e Fiscal.",       ],       correctAnswer: "Civil e Criminal.",       comment: "No contexto de erro médico, existem dois tipos de responsabilidade: civil e criminal. Ambas podem ser aplicadas ao médico e decorrer de um mesmo fato [2].",       topic: "Esferas da Responsabilidade Médica: Civil e Criminal",     },     {       question: "5. O que caracteriza a responsabilidade civil no caso de erro médico?",       options: [         "A imposição de uma pena de prisão.",         "A obrigação de pagar uma indenização à vítima.",         "A suspensão do registro profissional.",         "A advertência formal.",         "O serviço comunitário.",       ],       correctAnswer: "A obrigação de pagar uma indenização à vítima.",       comment: "A responsabilidade civil é a obrigação de pagar uma indenização à vítima do suposto erro médico [2].",       topic: "Responsabilidade Civil: Indenização por Dano",     },     {       question: "6. Qual é a característica principal da responsabilidade criminal para o médico?",       options: [         "Pagamento de multas administrativas.",         "Imposição de uma pena por um crime cometido, como homicídio culposo.",         "Perda da licença para praticar a medicina.",         "A realização de cursos de aperfeiçoamento.",         "A retratação pública.",       ],       correctAnswer: "Imposição de uma pena por um crime cometido, como homicídio culposo.",       comment: "A responsabilidade criminal é a imposição de uma pena por um crime cometido, como homicídio culposo por negligência, imprudência ou imperícia [2].",       topic: "Responsabilidade Criminal: Crimes Culposos na Medicina",     },     {       question: "7. Qual é a base legal para a responsabilidade civil no direito, segundo o Código Civil?",       options: [         "O contrato de prestação de serviços.",         "O ato ilícito, definido no artigo 186 do Código Civil.",         "A lei de proteção ao consumidor.",         "O código de ética médica.",         "A Constituição Federal.",       ],       correctAnswer: "O ato ilícito, definido no artigo 186 do Código Civil.",       comment: "A base legal para a responsabilidade civil no direito é o ato ilícito, definido no artigo 186 do Código Civil [2].",       topic: "O Ato Ilícito no Código Civil (Art. 186)",     },     {       question: "8. Para que um ato seja considerado ilícito, quais são as condições necessárias de acordo com o Art. 186 do Código Civil?",       options: [         "Que envolva apenas dano moral.",         "Que ocorra quando alguém, agindo de forma ativa ou passiva, com dolo ou culpa, viola um direito de outra pessoa e causa um dano.",         "Que seja intencional, sem exceções.",         "Que não envolva omissão.",         "Que cause exclusivamente dano material.",       ],       correctAnswer: "Que ocorra quando alguém, agindo de forma ativa ou passiva, com dolo ou culpa, viola um direito de outra pessoa e causa um dano.",       comment: "O ato ilícito ocorre quando alguém, agindo de forma ativa ou passiva, com dolo ou culpa, viola um direito de outra pessoa e causa um dano [2].",       topic: "Elementos do Ato Ilícito: Ação, Culpa, Dano e Violação de Direito",     },     {       question: "9. Como é, por regra, a responsabilidade do médico?",       options: ["Objetiva.", "Solidária.", "Subsidiária.", "Subjetiva.", "Absoluta."],       correctAnswer: "Subjetiva.",       comment: "A responsabilidade do médico é, por regra, subjetiva, ou seja, é necessário comprovar a culpa ou o dolo do profissional [3].",       topic: "Responsabilidade Subjetiva do Profissional Liberal",     },     {       question: "10. Em relação à responsabilidade, como se aplica a responsabilidade objetiva no contexto médico?",       options: [         "Aplica-se ao médico em todos os casos.",         "É exceção e aplica-se ao hospital, não ao médico.",         "Aplica-se somente em casos de imprudência.",         "É a regra para todos os profissionais de saúde.",         "Não existe responsabilidade objetiva no direito médico.",       ],       correctAnswer: "É exceção e aplica-se ao hospital, não ao médico.",       comment: "A responsabilidade objetiva é exceção e, nesse caso, aplica-se ao hospital, não ao médico [3].",       topic: "Responsabilidade Objetiva de Hospitais e Clínicas",     },     {       question: "11. Quais são os quatro elementos essenciais para que haja a responsabilização do médico?",       options: [         "Intenção, resultado, tempo e local.",         "Conduta, Violação de dever, Dano e Nexo de causalidade.",         "Exame, diagnóstico, tratamento e prognóstico.",         "Consentimento, sigilo, ética e lei.",         "Experiência, conhecimento, reputação e habilidade.",       ],       correctAnswer: "Conduta, Violação de dever, Dano e Nexo de causalidade.",       comment: "Para que haja a responsabilização do médico, é preciso que quatro elementos estejam presentes: 1. Conduta; 2. Violação de dever; 3. Dano; 4. Nexo de causalidade [3-5].",       topic: "Pressupostos da Responsabilidade Civil Médica",     },     {       question: "12. O que pode impedir a responsabilização do médico, mesmo que um dano tenha ocorrido?",       options: [         "A idade avançada do paciente.",         "A ausência de qualquer um dos quatro elementos de responsabilização.",         "A complexidade do procedimento.",         "A falta de seguro profissional.",         "O testemunho de outros médicos.",       ],       correctAnswer: "A ausência de qualquer um dos quatro elementos de responsabilização.",       comment: "A ausência de qualquer um desses elementos pode impedir a responsabilização do médico [4].",       topic: "Excludentes da Responsabilidade Médica",     },     {       question: "13. Em qual dos quatro elementos de responsabilização muitos processos por erro médico são decididos?",       options: ["Conduta.", "Violação de dever.", "Dano.", "Nexo de causalidade.", "Intenção."],       correctAnswer: "Nexo de causalidade.",       comment: "É justamente no nexo de causalidade que muitos processos por erro médico são decididos [4].",       topic: "Nexo de Causalidade no Erro Médico",     },     {       question: "14. Qual das seguintes descrições corresponde à negligência como forma de conduta culposa?",       options: [         "Conduta ativa precipitada ou sem as devidas cautelas.",         "Falta de conhecimento técnico necessário para a realização de um ato.",         "Omissão, ausência de uma ação que deveria ter sido tomada ou agir de forma menos diligente do que o esperado.",         "Ação deliberada para causar dano.",         "Atuação dentro dos padrões éticos e técnicos.",       ],       correctAnswer: "Omissão, ausência de uma ação que deveria ter sido tomada ou agir de forma menos diligente do que o esperado.",       comment: "Negligência é a omissão, ausência de uma ação que deveria ter sido tomada ou agir de forma menos diligente do que o esperado [4-6].",       topic: "Modalidades de Culpa: Negligência",     },     {       question: "15. A imprudência é caracterizada por qual tipo de conduta?",       options: [         "Omissão de um dever de agir.",         "Desconhecimento técnico evidente.",         "Conduta ativa precipitada ou sem as devidas cautelas.",         "Falta de supervisão adequada.",         "Ação baseada em conhecimento obsoleto.",       ],       correctAnswer: "Conduta ativa precipitada ou sem as devidas cautelas.",       comment: "Imprudência é uma conduta ativa precipitada ou sem as devidas cautelas [5-7]. Também é definida como um comportamento ativo e descuidado, marcado por precipitação ou excesso de rapidez [5] ou a prática de uma conduta perigosa ou sem a devida cautela [6].",       topic: "Modalidades de Culpa: Imprudência",     },     {       question: "16. O que define a imperícia no contexto da responsabilidade médica?",       options: [         "Ação com excesso de zelo.",         "Falta de conhecimento técnico necessário para a realização de um ato.",         "A omissão de um dever.",         "Uma conduta ativa e descuidada.",         "Erro de julgamento em situação de emergência.",       ],       correctAnswer: "Falta de conhecimento técnico necessário para a realização de um ato.",       comment: "Imperícia é a falta de conhecimento técnico necessário para a realização de um ato [7-9].",       topic: "Modalidades de Culpa: Imperícia",     },     {       question: "17. Qual é o principal fundamento para processos de erro médico, segundo o professor?",       options: ["Negligência.", "Imprudência.", "Imperícia.", "Dolo.", "Falta de consentimento informado."],       correctAnswer: "Imperícia.",       comment: "O professor destaca que o principal fundamento para processos de erro médico é a imperícia [7].",       topic: "Prevalência da Imperícia em Processos de Erro Médico",     },     {       question: "18. Como é a responsabilidade do hospital ou da clínica, em contraste com a do médico?",       options: ["Subjetiva.", "Exclusiva.", "Objetiva.", "Compartilhada.", "Secundária."],       correctAnswer: "Objetiva.",       comment: "A responsabilidade do hospital ou da clínica é objetiva [7].",       topic: "Diferença entre Responsabilidade Médica e Hospitalar",     },     {       question: "19. O que significa a responsabilidade objetiva do hospital no processo judicial?",       options: [         "É necessário provar dolo ou culpa do hospital.",         "Não é necessário provar dolo ou culpa, mas apenas se o dano ocorreu e se o hospital era responsável pela guarda e cuidado do paciente.",         "O hospital é sempre culpado, independentemente das circunstâncias.",         "A responsabilidade é sempre transferida para o médico.",         "Apenas o médico pode ser processado.",       ],       correctAnswer: "Não é necessário provar dolo ou culpa, mas apenas se o dano ocorreu e se o hospital era responsável pela guarda e cuidado do paciente.",       comment: "No processo contra o hospital, não é necessário provar dolo ou culpa, mas apenas se o dano ocorreu e se ele era o responsável pela guarda e cuidado do paciente [7].",       topic: "Aplicação da Responsabilidade Objetiva Hospitalar",     },     {       question: "20. De que forma o hospital pode ser eximido de responsabilidade?",       options: [         "Se o dano for atribuído exclusivamente à vítima ou a um terceiro.",         "Se o médico responsável tiver seguro.",         "Se o hospital for uma instituição pública.",         "Se o paciente assinar um termo de responsabilidade.",         "Se a equipe médica for considerada competente.",       ],       correctAnswer: "Se o dano for atribuído exclusivamente à vítima ou a um terceiro.",       comment: "A única forma de o hospital ser eximido de responsabilidade é se o dano for atribuído exclusivamente à vítima ou a um terceiro [7].",       topic: "Excludentes da Responsabilidade Hospitalar",     },     {       question: "21. Para que o hospital seja responsabilizado por um erro do médico, qual condição deve ser cumprida primeiramente?",       options: [         "A obtenção de um laudo pericial.",         "A comprovação da culpa do profissional.",         "A existência de um contrato entre paciente e hospital.",         "A declaração de emergência.",         "A apresentação de um plano de tratamento.",       ],       correctAnswer: "A comprovação da culpa do profissional.",       comment: "Para que o hospital seja responsabilizado por um erro do médico, é preciso primeiro comprovar a culpa do profissional [5].",       topic: "Responsabilidade Hospitalar por Ato de Médico",     },     {       question: "22. Segundo o professor, o que não se trata de imperícia, mesmo que exista desconhecimento em algum ponto da doutrina médica?",       options: [         "Qualquer desconhecimento.",         "Um erro crasso, evidente.",         "Um desvio da técnica médica preconizada.",         "Caso exista dúvida razoável na doutrina médica sobre determinado ponto.",         "Uma falha na execução de um procedimento simples.",       ],       correctAnswer: "Caso exista dúvida razoável na doutrina médica sobre determinado ponto.",       comment: "O professor ressalta que não se trata de qualquer desconhecimento, mas de um erro crasso, evidente, que desvia da técnica médica preconizada. Caso exista dúvida razoável na doutrina médica sobre determinado ponto, não há imperícia [8].",       topic: "Limites da Configuração da Imperícia",     },     {       question: "23. Como o erro médico é concluído pelo professor?",       options: [         "Como qualquer evento adverso.",         "Como o descumprimento de um dever técnico que causa dano ao paciente, seja por dolo ou culpa.",         "Como a falha em obter um resultado satisfatório.",         "Como a insatisfação do paciente.",         "Como a diferença de opiniões entre profissionais.",       ],       correctAnswer: "Como o descumprimento de um dever técnico que causa dano ao paciente, seja por dolo ou culpa.",       comment: "O professor conclui reforçando que o erro médico é o descumprimento de um dever técnico que causa dano ao paciente, seja por dolo ou culpa [8].",       topic: "Definição Jurídica de Erro Médico",     },     {       question: "24. Por que o médico deve estar atento às questões de responsabilidade e saber argumentar sobre elas?",       options: [         "Para evitar processos de qualquer tipo.",         "Porque sua defesa depende de saber argumentar sobre esses pontos.",         "Para impressionar seus colegas.",         "Para nunca precisar de um advogado.",         "Para escrever livros sobre o assunto.",       ],       correctAnswer: "Porque sua defesa depende de saber argumentar sobre esses pontos.",       comment: "O médico deve estar atento a essas questões, pois, ao ser processado, sua defesa depende de saber argumentar sobre esses pontos, e não apenas deixar a cargo de um advogado sem conhecimento técnico específico [10].",       topic: "A Defesa Técnica do Médico em Processos",     },     {       question: "25. Em caso de dúvida, como a justiça tende a se posicionar em processos envolvendo médicos?",       options: [         "A favorecer o paciente.",         "A favorecer o hospital.",         "A favorecer o médico.",         "A ser neutra, sem tendência.",         "A buscar um acordo extrajudicial.",       ],       correctAnswer: "A favorecer o médico.",       comment: "O professor enfatiza que é comum um médico ser processado, mesmo que tenha agido corretamente, e que, na dúvida, a justiça tende a favorecer o médico [10].",       topic: "Posicionamento Judicial em Ações de Erro Médico",     },     {       question: "26. Qual dilema ético é usado como ponto de partida na aula sobre ética médica?",       options: [         "O 'Dilema do Prisioneiro'.",         "O 'Problema do Bonde'.",         "O 'Paradoxo de Epimênides'.",         "O 'Problema da Torre de Hanói'.",         "O 'Dilema do Ouriço'.",       ],       correctAnswer: "O 'Problema do Bonde'.",       comment: "O trecho inicial da aula discute dilemas éticos, usando o 'Problema do Bonde' como ponto de partida [11].",       topic: "Dilemas Éticos na Medicina: O Problema do Bonde",     },     {       question: "27. Qual a distinção crucial discutida na aula, utilizando o 'Problema do Bonde' como base?",       options: [         "Entre teoria e prática.",         "Entre postura passiva (não agir e permitir um resultado) e postura ativa (agir para causar um resultado).",         "Entre intenção e consequência.",         "Entre ética pessoal e profissional.",         "Entre responsabilidade individual e coletiva.",       ],       correctAnswer: "Entre postura passiva (não agir e permitir um resultado) e postura ativa (agir para causar um resultado).",       comment: "A discussão se aprofunda na distinção entre uma postura passiva (não agir e permitir um resultado) e uma postura ativa (agir para causar um resultado) [11].",       topic: "Ação vs. Omissão em Dilemas Éticos",     },     {       question: "28. Qual cenário médico é usado pelo Dr. Pedro para ilustrar o 'Problema do Bonde'?",       options: [         "Cinco pessoas precisam de transplantes urgentes e uma pessoa saudável chega ao pronto-socorro.",         "A escolha entre dois tratamentos igualmente eficazes.",         "Um médico que precisa decidir qual paciente atender primeiro em uma emergência.",         "O dilema de informar ou não um diagnóstico grave a um paciente.",         "A decisão de manter ou não um paciente em suporte de vida.",       ],       correctAnswer: "Cinco pessoas precisam de transplantes urgentes e uma pessoa saudável chega ao pronto-socorro.",       comment: "O Dr. Pedro ilustra o problema com um cenário médico: cinco pessoas precisam de transplantes urgentes e uma pessoa saudável chega ao pronto-socorro [11].",       topic: "Aplicação de Dilemas Éticos a Cenários Médicos",     },     {       question: "29. Qual a crítica feita à lógica de 'maior número de salvamentos' no cenário médico apresentado?",       options: [         "Que ela é muito complexa para ser aplicada.",         "Que ela leva a um impasse ético, sendo puramente numérica ou utilitarista.",         "Que ela é a única abordagem correta em medicina.",         "Que ela desconsidera o custo dos tratamentos.",         "Que ela não é prática em situações de emergência.",       ],       correctAnswer: "Que ela leva a um impasse ético, sendo puramente numérica ou utilitarista.",       comment: "A aula enfatiza que essa abordagem, puramente numérica ou utilitarista, leva a um impasse ético [12].",       topic: "Crítica à Ética Utilitarista na Medicina",     },     {       question: "30. Qual conceito ético o palestrante introduz para contrapor a visão utilitarista?",       options: [         "A ética da virtude.",         "A ética consequencialista.",         "A ética deontológica.",         "O relativismo moral.",         "O utilitarismo.",       ],       correctAnswer: "A ética deontológica.",       comment: "Para contrapor essa visão, o palestrante introduz o conceito da ética deontológica [12].",       topic: "Introdução à Ética Deontológica",     },     {       question: "31. No que a deontologia foca, segundo a explicação do palestrante?",       options: [         "Nas consequências das ações.",         "Na correção ou incorreção das ações em si, independentemente de suas consequências.",         "Na intenção por trás das ações.",         "Nos sentimentos do agente.",         "No maior bem para o maior número.",       ],       correctAnswer: "Na correção ou incorreção das ações em si, independentemente de suas consequências.",       comment: "Ele explica que a deontologia foca na correção ou incorreção das ações em si, independentemente de suas consequências [12].",       topic: "Princípios da Deontologia: O Dever Moral",     },     {       question: "32. Qual é o princípio fundamental do 'limite ético absoluto' para o médico?",       options: [         "Que o bem comum sempre prevalece.",         "Que a vida humana tem um valor intrínseco e não pode ser usada como um meio para um fim coletivo.",         "Que os resultados positivos justificam os meios.",         "Que a decisão do médico é soberana.",         "Que o custo-benefício deve ser o guia.",       ],       correctAnswer: "Que a vida humana tem um valor intrínseco e não pode ser usada como um meio para um fim coletivo.",       comment: "O médico deve ter um 'limite ético absoluto', que se baseia no princípio de que a vida humana tem um valor intrínseco e não pode ser usada como um meio para um fim coletivo [12, 13].",       topic: "Valor Intrínseco da Vida Humana na Ética Médica",     },     {       question: "33. O que significa a afirmação de que a vida de um ser humano não pode ser instrumentalizada?",       options: [         "Que ela pode ser tratada como ferramenta para obter benefícios para outros.",         "Que ela não pode ser tratada como uma ferramenta para a obtenção de benefícios para outros.",         "Que ela deve ser usada para fins científicos.",         "Que ela deve servir a um propósito maior.",         "Que ela é um recurso limitado.",       ],       correctAnswer: "Que ela não pode ser tratada como uma ferramenta para a obtenção de benefícios para outros.",       comment: "A vida de um ser humano não pode ser instrumentalizada, ou seja, tratada como uma ferramenta para a obtenção de benefícios para outros [13].",       topic: "Instrumentalização do Ser Humano",     },     {       question: "34. Qual visão ética é o fundamento do Direito e da Ética Médica, segundo o Dr. Pedro?",       options: [         "A visão utilitarista.",         "A visão teleológica.",         "A visão consequencialista.",         "A visão deontológica.",         "A visão relativista.",       ],       correctAnswer: "A visão deontológica.",       comment: "O Dr. Pedro reforça que essa visão deontológica é o fundamento do Direito e da Ética Médica [13].",       topic: "Fundamentos Deontológicos do Direito Médico",     },     {       question: "35. Qual problema ético é mencionado pelo professor por levantar questionamentos sobre a legalização de uma prática que contraria a deontologia?",       options: ["O aborto.", "A clonagem humana.", "A eutanásia.", "A manipulação genética.", "A cirurgia plástica."],       correctAnswer: "A eutanásia.",       comment: "O professor também menciona o problema da 'Eutanásia', que levanta questionamentos sobre a legalização de uma prática que contraria a deontologia [13].",       topic: "Debate Ético-Jurídico sobre a Eutanásia",     },     {       question: "36. Qual o perigo da legalização da eutanásia, segundo a aula?",       options: [         "A sobrecarga do sistema de saúde.",         "A abertura de precedentes para o tratamento da vida humana como um bem de menor valor.",         "O aumento da população idosa.",         "A diminuição da qualidade de vida.",         "A violação da autonomia individual.",       ],       correctAnswer: "A abertura de precedentes para o tratamento da vida humana como um bem de menor valor.",       comment: "Ele destaca que, mesmo que se argumente que a vida é um bem disponível, a questão ética persiste, pois uma vez legalizada, a eutanásia poderia abrir precedentes para o tratamento da vida humana como um bem de menor valor [14].",       topic: "Argumentos Contrários à Legalização da Eutanásia",     },     {       question: "37. Quais exemplos históricos são citados para reforçar os perigos de uma ética puramente utilitarista?",       options: [         "As guerras mundiais e a Revolução Industrial.",         "A eugenia e os campos de concentração.",         "A Inquisição e as Cruzadas.",         "O colonialismo e a escravidão.",         "A Revolução Francesa e a Guerra Civil Americana.",       ],       correctAnswer: "A eugenia e os campos de concentração.",       comment: "A aula conclui este período com um retorno à questão da instrumentalização do ser humano, citando exemplos históricos como a eugenia e os campos de concentração, para reforçar os perigos de uma ética puramente utilitarista [14].",       topic: "Perigos Históricos da Ética Utilitarista",     },     {       question: "38. Segundo o Dr. Pedro, o que a negligência pode beirar, além de ser um ato de omissão?",       options: ["A imprudência.", "A imperícia.", "O dolo.", "A inocência.", "A incapacidade."],       correctAnswer: "O dolo.",       comment: "Negligência é um ato de omissão que pode beirar o dolo [6].",       topic: "Distinção entre Culpa Grave e Dolo Eventual",     },     {       question: "39. O exemplo de um médico que realiza um procedimento cirúrgico complexo sem o equipamento adequado ou que, por pressa, não realiza exames essenciais, ilustra qual conceito jurídico?",       options: ["Negligência.", "Imperícia.", "Imprudência.", "Dolo.", "Caso fortuito."],       correctAnswer: "Imprudência.",       comment: "Ele cita como exemplo um médico que realiza um procedimento cirúrgico complexo sem o equipamento adequado ou que, por pressa, não realiza exames essenciais, ilustrando a imprudência [6].",       topic: "Exemplos Práticos de Imprudência Médica",     },     {       question: "40. Qual a importância do 'contexto' no julgamento de uma conduta médica?",       options: [         "Diminui a responsabilidade do médico em todos os casos.",         "Torna o julgamento mais rápido e simples.",         "É fundamental, pois a responsabilidade médica é sempre uma análise de caso a caso.",         "Irrelevante, já que as leis são universais.",         "Apenas serve para justificar erros.",       ],       correctAnswer: "É fundamental, pois a responsabilidade médica é sempre uma análise de caso a caso.",       comment: "O palestrante também discute a importância do 'contexto' no julgamento de uma conduta médica, ressaltando que a responsabilidade médica é sempre uma análise de caso a caso [9, 15].",       topic: "Análise Contextual na Responsabilidade Médica",     },   ];

    function buildQuiz() {
      const output = [];

      questions.forEach((currentQuestion, questionNumber) => {
        const options = [];
        for (let i = 0; i < currentQuestion.options.length; i++) {
          options.push(
            `<label class="option" data-question="${questionNumber}" data-value="${currentQuestion.options[i]}">
              <img src="tesouras.png" class="scissor-icon" onclick="event.stopPropagation(); this.parentNode.classList.toggle('struck-through');">
              ${currentQuestion.options[i]}
            </label>`
          );
        }

        output.push(
          `<div class="card" id="question-${questionNumber}" data-topic="${currentQuestion.topic}">
            <div class="question">${currentQuestion.question}</div>
            <div class="options">${options.join("")}</div>
            <div class="comment" id="comment-${questionNumber}"></div>
          </div>`
        );
      });

      quizContainer.innerHTML = output.join("");
    }

    function showResults() {
      wrongQuestionIndices = [];
      errorCountByTopic = {};
      totalAnsweredQuestionsByTopic = {};
      currentWrongQuestionIndex = -1;
      hasErrors = false;
      isShowingErrors = false;
      isShowingDiagnosis = false;

      errorDiagnosisSection.style.display = 'none';
      topicsToReviewList.innerHTML = '';
      statusMessage.textContent = '';

      // Busca por todas as perguntas: estáticas e dinâmicas
      const allQuestionCards = document.querySelectorAll('.quiz-container .card, #newQuestionsContent .card');
      let correctAnswersCount = 0;
      let totalQuestionsAnswered = 0;

      console.log('🔍 Verificando', allQuestionCards.length, 'perguntas...');

      allQuestionCards.forEach((card, index) => {
        const questionEl = card.querySelector('.question') || card.querySelector('p');
        if (!questionEl) return;

        const questionText = questionEl.textContent.trim();
        const optionsContainer = card.querySelector('.options') || card;
        const allOptions = optionsContainer.querySelectorAll('.option, label.option, label');
        const userAnswerElement = optionsContainer.querySelector('.option.selected, label.selected');
        const commentDiv = card.querySelector('.comment');

        const questionTopic = card.dataset.topic || "Tópico não informado";
        
        console.log(`📝 Pergunta ${index + 1}: Tópico = "${questionTopic}"`);
        console.log(`🔍 Encontradas ${allOptions.length} alternativas`);
        
        // Remove classes anteriores
        allOptions.forEach(option => {
          option.classList.remove('correct', 'incorrect', 'selected');
        });
        if (commentDiv) commentDiv.classList.remove('show');

        let correctAnswerValue = null;
        let questionComment = null;

        // Verifica se é pergunta estática ou dinâmica
        const isStatic = card.id && card.id.startsWith('question-');
        if (isStatic) {
          // Pergunta estática - busca nos dados originais
          const questionData = questions.find(q => q.question.trim() === questionText);
          if (questionData) {
            correctAnswerValue = questionData.correctAnswer.trim();
            questionComment = questionData.comment;
          }
        } else {
          // Pergunta dinâmica - busca pela opção marcada como correta
          const correctOpt = optionsContainer.querySelector('.option[data-answer="true"], label[data-answer="true"]');
          if (correctOpt) {
            correctAnswerValue = correctOpt.dataset.value?.trim() || correctOpt.textContent.trim();
            console.log(`✅ Resposta correta encontrada: "${correctAnswerValue}"`);
          } else {
            console.log('❌ Nenhuma resposta correta encontrada para pergunta dinâmica');
          }
          
          // Busca comentário no próprio card ou no div comment
          const commentElement = card.querySelector('.comment');
          if (commentElement && commentElement.textContent.trim()) {
            questionComment = commentElement.textContent.trim();
          }
        }

        // Processa resposta do usuário e aplica coloração
        let userAnswer = null;
        if (userAnswerElement) {
          userAnswerElement.classList.add('selected');
          userAnswer = userAnswerElement.dataset.value?.trim() || userAnswerElement.textContent.trim();
          totalQuestionsAnswered++;
          totalAnsweredQuestionsByTopic[questionTopic] = (totalAnsweredQuestionsByTopic[questionTopic] || 0) + 1;

          console.log(`👤 Resposta do usuário: "${userAnswer}"`);
          console.log(`🎯 Resposta correta: "${correctAnswerValue}"`);

          // Verifica se a resposta está correta
          if (userAnswer === correctAnswerValue) {
            correctAnswersCount++;
            console.log(`✅ Resposta correta!`);
          } else {
            hasErrors = true;
            errorCountByTopic[questionTopic] = (errorCountByTopic[questionTopic] || 0) + 1;
            console.log(`❌ Resposta incorreta para tópico: ${questionTopic}`);
          }
        }

        // Aplica coloração: SEMPRE marca a correta de verde, e a errada de vermelho se foi marcada
        allOptions.forEach(option => {
          const optionValue = option.dataset.value?.trim() || option.textContent.trim();
          
          // Marca a resposta correta de verde SEMPRE
          if (optionValue === correctAnswerValue) {
            option.classList.add('correct');
            console.log(`🟢 Marcando como correta: "${optionValue}"`);
          }
          
          // Se o usuário marcou uma resposta E ela está errada, marca de vermelho
          if (userAnswer && optionValue === userAnswer && userAnswer !== correctAnswerValue) {
            option.classList.add('incorrect');
            console.log(`🔴 Marcando como incorreta: "${optionValue}"`);
          }
        });

        // Mostra comentário se disponível
        if (commentDiv && questionComment) {
          commentDiv.textContent = questionComment;
          commentDiv.classList.add('show');
        }
      });

      // Exibe resultados
      resultsContainer.textContent = `Você acertou ${correctAnswersCount} de ${totalQuestionsAnswered} questões respondidas.`;

      console.log('📊 Erros por tópico:', errorCountByTopic);
      console.log('📊 Total por tópico:', totalAnsweredQuestionsByTopic);

      // Gera diagnóstico de erros
      if (hasErrors) {
        for (const topic in errorCountByTopic) {
          const errors = errorCountByTopic[topic];
          const total = totalAnsweredQuestionsByTopic[topic] || 0;
          if (total > 0) {
            const percent = ((errors / total) * 100).toFixed(1);
            const li = document.createElement('li');
            li.textContent = `${topic}: ${percent}% de erros (${errors} de ${total} questões respondidas)`;
            topicsToReviewList.appendChild(li);
          }
        }
      } else {
        const li = document.createElement('li');
        li.textContent = "🥳 Parabéns! Você não teve erros nas questões respondidas.";
        topicsToReviewList.appendChild(li);
      }

      errorDiagnosisSection.style.display = 'block';
      generatedQuestionsSection.style.display = 'block';
      generateNewQuestionsBtn.style.display = 'block';
      scrollToDiagnosis();
    }

    function scrollToQuestion(index) {
      const questionCard = document.getElementById(`question-${index}`);
      if (questionCard) {
        questionCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }
    }

    function scrollToDiagnosis() {
        errorDiagnosisSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    function scrollToGeneratedQuestions() {
        generatedQuestionsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    // Event listener para seleção de opções (funciona para estáticas e dinâmicas)
    document.addEventListener("click", function (event) {
      const clickedElement = event.target;
      const optionElement = clickedElement.closest('.option');

      if (optionElement) {
          if (clickedElement.classList.contains("scissor-icon")) {
              event.stopPropagation();
              optionElement.classList.toggle("struck-through");
          }
          else {
              const parentCard = optionElement.closest('.card');
              const currentQuestionOptions = parentCard.querySelectorAll('.option');

              currentQuestionOptions.forEach(opt => opt.classList.remove("selected"));
              optionElement.classList.add("selected");
          }
      }
    });

    generateNewQuestionsBtn.addEventListener("click", async function() {
        statusMessage.textContent = '⏳ Gerando novas perguntas...';
        generateNewQuestionsBtn.disabled = true;

        const topics = Object.keys(errorCountByTopic).filter(topic => {
            const errorsInTopic = errorCountByTopic[topic] || 0;
            const totalAnsweredInTopic = totalAnsweredQuestionsByTopic[topic] || 0;
            return errorsInTopic > 0 && totalAnsweredInTopic > 0;
        });

        const topicsToSend = topics.length > 0 ? topics : ["fisiologia celular", "biologia"];

        try {
            const response = await fetch('https://www.quizia.xyz/quiz', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ topicos: topicsToSend }),
            });

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const data = await response.json();

            newQuestionsContent.innerHTML = '';
            if (data && data.html) {
                console.log('📥 HTML recebido do Flask:', data.html);
                
                // Insere o HTML diretamente sem reconstrução complexa
                newQuestionsContent.innerHTML = data.html.replace(/```html|```/g, '');
                
                // Adiciona tesouras e ajusta formatação apenas se necessário
                newQuestionsContent.querySelectorAll('.card').forEach((card, cardIndex) => {
                    // Garante que o elemento de pergunta tenha a classe correta
                    const questionElement = card.querySelector('p');
                    if (questionElement && !questionElement.classList.contains('question')) {
                       questionElement.classList.add('question');
                    }

                    // Remove qualquer input de radio que possa existir e adiciona tesouras
                    card.querySelectorAll('label').forEach((label) => {
                        // Remove inputs de radio MAS preserva o atributo data-answer
                        const radioInput = label.querySelector('input[type="radio"]');
                        if (radioInput) {
                            // PRESERVA o atributo data-answer do input no label
                            if (radioInput.hasAttribute('data-answer')) {
                                label.setAttribute('data-answer', radioInput.getAttribute('data-answer'));
                            }
                            radioInput.remove();
                        }
                        
                        // Garante que tenha a classe option
                        if (!label.classList.contains('option')) {
                            label.classList.add('option');
                        }

                        // Garante que tenha data-value
                        if (!label.dataset.value) {
                            label.dataset.value = label.textContent.trim();
                        }

                        // Adiciona tesoura se não existir
                        if (!label.querySelector('.scissor-icon')) {
                            const scissorIcon = document.createElement('img');
                            scissorIcon.src = 'tesouras.png';
                            scissorIcon.className = 'scissor-icon';
                            scissorIcon.onclick = function(e) {
                                e.stopPropagation();
                                label.classList.toggle('struck-through');
                            };
                            label.insertBefore(scissorIcon, label.firstChild);
                        }
                    });

                    console.log(`🏷️ Card ${cardIndex}: data-topic = "${card.dataset.topic}"`);
                    
                    // Verifica se há opção correta marcada
                    const correctOption = card.querySelector('label[data-answer="true"]');
                    if (correctOption) {
                        console.log(`✅ Opção correta encontrada: "${correctOption.dataset.value}"`);
                    } else {
                        console.log('❌ Nenhuma opção correta encontrada');
                    }
                });
            } else {
                newQuestionsContent.innerHTML = "<p>Não foi possível gerar novas perguntas para os tópicos selecionados.</p>";
            }
            
            generatedQuestionsSection.style.display = 'block';
            scrollToGeneratedQuestions();
            statusMessage.textContent = '✅ Perguntas geradas com sucesso!';
            setTimeout(() => { statusMessage.textContent = '' }, 3000);

        } catch (error) {
            console.error('Erro ao gerar novas perguntas:', error);
            newQuestionsContent.innerHTML = `<p>Erro ao carregar novas perguntas: ${error.message}. Por favor, tente novamente.</p>`;
            generatedQuestionsSection.style.display = 'block';
            scrollToGeneratedQuestions();
            statusMessage.textContent = '❌ Erro na requisição: ' + error.message;
            setTimeout(() => { statusMessage.textContent = '' }, 5000);
        } finally {
            generateNewQuestionsBtn.disabled = false;
        }
    });

    // Inicialização
    buildQuiz();
    errorDiagnosisSection.style.display = 'none';
    generatedQuestionsSection.style.display = 'none';
    generateNewQuestionsBtn.style.display = 'none';

    // Event listener para o botão de verificar respostas
    document.getElementById("verifyAnswersBtn").addEventListener("click", showResults);
  </script>
</body>
</html>
